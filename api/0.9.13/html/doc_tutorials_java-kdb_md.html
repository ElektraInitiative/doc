<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: How-To: Java kdb</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.9.13</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How-To: Java kdb </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_tutorials_java_kdb"></a> </p>
<h1><a class="anchor" id="autotoc_md4322"></a>
Introduction</h1>
<p>When programming in Java it is possible to access the key database, changing values of existing keys or adding new ones and a few other things. It is also possible to write plugins for Elektra in Java but we will focus on using the Java binding in this tutorial.</p>
<h1><a class="anchor" id="autotoc_md4323"></a>
First Steps</h1>
<p>In order to use <code>kdb</code> you need to include the dependency in your project. Here you can find a detailed tutorial on how to do that.</p>
<p>After that you can start loading a <code>KDB</code> object as follows:</p>
<div class="fragment"><div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open()) {</div>
<div class="line">    <span class="comment">// code to manipulate keys</span></div>
<div class="line">} <span class="keywordflow">catch</span> (KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
<div class="ttc" id="anamespacekdb_html"><div class="ttname"><a href="namespacekdb.html">kdb</a></div><div class="ttdoc">This is the main namespace for the C++ binding and libraries.</div><div class="ttdef"><b>Definition:</b> backend.hpp:31</div></div>
</div><!-- fragment --><p>Note that <code>KDB</code> implements <code>AutoClosable</code> which allows <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html"><code>try-with-resouces</code></a>.</p>
<p>If an error occurs, detailed information can be obtained from the thrown <code>KDBException</code>.</p>
<h1><a class="anchor" id="autotoc_md4324"></a>
A word about releasing native resources</h1>
<p>There are 3 kinds of native resources having to be cleaned up properly to prevent memory leaks: <code>KeySet</code>, <code>Key</code> and <code>KDB</code> or rather their backing native key set, key or KDB session.</p>
<p>Fortunately the only resource you are strictly required to release is <code>KDB</code> via either <code>KDB::close</code> or <code>try-with-resouces</code>. For <code>KeySet</code> and <code>Key</code> the garbage collector cleans them up automatically using a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ref/Cleaner.html"><code>Cleaner</code></a> In situations where memory is very constrained, it might be a good idea to clean up these native resources as soon as they are no longer needed, since we do not have any control of when or if the garbage collector cleans up after us. For this use-case, the following functions are provided: <code>KeySet::release</code>, <code>Key::release</code> and <code>KDBException::releaseErrorKey</code>`.</p>
<h1><a class="anchor" id="autotoc_md4325"></a>
Fetching keys</h1>
<p>First let's retrieve a key which is already part of the key database. The first thing we need to do is to create a <code>KeySet</code> your keys are going to be stored in:</p>
<div class="fragment"><div class="line">var keySet = KeySet.create();</div>
</div><!-- fragment --><p>Now we load all keys located below a specific parent key:</p>
<div class="fragment"><div class="line">var parentKey = Key.create(<span class="stringliteral">&quot;user:/&quot;</span>);</div>
<div class="line"><a class="code" href="namespacekdb.html">kdb</a>.get(keySet, parentKey);</div>
</div><!-- fragment --><p>Note on <code>KDB::get</code>: The resulting key set may contain more keys than requested.</p>
<p>Now we can simply fetch the desired key's value as follows:</p>
<div class="fragment"><div class="line">String value = keySet.lookup(<span class="stringliteral">&quot;user:/my/presaved/key&quot;</span>).map(Key::getString).orElseThrow();</div>
</div><!-- fragment --><p>So for example if you had executed the command below via shell, before starting the application:</p>
<div class="fragment"><div class="line">kdb set user:/my/presaved/key it_works!</div>
</div><!-- fragment --><p><code>value</code> would equals <code>it_works!</code>.</p>
<p>Afterwards, we may clean-up no longer needed native resources:</p>
<div class="fragment"><div class="line">parentKey.release();</div>
<div class="line">keySet.release();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4326"></a>
Saving Keys</h1>
<p>Next let's save a new key to the key database. Again, first we need to create an empty <code>KeySet</code>. We also <b>need to fetch</b> all keys for the namespace before we will be able to save a new key.</p>
<div class="fragment"><div class="line">var keyNamespace = Key.create(<span class="stringliteral">&quot;user:/&quot;</span>);                 <span class="comment">// create key representing the namespace to fetch</span></div>
<div class="line">var keySet = <a class="code" href="namespacekdb.html">kdb</a>.get(keyNamespace);                      <span class="comment">// fetch all keys for the namespace into a new key set</span></div>
<div class="line">var keyToStore = Key.create(<span class="stringliteral">&quot;user:/somekey&quot;</span>, <span class="stringliteral">&quot;myValue&quot;</span>); <span class="comment">// create key with value to store</span></div>
<div class="line">keySet.append(keyToStore);</div>
<div class="line"><a class="code" href="namespacekdb.html">kdb</a>.set(keySet, keyToStore);</div>
</div><!-- fragment --><p>If you try to save a key without fetching it beforehand, a <code>KDBException</code> will be thrown, telling you to call get before set.</p>
<p>The <em>user</em> namespace is accessible without special rights, but if you try to write to <em>system</em> you will need to have root privileges. Take a look at <a class="el" href="doc_TESTING_md.html">TESTING.md</a> to see how to access the system namespace as non-root user. This should only be done in testing environments though as it is not intended for productive systems.</p>
<h1><a class="anchor" id="autotoc_md4327"></a>
Examples</h1>
<h2><a class="anchor" id="autotoc_md4328"></a>
Traversing Keys in a &lt;tt&gt;KeySet&lt;/tt&gt;</h2>
<p>First we create a new <code>KDB</code> handle and fetch all keys for the desired namespace, in this example the whole <code>user</code> namespace. Since all keys are put in the passed <code>keySet</code> variable we can then iterate through it. The <code>at(int)</code> method returns a new <code>Key</code> object for the native key with the corresponding position within the <code>keySet</code>.</p>
<div class="fragment"><div class="line">var keyNamespace = Key.create(<span class="stringliteral">&quot;user:/&quot;</span>);           <span class="comment">// select a namespace from which all keys should be fetched</span></div>
<div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open()) {</div>
<div class="line">    var keySet = <a class="code" href="namespacekdb.html">kdb</a>.get(keyNamespace);            <span class="comment">// fetch all keys into a new key set</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; keySet.length(); i++) {    <span class="comment">// traverse the set</span></div>
<div class="line">        var currentKey = keySet.at(i);</div>
<div class="line">        System.out.println(String.format(<span class="stringliteral">&quot;%s: %s&quot;</span>,</div>
<div class="line">                currentKey.getName(),              <span class="comment">// fetch the key&#39;s name</span></div>
<div class="line">                currentKey.getString()));          <span class="comment">// fetch the key&#39;s value</span></div>
<div class="line">    }</div>
<div class="line">} <span class="keywordflow">catch</span> (KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>KeySet</code> also provides an iterator implementation:</p>
<div class="fragment"><div class="line">var keyNamespace = Key.create(<span class="stringliteral">&quot;user:/&quot;</span>);           <span class="comment">// select a namespace from which all keys should be fetched</span></div>
<div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open()) {</div>
<div class="line">    var iter = <a class="code" href="namespacekdb.html">kdb</a>.get(keyNamespace).iterator();   <span class="comment">// fetch all keys into a new key set</span></div>
<div class="line">    <span class="keywordflow">while</span>(iter.hasNext()) {                        <span class="comment">// traverse the set</span></div>
<div class="line">        var currentKey = iter.next();</div>
<div class="line">        System.out.println(String.format(<span class="stringliteral">&quot;%s: %s&quot;</span>,</div>
<div class="line">                currentKey.getName(),              <span class="comment">// fetch the key&#39;s name</span></div>
<div class="line">                currentKey.getString()));          <span class="comment">// fetch the key&#39;s value</span></div>
<div class="line">    }</div>
<div class="line">} <span class="keywordflow">catch</span> (KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Of course, alternatively a for each loop can be used:</p>
<div class="fragment"><div class="line">var keyNamespace = Key.create(<span class="stringliteral">&quot;user:/&quot;</span>);           <span class="comment">// select a namespace from which all keys should be fetched</span></div>
<div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open()) {</div>
<div class="line">    var keySet = <a class="code" href="namespacekdb.html">kdb</a>.get(keyNamespace);            <span class="comment">// fetch all keys into a new key set</span></div>
<div class="line">    <span class="keywordflow">for</span> (var currentKey : keySet) {                <span class="comment">// traverse the set</span></div>
<div class="line">        System.out.println(String.format(<span class="stringliteral">&quot;%s: %s&quot;</span>,</div>
<div class="line">                currentKey.getName(),              <span class="comment">// fetch the key&#39;s name</span></div>
<div class="line">                currentKey.getString()));          <span class="comment">// fetch the key&#39;s value</span></div>
<div class="line">    }</div>
<div class="line">} <span class="keywordflow">catch</span> (KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Another way to traverse is to use the Stream API which was introduced with Java 8:</p>
<div class="fragment"><div class="line">var keyNamespace = Key.create(<span class="stringliteral">&quot;user:/&quot;</span>);           <span class="comment">// select a namespace from which all keys should be fetched</span></div>
<div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open()) {</div>
<div class="line">    var keySet = <a class="code" href="namespacekdb.html">kdb</a>.get(keyNamespace);            <span class="comment">// fetch all keys into a new key set</span></div>
<div class="line">    keySet.forEach(key -&gt; System.out.printf(<span class="stringliteral">&quot;%s: %s%n&quot;</span>, key.getName(), key.getString()));                              <span class="comment">// directly format-print all key value pairs using foreach</span></div>
<div class="line">    <span class="comment">// or</span></div>
<div class="line">    keySet.stream().map(key -&gt; String.format(<span class="stringliteral">&quot;%s: %s&quot;</span>, key.getName(), key.getString())).forEach(System.out::println);  <span class="comment">// map the key value paris to the desired format first and then print them using foreach and a function reference</span></div>
<div class="line">} <span class="keywordflow">catch</span> (KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><p>As the <code>KeySet</code> implements the <code>SortedSet&lt;Key&gt;</code> interface, all its methods can be used for (not only) a traversal:</p>
<div class="fragment"><div class="line">var keyNamespace = Key.create(<span class="stringliteral">&quot;user:/&quot;</span>);           <span class="comment">// select a namespace from which all keys should be fetched</span></div>
<div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open()) {</div>
<div class="line">    var keySet = <a class="code" href="namespacekdb.html">kdb</a>.get(keyNamespace);            <span class="comment">// fetch all keys into a new key set</span></div>
<div class="line">    keySet.subSet(Key.create(<span class="stringliteral">&quot;user:/b&quot;</span>), Key.create(<span class="stringliteral">&quot;user:/k&quot;</span>))                                  <span class="comment">// only select the keys starting with &quot;user:/a&quot; through &quot;user:/k&quot; (excluded).</span></div>
<div class="line">        .forEach(key -&gt; System.out.printf(<span class="stringliteral">&quot;%s: %s%n&quot;</span>, key.getName(), key.getString()));          <span class="comment">// directly format-print all key value pairs using foreach</span></div>
<div class="line">} <span class="keywordflow">catch</span> (KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Another way to traverse is to use the Stream API which was introduced with Java 8:</p>
<div class="fragment"><div class="line">var keyNamespace = Key.create(<span class="stringliteral">&quot;user:/&quot;</span>);           <span class="comment">// select a namespace from which all keys should be fetched</span></div>
<div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open()) {</div>
<div class="line">    var keySet = <a class="code" href="namespacekdb.html">kdb</a>.get(keyNamespace);            <span class="comment">// fetch all keys into a new key set</span></div>
<div class="line">    keySet.forEach(key -&gt; System.out.printf(<span class="stringliteral">&quot;%s: %s%n&quot;</span>, key.getName(), key.getString()));                              <span class="comment">// directly format-print all key value pairs using foreach</span></div>
<div class="line">    <span class="comment">// or</span></div>
<div class="line">    keySet.stream().map(key -&gt; String.format(<span class="stringliteral">&quot;%s: %s&quot;</span>, key.getName(), key.getString())).forEach(System.out::println);  <span class="comment">// map the key value paris to the desired format first and then print them using foreach and a function reference</span></div>
<div class="line">} <span class="keywordflow">catch</span> (KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4329"></a>
Read Multiple Keys From KDB</h2>
<p>This example shows how to read multiple keys. It provides comments for further clarification. Further information can be found here.</p>
<h1><a class="anchor" id="autotoc_md4330"></a>
Java Plugin Tutorial</h1>
<p>For the tutorial on how to write java plugins, please check out <a class="el" href="doc_tutorials_java-plugins_md.html">this</a> page. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

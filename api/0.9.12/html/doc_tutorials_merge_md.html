<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: How-To: kdb merge</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.9.12</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How-To: kdb merge </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_tutorials_merge"></a> </p>
<h1><a class="anchor" id="autotoc_md4330"></a>
Introduction</h1>
<p>The kdb tool allows users to access and perform functions on the Elektra Key Database from the command line. We added a new command to this very useful tool, the <code>merge</code> command. This command allows a user to perform a three-way merge of KeySets from the <code>kdb</code> tool.</p>
<p>The command to use this tool is:</p>
<div class="fragment"><div class="line">kdb merge [options] ourpath theirpath basepath resultpath</div>
<div class="line"># RET: 7</div>
</div><!-- fragment --><p>The standard naming scheme for a three-way merge consists of <code>ours</code>, <code>theirs</code>, and <code>base</code>:</p>
<ul>
<li><code>ours</code> refers to the local copy of a file</li>
<li><code>theirs</code> refers to a remote copy</li>
<li><code>base</code> refers to their common ancestor.</li>
</ul>
<p>This works very similarly for KeySets, especially ones that consist of mounted configuration files.</p>
<p>For mounted configuration files:</p>
<ul>
<li><code>ours</code> should be the user's copy</li>
<li><code>theirs</code> would be the maintainers copy,</li>
<li><code>base</code> would be the previous version of the maintainer's copy.</li>
</ul>
<p>If the user is just trying to accomplish a three-way merge using any two arbitrary keysets that share a base, it doesn't matter which ones are defined as <code>ours</code> or <code>theirs</code> as long as they use the correct base KeySet. In <code>kdb merge</code>, <code>ourpath</code>, <code>theirpath</code>, and <code>basepath</code> work just like <code>ours</code>, <code>theirs</code>, and <code>base</code> except each one represents the root of a KeySet. The argument <code>resultpath</code> is pretty self-explanatory, it is just where you want the result of the merge to be saved under. It's worth noting, <code>resultpath</code> should be empty before attempting a merge, otherwise there can be unintended consequences.</p>
<h1><a class="anchor" id="autotoc_md4331"></a>
Options</h1>
<p>As for the options, there are two basic options:</p>
<ul>
<li><code>-i</code>, <code>--interactive</code>: which attempts the merge in an interactive way</li>
<li><code>-f</code>, <code>--force</code>: which overwrites any Keys in <code>resultpath</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md4332"></a>
Strategies</h2>
<p>Additionally, there is an option to specify a merge strategy, which is very important.</p>
<p>The option for strategy is:</p>
<ul>
<li><code>-s &lt;name&gt;</code>, <code>--strategy &lt;name&gt;</code>: which is used to specify a strategy to use in case of a conflict</li>
</ul>
<p>The current list of strategies are:</p>
<ul>
<li><code>preserve</code>: the merge will fail if a conflict is detected</li>
<li><code>ours</code>: the merge will use our version during a conflict</li>
<li><code>theirs</code>: the merge will use their version during a conflict</li>
<li><code>cut</code>: Removes existing keys below the resultpath and replaces them with the merged keyset.</li>
<li><code>import</code>: (DEPRECATED, avoid using it!) Preserves existing keys in the resultpath if they do not exist in the merged keyset. If the key does exist in the merged keyset, it will be overwritten.</li>
</ul>
<p>If no strategy is specified, the merge will default to the preserve strategy as to not risk making the wrong decision. If any of the other strategies are specified, when a conflict is detected, merge will use the Key specified by the strategy (<code>ours</code>, <code>theirs</code>, <code>cut</code> or <code>import</code>) for the resulting Key.</p>
<h1><a class="anchor" id="autotoc_md4333"></a>
Basic Example</h1>
<p>Basic Usage:</p>
<div class="fragment"><div class="line">kdb merge system:/hosts/ours system:/hosts/theirs system:/hosts/base system:/hosts/result</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4334"></a>
Examples Using Strategies</h1>
<p>Here are examples of the same KeySets being merged using different strategies. The KeySets are mounted using a property format, the left side of '=' is the name of the Key, the right side is its string value.</p>
<p>We start with the base KeySet, <code>system:/base</code>:</p>
<div class="fragment"><div class="line">key1=1</div>
<div class="line">key2=2</div>
<div class="line">key3=3</div>
<div class="line">key4=4</div>
<div class="line">key5=5</div>
</div><!-- fragment --><p>Here is our KeySet, <code>system:/ours</code>:</p>
<div class="fragment"><div class="line">key1=apple</div>
<div class="line">key2=2</div>
<div class="line">key3=3</div>
<div class="line">key5=fish</div>
</div><!-- fragment --><p>Here is their KeySet, <code>system:/theirs</code>:</p>
<div class="fragment"><div class="line">key1=1</div>
<div class="line">key2=pie</div>
<div class="line">key4=banana</div>
<div class="line">key5=5</div>
</div><!-- fragment --><p>To add the keys to the key database, execute the following commands:</p>
<div class="fragment"><div class="line">kdb set user:/tests/base/key1 1</div>
<div class="line">#&gt; Create a new key user:/tests/base/key1 with string &quot;1&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/base/key2 2</div>
<div class="line">#&gt; Create a new key user:/tests/base/key2 with string &quot;2&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/base/key3 3</div>
<div class="line">#&gt; Create a new key user:/tests/base/key3 with string &quot;3&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/base/key4 4</div>
<div class="line">#&gt; Create a new key user:/tests/base/key4 with string &quot;4&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/base/key5 5</div>
<div class="line">#&gt; Create a new key user:/tests/base/key5 with string &quot;5&quot;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/ours/key1 apple</div>
<div class="line">#&gt; Create a new key user:/tests/ours/key1 with string &quot;apple&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/ours/key2 2</div>
<div class="line">#&gt; Create a new key user:/tests/ours/key2 with string &quot;2&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/ours/key3 3</div>
<div class="line">#&gt; Create a new key user:/tests/ours/key3 with string &quot;3&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/ours/key5 fish</div>
<div class="line">#&gt; Create a new key user:/tests/ours/key5 with string &quot;fish&quot;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/theirs/key1 1</div>
<div class="line">#&gt; Create a new key user:/tests/theirs/key1 with string &quot;1&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/theirs/key2 pie</div>
<div class="line">#&gt; Create a new key user:/tests/theirs/key2 with string &quot;pie&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/theirs/key4 banana</div>
<div class="line">#&gt; Create a new key user:/tests/theirs/key4 with string &quot;banana&quot;</div>
<div class="line"> </div>
<div class="line">kdb set user:/tests/theirs/key5 5</div>
<div class="line">#&gt; Create a new key user:/tests/theirs/key5 with string &quot;5&quot;</div>
</div><!-- fragment --><p>Now we will examine the result KeySet with the different strategies.</p>
<h2><a class="anchor" id="autotoc_md4335"></a>
Preserve</h2>
<div class="fragment"><div class="line">kdb merge -s preserve user:/tests/ours user:/tests/theirs user:/tests/base user:/tests/result</div>
<div class="line"># RET: 255</div>
<div class="line"># STDERR: 1 conflicts were detected that could not be resolved automatically:⏎user:/tests/result/key4⏎ours: CONFLICT_DELETE, theirs: CONFLICT_MODIFY⏎⏎Merge unsuccessful.</div>
</div><!-- fragment --><p>The merge will fail because of a conflict for <code>key4</code> since <code>key4</code> was deleted in our KeySet and edited in their KeySet. Since we used preserve, the merge fails and the result KeySet is not saved.</p>
<h2><a class="anchor" id="autotoc_md4336"></a>
Ours</h2>
<div class="fragment"><div class="line">kdb merge -s ours user:/tests/ours user:/tests/theirs user:/tests/base user:/tests/result</div>
</div><!-- fragment --><p>The result KeySet, <code>user:/tests/result</code> will be:</p>
<div class="fragment"><div class="line">kdb ls user:/tests/result</div>
<div class="line">#&gt; user:/tests/result/key1</div>
<div class="line">#&gt; user:/tests/result/key2</div>
<div class="line">#&gt; user:/tests/result/key5</div>
</div><!-- fragment --><p>The values of the keys are:</p>
<div class="fragment"><div class="line">kdb get user:/tests/result/key1</div>
<div class="line">#&gt; apple</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/result/key2</div>
<div class="line">#&gt; pie</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/result/key5</div>
<div class="line">#&gt; fish</div>
</div><!-- fragment --><p>The conflict of <code>key4</code> (it was deleted in <code>ours</code> but changed in <code>theirs</code>) is solved by using our copy, thus deleting the key.</p>
<p>Now we delete the result keys and try the next merging strategy.</p>
<div class="fragment"><div class="line">kdb rm user:/tests/result/key1</div>
<div class="line">kdb rm user:/tests/result/key2</div>
<div class="line">kdb rm user:/tests/result/key5</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4337"></a>
Theirs</h2>
<div class="fragment"><div class="line">kdb merge -s theirs user:/tests/ours user:/tests/theirs user:/tests/base user:/tests/result</div>
</div><!-- fragment --><p>The result KeySet, <code>user:/tests/result</code> will be:</p>
<div class="fragment"><div class="line">kdb ls user:/tests/result</div>
<div class="line">#&gt; user:/tests/result/key1</div>
<div class="line">#&gt; user:/tests/result/key2</div>
<div class="line">#&gt; user:/tests/result/key4</div>
<div class="line">#&gt; user:/tests/result/key5</div>
</div><!-- fragment --><p>The values of the keys are:</p>
<div class="fragment"><div class="line">kdb get user:/tests/result/key1</div>
<div class="line">#&gt; apple</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/result/key2</div>
<div class="line">#&gt; pie</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/result/key4</div>
<div class="line">#&gt; banana</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/result/key5</div>
<div class="line">#&gt; fish</div>
</div><!-- fragment --><p>Here, the conflict of <code>key4</code> is solved by using their copy, thus <code>key4=banana</code>.</p>
<p>We delete the result keys again and finally try the <code>cut</code> merging strategy.</p>
<div class="fragment"><div class="line">kdb rm user:/tests/result/key1</div>
<div class="line">kdb rm user:/tests/result/key2</div>
<div class="line">kdb rm user:/tests/result/key4</div>
<div class="line">kdb rm user:/tests/result/key5</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4338"></a>
Cut</h2>
<div class="fragment"><div class="line">kdb merge -s cut user:/tests/ours user:/tests/theirs user:/tests/base user:/tests/result</div>
</div><!-- fragment --><p>The result KeySet, <code>user:/tests/result</code> will be:</p>
<div class="fragment"><div class="line">kdb ls user:/tests/result</div>
<div class="line">#&gt; user:/tests/result/key1</div>
<div class="line">#&gt; user:/tests/result/key2</div>
<div class="line">#&gt; user:/tests/result/key4</div>
<div class="line">#&gt; user:/tests/result/key5</div>
</div><!-- fragment --><p>The values of the keys are:</p>
<div class="fragment"><div class="line">kdb get user:/tests/result/key1</div>
<div class="line">#&gt; 1</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/result/key2</div>
<div class="line">#&gt; pie</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/result/key4</div>
<div class="line">#&gt; banana</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/result/key5</div>
<div class="line">#&gt; 5</div>
</div><!-- fragment --><p>Here the state of theirs is simply copied to the <code>resultpath</code>.</p>
<h1><a class="anchor" id="autotoc_md4339"></a>
SEE ALSO</h1>
<ul>
<li><a class="el" href="doc_help_kdb-merge_md.html">kdb-merge(1)</a></li>
<li><a class="el" href="doc_help_elektra-merge-strategy_md.html">elektra-merge-strategy(7)</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

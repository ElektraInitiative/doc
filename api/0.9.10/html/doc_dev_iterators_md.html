<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Migrating from internal to external KeySet iterators</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Migrating from internal to external KeySet iterators </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_dev_iterators"></a> The deprecated internal iterator are removed and replaced with external iteration.</p>
<h1><a class="anchor" id="autotoc_md2294"></a>
Interactions with users</h1>
<p>Developers of plugins should already use the external iterators instead of the internal ones. However, following functions will be removed:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__keyset.html#gabe793ff51f1728e3429c84a8a9086b70">ksRewind</a> (KeySet *ks);</div>
<div class="line">Key *<a class="code" href="group__keyset.html#ga317321c9065b5a4b3e33fe1c399bcec9">ksNext</a> (KeySet *ks);</div>
<div class="line">Key *<a class="code" href="group__keyset.html#ga4287b9416912c5f2ab9c195cb74fb094">ksCurrent</a> (<span class="keyword">const</span> KeySet *ks);</div>
<div class="line"> </div>
<div class="line">elektraCursor <a class="code" href="group__keyset.html#gace0444eb8ec958a429794f8586fc72e7">ksGetCursor</a> (<span class="keyword">const</span> KeySet *ks);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__keyset.html#ga28b2a7d13c620b3c9d4815a0608c738f">ksSetCursor</a> (KeySet *ks, elektraCursor cursor);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> keyRewindMeta (Key *key);</div>
<div class="line"><span class="keyword">const</span> Key *<a class="code" href="group__keymeta.html#ga4c88342f580a4291455a801af71ce048">keyNextMeta</a> (Key *key);</div>
<div class="line"><span class="keyword">const</span> Key *keyCurrentMeta (<span class="keyword">const</span> Key *key);</div>
<div class="ttc" id="agroup__keymeta_html_ga4c88342f580a4291455a801af71ce048"><div class="ttname"><a href="group__keymeta.html#ga4c88342f580a4291455a801af71ce048">keyNextMeta</a></div><div class="ttdeci">const Key * keyNextMeta(Key *key)</div><div class="ttdoc">Get the next metadata entry of a Key.</div><div class="ttdef"><b>Definition:</b> keymeta.c:154</div></div>
<div class="ttc" id="agroup__keyset_html_ga28b2a7d13c620b3c9d4815a0608c738f"><div class="ttname"><a href="group__keyset.html#ga28b2a7d13c620b3c9d4815a0608c738f">ksSetCursor</a></div><div class="ttdeci">int ksSetCursor(KeySet *ks, elektraCursor cursor)</div><div class="ttdoc">Set the KeySet internal cursor to cursor.</div><div class="ttdef"><b>Definition:</b> keyset.c:1783</div></div>
<div class="ttc" id="agroup__keyset_html_ga317321c9065b5a4b3e33fe1c399bcec9"><div class="ttname"><a href="group__keyset.html#ga317321c9065b5a4b3e33fe1c399bcec9">ksNext</a></div><div class="ttdeci">Key * ksNext(KeySet *ks)</div><div class="ttdoc">Returns the next Key in a KeySet.</div><div class="ttdef"><b>Definition:</b> keyset.c:1590</div></div>
<div class="ttc" id="agroup__keyset_html_ga4287b9416912c5f2ab9c195cb74fb094"><div class="ttname"><a href="group__keyset.html#ga4287b9416912c5f2ab9c195cb74fb094">ksCurrent</a></div><div class="ttdeci">Key * ksCurrent(const KeySet *ks)</div><div class="ttdoc">Return the current Key.</div><div class="ttdef"><b>Definition:</b> keyset.c:1623</div></div>
<div class="ttc" id="agroup__keyset_html_gabe793ff51f1728e3429c84a8a9086b70"><div class="ttname"><a href="group__keyset.html#gabe793ff51f1728e3429c84a8a9086b70">ksRewind</a></div><div class="ttdeci">int ksRewind(KeySet *ks)</div><div class="ttdoc">Rewinds the KeySet internal cursor.</div><div class="ttdef"><b>Definition:</b> keyset.c:1552</div></div>
<div class="ttc" id="agroup__keyset_html_gace0444eb8ec958a429794f8586fc72e7"><div class="ttname"><a href="group__keyset.html#gace0444eb8ec958a429794f8586fc72e7">ksGetCursor</a></div><div class="ttdeci">elektraCursor ksGetCursor(const KeySet *ks)</div><div class="ttdoc">Get the internal cursor of the KeySet.</div><div class="ttdef"><b>Definition:</b> keyset.c:1714</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2295"></a>
The Architecture</h1>
<p>Every occurence of using the internal iterator has to be replaced with the external iterator (see #4281). The functions of the internal iterator are listed in #3171. There are also some uses of the internal iterator found in the SWIG bindings (Lua, Ruby, Python) that also need removal (see #4279).</p>
<h2><a class="anchor" id="autotoc_md2296"></a>
Internal vs. external Iterators</h2>
<p>When the client (i.e. the programmer) controls the iteration, the iterator is called external iterator. Otherwise, when the iterator controls the iteration, it is called internal iterator. Due to the fact that external iterators are more flexible the internal iterators are the way to go.</p>
<h1><a class="anchor" id="autotoc_md2297"></a>
Examples</h1>
<p>An example for using an external iterator is:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (elektraCursor it = 0; it &lt; <a class="code" href="group__keyset.html#ga7474ad6b0a0fa969dbdf267ba5770eee">ksGetSize</a> (ks); ++it)</div>
<div class="line">{</div>
<div class="line">    Key * cur = <a class="code" href="group__keyset.html#gab3fb5e067c672d9fd60a4022b2ae9dd1">ksAtCursor</a> (ks, it);</div>
<div class="line">    <span class="comment">// [loop body]</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__keyset_html_ga7474ad6b0a0fa969dbdf267ba5770eee"><div class="ttname"><a href="group__keyset.html#ga7474ad6b0a0fa969dbdf267ba5770eee">ksGetSize</a></div><div class="ttdeci">ssize_t ksGetSize(const KeySet *ks)</div><div class="ttdoc">Return the number of Keys that ks contains.</div><div class="ttdef"><b>Definition:</b> keyset.c:718</div></div>
<div class="ttc" id="agroup__keyset_html_gab3fb5e067c672d9fd60a4022b2ae9dd1"><div class="ttname"><a href="group__keyset.html#gab3fb5e067c672d9fd60a4022b2ae9dd1">ksAtCursor</a></div><div class="ttdeci">Key * ksAtCursor(const KeySet *ks, elektraCursor pos)</div><div class="ttdoc">Return Key at given position pos.</div><div class="ttdef"><b>Definition:</b> keyset.c:1738</div></div>
</div><!-- fragment --><p>You can obtain the <code>Key</code> at a specific position in the <code>KeySet</code> and the overall size of the <code>KeySet</code>.</p>
<p>If you want to delete <code>Key</code>s during the iteration of a <code>KeySet</code>, be aware that all keys after the deleted <code>Key</code> are moved one slot forward, so maybe you have to change to value of <code>it</code> after deleting a <code>Key</code>:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (elektraCursor it = 0; it &lt; <a class="code" href="group__keyset.html#ga7474ad6b0a0fa969dbdf267ba5770eee">ksGetSize</a> (ks); ++it)</div>
<div class="line">{</div>
<div class="line">    Key * cur = <a class="code" href="group__keyset.html#gab3fb5e067c672d9fd60a4022b2ae9dd1">ksAtCursor</a> (ks, it);</div>
<div class="line">    <span class="keywordflow">if</span> ( shouldKeyGetDeleted (cur))</div>
<div class="line">    {</div>
<div class="line">            <a class="code" href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a> (cur);</div>
<div class="line">            --it; <span class="comment">//next key is now at the position of the current key which was deleted</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__key_html_ga3df95bbc2494e3e6703ece5639be5bb1"><div class="ttname"><a href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a></div><div class="ttdeci">int keyDel(Key *key)</div><div class="ttdoc">A destructor for Key objects.</div><div class="ttdef"><b>Definition:</b> key.c:482</div></div>
</div><!-- fragment --><p>For such scenarios, it is also important that you recalculate the size with <code>ksGetSize ()</code> within the loop-header or explicitely after changing the <code>KeySet</code>, e.g. by deleting a <code>Key</code>.</p>
<p>That should be all you need for iterating over keys. For future releases, the function <code>ksAtCursor</code> will be renamed to <code>ksAt</code>. (see issue #3976)</p>
<p>You can iterate over metakeys in a similar fashion as long as you iterate over a <code>KeySet</code>, e.g., <code>keyMeta("my_key")</code> returns a <code>KeySet</code> of metakeys.</p>
<p>The following is a comprehension of how to use iterators in various languages.</p>
<h3><a class="anchor" id="autotoc_md2298"></a>
C</h3>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (elektraCursor it = 0; it &lt; <a class="code" href="group__keyset.html#ga7474ad6b0a0fa969dbdf267ba5770eee">ksGetSize</a> (ks); ++it)</div>
<div class="line">{</div>
<div class="line">    Key * cur = <a class="code" href="group__keyset.html#gab3fb5e067c672d9fd60a4022b2ae9dd1">ksAtCursor</a> (ks, it);</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2299"></a>
C++</h3>
<p>C-style fashioned loop:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (elektraCursor it = 0; it &lt; ks.size (); ++it)</div>
<div class="line">{</div>
<div class="line">        Key key = ks.at(it);</div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Real iterators the C++ interface supports:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (KeySet::iterator i = ks3.begin(); i != ks3.end(); ++i)</div>
<div class="line">{</div>
<div class="line">        Key key(*i);</div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2300"></a>
Python</h3>
<div class="fragment"><div class="line">size = ksSize(keySet)</div>
<div class="line">for cursor in range(size):</div>
<div class="line">        key = ksAt(keySet, cursor)</div>
<div class="line">        # ...</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2301"></a>
Lua</h3>
<div class="fragment"><div class="line">size = kdb.ksSize(keySet);</div>
<div class="line">if size &gt; 0 then</div>
<div class="line">        for i = 1, size do</div>
<div class="line">                key = kdb.ksAt(keySet, i - 1)</div>
<div class="line">                -- ...</div>
<div class="line">        end</div>
<div class="line">end</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2302"></a>
Ruby</h3>
<div class="fragment"><div class="line">keySet.each do |key|</div>
<div class="line">        # ...</div>
<div class="line">end</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

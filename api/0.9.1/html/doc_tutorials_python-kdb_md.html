<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: How-To: Python kdb</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How-To: Python kdb </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>When programming in Python it is possible to access the kdb database, changing values of existing keys, adding and deleting keys and a few other things.</p>
<p>Either <a href="https://www.libelektra.org/bindings/swig_python">build</a> the package or install from a repository.</p>
<p>The <a href="https://pkgs.alpinelinux.org/packages?name=py3-elektra&amp;branch=edge&amp;repo=testing">python bindings package</a> is only available in the testing repository (as of 2019-04-29).</p>
<div class="fragment"><div class="line">docker run -it alpine:edge /bin/sh</div><div class="line">echo &quot;http://dl-cdn.alpinelinux.org/alpine/edge/testing&quot; &gt;&gt; /etc/apk/repositories</div><div class="line"># Install elektra and the python bindings</div><div class="line">apk update &amp;&amp; apk add elektra elektra-python py3-elektra</div></div><!-- fragment --><p>Under regular alpine, you have to install python3 from the edge repository. If you do not want to add the edge repositories permanently like above, you can do</p>
<div class="fragment"><div class="line">apk add --repository &quot;http://dl-cdn.alpinelinux.org/alpine/edge/main&quot; python3</div><div class="line">apk add --repository &quot;http://dl-cdn.alpinelinux.org/alpine/edge/testing&quot; elektra elektra-python py3-elektra</div></div><!-- fragment --><p>In order to being able to use <code>kdb</code>, you at first need to <code>import kdb</code>. You need access to a Python object of <code>KDB</code>. This is accomplished by calling <code><a class="el" href="classkdb_1_1KDB.html" title="Constructs a class KDB.">kdb.KDB()</a></code> and saving this to a variable because later on this object will be needed for various operations. The easiest way to do this would be:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    print(<span class="stringliteral">&quot;Hello world! I have a kdb-instance! :D&quot;</span>)</div><div class="line">    <span class="comment"># do all kinds of operations explained below</span></div></div><!-- fragment --><p>A keyset is basically a list of the keys that lie within the specified range of the database. When creating an empty keyset this range is obviously zero. It is possible to load the whole database into a keyset but in a lot of cases this is not needed and you can specify which keys exactly you need (which I mean with specified range). At first it is necessary to create a new keyset. When simply calling <code><a class="el" href="classkdb_1_1KeySet.html" title="A keyset holds together a set of keys.">kdb.KeySet()</a></code> the keyset is of size 0. There is no restriction to the keyset's size. It is possible to specify a certain (maximum) size for a keyset. To load keys into to keyset from the database you simply call the method <code>get</code> provided by the kdb-object.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    <span class="comment"># create empty keyset</span></div><div class="line">    ks = <a class="code" href="classkdb_1_1KeySet.html">kdb.KeySet</a>()</div><div class="line">    print(len(ks))  <span class="comment"># should be 0</span></div><div class="line">    <span class="comment"># load an existing keyset</span></div><div class="line">    k.get(ks, <span class="stringliteral">&#39;user&#39;</span>)</div></div><!-- fragment --><p>It is also possible to iterate as expected over a keyset and use <code>len</code>, <code>reversed</code> and copying. The elements of a keyset can be accessed by indexes and a keyset can be sliced. Another way of accessing a key is by the key name (&lsquo;keyset_name[&rsquo;/path/to/keys/key_name']<code>). If a key with the given name does not exist within the keyset, a</code>KeyError` exception is thrown.</p>
<p>An example that shows how to load an existing keyset and then access every key and value of the loaded keyset:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    ks = <a class="code" href="classkdb_1_1KeySet.html">kdb.KeySet</a>()</div><div class="line">    <span class="comment"># load an existing keyset</span></div><div class="line">    k.get(ks, <span class="stringliteral">&#39;user&#39;</span>)</div><div class="line">    <span class="comment"># if you for some reason want to loop through the keyset last key first</span></div><div class="line">    <span class="comment"># use: for key in reversed(ks):</span></div><div class="line">    <span class="keywordflow">for</span> key <span class="keywordflow">in</span> ks:</div><div class="line">        <span class="comment"># print for every key in the keyset the key and the value</span></div><div class="line">        print(<span class="stringliteral">&quot;key: {} value: {}&quot;</span>.format(key, key.value))</div></div><!-- fragment --><p>Here an example of how you can easily check if a key exists:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    namespace = <span class="stringliteral">&quot;user&quot;</span></div><div class="line">    path = <span class="stringliteral">&#39;{}/test&#39;</span>.format(namespace)</div><div class="line"></div><div class="line">    ks = <a class="code" href="classkdb_1_1KeySet.html">kdb.KeySet</a>()</div><div class="line">    k.get(ks, namespace)</div><div class="line"></div><div class="line">    <span class="keywordflow">try</span>:</div><div class="line">        print(<span class="stringliteral">&quot;The value of the key {} is {}!&quot;</span>.format(ks[path], ks[path]</div><div class="line">                                                      .value))</div><div class="line">    <span class="keywordflow">except</span> KeyError:</div><div class="line">        print(<span class="stringliteral">&quot;The key {} does not exist!&quot;</span>.format(path))</div></div><!-- fragment --><p>Ways of copying a keyset:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> copy, kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    ks = <a class="code" href="classkdb_1_1KeySet.html">kdb.KeySet</a>()</div><div class="line">    k.get(ks, <span class="stringliteral">&#39;spec&#39;</span>)</div><div class="line">    <span class="comment"># creating a deep copy</span></div><div class="line">    ks_deepcopy = copy.deepcopy(ks)</div><div class="line">    <span class="comment"># creating a shallow copy</span></div><div class="line">    ks_shallowcopy = copy.copy(ks)</div></div><!-- fragment --><p>Slicing works just like for normal lists in Python. But be careful: Afterwards the result will be a list - not a keyset.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    ks = <a class="code" href="classkdb_1_1KeySet.html">kdb.KeySet</a>()</div><div class="line">    k.get(ks, <span class="stringliteral">&#39;system&#39;</span>)</div><div class="line"></div><div class="line">    <span class="comment"># creating a shallow copy by slicing</span></div><div class="line">    ks_copy_by_slicing = ks[:]</div><div class="line"></div><div class="line">    <span class="comment"># in the following examples start &amp; end need to be replaced by integers</span></div><div class="line">    start, end = 1, 3</div><div class="line">    <span class="comment"># create keyset with keys from start to end-1</span></div><div class="line">    a = ks[start:end]</div><div class="line"></div><div class="line">    <span class="comment"># create keyset with keys from start to the end of the original keyset</span></div><div class="line">    start = len(ks) - 3</div><div class="line">    b = ks[start:]</div><div class="line"></div><div class="line">    <span class="comment"># create keyset with keys from the beginning of the keyset to end</span></div><div class="line">    c = ks[:end]</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> keyset <span class="keywordflow">in</span> [a, b, c]:</div><div class="line">        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> keyset:</div><div class="line">            <span class="keywordflow">try</span>:</div><div class="line">                print(<span class="stringliteral">&#39;{}: {}&#39;</span>.format(key, key.value))</div><div class="line">            <span class="keywordflow">except</span> UnicodeDecodeError:</div><div class="line">                <span class="keywordflow">pass</span>  <span class="comment"># Ignore keys and values that store non-ASCII characters</span></div><div class="line">        print(<span class="stringliteral">&#39;&#39;</span>)</div></div><!-- fragment --><p>If you have changed anything in the keyset and want those changes to be saved to the database, you need to call <code>set</code> which is just like <code>get</code> provided by the kdb-object.</p>
<p>An example of everything up until now could look like this:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    ks = <a class="code" href="classkdb_1_1KeySet.html">kdb.KeySet</a>()</div><div class="line">    k.get(ks, <span class="stringliteral">&#39;/path/to/keys&#39;</span>)</div><div class="line"></div><div class="line">    <span class="comment"># Any number of operations that manipulate the keyset as explained above</span></div><div class="line"></div><div class="line">    <span class="comment"># Setting and by doing so saving the new keyset</span></div><div class="line">    k.set(ks, <span class="stringliteral">&#39;/path/to/keys&#39;</span>)</div><div class="line">    <span class="comment"># by changing the path here it is for instance possible to set the keyset</span></div><div class="line">    <span class="comment"># of one user identical to another users</span></div></div><!-- fragment --><p>If you have a key a very simple way to get its name and value:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    ks = <a class="code" href="classkdb_1_1KeySet.html">kdb.KeySet</a>()</div><div class="line">    k.get(ks, <span class="stringliteral">&#39;user&#39;</span>)</div><div class="line">    <span class="keywordflow">for</span> key <span class="keywordflow">in</span> ks:</div><div class="line">        print(<span class="stringliteral">&quot;key name:  {}&quot;</span>.format(key.name))</div><div class="line">        print(<span class="stringliteral">&quot;{0}{1}\n{0}{2}\n&quot;</span>.format(<span class="stringliteral">&quot;key value: &quot;</span>, key.value,</div><div class="line">                                        ks.lookup(key).string))</div></div><!-- fragment --><p>It is possible to create new keys:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> kdb</div><div class="line"></div><div class="line"><span class="keyword">with</span> <a class="code" href="classkdb_1_1KDB.html">kdb.KDB</a>() <span class="keyword">as</span> k:</div><div class="line">    <span class="comment"># the first argument is the path to the key,</span></div><div class="line">    <span class="comment"># the third argument is the key&#39;s value</span></div><div class="line">    new_key = <a class="code" href="classkdb_1_1Key.html">kdb.Key</a>(<span class="stringliteral">&#39;/user/sw/pk/key_name&#39;</span>, kdb.KEY_VALUE, <span class="stringliteral">&#39;key_value&#39;</span>)</div><div class="line">    print(<span class="stringliteral">&quot;{}: {}&quot;</span>.format(new_key, new_key.value))</div></div><!-- fragment --><p>Keys can be added to a keyset using <code>append</code>. If the key already exists, the value will be updated. Calling &lsquo;keyset_name[&rsquo;/path/to/key'] = 'new_value` does not work for updating keys already in a keyset.</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> kdb <span class="keyword">import</span> KDB, KEY_VALUE, Key, KeySet</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">class </span>KeySet(KeySet):</div><div class="line">    <span class="keyword">def </span>__repr__(self):</div><div class="line">        <span class="stringliteral">&quot;&quot;&quot;Return a textual representation of this keyset.&quot;&quot;&quot;</span></div><div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&#39;\n&#39;</span>.join(</div><div class="line">            [<span class="stringliteral">&#39;{}: {}&#39;</span>.format(key.name, key.value) <span class="keywordflow">for</span> key <span class="keywordflow">in</span> self])</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">def </span>key(name, value):</div><div class="line">    <span class="stringliteral">&quot;&quot;&quot;Create a new key with the given name and value.&quot;&quot;&quot;</span></div><div class="line">    <span class="keywordflow">return</span> Key(name, KEY_VALUE, value)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">def </span>describe(keyset, title, newline=True):</div><div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&#39;{}\n{}\n{}{}&#39;</span>.format(title, <span class="stringliteral">&#39;=&#39;</span> * len(title), keyset,</div><div class="line">                                 <span class="stringliteral">&#39;\n&#39;</span> <span class="keywordflow">if</span> newline <span class="keywordflow">else</span> <span class="stringliteral">&#39;&#39;</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">with</span> KDB() <span class="keyword">as</span> data:</div><div class="line">    keyset = KeySet()</div><div class="line">    data.get(keyset, <span class="stringliteral">&#39;user&#39;</span>)</div><div class="line">    print(describe(keyset, <span class="stringliteral">&quot;Initial Keyset&quot;</span>))</div><div class="line"></div><div class="line">    new_key = key(<span class="stringliteral">&#39;user/sw/pk/key_name&#39;</span>, <span class="stringliteral">&#39;key_value&#39;</span>)</div><div class="line">    <span class="comment"># adding new_key to the existing key-set,</span></div><div class="line">    <span class="comment"># ks[&#39;/user/sw/pk/key_name&#39;].value == &#39;key_value&#39;</span></div><div class="line">    keyset.append(new_key)</div><div class="line">    print(describe(keyset, <span class="stringliteral">&quot;Add New Key&quot;</span>))</div><div class="line"></div><div class="line">    newer_key = key(<span class="stringliteral">&#39;user/sw/pk/key_name&#39;</span>, <span class="stringliteral">&#39;other_key_value&#39;</span>)</div><div class="line">    <span class="comment"># adding newer_key to the existing key-set, by doing so replacing new_key,</span></div><div class="line">    <span class="comment"># ks[&#39;/user/sw/pk/key_name&#39;].value == &#39;other_key_value&#39;</span></div><div class="line">    keyset.append(newer_key)</div><div class="line">    print(describe(keyset, <span class="stringliteral">&quot;Replace Key&quot;</span>, newline=<span class="keyword">False</span>))</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>

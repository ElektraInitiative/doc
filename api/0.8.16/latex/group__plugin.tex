\hypertarget{group__plugin}{\section{Plugins}
\label{group__plugin}\index{Plugins@{Plugins}}
}


Elektra plugin framework.  


\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__plugin_ga34d1a66f0a6e89cfd20f4014a9975a2a}{E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N}(module, function)~libelektra\+\_\+\#\#module\#\#\+\_\+\+L\+T\+X\+\_\+elektra\+Plugin\#\#function
\begin{DoxyCompactList}\small\item\em Declare a plugin's function name suitable for compilation variants (see doc/tutorials). \end{DoxyCompactList}\item 
\#define \hyperlink{group__plugin_ga78d616f68bf9fb0942f66478597467c6}{E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E}(module)~E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E2 (module)
\begin{DoxyCompactList}\small\item\em The filename for inclusion of the readme for compilation variants (see doc/tutorials). \end{DoxyCompactList}\item 
\#define \hyperlink{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R}(number, key, text)
\begin{DoxyCompactList}\small\item\em Sets the error in the keys metadata. \end{DoxyCompactList}\item 
\#define \hyperlink{group__plugin_ga3e4fc2c20d8e64bed7a54bb1af882e34}{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R\+F}(number, key, formatstring,...)
\begin{DoxyCompactList}\small\item\em Sets the error in the keys metadata. \end{DoxyCompactList}\item 
\#define \hyperlink{group__plugin_ga2bbb3bc3a3bdaf5b34b52de81886a098}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G\+F}(number, key, formatstring,...)
\begin{DoxyCompactList}\small\item\em Adds a warning in the keys metadata. \end{DoxyCompactList}\item 
\#define \hyperlink{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G}(number, key, text)
\begin{DoxyCompactList}\small\item\em Adds a warning in the keys metadata. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
Plugin $\ast$ \hyperlink{group__plugin_ga8dd092048e972a3f0c9c9f54eb41576e}{elektra\+Plugin\+Export} (const char $\ast$plugin\+Name,...)
\begin{DoxyCompactList}\small\item\em Allows one to Export Methods for a Plugin. \end{DoxyCompactList}\item 
Key\+Set $\ast$ \hyperlink{group__plugin_ga644bead796506c172817724051c977c9}{elektra\+Plugin\+Get\+Config} (Plugin $\ast$handle)
\begin{DoxyCompactList}\small\item\em Returns the configuration of that plugin. \end{DoxyCompactList}\item 
void \hyperlink{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}{elektra\+Plugin\+Set\+Data} (Plugin $\ast$plugin, void $\ast$data)
\begin{DoxyCompactList}\small\item\em Store a pointer to any plugin related data. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}{elektra\+Plugin\+Get\+Data} (Plugin $\ast$plugin)
\begin{DoxyCompactList}\small\item\em Get a pointer to any plugin related data stored before. \end{DoxyCompactList}\item 
int \hyperlink{group__plugin_ga23c2eb3584e38a4d494eb8f91e5e3d8d}{elektra\+Doc\+Open} (Plugin $\ast$handle, Key $\ast$warnings\+Key)
\begin{DoxyCompactList}\small\item\em Initialize data for the plugin. \end{DoxyCompactList}\item 
int \hyperlink{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}{elektra\+Doc\+Close} (Plugin $\ast$handle, Key $\ast$warnings\+Key)
\begin{DoxyCompactList}\small\item\em Finalize the plugin. \end{DoxyCompactList}\item 
int \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektra\+Doc\+Get} (Plugin $\ast$handle, Key\+Set $\ast$returned, Key $\ast$parent\+Key)
\begin{DoxyCompactList}\small\item\em Get data from storage to application. \end{DoxyCompactList}\item 
int \hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektra\+Doc\+Set} (Plugin $\ast$handle, Key\+Set $\ast$returned, Key $\ast$parent\+Key)
\begin{DoxyCompactList}\small\item\em Set data from application to storage. \end{DoxyCompactList}\item 
int \hyperlink{group__plugin_gad74b35f558ac7c3262f6069c5c47dc79}{elektra\+Doc\+Error} (Plugin $\ast$handle, Key\+Set $\ast$returned, Key $\ast$parent\+Key)
\begin{DoxyCompactList}\small\item\em Rollback in case of errors. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Elektra plugin framework. 

\begin{DoxySince}{Since}
version 0.\+4.\+9, Elektra can dynamically load different key storage plugins.

version 0.\+7.\+0 Elektra can have multiple backends, mounted at any place in the key database.

version 0.\+8.\+0 Elektra backends are composed out of multiple plugins.
\end{DoxySince}
To get started with writing plugins, first read our \href{doc_tutorials_plugins_md.html}{\tt Plugin Tutorial}.

A plugin can implement any functionality related to configuration. There are 6 possible entry points for a plugin.
\begin{DoxyItemize}
\item \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektra\+Doc\+Get()} will be called when configuration or the plugin's contract is retrieved from the key database
\item \hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektra\+Doc\+Set()} will be called when configuration is written to the key database
\item \hyperlink{group__plugin_ga23c2eb3584e38a4d494eb8f91e5e3d8d}{elektra\+Doc\+Open()} will be called before any other method of the plugin is called
\item \hyperlink{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}{elektra\+Doc\+Close()} will be called as last method
\item \hyperlink{group__plugin_gad74b35f558ac7c3262f6069c5c47dc79}{elektra\+Doc\+Error()} will be called when \hyperlink{group__kdb_ga11436b058408f83d303ca5e996832bcf}{kdb\+Set()} failed (to give the plugin a chance to recover/undo its actions)
\item \hyperlink{group__plugin_ga8dd092048e972a3f0c9c9f54eb41576e}{elektra\+Plugin\+Export()} exports all methods for the plugin.
\end{DoxyItemize}

Additionally, make sure that you write a contract in the R\+E\+A\+D\+M\+E.\+md. It is used by the build system and the mounting tools.

The names described here contain \char`\"{}\+Doc\char`\"{} within the method's name just because the plugin described in this document is called doc (the doxygen source was generated from \hyperlink{doc_8h}{src/plugins/doc/doc.\+h}). Always replace Doc with the name of the plugin you are going to implement or use \hyperlink{group__plugin_ga34d1a66f0a6e89cfd20f4014a9975a2a}{E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N}.

\begin{DoxyParagraph}{Overview}
There are different types of plugins for different concerns. They all only have the entry points as defined above. The types of plugins handled in this document\+:
\begin{DoxyItemize}
\item A storage plugin gets an empty keyset in \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektra\+Doc\+Get()} and constructs the information out from a file. In \hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektra\+Doc\+Set()} the keyset is written to a file. ~\newline
 Other persistent storage then a file is not handled within this document because it involves many other issues. For files the resolver plugin already takes care of transactions and rollback. So the storage plugin is the source and dump as known from pipes and filters.
\item A filter plugin is a plugin which operates on existing keys. It may process or change the keyset. Or it may reject specific keysets which do not meet some criteria.
\end{DoxyItemize}
\end{DoxyParagraph}
Use following include to have the functions that are not implement by you available\+:


\begin{DoxyCodeInclude}
\textcolor{preprocessor}{#include <\hyperlink{kdbplugin_8h}{kdbplugin.h}>}
\end{DoxyCodeInclude}
 \begin{DoxyParagraph}{Error and Warnings}
In case of trouble, in some methods you can use the macro \hyperlink{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R} (in other methods it is not allowed). You might add warnings with the macro \hyperlink{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G}. You can also use their pedants that accept a format string as known by printf\+: \hyperlink{group__plugin_ga3e4fc2c20d8e64bed7a54bb1af882e34}{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R\+F} and \hyperlink{group__plugin_ga2bbb3bc3a3bdaf5b34b52de81886a098}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G\+F}. Make sure to define and use a macro in the error specification (/src/error/specification) so that you can easily renumber your error/warning codes\+:
\end{DoxyParagraph}

\begin{DoxyCodeInclude}
number:60
description:Invalid Line encountered
severity:error
ingroup:plugin
macro:NOEOF
module:simpleini
\end{DoxyCodeInclude}
 Use following include to have the macros for setting the error and adding the warnings available\+:


\begin{DoxyCodeInclude}
\textcolor{preprocessor}{#include <kdberrors.h>}
\end{DoxyCodeInclude}
 and then you can use\+:


\begin{DoxyCodeInclude}
\hyperlink{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}{ELEKTRA\_SET\_ERROR} (ELEKTRA\_ERROR\_NOEOF, parentKey, \textcolor{stringliteral}{"not at the end of file"});
\end{DoxyCodeInclude}
 \begin{DoxyParagraph}{Further help}
Do not hesitate to open an issue if anything is unclear. 
\end{DoxyParagraph}


\subsection{Macro Definition Documentation}
\hypertarget{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}{\index{Plugins@{Plugins}!E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G@{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G}}
\index{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G@{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G}!Plugins@{Plugins}}
\subsubsection[{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G(
\begin{DoxyParamCaption}
\item[{}]{number, }
\item[{}]{key, }
\item[{}]{text}
\end{DoxyParamCaption}
)}}\label{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}


Adds a warning in the keys metadata. 

Include kdberrors.\+h to make it work\+:


\begin{DoxyCodeInclude}
\textcolor{preprocessor}{#include <kdberrors.h>}
\end{DoxyCodeInclude}



\begin{DoxyParams}{Parameters}
{\em number} & the warning number from src/error/specification \\
\hline
{\em key} & to write the error to \\
\hline
{\em text} & additional text for the user \\
\hline
\end{DoxyParams}
\hypertarget{group__plugin_ga2bbb3bc3a3bdaf5b34b52de81886a098}{\index{Plugins@{Plugins}!E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G\+F@{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G\+F}}
\index{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G\+F@{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G\+F}!Plugins@{Plugins}}
\subsubsection[{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G\+F}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G\+F(
\begin{DoxyParamCaption}
\item[{}]{number, }
\item[{}]{key, }
\item[{}]{formatstring, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{group__plugin_ga2bbb3bc3a3bdaf5b34b52de81886a098}


Adds a warning in the keys metadata. 

Include kdberrors.\+h to make it work\+:


\begin{DoxyCodeInclude}
\textcolor{preprocessor}{#include <kdberrors.h>}
\end{DoxyCodeInclude}



\begin{DoxyParams}{Parameters}
{\em number} & the warning number from src/error/specification \\
\hline
{\em key} & to write the error to \\
\hline
{\em formatstring} & a format string as in printf \\
\hline
{\em ...} & further arguments as in printf \\
\hline
\end{DoxyParams}
\hypertarget{group__plugin_ga34d1a66f0a6e89cfd20f4014a9975a2a}{\index{Plugins@{Plugins}!E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N@{E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N}}
\index{E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N@{E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N}!Plugins@{Plugins}}
\subsubsection[{E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N(
\begin{DoxyParamCaption}
\item[{}]{module, }
\item[{}]{function}
\end{DoxyParamCaption}
)~libelektra\+\_\+\#\#module\#\#\+\_\+\+L\+T\+X\+\_\+elektra\+Plugin\#\#function}}\label{group__plugin_ga34d1a66f0a6e89cfd20f4014a9975a2a}


Declare a plugin's function name suitable for compilation variants (see doc/tutorials). 

It can be used in the same way as \hyperlink{group__plugin_ga8dd092048e972a3f0c9c9f54eb41576e}{elektra\+Plugin\+Export()}. \begin{DoxySeeAlso}{See also}
E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+E\+X\+P\+O\+R\+T
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em plugin} & the name of the plugin \\
\hline
{\em function} & which function it is (open, close, get, set, error) \\
\hline
\end{DoxyParams}
\hypertarget{group__plugin_ga78d616f68bf9fb0942f66478597467c6}{\index{Plugins@{Plugins}!E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E@{E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E}}
\index{E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E@{E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E}!Plugins@{Plugins}}
\subsubsection[{E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E(
\begin{DoxyParamCaption}
\item[{}]{module}
\end{DoxyParamCaption}
)~E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E2 (module)}}\label{group__plugin_ga78d616f68bf9fb0942f66478597467c6}


The filename for inclusion of the readme for compilation variants (see doc/tutorials). 


\begin{DoxyParams}{Parameters}
{\em plugin} & the name of the plugin \\
\hline
\end{DoxyParams}
\hypertarget{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}{\index{Plugins@{Plugins}!E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R@{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R}}
\index{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R@{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R}!Plugins@{Plugins}}
\subsubsection[{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R(
\begin{DoxyParamCaption}
\item[{}]{number, }
\item[{}]{key, }
\item[{}]{text}
\end{DoxyParamCaption}
)}}\label{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}


Sets the error in the keys metadata. 

Include kdberrors.\+h to make it work\+:


\begin{DoxyCodeInclude}
\textcolor{preprocessor}{#include <kdberrors.h>}
\end{DoxyCodeInclude}



\begin{DoxyParams}{Parameters}
{\em number} & the error number from src/error/specification \\
\hline
{\em key} & to write the error to \\
\hline
{\em text} & additional text for the user \\
\hline
\end{DoxyParams}
\hypertarget{group__plugin_ga3e4fc2c20d8e64bed7a54bb1af882e34}{\index{Plugins@{Plugins}!E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R\+F@{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R\+F}}
\index{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R\+F@{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R\+F}!Plugins@{Plugins}}
\subsubsection[{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R\+F}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R\+F(
\begin{DoxyParamCaption}
\item[{}]{number, }
\item[{}]{key, }
\item[{}]{formatstring, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{group__plugin_ga3e4fc2c20d8e64bed7a54bb1af882e34}


Sets the error in the keys metadata. 

Include kdberrors.\+h to make it work\+:


\begin{DoxyCodeInclude}
\textcolor{preprocessor}{#include <kdberrors.h>}
\end{DoxyCodeInclude}



\begin{DoxyParams}{Parameters}
{\em number} & the error number from src/error/specification \\
\hline
{\em key} & to write the error to \\
\hline
{\em formatstring} & a format string as in printf \\
\hline
{\em ...} & further arguments as in printf \\
\hline
\end{DoxyParams}


\subsection{Function Documentation}
\hypertarget{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}{\index{Plugins@{Plugins}!elektra\+Doc\+Close@{elektra\+Doc\+Close}}
\index{elektra\+Doc\+Close@{elektra\+Doc\+Close}!Plugins@{Plugins}}
\subsubsection[{elektra\+Doc\+Close}]{\setlength{\rightskip}{0pt plus 5cm}int elektra\+Doc\+Close (
\begin{DoxyParamCaption}
\item[{Plugin $\ast$}]{handle, }
\item[{Key $\ast$}]{warnings\+Key}
\end{DoxyParamCaption}
)}}\label{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}


Finalize the plugin. 

Called prior to unloading the plugin dynamic module. After this function is called, it is ensured that no functions from your plugin will ever be accessed again.

Make sure to free all memory that your plugin requested at runtime. Also make sure to free what you stored by \hyperlink{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}{elektra\+Plugin\+Set\+Data()} before.

So for the Doc plugin we need to\+:


\begin{DoxyCodeInclude}
\textcolor{keywordtype}{int} \hyperlink{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}{elektraDocClose} (Plugin * handle, Key * warningsKey ELEKTRA\_UNUSED)
\{
        \hyperlink{internal_8c_a7f572149d2e0bfe18023a6ac969f195c}{elektraFree} (\hyperlink{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}{elektraPluginGetData} (handle));

        \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* success */}
\}
\end{DoxyCodeInclude}
 After this call, libelektra.\+so will unload the plugin library, so this is the point to shutdown any affairs with the storage.


\begin{DoxyParams}{Parameters}
{\em handle} & contains internal information of the plugin \\
\hline
{\em warnings\+Key} & can be used to to add warnings using \hyperlink{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G} (Do not add errors!)\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & on success (no other return value currently allowed)\\
\hline
{\em -\/1} & on problems (only use E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G, but never set an error).\\
\hline
\end{DoxyRetVals}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__kdb_gadb54dc9fda17ee07deb9444df745c96f}{kdb\+Close()} 

\hyperlink{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}{elektra\+Plugin\+Get\+Data()}, \hyperlink{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}{elektra\+Plugin\+Set\+Data()} and \hyperlink{group__plugin_ga644bead796506c172817724051c977c9}{elektra\+Plugin\+Get\+Config()} 
\end{DoxySeeAlso}
\hypertarget{group__plugin_gad74b35f558ac7c3262f6069c5c47dc79}{\index{Plugins@{Plugins}!elektra\+Doc\+Error@{elektra\+Doc\+Error}}
\index{elektra\+Doc\+Error@{elektra\+Doc\+Error}!Plugins@{Plugins}}
\subsubsection[{elektra\+Doc\+Error}]{\setlength{\rightskip}{0pt plus 5cm}int elektra\+Doc\+Error (
\begin{DoxyParamCaption}
\item[{Plugin $\ast$}]{handle, }
\item[{Key\+Set $\ast$}]{returned, }
\item[{Key $\ast$}]{parent\+Key}
\end{DoxyParamCaption}
)}}\label{group__plugin_gad74b35f558ac7c3262f6069c5c47dc79}


Rollback in case of errors. 

First for all plugins \hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektra\+Doc\+Set()} will be called. If any plugin had problems before the commit (done by the resolver plugin), we can safely rollback our changes.

This method is rarely used by plugins, it is mainly used for resolvers (to implement rollback) or by logging plugins. It is not needed for storage plugins, because they only operate on temporary files created by the resolver.


\begin{DoxyParams}{Parameters}
{\em handle} & contains internal information of the plugin \\
\hline
{\em returned} & contains a keyset with relevant keys \\
\hline
{\em parent\+Key} & contains the information where to set the keys. can be used to add warnings with the macro \hyperlink{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G}, but do not add errors!\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 1} & on success \\
\hline
{\em 0} & on success with no action \\
\hline
{\em -\/1} & on failure (you can add warnings, but we are already in an error state, so do not set the error). \\
\hline
\end{DoxyRetVals}
\hypertarget{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{\index{Plugins@{Plugins}!elektra\+Doc\+Get@{elektra\+Doc\+Get}}
\index{elektra\+Doc\+Get@{elektra\+Doc\+Get}!Plugins@{Plugins}}
\subsubsection[{elektra\+Doc\+Get}]{\setlength{\rightskip}{0pt plus 5cm}int elektra\+Doc\+Get (
\begin{DoxyParamCaption}
\item[{Plugin $\ast$}]{handle, }
\item[{Key\+Set $\ast$}]{returned, }
\item[{Key $\ast$}]{parent\+Key}
\end{DoxyParamCaption}
)}}\label{group__plugin_gacb69f3441c6d84241b4362f958fbe313}


Get data from storage to application. 

Retrieve information from a permanent storage to construct a keyset.\hypertarget{group__plugin_intro}{}\subsection{Introduction}\label{group__plugin_intro}
The \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektra\+Doc\+Get()} function handle everything related to receiving keys.\hypertarget{group__plugin_contract}{}\subsubsection{Contract Handling}\label{group__plugin_contract}
The contract is a keyset that needs to be returned if the parent\+Key is system/elektra/modules/yourpluginname.

Which keys and their meaning is specified in doc/\+C\+O\+N\+T\+R\+A\+C\+T.\+ini

Here is an example for our doc plugin\+:


\begin{DoxyCodeInclude}
\textcolor{keywordtype}{int} \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektraDocGet} (Plugin * plugin ELEKTRA\_UNUSED, KeySet * returned, Key * parentKey)
\{
        \textcolor{keywordflow}{if} (!strcmp (\hyperlink{group__keyname_ga8e805c726a60da921d3736cda7813513}{keyName} (parentKey), \textcolor{stringliteral}{"system/elektra/modules/doc"}))
        \{
                KeySet * contract =
                        \hyperlink{group__keyset_ga671e1aaee3ae9dc13b4834a4ddbd2c3c}{ksNew} (30, \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (\textcolor{stringliteral}{"system/elektra/modules/doc"}, 
      \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40ac66e4a49d09212b79f5754ca6db5bd2e}{KEY\_VALUE}, \textcolor{stringliteral}{"doc plugin waits for your orders"}, \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403}{KEY\_END}),
                               \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (\textcolor{stringliteral}{"system/elektra/modules/doc/exports"}, 
      \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403}{KEY\_END}),
                               \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (\textcolor{stringliteral}{"system/elektra/modules/doc/exports/open"}, KEY\_FUNC, 
      \hyperlink{group__plugin_ga23c2eb3584e38a4d494eb8f91e5e3d8d}{elektraDocOpen}, \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403}{KEY\_END}),
                               \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (\textcolor{stringliteral}{"system/elektra/modules/doc/exports/close"}, KEY\_FUNC, 
      \hyperlink{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}{elektraDocClose}, \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403}{KEY\_END}),
                               \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (\textcolor{stringliteral}{"system/elektra/modules/doc/exports/get"}, KEY\_FUNC, 
      \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektraDocGet}, \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403}{KEY\_END}),
                               \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (\textcolor{stringliteral}{"system/elektra/modules/doc/exports/set"}, KEY\_FUNC, 
      \hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektraDocSet}, \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403}{KEY\_END}),
                               \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (\textcolor{stringliteral}{"system/elektra/modules/doc/exports/error"}, KEY\_FUNC, 
      \hyperlink{group__plugin_gad74b35f558ac7c3262f6069c5c47dc79}{elektraDocError}, \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403}{KEY\_END}),
#include \hyperlink{group__plugin_ga78d616f68bf9fb0942f66478597467c6}{ELEKTRA\_README} (doc)
                               \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (\textcolor{stringliteral}{"system/elektra/modules/doc/infos/version"}, 
      \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40ac66e4a49d09212b79f5754ca6db5bd2e}{KEY\_VALUE}, PLUGINVERSION, \hyperlink{group__key_gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403}{KEY\_END}), \hyperlink{kdbenum_8c_a7a28fce3773b2c873c94ac80b8b4cd54}{KS\_END});
                \hyperlink{group__keyset_ga21eb9c3a14a604ee3a8bdc779232e7b7}{ksAppend} (returned, contract);
                \hyperlink{group__keyset_ga27e5c16473b02a422238c8d970db7ac8}{ksDel} (contract);

                \textcolor{keywordflow}{return} 1; \textcolor{comment}{/* success */}
        \}
\end{DoxyCodeInclude}
 Some clauses of the contract, especially the description of the plugin can be done more conveniently directly in a R\+E\+A\+D\+M\+E.\+md that is included by \hyperlink{group__plugin_ga78d616f68bf9fb0942f66478597467c6}{E\+L\+E\+K\+T\+R\+A\+\_\+\+R\+E\+A\+D\+M\+E}.\hypertarget{group__plugin_storage}{}\subsubsection{Storage Plugins}\label{group__plugin_storage}
For storage plugins the filename is written in the value of the parent\+Key. So the first task of the plugin is to open that file. Then it should parse its content and construct a keyset with all information of that file.

You need to be able to reconstruct the same file with the information of the keyset. So be sure to copy all comments, whitespaces and so on into some metadata of the keys. Otherwise the information is lost after writing the file the next time.

Now lets look at an example how the typical \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektra\+Doc\+Get()} might be implemented. To explain we introduce some pseudo functions which do all the work with the storage (which is of course 90\% of the work for a real plugin)\+:
\begin{DoxyItemize}
\item parse\+\_\+key will parse a key and a value from an open file handle
\end{DoxyItemize}

The typical loop for a storage plugin will be like\+:


\begin{DoxyCodeInclude}
        FILE * fp = fopen (\hyperlink{group__keyvalue_ga880936f2481d28e6e2acbe7486a21d05}{keyString} (parentKey), \textcolor{stringliteral}{"r"});
        \textcolor{keywordtype}{char} * key;
        \textcolor{keywordtype}{char} * value;

        \textcolor{keywordflow}{while} (parseKey (fp, &key, &value) >= 1)
        \{
                Key * read = \hyperlink{group__key_gad23c65b44bf48d773759e1f9a4d43b89}{keyNew} (0);
                \textcolor{keywordflow}{if} (\hyperlink{group__keyname_ga7699091610e7f3f43d2949514a4b35d9}{keySetName} (read, key) == -1)
                \{
                        fclose (fp);
                        \hyperlink{group__key_ga3df95bbc2494e3e6703ece5639be5bb1}{keyDel} (read);
                        \hyperlink{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}{ELEKTRA\_SET\_ERROR} (59, parentKey, key);
                        \textcolor{keywordflow}{return} -1;
                \}
                \hyperlink{group__keyvalue_ga622bde1eb0e0c4994728331326340ef2}{keySetString} (read, value);

                \hyperlink{group__keyset_gaa5a1d467a4d71041edce68ea7748ce45}{ksAppendKey} (returned, read);
                \hyperlink{internal_8c_a7f572149d2e0bfe18023a6ac969f195c}{elektraFree} (key);
                \hyperlink{internal_8c_a7f572149d2e0bfe18023a6ac969f195c}{elektraFree} (value);
        \}

        \textcolor{keywordflow}{if} (feof (fp) == 0)
        \{
                fclose (fp);
                \hyperlink{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}{ELEKTRA\_SET\_ERROR} (ELEKTRA\_ERROR\_NOEOF, parentKey, \textcolor{stringliteral}{"not at the end of file
      "});
                \textcolor{keywordflow}{return} -1;
        \}

        fclose (fp);
\end{DoxyCodeInclude}
 \hypertarget{group__plugin_filter}{}\subsubsection{Filter Plugins}\label{group__plugin_filter}
For filter plugins the actual task is rather unspecified. You basically can do anything with the keyset. To get roundtrip properties you might want to undo any changes you did in \hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektra\+Doc\+Set()}.

The pseudo functions (which do the real work) are\+:
\begin{DoxyItemize}
\item do\+\_\+action() which processes every key in this filter
\end{DoxyItemize}


\begin{DoxyCodeInclude}
        Key * k;
        \hyperlink{group__keyset_gabe793ff51f1728e3429c84a8a9086b70}{ksRewind} (returned);
        \textcolor{keywordflow}{while} ((k = \hyperlink{group__keyset_ga317321c9065b5a4b3e33fe1c399bcec9}{ksNext} (returned)) != 0)
        \{
                doAction (k);
        \}

        \textcolor{keywordflow}{return} 1; \textcolor{comment}{// success}
\}
\end{DoxyCodeInclude}


\begin{DoxyPrecond}{Precondition}
The caller \hyperlink{group__kdb_ga28e385fd9cb7ccfe0b2f1ed2f62453a1}{kdb\+Get()} will make sure before you are called that the parent\+Key\+:
\begin{DoxyItemize}
\item is a valid key (means that it is a system or user key).
\item is your mountpoint and that your plugin is responsible for it. 
\end{DoxyItemize}

and that the returned\+:
\begin{DoxyItemize}
\item is a valid keyset.
\item your plugin is only called when needed (e.\+g. only if file was modified)
\item has {\ttfamily all} keys related to your plugin.
\item contains only valid keys below (see \hyperlink{group__keytest_ga03332b5d97c76a4fd2640aca4762b8df}{key\+Is\+Below()}) your parent\+Key.
\item is in a sorted order (given implicit by Key\+Set) 
\end{DoxyItemize}

and that the handle\+:
\begin{DoxyItemize}
\item is valid for your plugin.
\item that \hyperlink{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}{elektra\+Plugin\+Get\+Data()} contains the same handle for lifetime of your plugin.
\end{DoxyItemize}

The caller \hyperlink{group__kdb_ga28e385fd9cb7ccfe0b2f1ed2f62453a1}{kdb\+Get()} will make sure that afterwards you were called, that\+:
\begin{DoxyItemize}
\item other plugins below your plugin will be called again recursively.
\item that all keys are merged to one keyset the user gets
\item that all keys (that should not be removed) are passed to \hyperlink{group__kdb_ga11436b058408f83d303ca5e996832bcf}{kdb\+Set()} if writing to disc is needed.
\end{DoxyItemize}
\end{DoxyPrecond}
\begin{DoxyInvariant}{Invariant}
There are no global variables and \hyperlink{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}{elektra\+Plugin\+Set\+Data()} stores all information. The handle is to be guaranteed to be the same if it is the same plugin.
\end{DoxyInvariant}
\begin{DoxyPostcond}{Postcondition}
The keyset {\ttfamily returned} has the {\ttfamily parent\+Key} and all keys below (\hyperlink{group__keytest_ga03332b5d97c76a4fd2640aca4762b8df}{key\+Is\+Below()}) with all information from the storage. Make sure to return all keys, all directories and also all hidden keys. If some of them are not wished, the caller \hyperlink{group__kdb_ga28e385fd9cb7ccfe0b2f1ed2f62453a1}{kdb\+Get()} will drop these keys with additional plugins.
\end{DoxyPostcond}
\begin{DoxyParagraph}{Updating}
To get all keys out of the storage over and over again can be very inefficient. You might know a more efficient method to know if the key needs update or not, e.\+g. by stating it or by an external time stamp info. For file storage plugins this is automatically done for you by the resolver. For other types (e.\+g. databases) you need to implement your own resolver doing this.
\end{DoxyParagraph}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__kdb_ga28e385fd9cb7ccfe0b2f1ed2f62453a1}{kdb\+Get()} for caller.
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em handle} & contains internal information of \hyperlink{group__kdb_ga6808defe5870f328dd17910aacbdc6ca}{opened } key database \\
\hline
{\em returned} & contains a keyset where the function need to append the keys got from the storage. There might be also some keys inside it, see conditions. You may use them to support efficient updating of keys, see updating. \\
\hline
{\em parent\+Key} & contains the information below which key the keys should be gotten.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 1} & on success \\
\hline
{\em 0} & when nothing was to do \\
\hline
{\em -\/1} & on failure, the current key in returned shows the position. use \hyperlink{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R} of kdberrors.\+h to define the error code. You additionally can add as many warnings as you would like to add. \\
\hline
\end{DoxyRetVals}
\hypertarget{group__plugin_ga23c2eb3584e38a4d494eb8f91e5e3d8d}{\index{Plugins@{Plugins}!elektra\+Doc\+Open@{elektra\+Doc\+Open}}
\index{elektra\+Doc\+Open@{elektra\+Doc\+Open}!Plugins@{Plugins}}
\subsubsection[{elektra\+Doc\+Open}]{\setlength{\rightskip}{0pt plus 5cm}int elektra\+Doc\+Open (
\begin{DoxyParamCaption}
\item[{Plugin $\ast$}]{handle, }
\item[{Key $\ast$}]{warnings\+Key}
\end{DoxyParamCaption}
)}}\label{group__plugin_ga23c2eb3584e38a4d494eb8f91e5e3d8d}


Initialize data for the plugin. 

This is the first method called after dynamically loading this plugin. It is guaranteed, that this method will be called before any other method.

This method is responsible for\+:
\begin{DoxyItemize}
\item plugin's specific configuration gathering
\item initialization of all plugin's internal structs
\item initial setup of all I/\+O details such as opening a file, connecting to a database, setup connection to a server, iff this cannot be done per invocation in \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektra\+Doc\+Get()} and \hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektra\+Doc\+Set()}.
\end{DoxyItemize}

You may also read the configuration you can get with \hyperlink{group__plugin_ga644bead796506c172817724051c977c9}{elektra\+Plugin\+Get\+Config()} and transform it into other structures used by your plugin.

\begin{DoxyNote}{Note}
The plugin must not have any global variables. If you have one Elektra will not be threadsafe. Do not assume that your plugin will be opened only once or will not be reopened at a later time.
\end{DoxyNote}
Instead of global variables the methods \hyperlink{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}{elektra\+Plugin\+Get\+Data()} and \hyperlink{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}{elektra\+Plugin\+Set\+Data()} exist to store and get any information related to your plugin.

The correct substitute for global variables will be\+:


\begin{DoxyCodeInclude}
\textcolor{keyword}{typedef} \textcolor{keyword}{struct}
\{
        \textcolor{keywordtype}{int} global;
\} GlobalData;
\end{DoxyCodeInclude}
 and then initialize it using\+:


\begin{DoxyCodeInclude}
\textcolor{keywordtype}{int} \hyperlink{group__plugin_ga23c2eb3584e38a4d494eb8f91e5e3d8d}{elektraDocOpen} (Plugin * handle, Key * warningsKey ELEKTRA\_UNUSED)
\{
        GlobalData * data;
        KeySet * config = \hyperlink{group__plugin_ga644bead796506c172817724051c977c9}{elektraPluginGetConfig} (handle);
        Key * kg = \hyperlink{group__keyset_gad2e30fb6d4739d917c5abb2ac2f9c1a1}{ksLookupByName} (config, \textcolor{stringliteral}{"/global"}, 0);

        data = \hyperlink{internal_8c_a35cdc2e5caed3454cb73b4fc7f37858c}{elektraMalloc} (\textcolor{keyword}{sizeof} (GlobalData));
        data->global = 0;
        \textcolor{keywordflow}{if} (kg) data->global = atoi (\hyperlink{group__keyvalue_ga880936f2481d28e6e2acbe7486a21d05}{keyString} (kg));
        \hyperlink{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}{elektraPluginSetData} (handle, data);
\end{DoxyCodeInclude}
 Make sure to free everything you allocate within \hyperlink{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}{elektra\+Doc\+Close()}.

If your plugin has no useful way to startup without config, the module loader would not be able to load the module. We need, however, to still load the plugin to get the contract.

To solve that problem the module loader adds the configuration key /module. Even if your plugin is basically not able to startup successfully, it should still provide a fallback when /module is present, so that \hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektra\+Doc\+Get()} on system/elektra/modules can be called successfully later on.


\begin{DoxyCodeInclude}
        \textcolor{keywordflow}{if} (\hyperlink{group__keyset_gad2e30fb6d4739d917c5abb2ac2f9c1a1}{ksLookupByName} (config, \textcolor{stringliteral}{"/module"}, 0))
        \{
                \textcolor{keywordflow}{return} 0;
        \}
        \textcolor{comment}{// do some setup that will fail without configuration}
\end{DoxyCodeInclude}
 Note that for plugins where the contract will be altered based on configuration this specific configuration should be considered. In fact the idea of /module is to get the correct contract.


\begin{DoxyRetVals}{Return values}
{\em -\/1} & on error, your plugin will be removed then and the missing plugin added instead. Use \hyperlink{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G} to indicate the problem. The system will automatically add the information that the plugin was removed, so you do not need the user give that information.\\
\hline
{\em 0} & on success\\
\hline
\end{DoxyRetVals}

\begin{DoxyParams}{Parameters}
{\em handle} & contains internal information of the plugin \\
\hline
{\em warnings\+Key} & can be used to add warnings with the macro \hyperlink{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G} (Do not add errors!) \\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}{elektra\+Plugin\+Get\+Data()}, \hyperlink{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}{elektra\+Plugin\+Set\+Data()} and \hyperlink{group__plugin_ga644bead796506c172817724051c977c9}{elektra\+Plugin\+Get\+Config()} 

\hyperlink{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}{elektra\+Doc\+Close()} 
\end{DoxySeeAlso}
\hypertarget{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{\index{Plugins@{Plugins}!elektra\+Doc\+Set@{elektra\+Doc\+Set}}
\index{elektra\+Doc\+Set@{elektra\+Doc\+Set}!Plugins@{Plugins}}
\subsubsection[{elektra\+Doc\+Set}]{\setlength{\rightskip}{0pt plus 5cm}int elektra\+Doc\+Set (
\begin{DoxyParamCaption}
\item[{Plugin $\ast$}]{handle, }
\item[{Key\+Set $\ast$}]{returned, }
\item[{Key $\ast$}]{parent\+Key}
\end{DoxyParamCaption}
)}}\label{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}


Set data from application to storage. 

This function does everything related to set and remove keys in a plugin. There is only one function for that purpose to make implementation of file based plugins much easier.

The keyset {\ttfamily returned} was filled in with information from the application using elektra and the task of this function is to store it in a permanent way so that a subsequent call of elektra\+Plugin\+Get() can rebuild the keyset as it was before. See the live cycle to understand\+:


\begin{DoxyCodeInclude}
\textcolor{keyword}{static} \textcolor{keywordtype}{void} usercode (KDB * handle, KeySet * keyset, Key * key)
\{
        \textcolor{comment}{// some more user code}
        \hyperlink{group__keyvalue_ga622bde1eb0e0c4994728331326340ef2}{keySetString} (key, \textcolor{stringliteral}{"mycomment"}); \textcolor{comment}{// the user changes the key}
        \hyperlink{group__keyset_gaa5a1d467a4d71041edce68ea7748ce45}{ksAppendKey} (keyset, key);       \textcolor{comment}{// append the key to the keyset}
        \hyperlink{group__kdb_ga11436b058408f83d303ca5e996832bcf}{kdbSet} (handle, keyset, 0);      \textcolor{comment}{// and syncs it to disc}
\}

\textcolor{comment}{// so now kdbSet is called}
\textcolor{keywordtype}{int} elektraKdbSet (KDB * handle, KeySet * keyset, Key * parentKey)
\{
        \textcolor{keywordtype}{int} ret = 0;
        \textcolor{comment}{// find appropriate plugin and then call it:}
        Plugin * plugin = findPlugin (handle);
        ret = \hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektraDocSet} (plugin, keyset, parentKey);
        \textcolor{comment}{// the keyset with the key (and others for this plugin)}
        \textcolor{comment}{// will be passed to this function}
        \textcolor{keywordflow}{return} ret;
\}

\textcolor{comment}{// so now elektraPluginSet(), which is the function described here,}
\textcolor{comment}{// is called:}
\textcolor{keywordtype}{int} elektraPluginSet (Plugin * plugin ELEKTRA\_UNUSED, KeySet * returned, Key * parentKey ELEKTRA\_UNUSED)
\{
        \textcolor{comment}{// the task of elektraPluginSet is now to store the keys}
        Key * k;
        \hyperlink{group__keyset_gabe793ff51f1728e3429c84a8a9086b70}{ksRewind} (returned);
        \textcolor{keywordflow}{while} ((k = \hyperlink{group__keyset_ga317321c9065b5a4b3e33fe1c399bcec9}{ksNext} (returned)) != 0)
        \{
                saveToDisc (k);
        \}

        \textcolor{keywordflow}{return} 1; \textcolor{comment}{/* success */}
\}
\end{DoxyCodeInclude}
 Of course all information of every key in the keyset {\ttfamily returned} need to be stored permanently. So this specification needs to give an exhaustive list of information present in a key.

\begin{DoxyPrecond}{Precondition}
The keyset {\ttfamily returned} holds all keys which must be saved permanently for this keyset. The keyset is sorted and rewinded.

The {\ttfamily parent\+Key} is the key which is the ancestor for all other keys in the keyset. The first key of the keyset {\ttfamily returned} has the same keyname. The name of the parent\+Key marks the mountpoint. The string of the parent\+Key is the filename to write to.
\end{DoxyPrecond}
Make sure to set all keys, all directories and also all hidden keys. If some of them are not wished, the caller \hyperlink{group__kdb_ga11436b058408f83d303ca5e996832bcf}{kdb\+Set()} and plugins will sort them out.

\begin{DoxyInvariant}{Invariant}
There are no global variables, but instead \hyperlink{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}{elektra\+Plugin\+Get\+Data()} will be used. The handle is the same when it is the same plugin.
\end{DoxyInvariant}
\begin{DoxyPostcond}{Postcondition}
The information of the keyset {\ttfamily returned} is stored permanently.
\end{DoxyPostcond}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__kdb_ga11436b058408f83d303ca5e996832bcf}{kdb\+Set()} for caller.
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em handle} & contains internal information of the plugin \\
\hline
{\em returned} & contains a keyset with relevant keys \\
\hline
{\em parent\+Key} & contains the information where to set the keys (name is mountpoint your plugin is mounted, string is the file to write to)\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
When everything works gracefully return the number of keys you set. The cursor position and the keys remaining in the keyset are not important.
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em 1} & on success \\
\hline
{\em 0} & on success with no changed key in database \\
\hline
{\em -\/1} & on failure. The cause of the error needs to be added in parent\+Key You also have to make sure that \hyperlink{group__keyset_gaffe507ab9281c322eb16c3e992075d29}{ks\+Get\+Cursor()} shows to the position where the error appeared. Set an error using \hyperlink{group__plugin_gaab1842b82272e6d4235b6a71587a64d9}{E\+L\+E\+K\+T\+R\+A\+\_\+\+S\+E\+T\+\_\+\+E\+R\+R\+O\+R} to inform the user what went wrong. Additionally you can add any number of warnings with \hyperlink{group__plugin_ga3da3bdb0f41710adda9eee3d7adac9ff}{E\+L\+E\+K\+T\+R\+A\+\_\+\+A\+D\+D\+\_\+\+W\+A\+R\+N\+I\+N\+G}. \\
\hline
\end{DoxyRetVals}
\hypertarget{group__plugin_ga8dd092048e972a3f0c9c9f54eb41576e}{\index{Plugins@{Plugins}!elektra\+Plugin\+Export@{elektra\+Plugin\+Export}}
\index{elektra\+Plugin\+Export@{elektra\+Plugin\+Export}!Plugins@{Plugins}}
\subsubsection[{elektra\+Plugin\+Export}]{\setlength{\rightskip}{0pt plus 5cm}Plugin$\ast$ elektra\+Plugin\+Export (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{plugin\+Name, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{group__plugin_ga8dd092048e972a3f0c9c9f54eb41576e}


Allows one to Export Methods for a Plugin. 

This function must be called within E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+E\+X\+P\+O\+R\+T. It define the plugin's methods that will be exported.

All K\+D\+B methods implemented by the plugin basically could have random names (convention is elektra\+Name$\ast$), except E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+E\+X\+P\+O\+R\+T.

This is the single symbol that will be looked up when loading the plugin, and the first method of the backend implementation that will be called.

You need to use a macro so that both dynamic and static loading of the plugin works. For example for the doc plugin\+: 
\begin{DoxyCodeInclude}
Plugin * ELEKTRA\_PLUGIN\_EXPORT (doc)
\{
        \textcolor{comment}{// clang-format off}
        \textcolor{keywordflow}{return} \hyperlink{group__plugin_ga8dd092048e972a3f0c9c9f54eb41576e}{elektraPluginExport}(DOC\_PLUGIN\_NAME,
                \hyperlink{kdbplugin_8h_afed89ef026fb0622918a5de020de7814ab7e2dcc6e79af21dd90d2bb62920551d}{ELEKTRA\_PLUGIN\_OPEN}, &\hyperlink{group__plugin_ga23c2eb3584e38a4d494eb8f91e5e3d8d}{elektraDocOpen},
                \hyperlink{kdbplugin_8h_afed89ef026fb0622918a5de020de7814a449e166b322550b3ad26efd4c46e49e3}{ELEKTRA\_PLUGIN\_CLOSE},       &\hyperlink{group__plugin_ga1236aefe5b2baf8b7bf636ba5aa9ea29}{elektraDocClose},
                \hyperlink{kdbplugin_8h_afed89ef026fb0622918a5de020de7814a3d5f4a887e68878f1cc3a75985194204}{ELEKTRA\_PLUGIN\_GET},   &\hyperlink{group__plugin_gacb69f3441c6d84241b4362f958fbe313}{elektraDocGet},
                \hyperlink{kdbplugin_8h_afed89ef026fb0622918a5de020de7814a85c9545261cf0bcc932616e67ea3b70a}{ELEKTRA\_PLUGIN\_SET},   &\hyperlink{group__plugin_gae65781a1deb34efc79c8cb9d9174842c}{elektraDocSet},
                \hyperlink{kdbplugin_8h_afed89ef026fb0622918a5de020de7814a89e027283d949dd78bb9c1fce1b19a10}{ELEKTRA\_PLUGIN\_ERROR},       &\hyperlink{group__plugin_gad74b35f558ac7c3262f6069c5c47dc79}{elektraDocError},
                \hyperlink{kdbplugin_8h_afed89ef026fb0622918a5de020de7814a64a0bc789482284d9fd27ce974e0959a}{ELEKTRA\_PLUGIN\_END});
\}
\end{DoxyCodeInclude}
 The first parameter is the name of the plugin. Then every plugin should have\+: {\ttfamily E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+O\+P\+E\+N}, {\ttfamily E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+C\+L\+O\+S\+E}, {\ttfamily E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+G\+E\+T}, {\ttfamily E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+S\+E\+T} and optionally {\ttfamily E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+E\+R\+R\+O\+R}.

The list is terminated with {\ttfamily E\+L\+E\+K\+T\+R\+A\+\_\+\+P\+L\+U\+G\+I\+N\+\_\+\+E\+N\+D}.

You must use static \char`\"{}char arrays\char`\"{} in a read only segment. Don't allocate storage, it won't be freed.


\begin{DoxyParams}{Parameters}
{\em plugin\+Name} & the name of this plugin \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
an object that contains all plugin information needed by libelektra.\+so 
\end{DoxyReturn}
\hypertarget{group__plugin_ga644bead796506c172817724051c977c9}{\index{Plugins@{Plugins}!elektra\+Plugin\+Get\+Config@{elektra\+Plugin\+Get\+Config}}
\index{elektra\+Plugin\+Get\+Config@{elektra\+Plugin\+Get\+Config}!Plugins@{Plugins}}
\subsubsection[{elektra\+Plugin\+Get\+Config}]{\setlength{\rightskip}{0pt plus 5cm}Key\+Set$\ast$ elektra\+Plugin\+Get\+Config (
\begin{DoxyParamCaption}
\item[{Plugin $\ast$}]{handle}
\end{DoxyParamCaption}
)}}\label{group__plugin_ga644bead796506c172817724051c977c9}


Returns the configuration of that plugin. 


\begin{DoxyItemize}
\item The user/ config holds plugin specific configuration
\item The system/ config holds backend specific configuration
\end{DoxyItemize}

So prefer cascading lookups to honor both.


\begin{DoxyParams}{Parameters}
{\em handle} & a pointer to the plugin\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
keyset to the configuration for that plugin 
\end{DoxyReturn}
\hypertarget{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}{\index{Plugins@{Plugins}!elektra\+Plugin\+Get\+Data@{elektra\+Plugin\+Get\+Data}}
\index{elektra\+Plugin\+Get\+Data@{elektra\+Plugin\+Get\+Data}!Plugins@{Plugins}}
\subsubsection[{elektra\+Plugin\+Get\+Data}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ elektra\+Plugin\+Get\+Data (
\begin{DoxyParamCaption}
\item[{Plugin $\ast$}]{plugin}
\end{DoxyParamCaption}
)}}\label{group__plugin_gaafcf3216b46292f222b8cc7828b4dd20}


Get a pointer to any plugin related data stored before. 


\begin{DoxyParams}{Parameters}
{\em plugin} & a pointer to the plugin \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
a pointer to the data 
\end{DoxyReturn}
\hypertarget{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}{\index{Plugins@{Plugins}!elektra\+Plugin\+Set\+Data@{elektra\+Plugin\+Set\+Data}}
\index{elektra\+Plugin\+Set\+Data@{elektra\+Plugin\+Set\+Data}!Plugins@{Plugins}}
\subsubsection[{elektra\+Plugin\+Set\+Data}]{\setlength{\rightskip}{0pt plus 5cm}void elektra\+Plugin\+Set\+Data (
\begin{DoxyParamCaption}
\item[{Plugin $\ast$}]{plugin, }
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{group__plugin_gaf4b941a52ff55d0ca2a9158d90208ef2}


Store a pointer to any plugin related data. 


\begin{DoxyParams}{Parameters}
{\em plugin} & a pointer to the plugin \\
\hline
{\em data} & the pointer to the data \\
\hline
\end{DoxyParams}

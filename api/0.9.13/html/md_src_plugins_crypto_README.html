<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: crypto</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.9.13</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: crypto </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about crypto plugin is in keys below</li>
<li>infos/author = Peter Nirschl <a href="#" onclick="location.href='mai'+'lto:'+'pet'+'er'+'.ni'+'rs'+'chl'+'@g'+'mai'+'l.'+'com'; return false;">peter<span style="display: none;">.nosp@m.</span>.nir<span style="display: none;">.nosp@m.</span>schl@<span style="display: none;">.nosp@m.</span>gmai<span style="display: none;">.nosp@m.</span>l.com</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = crypto</li>
<li>infos/needs =</li>
<li>infos/recommends =</li>
<li>infos/placements = postgetstorage presetstorage</li>
<li>infos/status = unittest configurable memleak unfinished discouraged</li>
<li>infos/metadata = crypto/encrypt</li>
<li>infos/description = Cryptographic operations</li>
</ul>
<h1><a class="anchor" id="src_plugins_crypto_README_md"></a>
Introduction</h1>
<p>This plugin is a filter plugin allowing Elektra to encrypt values before they are persisted and to decrypt values after they have been read from a backend.</p>
<p>The idea is to provide protection of sensible values before they are persisted. This means the value of a key needs to be encrypted before it is written to a file or a database. It also needs to be decrypted whenever an admissible access (read) is being performed.</p>
<p>The users of Elektra should not be bothered too much with the internals of the cryptographic operations. Also the cryptographic keys must never be exposed to the outside of the crypto module.</p>
<p>The crypto plugin uses libgcrypt as provider of cryptographic operations.</p>
<h1><a class="anchor" id="autotoc_md113"></a>
Installation</h1>
<p>See <a class="el" href="doc_INSTALL_md.html">installation</a>. The package is called <code>libelektra5-crypto</code>.</p>
<h1><a class="anchor" id="autotoc_md114"></a>
Dependencies</h1>
<ul>
<li><code>libgcrypt20-dev</code> or <code>libgcrypt-devel</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md115"></a>
GnuPG (GPG)</h2>
<p>GPG is a run-time dependency of the crypto plugin. Either the <code>gpg</code> or the <code>gpg2</code> binary must be installed when using the plugin. Note that <code>gpg2</code> will be preferred if both versions are available. The GPG binary can be configured in the plugin configuration as <code>/gpg/bin</code> (see <em>GPG Configuration</em> below). If no such configuration is provided, the plugin will look at the PATH environment variable to find the GPG binaries.</p>
<h1><a class="anchor" id="autotoc_md116"></a>
How to compile</h1>
<p>Add "crypto" to the <code>PLUGINS</code> variable in <code>CMakeCache.txt</code> and re-run <code>cmake</code>.</p>
<p>An example <code>CMakeCache.txt</code> may contain the following variable:</p>
<div class="fragment"><div class="line">PLUGINS=crypto</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md117"></a>
macOS</h2>
<p>The crypto plugin works under macOS Sierra (Version 10.12.3 (16D32)).</p>
<p>To set up the build environment on macOS Sierra we recommend using <a href="http://brew.sh/">Homebrew</a>. Follow these steps to get everything up and running:</p>
<div class="fragment"><div class="line">brew install libgcrypt pkg-config cmake</div>
</div><!-- fragment --><p>Also a GPG installation is required. The <a href="https://gpgtools.org">GPG Tools</a> work fine for us.</p>
<h1><a class="anchor" id="autotoc_md118"></a>
Restrictions</h1>
<p>At the moment the plugin will only run on Unix/Linux-like systems, that provide implementations for <code>fork ()</code> and <code>execv ()</code>.</p>
<h1><a class="anchor" id="autotoc_md119"></a>
Examples</h1>
<p>To mount a backend with the crypto plugin that uses the GPG key 9CCC3B514E196C6308CCD230666260C14A525406, use:</p>
<div class="fragment"><div class="line">sudo kdb mount test.ecf user:/tests/t crypto &quot;crypto/key=9CCC3B514E196C6308CCD230666260C14A525406&quot;</div>
</div><!-- fragment --><p>Now you can specify a key <code>user:/t/a</code> and protect its content by using:</p>
<div class="fragment"><div class="line">kdb set user:/tests/t/a</div>
<div class="line">kdb meta-set user:/tests/t/a crypto/encrypt 1</div>
<div class="line">kdb set user:/tests/t/a &quot;secret&quot;</div>
</div><!-- fragment --><p>The value of <code>user:/t/a</code> will be stored encrypted. But you can still access the original value using <code>kdb get</code>:</p>
<div class="fragment"><div class="line">kdb get user:/tests/t/a</div>
</div><!-- fragment --><p>To unmount it you can run:</p>
<div class="fragment"><div class="line">sudo kdb umount user:/tests/t</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md120"></a>
Configuration</h1>
<h2><a class="anchor" id="autotoc_md121"></a>
GPG Configuration</h2>
<p>The path to the gpg binary can be specified in</p>
<div class="fragment"><div class="line">/gpg/bin</div>
</div><!-- fragment --><p>The GPG recipient keys can be specified as <code>encrypt/key</code> directly. If you want to use more than one key, just enumerate like:</p>
<div class="fragment"><div class="line">encrypt/key/#0</div>
<div class="line">encrypt/key/#1</div>
</div><!-- fragment --><p>If more than one key is defined, every owner of the corresponding private key can decrypt the values of the backend. This might be useful if applications run with their own user but the administrator has to update the configuration. The administrator then only needs the public key of the application user in her keyring, set the values and the application will be able to decrypt the values.</p>
<p>If you are not sure which keys are available to you, the <code>kdb</code> program will give you suggestions in the error description. For example you can type:</p>
<div class="fragment"><div class="line">sudo kdb mount test.ecf user:/tests/t crypto</div>
<div class="line"># RET: 7</div>
</div><!-- fragment --><p>In the error description you should see something like:</p>
<div class="fragment"><div class="line">The command ./bin/kdb mount terminated unsuccessfully with the info:</div>
<div class="line">The provided plugin configuration is not valid!</div>
<div class="line">Errors/Warnings during the check were:</div>
<div class="line">Sorry, module crypto issued the error C01310:</div>
<div class="line">Failed to create handle. Reason: Missing GPG key (specified as encrypt/key) in plugin configuration. Available key IDs are: B815F1334CF4F830187A784256CFA3A5C54DF8E4,847378ABCF0A552B48082A80C52E8E92F785163F</div>
<div class="line">Please report the issue at https://issues.libelektra.org/</div>
</div><!-- fragment --><p>This means that the following keys are available:</p>
<ul>
<li>B815F1334CF4F830187A784256CFA3A5C54DF8E4</li>
<li>847378ABCF0A552B48082A80C52E8E92F785163F</li>
</ul>
<p>So the full mount command could look like this:</p>
<div class="fragment"><div class="line">sudo kdb mount test.ecf user:/tests/t crypto &quot;crypto/key=847378ABCF0A552B48082A80C52E8E92F785163F&quot;</div>
</div><!-- fragment --><p>To unmount it you can run:</p>
<div class="fragment"><div class="line">sudo kdb umount user:/tests/t</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md122"></a>
Cryptographic Operations</h2>
<p>Please note that these options are meant for experts only. If you do not provide these configuration options, secure defaults are being used.</p>
<p>The length of the master password that protects all the other keys can be set in:</p>
<div class="fragment"><div class="line">/crypto/masterpasswordlength</div>
</div><!-- fragment --><p>The number of iterations that are to be performed in the PBKDF2 call can be set in:</p>
<div class="fragment"><div class="line">/crypto/iterations</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md123"></a>
Library Shutdown</h2>
<p>The following key must be set to <code>"1"</code> within the plugin configuration, if the plugin should shut down the crypto library:</p>
<div class="fragment"><div class="line">/shutdown</div>
</div><!-- fragment --><p>Per default shutdown is disabled to prevent applications like the qt-gui from crashing. Shutdown is enabled in the unit tests to prevent memory leaks.</p>
<h1><a class="anchor" id="autotoc_md124"></a>
Technical Details</h1>
<h2><a class="anchor" id="autotoc_md125"></a>
Ciphers and Mode of Operation</h2>
<p>The crypto plugin uses the Advanced Encryption Standard (AES) in Cipher Block Chaining Mode (CBC) with a key size of 256 bit. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

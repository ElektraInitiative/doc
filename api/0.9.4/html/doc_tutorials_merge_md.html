<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: How-To: kdb merge</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How-To: kdb merge </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The kdb tool allows users to access and perform functions on the Elektra Key Database from the command line. We added a new command to this very useful tool, the <code>merge</code> command. This command allows a user to perform a three-way merge of KeySets from the <code>kdb</code> tool.</p>
<p>The command to use this tool is:</p>
<div class="fragment"><div class="line">kdb merge [options] ourpath theirpath basepath resultpath</div></div><!-- fragment --><p>The standard naming scheme for a three-way merge consists of <code>ours</code>, <code>theirs</code>, and <code>base</code>:</p>
<ul>
<li><code>ours</code> refers to the local copy of a file</li>
<li><code>theirs</code> refers to a remote copy</li>
<li><code>base</code> refers to their common ancestor.</li>
</ul>
<p>This works very similarly for KeySets, especially ones that consist of mounted configuration files.</p>
<p>For mounted configuration files:</p>
<ul>
<li><code>ours</code> should be the user's copy</li>
<li><code>theirs</code> would be the maintainers copy,</li>
<li><code>base</code> would be the previous version of the maintainer's copy.</li>
</ul>
<p>If the user is just trying to accomplish a three-way merge using any two arbitrary keysets that share a base, it doesn't matter which ones are defined as <code>ours</code> or <code>theirs</code> as long as they use the correct base KeySet. In <code>kdb merge</code>, <code>ourpath</code>, <code>theirpath</code>, and <code>basepath</code> work just like <code>ours</code>, <code>theirs</code>, and <code>base</code> except each one represents the root of a KeySet. The argument <code>resultpath</code> is pretty self-explanatory, it is just where you want the result of the merge to be saved under. It's worth noting, <code>resultpath</code> should be empty before attempting a merge, otherwise there can be unintended consequences.</p>
<p>As for the options, there are a few basic options:</p>
<ul>
<li><code>-i</code>, <code>--interactive</code>: which attempts the merge in an interactive way</li>
<li><code>-t</code>, <code>--test</code>: which tests the proposed merge and informs you about possible conflicts</li>
<li><code>-f</code>, <code>--force</code>: which overwrites any Keys in <code>resultpath</code></li>
</ul>
<p>Additionally there is an option to specify a merge strategy, which is very important.</p>
<p>The option for strategy is:</p>
<ul>
<li><code>-s &lt;name&gt;</code>, <code>--strategy &lt;name&gt;</code>: which is used to specify a strategy to use in case of a conflict</li>
</ul>
<p>The current list of strategies are:</p>
<ul>
<li><code>preserve</code>: the merge will fail if a conflict is detected</li>
<li><code>ours</code>: the merge will use our version during a conflict</li>
<li><code>theirs</code>: the merge will use their version during a conflict</li>
<li><code>base</code>: the merge will use the base version during a conflict</li>
</ul>
<p>If no strategy is specified, the merge will default to the preserve strategy as to not risk making the wrong decision. If any of the other strategies are specified, when a conflict is detected, merge will use the Key specified by the strategy (<code>ours</code>, <code>theirs</code>, or <code>base</code>) for the resulting Key.</p>
<p>Basic Usage:</p>
<div class="fragment"><div class="line">kdb merge system:/hosts/ours system:/hosts/theirs system:/hosts/base system:/hosts/result</div></div><!-- fragment --><p>Here are examples of the same KeySets being merged using different strategies. The KeySets are mounted using a property format, the left side of '=' is the name of the Key, the right side is its string value.</p>
<p>We start with the base KeySet, <code>system:/base</code>:</p>
<div class="fragment"><div class="line">key1=1</div><div class="line">key2=2</div><div class="line">key3=3</div><div class="line">key4=4</div><div class="line">key5=5</div></div><!-- fragment --><p>Here is our KeySet, <code>system:/ours</code>:</p>
<div class="fragment"><div class="line">key1=apple</div><div class="line">key2=2</div><div class="line">key3=3</div><div class="line">key5=fish</div></div><!-- fragment --><p>Here is their KeySet, <code>system:/theirs</code>:</p>
<div class="fragment"><div class="line">key1=1</div><div class="line">key2=pie</div><div class="line">key4=banana</div><div class="line">key5=5</div></div><!-- fragment --><p>Now we will examine the result KeySet with the different strategies.</p>
<div class="fragment"><div class="line">kdb merge -s preserve system:/ours system:/theirs system:/base system:/result</div></div><!-- fragment --><p>The merge will fail because of a conflict for <code>key4</code> since <code>key4</code> was deleted in our KeySet and edited in their KeySet. Since we used preserve, the merge fails and the result KeySet is not saved.</p>
<div class="fragment"><div class="line">kdb merge -s ours system:/ours system:/theirs system:/base system:/result</div></div><!-- fragment --><p>The result KeySet, system:/result will be:</p>
<div class="fragment"><div class="line">key1=apple</div><div class="line">key2=pie</div><div class="line">key5=fish</div></div><!-- fragment --><p>Because the conflict of <code>key4</code> (it was deleted in <code>ours</code> but changed in <code>theirs</code>) is solved by using our copy thus deleting the key.</p>
<div class="fragment"><div class="line">kdb merge -s theirs system:/ours system:/theirs system:/base system:/result</div></div><!-- fragment --><p>The result KeySet, <code>system:/result</code> will be:</p>
<div class="fragment"><div class="line">key1=apple</div><div class="line">key2=pie</div><div class="line">key4=banana</div><div class="line">key5=fish</div></div><!-- fragment --><p>Here, the conflict of <code>key4</code> is solved by using their copy, thus <code>key4=banana</code>.</p>
<div class="fragment"><div class="line">kdb merge -s base system:/ours system:/theirs system:/base system:/result</div></div><!-- fragment --><p>The result KeySet, <code>system:/result</code> will be:</p>
<div class="fragment"><div class="line">key1=apple</div><div class="line">key2=pie</div><div class="line">key4=4</div><div class="line">key5=5</div></div><!-- fragment --><p>The same conflict is found in <code>key4</code>, but here we use the <code>base</code> version to solve it so <code>key4=4</code>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

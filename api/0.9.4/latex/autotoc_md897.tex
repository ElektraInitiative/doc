
\begin{DoxyItemize}
\item infos = Information about the yanlr plugin is in keys below
\item infos/author = René Schwaiger \href{mailto:sanssecours@me.com}{\tt sanssecours@me.\+com}
\item infos/licence = B\+SD
\item infos/needs = directoryvalue yamlsmith
\item infos/provides = storage/yaml
\item infos/recommends =
\item infos/placements = getstorage
\item infos/status = maintained unittest preview experimental unfinished nodoc concept discouraged
\item infos/metadata =
\item infos/description = This storage plugin use a parser generated by A\+N\+T\+LR to read Y\+A\+ML files
\end{DoxyItemize}\hypertarget{autotoc_md897_src_plugins_yanlr_README_md}{}\section{Yan LR}\label{autotoc_md897_src_plugins_yanlr_README_md}
\hypertarget{autotoc_md897_autotoc_md898}{}\subsection{Introduction}\label{autotoc_md897_autotoc_md898}
This plugin uses A\+N\+T\+LR to generate a parser for the \href{http://yaml.org}{\tt Y\+A\+ML} serialization format. Apart from the hand written \href{/home/jenkins/workspace/libelektra-release/src/plugins/yanlr/yaml_lexer.cpp}{\tt lexer}, all other parts of the plugin use standard A\+N\+T\+LR tools, such as


\begin{DoxyItemize}
\item an A\+N\+T\+LR parser grammar,
\item a \href{/home/jenkins/workspace/libelektra-release/src/plugins/yanlr/listener.cpp}{\tt listener}, that reacts to matches in the grammar building a key set, and
\item an \href{/home/jenkins/workspace/libelektra-release/src/plugins/yanlr/error_listener.cpp}{\tt error listener} that reacts to syntax errors
\end{DoxyItemize}\hypertarget{autotoc_md897_autotoc_md899}{}\subsection{Dependencies}\label{autotoc_md897_autotoc_md899}
The plugin requires


\begin{DoxyItemize}
\item \href{https://www.antlr.org}{\tt A\+N\+T\+LR} {\ttfamily 4.\+6} or later, and
\item \href{https://github.com/antlr/antlr4/tree/master/runtime/Cpp}{\tt A\+N\+T\+LR 4’s C++ runtime}.
\end{DoxyItemize}

If packages for those libraries are not available for your system, you can install them manually. For more information about that please take a look \href{https://www.antlr.org}{\tt at A\+N\+T\+L\+R’s homepage} and at the \href{https://github.com/antlr/antlr4/tree/master/runtime/Cpp}{\tt Read\+Me of the A\+N\+T\+LR C++ runtime}.

Please note that we only tested the plugin with A\+N\+T\+LR {\ttfamily 4.\+7.\+1} (and later versions of A\+N\+T\+LR).\hypertarget{autotoc_md897_autotoc_md900}{}\subsubsection{Arch Linux}\label{autotoc_md897_autotoc_md900}
In \href{https://www.archlinux.org/}{\tt Arch Linux} the required packages are called \href{https://www.archlinux.org/packages/extra/any/antlr4/}{\tt {\ttfamily antlr4}} and \href{https://www.archlinux.org/packages/community/x86_64/antlr4-runtime/}{\tt {\ttfamily antlr4-\/runtime}}.


\begin{DoxyCode}
pacman -Sy --noconfirm antlr4 antlr4-runtime
\end{DoxyCode}
\hypertarget{autotoc_md897_autotoc_md901}{}\subsubsection{Debian Linux}\label{autotoc_md897_autotoc_md901}
In Debian Linux you need the packages \href{https://packages.debian.org/sid/antlr4}{\tt {\ttfamily antlr4}} and \href{https://packages.debian.org/sid/libantlr4-runtime-dev}{\tt {\ttfamily libantlr4-\/runtime-\/dev}}.


\begin{DoxyCode}
apt-get -y install antlr4 libantlr4-runtime-dev
\end{DoxyCode}
\hypertarget{autotoc_md897_autotoc_md902}{}\subsubsection{mac\+OS}\label{autotoc_md897_autotoc_md902}
To install the dependencies of the plugin using \href{https://brew.sh}{\tt Homebrew}, please use the command below.


\begin{DoxyCode}
brew install antlr antlr4-cpp-runtime
\end{DoxyCode}
\hypertarget{autotoc_md897_autotoc_md903}{}\subsection{Examples}\label{autotoc_md897_autotoc_md903}
\hypertarget{autotoc_md897_autotoc_md904}{}\subsubsection{Mappings}\label{autotoc_md897_autotoc_md904}
``{\ttfamily  @section autotoc\+\_\+md905 Mount plugin to}user\+:/tests/yanlr` sudo kdb mount config.\+yaml user\+:/tests/yanlr yanlr\hypertarget{autotoc_md897_autotoc_md906}{}\section{Manually add some mappings to the configuration file}\label{autotoc_md897_autotoc_md906}
printf \textquotesingle{}all \+: circles presuppose~\newline
\textquotesingle{} $>$ {\ttfamily kdb file user\+:/tests/yanlr} printf \textquotesingle{}hello \+: world~\newline
\textquotesingle{} $>$$>$ {\ttfamily kdb file user\+:/tests/yanlr}

kdb ls /tests/yanlr \#$>$ user\+:/tests/yanlr/all \#$>$ user\+:/tests/yanlr/hello

kdb get user\+:/tests/yanlr/all \#$>$ circles presuppose\hypertarget{autotoc_md897_autotoc_md907}{}\section{Store value at root of mountpoint}\label{autotoc_md897_autotoc_md907}
kdb set user\+:/tests/yanlr \textquotesingle{}Mount Eerie\textquotesingle{} kdb get user\+:/tests/yanlr \#$>$ Mount Eerie\hypertarget{autotoc_md897_autotoc_md908}{}\section{Add new key-\/value pairs}\label{autotoc_md897_autotoc_md908}
\hypertarget{autotoc_md897_autotoc_md909}{}\section{Yan L\+R actually uses the Y\+A\+M\+L Smith plugin to write data}\label{autotoc_md897_autotoc_md909}
kdb set user\+:/tests/yanlr/brand new kdb set user\+:/tests/yanlr/brand/new eyes kdb set user\+:/tests/yanlr/dance/gavin \textquotesingle{}Dance!\textquotesingle{}

kdb ls /tests/yanlr \#$>$ user\+:/tests/yanlr \#$>$ user\+:/tests/yanlr/all \#$>$ user\+:/tests/yanlr/brand \#$>$ user\+:/tests/yanlr/brand/new \#$>$ user\+:/tests/yanlr/dance/gavin \#$>$ user\+:/tests/yanlr/hello

kdb get /tests/yanlr/hello \#$>$ world kdb get user\+:/tests/yanlr/brand \#$>$ new kdb get /tests/yanlr/dance/gavin \#$>$ Dance!\hypertarget{autotoc_md897_autotoc_md910}{}\section{Undo modifications to the key database}\label{autotoc_md897_autotoc_md910}
kdb rm -\/r user\+:/tests/yanlr sudo kdb umount user\+:/tests/yanlr 
\begin{DoxyCode}
### Arrays
\end{DoxyCode}
 \hypertarget{autotoc_md897_autotoc_md911}{}\section{Mount plugin to `/tests/yanlr`}\label{autotoc_md897_autotoc_md911}
sudo kdb mount config.\+yaml user\+:/tests/yanlr yanlr\hypertarget{autotoc_md897_autotoc_md912}{}\section{Manually add a sequences to the configuration file}\label{autotoc_md897_autotoc_md912}
printf \textquotesingle{}primes\+:~\newline
\textquotesingle{} $>$ {\ttfamily kdb file user\+:/tests/yanlr} printf \textquotesingle{} -\/ two~\newline
\textquotesingle{} $>$$>$ {\ttfamily kdb file user\+:/tests/yanlr} printf \textquotesingle{} -\/ three~\newline
\textquotesingle{} $>$$>$ {\ttfamily kdb file user\+:/tests/yanlr} printf \textquotesingle{} -\/ five~\newline
\textquotesingle{} $>$$>$ {\ttfamily kdb file user\+:/tests/yanlr}

kdb ls user\+:/tests/yanlr \#$>$ user\+:/tests/yanlr/primes \#$>$ user\+:/tests/yanlr/primes/\#0 \#$>$ user\+:/tests/yanlr/primes/\#1 \#$>$ user\+:/tests/yanlr/primes/\#2

kdb set user\+:/tests/yanlr/primes/\#3 seven\hypertarget{autotoc_md897_autotoc_md913}{}\section{Retrieve index of last array element}\label{autotoc_md897_autotoc_md913}
kdb meta-\/get user\+:/tests/yanlr/primes array \#$>$ \#3\hypertarget{autotoc_md897_autotoc_md914}{}\section{Undo modifications to the key database}\label{autotoc_md897_autotoc_md914}
kdb rm -\/r user\+:/tests/yanlr sudo kdb umount user\+:/tests/yanlr 
\begin{DoxyCode}
### Boolean Values
\end{DoxyCode}
 \hypertarget{autotoc_md897_autotoc_md915}{}\section{Mount plugin to `/tests/yanlr`}\label{autotoc_md897_autotoc_md915}
sudo kdb mount config.\+yaml user\+:/tests/yanlr yanlr\hypertarget{autotoc_md897_autotoc_md916}{}\section{Manually add a boolean value to the database}\label{autotoc_md897_autotoc_md916}
printf \textquotesingle{}boolean\+: true\textquotesingle{} $>$ {\ttfamily kdb file user\+:/tests/yanlr}\hypertarget{autotoc_md897_autotoc_md917}{}\section{Elektra stores boolean values as `0` and `1`}\label{autotoc_md897_autotoc_md917}
kdb get user\+:/tests/yanlr/boolean \#$>$ 1\hypertarget{autotoc_md897_autotoc_md918}{}\section{Undo modifications to the key database}\label{autotoc_md897_autotoc_md918}
kdb rm -\/r user\+:/tests/yanlr sudo kdb umount user\+:/tests/yanlr 
\begin{DoxyCode}
### Null Values
\end{DoxyCode}
 \hypertarget{autotoc_md897_autotoc_md919}{}\section{Mount plugin to `/tests/yanlr`}\label{autotoc_md897_autotoc_md919}
sudo kdb mount config.\+yaml user\+:/tests/yanlr yanlr\hypertarget{autotoc_md897_autotoc_md920}{}\section{Manually add a null value to the database}\label{autotoc_md897_autotoc_md920}
printf \textquotesingle{}\char`\"{}null\char`\"{}\+:\textquotesingle{} $>$ {\ttfamily kdb file user\+:/tests/yanlr}\hypertarget{autotoc_md897_autotoc_md921}{}\section{Elektra adds the metakey `binary` for empty keys}\label{autotoc_md897_autotoc_md921}
kdb meta-\/ls user\+:/tests/yanlr/null \#$>$ binary\hypertarget{autotoc_md897_autotoc_md922}{}\section{Undo modifications to the key database}\label{autotoc_md897_autotoc_md922}
kdb rm -\/r user\+:/tests/yanlr sudo kdb umount user\+:/tests/yanlr 
\begin{DoxyCode}
### Error Messages
\end{DoxyCode}
 \hypertarget{autotoc_md897_autotoc_md923}{}\section{Mount plugin}\label{autotoc_md897_autotoc_md923}
sudo kdb mount config.\+yaml user\+:/tests/yanlr yanlr\hypertarget{autotoc_md897_autotoc_md924}{}\section{Manually add syntactically incorrect data}\label{autotoc_md897_autotoc_md924}
printf -- \textquotesingle{}key\+: -\/ element 1~\newline
\textquotesingle{} $>$ {\ttfamily kdb file user\+:/tests/yanlr} printf -- \textquotesingle{}-\/ element 2 \# Incorrect Indentation!\textquotesingle{} $>$$>$ {\ttfamily kdb file user\+:/tests/yanlr}\hypertarget{autotoc_md897_autotoc_md925}{}\section{The plugin reports the location of the error}\label{autotoc_md897_autotoc_md925}
kdb ls user\+:/tests/yanlr \hypertarget{autotoc_md897_autotoc_md926}{}\section{R\+E\+T\+: 5}\label{autotoc_md897_autotoc_md926}
\hypertarget{autotoc_md897_autotoc_md927}{}\section{S\+T\+D\+E\+R\+R\+: .$\ast$/config.\+yaml\+:2\+:1\+: mismatched input \textquotesingle{}-\/ \textquotesingle{} expecting end of map.$\ast$}\label{autotoc_md897_autotoc_md927}
\hypertarget{autotoc_md897_autotoc_md928}{}\section{Let us look at the error message more closely.}\label{autotoc_md897_autotoc_md928}
\hypertarget{autotoc_md897_autotoc_md929}{}\section{Since the location of `config.\+yaml` depends on the current user and O\+S,}\label{autotoc_md897_autotoc_md929}
\hypertarget{autotoc_md897_autotoc_md930}{}\section{we store the text before `config.\+yaml` as `user\+:/tests/error/prefix`.}\label{autotoc_md897_autotoc_md930}
kdb set user\+:/tests/error \char`\"{}\$(2$>$\&1 kdb ls user\+:/tests/yanlr)\char`\"{} kdb set user\+:/tests/error/prefix \char`\"{}\$(kdb get user\+:/tests/error $\vert$ grep \textquotesingle{}config.\+yaml\textquotesingle{} $\vert$ head -\/1 $\vert$ sed -\/\+E \textquotesingle{}s/(.$\ast$)config.\+yaml.$\ast$/\textbackslash{}1/\textquotesingle{})\char`\"{} \hypertarget{autotoc_md897_autotoc_md931}{}\section{We also store the length of the prefix, so we can remove it from every}\label{autotoc_md897_autotoc_md931}
\hypertarget{autotoc_md897_autotoc_md932}{}\section{line of the error message.}\label{autotoc_md897_autotoc_md932}
kdb set user\+:/tests/error/prefix/length \char`\"{}\$(kdb get user\+:/tests/error/prefix $\vert$ wc -\/c $\vert$ sed \textquotesingle{}s/\mbox{[} \mbox{]}$\ast$//g\textquotesingle{})\char`\"{}\hypertarget{autotoc_md897_autotoc_md933}{}\section{Since we only want to look at the “reason” of the error, we}\label{autotoc_md897_autotoc_md933}
\hypertarget{autotoc_md897_autotoc_md934}{}\section{remove the other part of the error message with `head` and `tail`.}\label{autotoc_md897_autotoc_md934}
kdb get user\+:/tests/error $\vert$ tail -\/n6 $\vert$ cut -\/c\char`\"{}\$(kdb get user\+:/tests/error/prefix/length $\vert$ tr -\/d \textquotesingle{}\textbackslash{}n\textquotesingle{})\char`\"{}-\/ \#$>$ config.\+yaml\+:2\+:1\+: mismatched input \textquotesingle{}-\/ \textquotesingle{} expecting end of map \#$>$ -\/ element 2 \# Incorrect Indentation! \#$>$ $^\wedge$$^\wedge$ \#$>$ config.\+yaml\+:2\+:37\+: extraneous input \textquotesingle{}end of map\textquotesingle{} expecting end of document \#$>$ -\/ element 2 \# Incorrect Indentation! \#$>$ $^\wedge$\hypertarget{autotoc_md897_autotoc_md935}{}\section{Fix syntax error}\label{autotoc_md897_autotoc_md935}
printf -- \textquotesingle{}key\+: -\/ element 1~\newline
\textquotesingle{} $>$ {\ttfamily kdb file user\+:/tests/yanlr} printf -- \textquotesingle{} -\/ element 2 \# Fixed!\textquotesingle{} $>$$>$ {\ttfamily kdb file user\+:/tests/yanlr}

kdb ls user\+:/tests/yanlr \#$>$ user\+:/tests/yanlr/key \#$>$ user\+:/tests/yanlr/key/\#0 \#$>$ user\+:/tests/yanlr/key/\#1\hypertarget{autotoc_md897_autotoc_md936}{}\section{Undo modifications}\label{autotoc_md897_autotoc_md936}
kdb rm -\/r user\+:/tests/error kdb rm -\/r user\+:/tests/yanlr sudo kdb umount user\+:/tests/yanlr 
\begin{DoxyCode}
## Limitations

- The plugin does **not support**

  - plain scalars that span **multiple lines**,
  - **special characters** inside double quoted scalars,
  - other **line endings** than `\(\backslash\)n` (Unix line endings),
  - **block scalars**,
  - **flow collections**,
  - **tags**,
  - **anchors & aliases**,
  - **multiple documents**, and
  - document **start and end markers**

  .

- Yan LR does not provide write support for data. Please use the [YAML Smith](@ref
       src\_plugins\_yamlsmith\_README\_md) plugin for that purpose.

### Input Restrictions

The plugin should, but does not, limit the amount

- of **nesting levels**,
- the **length of numbers**, and
- the **length of scalars**

. These restrictions would make it less easy to crash the parser, by feeding it unrestricted data.

### Duplicate Keys

Currently the plugin parses the input

```yaml
duplicate: one
duplicate: two
\end{DoxyCode}


storing the value {\ttfamily two}. According to the Y\+A\+ML specification the parser should not allow duplicated keys, and instead fail with an error, for the input above.
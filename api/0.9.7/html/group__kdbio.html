<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: I/O Bindings</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">I/O Bindings</div>  </div>
</div><!--header-->
<div class="contents">

<p>Asynchronous I/O feature.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:kdbio_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kdbio_8h.html">kdbio.h</a></td></tr>
<tr class="memdesc:kdbio_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Elektra-I/O structures for I/O bindings, plugins and applications. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:kdbioplugin_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kdbioplugin_8h.html">kdbioplugin.h</a></td></tr>
<tr class="memdesc:kdbioplugin_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Elektra-I/O functions and declarations for the I/O binding test suite. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:kdbiotest_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kdbiotest_8h.html">kdbiotest.h</a></td></tr>
<tr class="memdesc:kdbiotest_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Elektra-I/O functions and declarations for the I/O binding test suite. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Asynchronous I/O feature. </p>
<h1><a class="anchor" id="async"></a>
Asynchronous I/O with Elektra</h1>
<h2><a class="anchor" id="Overview"></a>
Overview</h2>
<p>I/O bindings allow Elektra and its plugins to integrate into different main loop APIs using a thin abstraction layer. For example, this is used for notification transport plugins which receive notifications using ZeroMQ, D-Bus, etc.</p>
<p>I/O bindings are created using an initialization function for a specific main loop API. Please see <a href="https://www.libelektra.org/bindings/readme">bindings</a> for available I/O bindings and their according READMEs for more details. After creating, an I/O binding is associated to a KDB instance using elektraIoSetBinding(). Having different I/O bindings (e.g. same or different main loop APIs) for different KDB instances is supported.</p>
<p>The remainder of this page contains useful details for creating I/O bindings and using the operations provided by these bindings. Application developers are normally not required to do those tasks. For more information about using I/O bindings from an application developer perspective please read the <a href="doc_tutorials_notifications_md.html">Notification Tutorial</a>.</p>
<h2><a class="anchor" id="Introduction"></a>
Introduction</h2>
<p>An I/O binding needs to handle different types of operations. These operations are used by plugins that require asynchronous I/O. In this document we will call developers of these plugins "users". The three types of operations are:</p><ul>
<li>file descriptor watch operations</li>
<li>timer operations</li>
<li>idle operations</li>
</ul>
<p>Each operation has a user callback that is called under the following conditions:</p><ul>
<li>For file descriptor watch operations a user callback shall be called whenever the descriptor status matches the "flags" bitmask (readable, writable or both).</li>
<li>For timer operations a user callback shall be called whenever a given interval has elapsed.</li>
<li>Idle operations shall call a user callback whenever possible without interfering other operations. These operations are used for bulk data transfers or expensive calculations that would stall other operations when done at once.</li>
</ul>
<p>Each operation has different properties. The following properties are shared by all operations:</p><ul>
<li>callback (<a class="el" href="io_8c.html#a885381fdd55cf957af1d65db7522899a" title="Get callback of file descriptor watch operation.">elektraIoFdGetCallback()</a>;set by <a class="el" href="io_8c.html#a3804183da1aecdfcf09455d246c3891c" title="Create a new file descriptor watch operation.">elektraIoNewFdOperation()</a>) user callback</li>
<li>enabled (<a class="el" href="io_8c.html#af35cfd8a33db0170e06cb8c3cdc08244" title="Check if file descriptor watch operation is enabled or disabled.">elektraIoFdIsEnabled()</a>;<a class="el" href="io_8c.html#a56f8b0059e6c7708681624d1994e4b44" title="Enable or disable file descriptor watch operation.">elektraIoFdSetEnabled()</a>) indicates whether the operation is enabled. No callback shall be fired when an operation is disabled.</li>
<li>privateData (<a class="el" href="io_8c.html#a6a2a281c9e437dd1d660f1310fa06108" title="Get private data from operation.">elektraIoFdGetData()</a>;set by <a class="el" href="io_8c.html#a3804183da1aecdfcf09455d246c3891c" title="Create a new file descriptor watch operation.">elektraIoNewFdOperation()</a>) pointer to data owned by user</li>
<li>bindingData (<a class="el" href="io_8c.html#a6103b457ed1440d0490acf0a6ec17386" title="Get private binding data from operation.">elektraIoFdGetBindingData()</a>;<a class="el" href="io_8c.html#ae02ec122aafa67b7dd92d9c3daa6499e" title="Set private binding data for operation.">elektraIoFdSetBindingData()</a>) pointer to data owned by I/O binding</li>
</ul>
<p>For brevity only file descriptor operation variants are listed here. Variants for timer and idle operations are called <code>elektraIoTimer*</code> and <code>elektraIoIdle*</code>. All <code>elektraIo*</code> utility functions are provided by the <code>elektra-io</code> library.</p>
<p>File descriptor watch operations have the following additional properties:</p><ul>
<li>fd (<a class="el" href="io_8c.html#a7dec6afadd09f6350f9ad642906fc88a" title="Get file descriptor number from operation.">elektraIoFdGetFd()</a>;set by <a class="el" href="io_8c.html#a3804183da1aecdfcf09455d246c3891c" title="Create a new file descriptor watch operation.">elektraIoNewFdOperation()</a>) file descriptor number to be watched</li>
<li>flags (<a class="el" href="io_8c.html#a8e2d356be0d89af3e46ebc8ce675db37" title="Get flag bitmask of file descriptor watch operation.">elektraIoFdGetFlags()</a>;<a class="el" href="io_8c.html#a1fd34686b0b3b1db5f460ea8c40ba5a8" title="Update flag bitmask of file descriptor watch operation.">elektraIoFdSetFlags()</a>) flags bitmask</li>
</ul>
<p>Timer operations have the following additional properties:</p><ul>
<li>interval (<a class="el" href="io_8c.html#abc383110a8cb712a0a35b958b4e446ea" title="Get interval of timer operation.">elektraIoTimerGetInterval()</a>;<a class="el" href="io_8c.html#a3e317e4c6e5869f296261c24312507ed" title="Update interval of timer operation.">elektraIoTimerSetInterval()</a>) minimum interval in milliseconds after the user callback shall be fired</li>
</ul>
<p>Idle operations have no additional properties.</p>
<dl class="section user"><dt>Creating a new I/O Binding</dt><dd></dd></dl>
<p>Every I/O binding needs to provide ten functions:</p><ul>
<li>file descriptor watch operations<ul>
<li><a class="el" href="kdbio_8h.html#addbfc876a15d0b8864196c67ab3e5a26" title="Add file descriptor to be watched by I/O binding.">ElektraIoBindingAddFd</a> (e.g. <a class="el" href="io__doc_8c.html#ae9b5f4e891829f3af8563e8160e1bd02" title="Add file descriptor to I/O binding.">ioDocBindingAddFd()</a>)</li>
<li><a class="el" href="kdbio_8h.html#acdb75b8df54c2b64980cf541b2704f37" title="Notify I/O binding about changes to file descriptor watch operation.">ElektraIoBindingUpdateFd</a> (e.g. <a class="el" href="io__doc_8c.html#a172a781f21310745a16cb24c578c4656" title="Update information about a file descriptor watched by I/O binding.">ioDocBindingUpdateFd()</a>)</li>
<li><a class="el" href="kdbio_8h.html#af1d03ff367130892ec3d1f4788eb8277" title="Remove file descriptor from I/O binding.">ElektraIoBindingRemoveFd</a> (e.g. <a class="el" href="io__doc_8c.html#ac5a985c3d54b2c06838d8af1719fcf09" title="Remove file descriptor from I/O binding.">ioDocBindingRemoveFd()</a>)</li>
</ul>
</li>
<li>timer operations<ul>
<li><a class="el" href="kdbio_8h.html#a61a8f37e371b8360c92222f58f4691eb" title="Add timer to I/O binding.">ElektraIoBindingAddTimer</a> (e.g. <a class="el" href="io__doc_8c.html#a4392a7bfa23513cf4cff7bcf4b0c4c68" title="Add timer for I/O binding.">ioDocBindingAddTimer()</a>)</li>
<li><a class="el" href="kdbio_8h.html#ab50f6288380aba507d27a0d66e00d8b4" title="Notifiy I/O binding about changes to timer structure.">ElektraIoBindingUpdateTimer</a> (e.g. <a class="el" href="io__doc_8c.html#a1ed16f0e61d2c7c59735b321b7080dec" title="Update timer in I/O binding.">ioDocBindingUpdateTimer()</a>)</li>
<li><a class="el" href="kdbio_8h.html#a00c0ffb60386fd65869367280d1ffe62" title="Remove timer from I/O binding.">ElektraIoBindingRemoveTimer</a> (e.g. <a class="el" href="io__doc_8c.html#afc27d1f174e30aab500a9e94a366f8ec" title="Remove timer from I/O binding.">ioDocBindingRemoveTimer()</a>)</li>
</ul>
</li>
<li>idle operations<ul>
<li><a class="el" href="kdbio_8h.html#adcfdf9f514441cabfbfd064fe4021522" title="Add idle to I/O binding.">ElektraIoBindingAddIdle</a> (e.g. <a class="el" href="io__doc_8c.html#ae7db8c833350176d2570cc4a010c2692" title="Add idle operation to I/O binding.">ioDocBindingAddIdle()</a>)</li>
<li><a class="el" href="kdbio_8h.html#af4fa5e05e59022b5d5421932882fc966" title="Notifiy I/O binding about changes to idle structure.">ElektraIoBindingUpdateIdle</a> (e.g <a class="el" href="io__doc_8c.html#a9b8faf0861123676a0a826987962552f" title="Update idle operation in I/O binding.">ioDocBindingUpdateIdle()</a>)</li>
<li><a class="el" href="kdbio_8h.html#a23b523b54e70df91a85c95583b6c958f" title="Remove idle from I/O binding.">ElektraIoBindingRemoveIdle</a> (e.g. <a class="el" href="io__doc_8c.html#ad813afce995620df6542c3cdd32b23e6" title="Remove idle operation from I/O binding.">ioDocBindingRemoveIdle()</a>)</li>
</ul>
</li>
<li><a class="el" href="kdbio_8h.html#a08d3ce531bbd1c5acedbdb9822b24d6d" title="Free memory used by I/O binding.">ElektraIoBindingCleanup</a> (e.g. <a class="el" href="io__doc_8c.html#a8bfb50f3c81b02ba9f0ad1a2f24afb6d" title="Cleanup.">ioDocBindingCleanup()</a>)</li>
</ul>
<p>In order to create a new I/O binding you have to create an entry point for your binding (e.g. <a class="el" href="io__doc_8c.html#af4bd586146acfbb1c1324483b79f0cc3" title="Create and initialize a new doc I/O binding.">elektraIoDocNew()</a>). This entry point then calls <a class="el" href="io_8c.html#a8dd14e7bd04afb798ea30ff8feb5f3a6" title="Create a new I/O binding.">elektraIoNewBinding()</a> with pointers to the ten required functions.</p>
<div class="fragment"><div class="line">        <span class="comment">// Initialize I/O interface</span></div>
<div class="line">        <a class="code" href="kdbio_8h.html#aabcd87b8c09d4d4c1033fc1baa417391">ElektraIoInterface</a> * binding = <a class="code" href="io_8c.html#a8dd14e7bd04afb798ea30ff8feb5f3a6">elektraIoNewBinding</a> (</div>
<div class="line">                <span class="comment">// file descriptors</span></div>
<div class="line">                <a class="code" href="io__doc_8c.html#ae9b5f4e891829f3af8563e8160e1bd02">ioDocBindingAddFd</a>, <a class="code" href="io__doc_8c.html#a172a781f21310745a16cb24c578c4656">ioDocBindingUpdateFd</a>, <a class="code" href="io__doc_8c.html#ac5a985c3d54b2c06838d8af1719fcf09">ioDocBindingRemoveFd</a>,</div>
<div class="line">                <span class="comment">// timers</span></div>
<div class="line">                <a class="code" href="io__doc_8c.html#a4392a7bfa23513cf4cff7bcf4b0c4c68">ioDocBindingAddTimer</a>, <a class="code" href="io__doc_8c.html#a1ed16f0e61d2c7c59735b321b7080dec">ioDocBindingUpdateTimer</a>, <a class="code" href="io__doc_8c.html#afc27d1f174e30aab500a9e94a366f8ec">ioDocBindingRemoveTimer</a>,</div>
<div class="line">                <span class="comment">// idle</span></div>
<div class="line">                <a class="code" href="io__doc_8c.html#ae7db8c833350176d2570cc4a010c2692">ioDocBindingAddIdle</a>, <a class="code" href="io__doc_8c.html#a9b8faf0861123676a0a826987962552f">ioDocBindingUpdateIdle</a>, <a class="code" href="io__doc_8c.html#ad813afce995620df6542c3cdd32b23e6">ioDocBindingRemoveIdle</a>,</div>
<div class="line">                <span class="comment">// cleanup</span></div>
<div class="line">                <a class="code" href="io__doc_8c.html#a8bfb50f3c81b02ba9f0ad1a2f24afb6d">ioDocBindingCleanup</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (binding == NULL)</div>
<div class="line">        {</div>
<div class="line">                ELEKTRA_LOG_WARNING (<span class="stringliteral">&quot;elektraIoNewBinding failed&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="ttc" id="aio_8c_html_a8dd14e7bd04afb798ea30ff8feb5f3a6"><div class="ttname"><a href="io_8c.html#a8dd14e7bd04afb798ea30ff8feb5f3a6">elektraIoNewBinding</a></div><div class="ttdeci">ElektraIoInterface * elektraIoNewBinding(ElektraIoBindingAddFd *addFd, ElektraIoBindingUpdateFd *updateFd, ElektraIoBindingRemoveFd *removeFd, ElektraIoBindingAddTimer *addTimer, ElektraIoBindingUpdateTimer *updateTimer, ElektraIoBindingRemoveTimer *removeTimer, ElektraIoBindingAddIdle *addIdle, ElektraIoBindingUpdateIdle *updateIdle, ElektraIoBindingRemoveIdle *removeIdle, ElektraIoBindingCleanup *cleanup)</div><div class="ttdoc">Create a new I/O binding.</div><div class="ttdef"><b>Definition:</b> io.c:42</div></div>
<div class="ttc" id="aio__doc_8c_html_a172a781f21310745a16cb24c578c4656"><div class="ttname"><a href="io__doc_8c.html#a172a781f21310745a16cb24c578c4656">ioDocBindingUpdateFd</a></div><div class="ttdeci">int ioDocBindingUpdateFd(ElektraIoFdOperation *fdOp)</div><div class="ttdoc">Update information about a file descriptor watched by I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:368</div></div>
<div class="ttc" id="aio__doc_8c_html_a1ed16f0e61d2c7c59735b321b7080dec"><div class="ttname"><a href="io__doc_8c.html#a1ed16f0e61d2c7c59735b321b7080dec">ioDocBindingUpdateTimer</a></div><div class="ttdeci">int ioDocBindingUpdateTimer(ElektraIoTimerOperation *timerOp)</div><div class="ttdoc">Update timer in I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:432</div></div>
<div class="ttc" id="aio__doc_8c_html_a4392a7bfa23513cf4cff7bcf4b0c4c68"><div class="ttname"><a href="io__doc_8c.html#a4392a7bfa23513cf4cff7bcf4b0c4c68">ioDocBindingAddTimer</a></div><div class="ttdeci">int ioDocBindingAddTimer(ElektraIoInterface *binding, ElektraIoTimerOperation *timerOp)</div><div class="ttdoc">Add timer for I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:448</div></div>
<div class="ttc" id="aio__doc_8c_html_a8bfb50f3c81b02ba9f0ad1a2f24afb6d"><div class="ttname"><a href="io__doc_8c.html#a8bfb50f3c81b02ba9f0ad1a2f24afb6d">ioDocBindingCleanup</a></div><div class="ttdeci">int ioDocBindingCleanup(ElektraIoInterface *binding)</div><div class="ttdoc">Cleanup.</div><div class="ttdef"><b>Definition:</b> io_doc.c:551</div></div>
<div class="ttc" id="aio__doc_8c_html_a9b8faf0861123676a0a826987962552f"><div class="ttname"><a href="io__doc_8c.html#a9b8faf0861123676a0a826987962552f">ioDocBindingUpdateIdle</a></div><div class="ttdeci">int ioDocBindingUpdateIdle(ElektraIoIdleOperation *idleOp)</div><div class="ttdoc">Update idle operation in I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:492</div></div>
<div class="ttc" id="aio__doc_8c_html_ac5a985c3d54b2c06838d8af1719fcf09"><div class="ttname"><a href="io__doc_8c.html#ac5a985c3d54b2c06838d8af1719fcf09">ioDocBindingRemoveFd</a></div><div class="ttdeci">int ioDocBindingRemoveFd(ElektraIoFdOperation *fdOp)</div><div class="ttdoc">Remove file descriptor from I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:414</div></div>
<div class="ttc" id="aio__doc_8c_html_ad813afce995620df6542c3cdd32b23e6"><div class="ttname"><a href="io__doc_8c.html#ad813afce995620df6542c3cdd32b23e6">ioDocBindingRemoveIdle</a></div><div class="ttdeci">int ioDocBindingRemoveIdle(ElektraIoIdleOperation *idleOp)</div><div class="ttdoc">Remove idle operation from I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:534</div></div>
<div class="ttc" id="aio__doc_8c_html_ae7db8c833350176d2570cc4a010c2692"><div class="ttname"><a href="io__doc_8c.html#ae7db8c833350176d2570cc4a010c2692">ioDocBindingAddIdle</a></div><div class="ttdeci">int ioDocBindingAddIdle(ElektraIoInterface *binding, ElektraIoIdleOperation *idleOp)</div><div class="ttdoc">Add idle operation to I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:507</div></div>
<div class="ttc" id="aio__doc_8c_html_ae9b5f4e891829f3af8563e8160e1bd02"><div class="ttname"><a href="io__doc_8c.html#ae9b5f4e891829f3af8563e8160e1bd02">ioDocBindingAddFd</a></div><div class="ttdeci">int ioDocBindingAddFd(ElektraIoInterface *binding, ElektraIoFdOperation *fdOp)</div><div class="ttdoc">Add file descriptor to I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:384</div></div>
<div class="ttc" id="aio__doc_8c_html_afc27d1f174e30aab500a9e94a366f8ec"><div class="ttname"><a href="io__doc_8c.html#afc27d1f174e30aab500a9e94a366f8ec">ioDocBindingRemoveTimer</a></div><div class="ttdeci">int ioDocBindingRemoveTimer(ElektraIoTimerOperation *timerOp)</div><div class="ttdoc">Remove timer from I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:476</div></div>
<div class="ttc" id="akdbio_8h_html_aabcd87b8c09d4d4c1033fc1baa417391"><div class="ttname"><a href="kdbio_8h.html#aabcd87b8c09d4d4c1033fc1baa417391">ElektraIoInterface</a></div><div class="ttdeci">struct _ElektraIoInterface ElektraIoInterface</div><div class="ttdoc">I/O binding handle.</div><div class="ttdef"><b>Definition:</b> kdbio.h:22</div></div>
</div><!-- fragment --><p> If your I/O management library requires you to store additional data you can do so using <a class="el" href="io_8c.html#a6021718783b36ca71bb465bc08a682cc" title="Set private data from I/O Binding.">elektraIoBindingSetData()</a>. Let's assume you have the following data structure:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structDocBindingData.html">DocBindingData</a></div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">char</span> * <a class="code" href="structDocBindingData.html#ad3a3b6278b9d7287f923de0e6c3fa14d">foo</a>;</div>
<div class="line">        <span class="comment">// Add additional members as required</span></div>
<div class="line">} <a class="code" href="io__doc_8c.html#a3e79cb58a2092e9b78e5491680201386">DocBindingData</a>;</div>
<div class="ttc" id="aio__doc_8c_html_a3e79cb58a2092e9b78e5491680201386"><div class="ttname"><a href="io__doc_8c.html#a3e79cb58a2092e9b78e5491680201386">DocBindingData</a></div><div class="ttdeci">struct DocBindingData DocBindingData</div><div class="ttdoc">[kdbio operation data]</div></div>
<div class="ttc" id="astructDocBindingData_html"><div class="ttname"><a href="structDocBindingData.html">DocBindingData</a></div><div class="ttdoc">[kdbio operation data]</div><div class="ttdef"><b>Definition:</b> io_doc.c:269</div></div>
<div class="ttc" id="astructDocBindingData_html_ad3a3b6278b9d7287f923de0e6c3fa14d"><div class="ttname"><a href="structDocBindingData.html#ad3a3b6278b9d7287f923de0e6c3fa14d">DocBindingData::foo</a></div><div class="ttdeci">char * foo</div><div class="ttdoc">Example member.</div><div class="ttdef"><b>Definition:</b> io_doc.c:271</div></div>
</div><!-- fragment --><p> Then you can store your data with the I/O binding.</p>
<div class="fragment"><div class="line">        <span class="comment">// Store binding relevant data in the interface</span></div>
<div class="line">        <a class="code" href="structDocBindingData.html">DocBindingData</a> * bindingData = <a class="code" href="internal_8c.html#a35cdc2e5caed3454cb73b4fc7f37858c">elektraMalloc</a> (<span class="keyword">sizeof</span> (*bindingData));</div>
<div class="line">        <span class="keywordflow">if</span> (bindingData == NULL)</div>
<div class="line">        {</div>
<div class="line">                ELEKTRA_LOG_WARNING (<span class="stringliteral">&quot;elektraMalloc failed&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="io_8c.html#a6021718783b36ca71bb465bc08a682cc">elektraIoBindingSetData</a> (binding, bindingData);</div>
<div class="line">        bindingData-&gt;<a class="code" href="structDocBindingData.html#ad3a3b6278b9d7287f923de0e6c3fa14d">foo</a> = foo;</div>
<div class="ttc" id="ainternal_8c_html_a35cdc2e5caed3454cb73b4fc7f37858c"><div class="ttname"><a href="internal_8c.html#a35cdc2e5caed3454cb73b4fc7f37858c">elektraMalloc</a></div><div class="ttdeci">void * elektraMalloc(size_t size)</div><div class="ttdoc">Allocate memory for Elektra.</div><div class="ttdef"><b>Definition:</b> internal.c:274</div></div>
<div class="ttc" id="aio_8c_html_a6021718783b36ca71bb465bc08a682cc"><div class="ttname"><a href="io_8c.html#a6021718783b36ca71bb465bc08a682cc">elektraIoBindingSetData</a></div><div class="ttdeci">int elektraIoBindingSetData(ElektraIoInterface *binding, void *data)</div><div class="ttdoc">Set private data from I/O Binding.</div><div class="ttdef"><b>Definition:</b> io.c:295</div></div>
</div><!-- fragment --><p> Of course if you need to store only a single pointer (e.g. a handle) you can omit the struct and directly use <a class="el" href="io_8c.html#a6021718783b36ca71bb465bc08a682cc" title="Set private data from I/O Binding.">elektraIoBindingSetData()</a> with your pointer.</p>
<dl class="section user"><dt>Implementing Operations</dt><dd></dd></dl>
<p>The next step is to implement operation functions. We'll walk through the implementation of the functions for managing file descriptor watch operations. Timer and idle variants are the same except for the operation properties.</p>
<p>For reconstructing the user callback it is advisable to store a context for each operation in your I/O management library. Most I/O management libraries let you pass this context when adding an operation to the library. This context is then passed by the library back to your callbacks. You can use the operation data itself as context and store additional data like handles from your I/O management library by using <a class="el" href="io_8c.html#ae02ec122aafa67b7dd92d9c3daa6499e" title="Set private binding data for operation.">elektraIoFdSetBindingData()</a>.</p>
<p>Let's assume the data structure looks like this:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structDocOperationData.html">DocOperationData</a></div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">char</span> * <a class="code" href="structDocOperationData.html#aae15fddcc4a8c6e7a9faaebe4f9964ec">bar</a>;</div>
<div class="line">        <span class="comment">// Add additional members as required</span></div>
<div class="line">} <a class="code" href="io__doc_8c.html#a98f626ef4a6e7a09780ea66d3e0b10e1">DocOperationData</a>;</div>
<div class="ttc" id="aio__doc_8c_html_a98f626ef4a6e7a09780ea66d3e0b10e1"><div class="ttname"><a href="io__doc_8c.html#a98f626ef4a6e7a09780ea66d3e0b10e1">DocOperationData</a></div><div class="ttdeci">struct DocOperationData DocOperationData</div><div class="ttdoc">[kdbio operation data]</div></div>
<div class="ttc" id="astructDocOperationData_html"><div class="ttname"><a href="structDocOperationData.html">DocOperationData</a></div><div class="ttdoc">[kdbio operation data]</div><div class="ttdef"><b>Definition:</b> io_doc.c:257</div></div>
<div class="ttc" id="astructDocOperationData_html_aae15fddcc4a8c6e7a9faaebe4f9964ec"><div class="ttname"><a href="structDocOperationData.html#aae15fddcc4a8c6e7a9faaebe4f9964ec">DocOperationData::bar</a></div><div class="ttdeci">char * bar</div><div class="ttdoc">Example member.</div><div class="ttdef"><b>Definition:</b> io_doc.c:259</div></div>
</div><!-- fragment --><p> Using this struct's members you can store additional data like handles in operations. The member <code>bar</code> is just an example.</p>
<p>The following snippet from <a class="el" href="io__doc_8c.html#ae9b5f4e891829f3af8563e8160e1bd02" title="Add file descriptor to I/O binding.">ioDocBindingAddFd()</a> shows example code for <a class="el" href="kdbio_8h.html#addbfc876a15d0b8864196c67ab3e5a26" title="Add file descriptor to be watched by I/O binding.">ElektraIoBindingAddFd</a>. Code for <a class="el" href="kdbio_8h.html#a61a8f37e371b8360c92222f58f4691eb" title="Add timer to I/O binding.">ElektraIoBindingAddTimer</a> and <a class="el" href="kdbio_8h.html#adcfdf9f514441cabfbfd064fe4021522" title="Add idle to I/O binding.">ElektraIoBindingAddIdle</a> is similar.</p>
<div class="fragment"><div class="line">        <a class="code" href="structDocOperationData.html">DocOperationData</a> * operationData = <a class="code" href="io__doc_8c.html#a18494b019c975b4212d39c9d83ff1e02">newOperationData</a> ();</div>
<div class="line">        <span class="keywordflow">if</span> (operationData == NULL)</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// You can use private data stored in the I/O binding</span></div>
<div class="line">        <span class="comment">// e.g. MyData data = (MyData *)elektraIoBindingGetData (binding);</span></div>
<div class="line"> </div>
<div class="line">        <a class="code" href="io_8c.html#ae02ec122aafa67b7dd92d9c3daa6499e">elektraIoFdSetBindingData</a> (fdOp, operationData);</div>
<div class="line">        <span class="comment">// You can store additional data for each operation in your operationData structure</span></div>
<div class="line">        operationData-&gt;<a class="code" href="structDocOperationData.html#aae15fddcc4a8c6e7a9faaebe4f9964ec">bar</a> = <span class="stringliteral">&quot;foo&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Here you need to add the operation to the I/O management library</span></div>
<div class="line">        <span class="comment">// ioDocBindingFdCallback() holds an example callback to pass to your I/O management library</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// assume SomeIoLibHandle * someIoLibAddFd (int fd, int flags, int enabled, void * privateData, callback)</span></div>
<div class="line">        <span class="comment">// operationData-&gt;handle = someIoLibAddFd (elektraIoFdGetFd (fdOp), elektraIoFdGetFlags (fdOp), elektraIoFdIsEnabled (fdOp), &amp;fdOp,</span></div>
<div class="line">        <span class="comment">// ioDocBindingFdCallback)</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="ttc" id="aio_8c_html_ae02ec122aafa67b7dd92d9c3daa6499e"><div class="ttname"><a href="io_8c.html#ae02ec122aafa67b7dd92d9c3daa6499e">elektraIoFdSetBindingData</a></div><div class="ttdeci">int elektraIoFdSetBindingData(ElektraIoFdOperation *fdOp, void *data)</div><div class="ttdoc">Set private binding data for operation.</div><div class="ttdef"><b>Definition:</b> io.c:479</div></div>
<div class="ttc" id="aio__doc_8c_html_a18494b019c975b4212d39c9d83ff1e02"><div class="ttname"><a href="io__doc_8c.html#a18494b019c975b4212d39c9d83ff1e02">newOperationData</a></div><div class="ttdeci">DocOperationData * newOperationData(void)</div><div class="ttdoc">[kdbio binding data]</div><div class="ttdef"><b>Definition:</b> io_doc.c:280</div></div>
</div><!-- fragment --><p> In <a class="el" href="kdbio_8h.html#acdb75b8df54c2b64980cf541b2704f37" title="Notify I/O binding about changes to file descriptor watch operation.">ElektraIoBindingUpdateFd</a> or <a class="el" href="kdbio_8h.html#af1d03ff367130892ec3d1f4788eb8277" title="Remove file descriptor from I/O binding.">ElektraIoBindingRemoveFd</a> you can access your binding operation data by using <a class="el" href="io_8c.html#a6103b457ed1440d0490acf0a6ec17386" title="Get private binding data from operation.">elektraIoFdGetBindingData()</a>.</p>
<div class="fragment"><div class="line">        <a class="code" href="structDocOperationData.html">DocOperationData</a> * operationData = (<a class="code" href="structDocOperationData.html">DocOperationData</a> *) <a class="code" href="io_8c.html#a6103b457ed1440d0490acf0a6ec17386">elektraIoFdGetBindingData</a> (fdOp);</div>
<div class="ttc" id="aio_8c_html_a6103b457ed1440d0490acf0a6ec17386"><div class="ttname"><a href="io_8c.html#a6103b457ed1440d0490acf0a6ec17386">elektraIoFdGetBindingData</a></div><div class="ttdeci">void * elektraIoFdGetBindingData(ElektraIoFdOperation *fdOp)</div><div class="ttdoc">Get private binding data from operation.</div><div class="ttdef"><b>Definition:</b> io.c:491</div></div>
</div><!-- fragment --><p> When your I/O management library detects a change of the file descriptor status it will call a callback supplied by your I/O binding. We will assume for file descriptor watch operations this is <a class="el" href="io__doc_8c.html#a1fce91400d38bed917cdb6dfc1bc1cf6" title="Calls the associated operation callback.">ioDocBindingFdCallback()</a>. Your I/O binding's task is to call the operation callback supplied by the user with the correct arguments.</p>
<div class="fragment"><div class="line"><span class="comment">/*static*/</span> <span class="keywordtype">void</span> <a class="code" href="io__doc_8c.html#a1fce91400d38bed917cdb6dfc1bc1cf6">ioDocBindingFdCallback</a> (<a class="code" href="structSomeIoLibHandle.html">SomeIoLibHandle</a> * handle, <span class="keywordtype">int</span> bitmask)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// For this example let&#39;s assume handle is passed as argument</span></div>
<div class="line">        ELEKTRA_NOT_NULL (handle-&gt;<a class="code" href="structSomeIoLibHandle.html#a3268457567f3ec3094c96c4bdf8424e5">data</a>);</div>
<div class="line">        <a class="code" href="kdbio_8h.html#af7fbb1df168155ef4bf0b8cd2dd1b0ff">ElektraIoFdOperation</a> * fdOp = (<a class="code" href="kdbio_8h.html#af7fbb1df168155ef4bf0b8cd2dd1b0ff">ElektraIoFdOperation</a> *) handle-&gt;<a class="code" href="structSomeIoLibHandle.html#a3268457567f3ec3094c96c4bdf8424e5">data</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Convert bitmask to Elekta&#39;s flags</span></div>
<div class="line">        <a class="code" href="io_8c.html#a885381fdd55cf957af1d65db7522899a">elektraIoFdGetCallback</a> (fdOp) (fdOp, <a class="code" href="io__doc_8c.html#a3765fc3222ed7bd10910575f3fa700be">someBitMaskToElektraIoFlags</a> (bitmask));</div>
<div class="line">}</div>
<div class="ttc" id="aio_8c_html_a885381fdd55cf957af1d65db7522899a"><div class="ttname"><a href="io_8c.html#a885381fdd55cf957af1d65db7522899a">elektraIoFdGetCallback</a></div><div class="ttdeci">ElektraIoFdCallback elektraIoFdGetCallback(ElektraIoFdOperation *fdOp)</div><div class="ttdoc">Get callback of file descriptor watch operation.</div><div class="ttdef"><b>Definition:</b> io.c:535</div></div>
<div class="ttc" id="aio__doc_8c_html_a1fce91400d38bed917cdb6dfc1bc1cf6"><div class="ttname"><a href="io__doc_8c.html#a1fce91400d38bed917cdb6dfc1bc1cf6">ioDocBindingFdCallback</a></div><div class="ttdeci">void ioDocBindingFdCallback(SomeIoLibHandle *handle, int bitmask)</div><div class="ttdoc">Calls the associated operation callback.</div><div class="ttdef"><b>Definition:</b> io_doc.c:320</div></div>
<div class="ttc" id="aio__doc_8c_html_a3765fc3222ed7bd10910575f3fa700be"><div class="ttname"><a href="io__doc_8c.html#a3765fc3222ed7bd10910575f3fa700be">someBitMaskToElektraIoFlags</a></div><div class="ttdeci">int someBitMaskToElektraIoFlags(int bitmask)</div><div class="ttdoc">Convert your I/O library bit mask to Elektra's I/O flags.</div><div class="ttdef"><b>Definition:</b> io_doc.c:298</div></div>
<div class="ttc" id="akdbio_8h_html_af7fbb1df168155ef4bf0b8cd2dd1b0ff"><div class="ttname"><a href="kdbio_8h.html#af7fbb1df168155ef4bf0b8cd2dd1b0ff">ElektraIoFdOperation</a></div><div class="ttdeci">struct _ElektraIoFdOperation ElektraIoFdOperation</div><div class="ttdoc">file descriptor watch operation handle</div><div class="ttdef"><b>Definition:</b> kdbio.h:25</div></div>
<div class="ttc" id="astructSomeIoLibHandle_html"><div class="ttname"><a href="structSomeIoLibHandle.html">SomeIoLibHandle</a></div><div class="ttdoc">Example I/O management library data structure.</div><div class="ttdef"><b>Definition:</b> io_doc.c:231</div></div>
<div class="ttc" id="astructSomeIoLibHandle_html_a3268457567f3ec3094c96c4bdf8424e5"><div class="ttname"><a href="structSomeIoLibHandle.html#a3268457567f3ec3094c96c4bdf8424e5">SomeIoLibHandle::data</a></div><div class="ttdeci">void * data</div><div class="ttdoc">Let's you access the context you supplied to the I/O management library.</div><div class="ttdef"><b>Definition:</b> io_doc.c:233</div></div>
</div><!-- fragment --><p> We assumed <code>SomeIoLibHandle-&gt;data</code> let's you access your context. Since we have used the original operation data as context we directly obtain the operation data to retrieve the user callback using <a class="el" href="io_8c.html#a885381fdd55cf957af1d65db7522899a" title="Get callback of file descriptor watch operation.">elektraIoFdGetCallback()</a>. Additionally it is necessary to convert the I/O management library's bitmask to Elekta's I/O bitmask (<a class="el" href="kdbio_8h.html#ac46f42188abb1fa28c3116b8cb755825" title="Available flags for file descriptors operation bitmask.">ElektraIoFdFlags</a>) and then call the user callback.</p>
<p>When implementing <a class="el" href="kdbio_8h.html#af1d03ff367130892ec3d1f4788eb8277" title="Remove file descriptor from I/O binding.">ElektraIoBindingRemoveFd</a> (or the timer and idle equivalents) make sure to free data allocated in the add functions.</p>
<dl class="section user"><dt>Cleanup</dt><dd></dd></dl>
<p><a class="el" href="kdbio_8h.html#a08d3ce531bbd1c5acedbdb9822b24d6d" title="Free memory used by I/O binding.">ElektraIoBindingCleanup</a> is the place to free data allocated for your I/O binding.</p>
<p>At least you need to free the pointer returned from <a class="el" href="io_8c.html#a8dd14e7bd04afb798ea30ff8feb5f3a6" title="Create a new I/O binding.">elektraIoNewBinding()</a> in your I/O binding's entry point.</p>
<dl class="section user"><dt>Linking</dt><dd></dd></dl>
<p>Make sure to link against the <code>elektra-io</code> library for the <code>elektraIo*</code> utility functions that create bindings or operations and allow access to their fields. This library is available via <code>pkg-config</code>.</p>
<dl class="section user"><dt>Testing</dt><dd></dd></dl>
<p>Elektra provides a test suite for I/O bindings in order to make sure that transport plugins will work with all bindings. To run the test suite you need to execute <a class="el" href="kdbiotest_8h.html#afe747efa9fd4b15b6c212ae7e1c51eb6" title="Test-Suite for I/O Bindings.">elektraIoTestSuite()</a> and provide the necessary callbacks for creating a new binding, starting and stopping asynchronous processing (<a class="el" href="kdbiotest_8h.html#a34b00a39be5b3f0a15959cda384e33dc" title="Create and initialize I/O binding.">ElektraIoTestSuiteCreateBinding</a>, <a class="el" href="kdbiotest_8h.html#adc6ce3b9abbedf6ce56a5b0167d01286" title="Start I/O processing (for example event loop).">ElektraIoTestSuiteStart</a> and <a class="el" href="kdbiotest_8h.html#a0f56c00b010605d876c22d0c7a49aa0c" title="Stop I/O processing (for example event loop).">ElektraIoTestSuiteStop</a>).</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)</div>
<div class="line">{</div>
<div class="line">        init (argc, argv);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="kdbiotest_8h.html#afe747efa9fd4b15b6c212ae7e1c51eb6">elektraIoTestSuite</a> (createBinding, startLoop, stopLoop);</div>
<div class="line"> </div>
<div class="line">        print_result (<span class="stringliteral">&quot;iowrapper_doc&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> nbError;</div>
<div class="line">}</div>
<div class="ttc" id="akdbiotest_8h_html_afe747efa9fd4b15b6c212ae7e1c51eb6"><div class="ttname"><a href="kdbiotest_8h.html#afe747efa9fd4b15b6c212ae7e1c51eb6">elektraIoTestSuite</a></div><div class="ttdeci">void elektraIoTestSuite(ElektraIoTestSuiteCreateBinding createBinding, ElektraIoTestSuiteStart start, ElektraIoTestSuiteStop stop)</div><div class="ttdoc">Test-Suite for I/O Bindings.</div></div>
<div class="ttc" id="atestio__doc_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdoc">[kdbio testsuite main]</div><div class="ttdef"><b>Definition:</b> testio_doc.c:48</div></div>
</div><!-- fragment --><p> The functions supplied to <a class="el" href="kdbiotest_8h.html#afe747efa9fd4b15b6c212ae7e1c51eb6" title="Test-Suite for I/O Bindings.">elektraIoTestSuite()</a> are called for setup, starting and stopping of the tests.</p>
<p>For example <a class="el" href="kdbiotest_8h.html#a34b00a39be5b3f0a15959cda384e33dc" title="Create and initialize I/O binding.">ElektraIoTestSuiteCreateBinding</a> of the "doc" binding:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="kdbio_8h.html#aabcd87b8c09d4d4c1033fc1baa417391">ElektraIoInterface</a> * createBinding (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="io__doc_8c.html#af4bd586146acfbb1c1324483b79f0cc3">elektraIoDocNew</a> (<span class="stringliteral">&quot;foo&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="aio__doc_8c_html_af4bd586146acfbb1c1324483b79f0cc3"><div class="ttname"><a href="io__doc_8c.html#af4bd586146acfbb1c1324483b79f0cc3">elektraIoDocNew</a></div><div class="ttdeci">ElektraIoInterface * elektraIoDocNew(char *foo)</div><div class="ttdoc">Create and initialize a new doc I/O binding.</div><div class="ttdef"><b>Definition:</b> io_doc.c:564</div></div>
</div><!-- fragment --><p> Of course starting and stopping is specific to your I/O management library. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

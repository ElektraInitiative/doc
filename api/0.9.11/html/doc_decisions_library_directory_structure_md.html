<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Library Directory Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Library Directory Structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_decisions_library_directory_structure"></a> </p>
<h1><a class="anchor" id="autotoc_md2003"></a>
Problem</h1>
<p>Currently <code>src/libs/elektra</code> contains the source of several libraries. Each of the libraries should have its own folder. Furthermore, we need to allow rust source to exist in parallel.</p>
<h1><a class="anchor" id="autotoc_md2004"></a>
Constraints</h1>
<ul>
<li>It must be possible to set up include-paths via CMake so that <code>#include &lt;elektra/foo/header.h&gt;</code> works the same in the build directory and when installed.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2005"></a>
Assumptions</h1>
<h1><a class="anchor" id="autotoc_md2006"></a>
Considered Alternatives</h1>
<ul>
<li>One folder per language, then split by code type (<code>src/&lt;lang&gt;/plugins</code>, <code>src/&lt;lang&gt;/libs</code>, etc.):<ul>
<li>Pro: Makes the per language setup easier, since everything is contained in a single directory and that directory is for a single language, just as if it was any other standalone project in that language.</li>
<li>Con: When navigating the source-code you need to know what language e.g. a plugin is written in to find the correct folder.</li>
</ul>
</li>
<li>First split by code type, then one folder per language (<code>src/plugins/&lt;lang&gt;</code>, <code>src/libs/&lt;lang&gt;</code>, etc.)<ul>
<li>Similar to the variant above, but has more downsides. "single folder per language" no longer applies and you still need to know the language to find the folder.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2007"></a>
Decision</h1>
<p>We use this directory tree (YAML syntax for highlighting):</p>
<div class="fragment"><div class="line">doc:</div>
<div class="line">benchmarks:</div>
<div class="line">examples:</div>
<div class="line">scripts:</div>
<div class="line">src:</div>
<div class="line">  include:</div>
<div class="line">   # headers that don&#39;t belong to a specific library</div>
<div class="line">  libs:</div>
<div class="line">    core-c: C implementation of libelektra-core.so</div>
<div class="line">    core-rust: Rust implementation of libelektra-core.so</div>
<div class="line">    opts: libelektra-opts.so has only a single implementation, so no suffix</div>
<div class="line">  # plugins and tools use the same suffix idea as above</div>
<div class="line">  plugins:</div>
<div class="line">  tools:</div>
<div class="line">  bindings:</div>
<div class="line">    rust: Rust bindings</div>
<div class="line">    cpp: C++ bindings</div>
<div class="line">    java: Java bindings</div>
<div class="line">  tests:</div>
<div class="line">    shell: shell script tests</div>
<div class="line">    cframework: framework for C tests</div>
<div class="line">    gtest-framework: framework for C++ tests</div>
<div class="line">    abi: ABI compatibility tests</div>
<div class="line">  # build tool configuration files to create a single root project for every language</div>
<div class="line">  # this is improves IDE support</div>
<div class="line">  CMakeLists.txt</div>
<div class="line">  build.gradle</div>
<div class="line">  Cargo.toml</div>
</div><!-- fragment --><p>Unit tests (*) (e.g. the old <code>tests/ctest</code>, <code>tests/kdb</code>) should be bundled with the code they are testing: e.g. in Rust test code is in the same file, in C/C++ it should be in the same folder and in Java a separate source set in the same module is used. This makes it easier to find the tests for a library, and also creates a uniform structure (in Rust or Java it would be harder to put tests into the current structure). System tests that test multiple components live in the <code>src/tests</code> folder.</p>
<blockquote class="doxtable">
<p>(*) The term "unit test" is used very loosely here. Most tests for e.g. the <code>kdb</code> tool will not, strictly speaking, be unit tests, since they don't replace dependencies with mocks/fakes and instead test the whole <code>kdb</code> tool. </p>
</blockquote>
<p>For now benchmarks will remain in the top-level <code>benchmarks</code> directory, unless there is a language specific reason to have them next to the code they benchmark (like unit-tests). In future this may change to facilitate automated performance-regression tests.</p>
<h1><a class="anchor" id="autotoc_md2008"></a>
Rationale</h1>
<p>This setup, allows to find a plugin/library/etc. just by knowing its code type (library/plugin/etc.) and its name. At the same time, using language suffixes allows having multiple implementations in different languages. Finally, whenever possible there should be project config file in the top-level <code>src</code> directory for every language. This will improve IDE support and make it possible to treat all code from one language as a single project. However, it is important that modularity is not lost in the process. It must still be possible to depend on individual libraries in CMake, without having to build everything else that is written in the same language.</p>
<p>Therefore, the top-level project should only exist, if the language allows projects that only include sub-modules. Otherwise, fully separate projects for every plugin/library/etc. should be used to preserve modularity.</p>
<h1><a class="anchor" id="autotoc_md2009"></a>
Implications</h1>
<h1><a class="anchor" id="autotoc_md2010"></a>
Related Decisions</h1>
<ul>
<li><a class="el" href="doc_decisions_header_file_structure_md.html">Header File Structure</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md2011"></a>
Notes</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Logging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.10.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Logging </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_decisions_6_implemented_logging"></a> </p>
<h1><a class="anchor" id="autotoc_md2419"></a>
Problem</h1>
<p>Both code comments and assertions are unfortunately not very popular. A quite efficient way to still get some documentation about the code are logging statements. In Elektra they are currently inconsistent and unusable. Thus there is an urge for this decision.</p>
<h1><a class="anchor" id="autotoc_md2420"></a>
Constraints</h1>
<ul>
<li>Logging must be disabled by default.</li>
<li>This decision is irrelevant for plugins and bindings that are not written in C/C++.</li>
<li>Should completely compile away with the cmake variable <code>ENABLE_LOGGER=OFF</code></li>
<li>Should support minimalistic, compile-time filtering (per modules and verbosity level) and some sinks (stderr, syslog or files)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2421"></a>
Assumptions</h1>
<ul>
<li>run-time problems are checked via assertions, not logged</li>
<li>opinions about if logging should be to stderr or files differ</li>
<li>filtering with grep is not enough</li>
<li>per default there should be no output</li>
<li>with ENABLE_LOGGER=ON only warnings and errors should be shown on stderr</li>
<li>other sinks like syslog and file may log more (they are not immediately visible and distracting)</li>
<li>performance is not so important (because logging is usually turned off anyway)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2422"></a>
Considered Alternatives</h1>
<ul>
<li>log similar to the warnings/error system work, discarded because of the run-time overhead and no use case why end users should see log statements.</li>
<li>C++ logging library (boost, apache,..), discarded because C++ should not be in core</li>
<li>libraries needed static initializing: problematic, logging should just work, even if application does not initialize anything</li>
<li>using syslog: no info from which source file the logging statement comes from</li>
<li>using journald: adds deps problematic for non-linux</li>
<li>zlog: incompatible licence (LGPL)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2423"></a>
Decision</h1>
<p>Provide a Macro</p>
<div class="fragment"><div class="line">ELEKTRA_LOG (<span class="keywordtype">int</span> module, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, ...);</div>
</div><!-- fragment --><p>that calls</p>
<div class="fragment"><div class="line">elektraLog ([as above], <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">function</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> * file,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> line, ...);</div>
</div><!-- fragment --><p>and adds current function, file and line to <code>elektraLog</code>'s arguments.</p>
<p><code>elektraLog</code> is implemented in a separate <code><a class="el" href="log_8c.html" title="Non-C99 Logger Implementation.">log.c</a></code> file. If someone needs filtering, logging to different sources or similar, he/she simply modifies <code><a class="el" href="log_8c.html" title="Non-C99 Logger Implementation.">log.c</a></code>.</p>
<h2><a class="anchor" id="autotoc_md2424"></a>
Severity</h2>
<p>The severity passed to <code>ELEKTRA_LOG_</code> should be as in syslog's priority, except the error conditions which are not needed (asserts should be used in these situations).</p>
<p>So we have:</p>
<ul>
<li><code>ELEKTRA_LOG_WARNING</code>: warning conditions</li>
<li><code>ELEKTRA_LOG_NOTICE</code>: normal, but significant, condition</li>
<li><code>ELEKTRA_LOG_INFO</code>: informational message</li>
<li><code>ELEKTRA_LOG_DEBUG</code>: debug-level message</li>
</ul>
<h2><a class="anchor" id="autotoc_md2425"></a>
Modules</h2>
<p>To add a new module, one simply adds his/her module to <code>elektramodules.h</code> via <code>#define</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define ELEKTRA_MODULE_&lt;NAME&gt; &lt;SEQNUMBER&gt;</span></div>
</div><!-- fragment --><p>The module name <code>&lt;NAME&gt;</code> shall be consistent with module names used in <code>module:</code> of <code>src/error/specification</code>.</p>
<h1><a class="anchor" id="autotoc_md2426"></a>
Rationale</h1>
<p>A more complex system is overkill. Thus libraries should not have any effects other than what is described by their API, logging should nearly always be disabled.</p>
<p>A more "hackable" logger seems to be more suitable for individual needs. Having a separate <code><a class="el" href="log_8c.html" title="Non-C99 Logger Implementation.">log.c</a></code> means that the logger can be changed without the need to recompile anything but a single file. It also removes the dependency of <code>stdio.h</code> from every individual file to a single place.</p>
<ul>
<li>Logging is very easy to use (only include <code>elektralog.h</code> and use <code>ELEKTRA_LOG</code>)</li>
<li>Logging is still flexible enough (with modules, severity, file, line and function information)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2427"></a>
Implications</h1>
<p>The current VERBOSE would be turned off forever and the code within VERBOSE needs to be migrated to <code>ELEKTRA_LOG</code>.</p>
<h1><a class="anchor" id="autotoc_md2428"></a>
Related Decisions</h1>
<h1><a class="anchor" id="autotoc_md2429"></a>
Notes</h1>
<p>See <a class="el" href="doc_CODING_md.html">CODING.md</a> for recommendations how to use the logger. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

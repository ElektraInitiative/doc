<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Cascading Lookups</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Cascading Lookups </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial assumes that you are already familiar with <a class="el" href="doc_tutorials_namespaces_md.html">namespaces</a>. This tutorial will only explain <a class="el" href="doc_help_elektra-cascading_md.html">cascading lookup</a>.</p>
<p>When Elektra looks up a <em>cascading key</em> (i.e. key names without a namespace and a leading slash <code>/</code>, the namespaces are searched in the following order:</p>
<ul>
<li><a href="https://github.com/ElektraInitiative/libelektra/blob/master/doc/help/elektra-namespaces.md#spec">spec</a> (contains metadata, e.g. to modify Elektra's lookup behavior)</li>
<li><a href="https://github.com/ElektraInitiative/libelektra/blob/master/doc/help/elektra-namespaces.md#proc">proc</a> (process-related information)</li>
<li><a href="https://github.com/ElektraInitiative/libelektra/blob/master/doc/help/elektra-namespaces.md#dir">dir</a> (directory-related information, e.g. <code>.git</code> or <code>.htaccess</code>)</li>
<li><a href="https://github.com/ElektraInitiative/libelektra/blob/master/doc/help/elektra-namespaces.md#user">user</a> (user configuration)</li>
<li><a href="https://github.com/ElektraInitiative/libelektra/blob/master/doc/help/elektra-namespaces.md#system">system</a> (system configuration)</li>
</ul>
<p>If a key, for example, exists in both <b>user</b> and <b>system</b> namespace, the key in the <b>user</b> namespace takes precedence over the one in the <b>system</b> namespace. If there is no such key in the <b>user</b> namespace the key in the <b>system</b> namespace acts as a fallback.</p>
<p>But lets demonstrate this with an example:</p>
<h2><a class="anchor" id="autotoc_md2570"></a>
Add a Key to the system Namespace</h2>
<p>Configuration in the <b>system</b> namespace is the same for all users. Therefore this namespace provides a default or fallback configuration.</p>
<p>With the default Elektra installation only an administrator can update configuration settings within the <b>system</b> namespace.</p>
<div class="fragment"><div class="line"># Backup-and-Restore:/tests/tutorial</div>
<div class="line"> </div>
<div class="line"># Backup old override specification</div>
<div class="line">kdb set user/tests/overrides $(mktemp)</div>
<div class="line">kdb export system/tests/overrides dump &gt; $(kdb get user/tests/overrides)</div>
<div class="line"> </div>
<div class="line">kdb get /tests/tutorial/cascading/#0/current/test</div>
<div class="line"># RET: 11</div>
<div class="line"># STDERR: Did not find key &#39;/tests/tutorial/cascading/#0/current/test&#39;</div>
<div class="line"> </div>
<div class="line"># Now add the key ...</div>
<div class="line">sudo kdb set system/tests/tutorial/cascading/#0/current/test &quot;hello world&quot;</div>
<div class="line">#&gt; Create a new key system/tests/tutorial/cascading/#0/current/test with string &quot;hello world&quot;</div>
<div class="line"> </div>
<div class="line"># ... and verify that it exists</div>
<div class="line">kdb get /tests/tutorial/cascading/#0/current/test</div>
<div class="line">#&gt; hello world</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2571"></a>
Add a Key to the user Namespace</h2>
<p>A user may now want to override the configuration in <b>system</b>, so he/she sets a key in the <b>user</b> namespace:</p>
<div class="fragment"><div class="line">kdb set user/tests/tutorial/cascading/#0/current/test &quot;hello galaxy&quot;</div>
<div class="line">#&gt; Create a new key user/tests/tutorial/cascading/#0/current/test with string &quot;hello galaxy&quot;</div>
<div class="line"> </div>
<div class="line"># This key masks the key in the system namespace</div>
<div class="line">kdb get /tests/tutorial/cascading/#0/current/test</div>
<div class="line">#&gt; hello galaxy</div>
</div><!-- fragment --><p>Note that configuration in the <b>user</b> namespace only affects <em>this</em> user. Other users would still get the key from the <b>system</b> namespace.</p>
<h2><a class="anchor" id="autotoc_md2572"></a>
Add a Key to the dir Namespace</h2>
<p>The <b>dir</b> namespace is associated with a directory. The configuration in the <b>dir</b> namespace applies to the <b>current working directory</b> and all its subdirectories. This is useful if you have project specific settings (e.g. your git configuration or a .htaccess file).</p>
<p>As <b>dir</b> precedes the <b>user</b> namespace, configuration in <b>dir</b> can overwrite user configuration:</p>
<div class="fragment"><div class="line"># create and change to a new directory ...</div>
<div class="line">mkdir kdbtutorial</div>
<div class="line">cd kdbtutorial</div>
<div class="line"> </div>
<div class="line"># ... and create a key in this directories dir-namespace</div>
<div class="line"># By default this data will be saved in the directory `.dir`.</div>
<div class="line">kdb set dir/tests/tutorial/cascading/#0/current/test &quot;hello universe&quot;</div>
<div class="line">#&gt; Create a new key dir/tests/tutorial/cascading/#0/current/test with string &quot;hello universe&quot;</div>
<div class="line"> </div>
<div class="line"># This key masks the key in the system namespace</div>
<div class="line">kdb get /tests/tutorial/cascading/#0/current/test</div>
<div class="line">#&gt; hello universe</div>
<div class="line"> </div>
<div class="line"># But is only present in the associated directory</div>
<div class="line">cd ..</div>
<div class="line">kdb get /tests/tutorial/cascading/#0/current/test</div>
<div class="line"># hello galaxy</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2573"></a>
Add a Key to the proc Namespace</h2>
<p>The <b>proc</b> namespace is not accessible by the command line tool <b>kdb</b>, as it is unique for each running process using Elektra. So we have to omit an example for this namespace at this point. <a class="el" href="doc_help_elektra-glossary_md.html">Elektrified</a> applications can use this namespace to override configuration from other namespaces internally.</p>
<h2><a class="anchor" id="autotoc_md2574"></a>
Add a Key to the spec Namespace</h2>
<p>The <b>spec</b> namespace is used to store metadata about keys and therefore Elektra handles the <b>spec</b> namespace differently to other namespaces. The following part of the tutorial is dedicated to the impact of the <b>spec</b> namespace on cascading lookups.</p>
<h1><a class="anchor" id="autotoc_md2575"></a>
Override Links</h1>
<p>The <code>spec</code> namespace is special as it can completely change how the cascading lookup works.</p>
<p>During a cascading lookup for a specific key, the default Elektra behavior can be changed by a corresponding <code>spec-key</code>, i.e. a key in the <b>spec</b> namespace <b>with the same name</b>.</p>
<p>For example, the metadata <code>override/#0</code> of the respective <code>spec-key</code> can be specified to use a different key in favor of the key itself. This way, we can implement a redirect or symlink like behavior and therefore even config from current folder (<code>dir</code> namespace) can be overwritten.</p>
<p>The cascading lookup will consider the following <b>metadata keys</b> of <code>spec-key</code>:</p>
<ol type="1">
<li><code>override/#n</code> redirect to one of the specified keys</li>
<li><code>namespaces/#n</code> specifies which namespaces will be considered and in which order</li>
<li><code>fallback/#n</code> if no key was found these keys will act as a fallback</li>
<li><code>default</code> defines a default value for the key if none of the keys was found</li>
</ol>
<p><b>Note:</b> <code>override/#n</code>, <code>namespaces/#n</code> and <code>fallback/#n</code> are Elektra <b>array keys</b>. This means, such keys can exist several times, each with a different number for <code>n</code>, e.g. <code>override/#0</code>, <code>override/#1</code>... This way, we can define multiple values for a specific key with a defined order.</p>
<p>As you can see, override links are considered before everything else, which makes them really powerful.</p>
<p>Consider the following example:</p>
<p>First, we create a target key to demonstrate the override link mechanism:</p>
<div class="fragment"><div class="line">sudo kdb set system/tests/overrides/test &quot;hello override&quot;</div>
<div class="line">#&gt; Create a new key system/tests/overrides/test with string &quot;hello override&quot;</div>
</div><!-- fragment --><p>Override links can be defined by adding them to the <code>override/#</code> metadata array key of the corresponding <code>spec-key</code>:</p>
<div class="fragment"><div class="line">sudo kdb meta-set spec/tests/tutorial/cascading/#0/current/test override/#0 /tests/overrides/test</div>
</div><!-- fragment --><p>Now when doing a cascading lookup, we get the value of our target key instead of the specified one:</p>
<div class="fragment"><div class="line">kdb get /tests/tutorial/cascading/#0/current/test</div>
<div class="line">#&gt; hello override</div>
</div><!-- fragment --><p>As we used a cascading key for our override link (<code>/tests/overrides/test</code>) we can use this to allow users to provide their own <code>tests/overrides/test</code> keys. If a user sets the <code>/tests/overrides/test</code> key, the <b>user</b> namespace will be used (for a non-root user) and therefore the new target for our <code>/tests/tutorial/cascading/#0/current/test</code> key will be <code>user/tests/overrides/test</code> instead of <code>system/tests/overrides/test</code>.</p>
<div class="fragment"><div class="line">kdb set /tests/overrides/test &quot;hello user&quot;</div>
<div class="line"># STDOUT-REGEX: .+(Create a new key.+|Set string to) &quot;hello user&quot;</div>
<div class="line">kdb get /tests/tutorial/cascading/#0/current/test</div>
<div class="line">#&gt; hello user</div>
</div><!-- fragment --><p>Furthermore, you can specify a custom order for the namespaces, set fallback keys and more. For more information, read the <a class="el" href="doc_help_elektra-spec_md.html">`elektra-spec` help page</a>.</p>
<h1><a class="anchor" id="autotoc_md2576"></a>
Cleanup</h1>
<p>As last part in this tutorial we remove the modifications to the database we made previously.</p>
<div class="fragment"><div class="line">kdb rm -r user/tests/tutorial/</div>
<div class="line">kdb rm -r system/tests/tutorial</div>
<div class="line">kdb rm -r system/tests/overrides</div>
<div class="line">kdb import system/tests/overrides dump &lt; $(kdb get user/tests/overrides)</div>
<div class="line">rm $(kdb get user/tests/overrides)</div>
<div class="line">kdb rm user/tests/overrides</div>
<div class="line"> </div>
<div class="line">kdb rm -r spec/tests/tutorial/</div>
<div class="line"> </div>
<div class="line">rm -r .dir/</div>
<div class="line">rmdir kdbtutorial</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: directoryvalue</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.21</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: directoryvalue </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the directoryvalue plugin is in keys below</li>
<li>infos/author = René Schwaiger <a href="#" onclick="location.href='mai'+'lto:'+'san'+'ss'+'eco'+'ur'+'s@m'+'e.'+'com'; return false;">sanss<span style="display: none;">.nosp@m.</span>ecou<span style="display: none;">.nosp@m.</span>rs@me<span style="display: none;">.nosp@m.</span>.com</a></li>
<li>infos/licence = BSD</li>
<li>infos/needs =</li>
<li>infos/provides =</li>
<li>infos/recommends =</li>
<li>infos/placements = postgetstorage presetstorage</li>
<li>infos/status = maintained unittest nodep preview</li>
<li>infos/metadata =</li>
<li>infos/description = This plugin converts directory values to leaf values</li>
</ul>
<h1><a class="anchor" id="src_plugins_directoryvalue_README_md"></a>
Directory Value</h1>
<h2>Introduction</h2>
<p>The Directory Value plugin converts</p>
<ol type="1">
<li>directory (non-leaf) values to leaf values in the “set” direction, and</li>
<li>converts them back to directory values in the “get” direction.</li>
</ol>
<p>A directory value is a key that contains children. For example in the key set:</p>
<div class="fragment"><div class="line">user/grandparent                = Grandparent</div><div class="line">user/grandparent/leaf           = Leaf</div><div class="line">user/grandparent/parent         = Parent</div><div class="line">user/grandparent/parent/child   = Child</div><div class="line">user/mother                     = Mother</div><div class="line">user/mother/daughter            = Daughter</div><div class="line">user/mother/son                 = Son</div></div><!-- fragment --><p>the keys</p>
<div class="fragment"><div class="line">user/grandparent</div><div class="line">user/grandparent/parent</div><div class="line">user/mother</div></div><!-- fragment --><p>represent directory values, while the keys</p>
<div class="fragment"><div class="line">user/grandparent/leaf</div><div class="line">user/grandparent/parent/child</div><div class="line">user/mother/daughter</div><div class="line">user/mother/son</div></div><!-- fragment --><p>specify leaf values. You can easily check this by drawing the key set in the form of a rooted tree:</p>
<div class="fragment"><div class="line">             user</div><div class="line">      /               \</div><div class="line">  granparent        mother</div><div class="line">  /      |          /    \</div><div class="line">leaf  parent    daughter son</div><div class="line">         |</div><div class="line">       child</div></div><!-- fragment --><p>. The Directory Value plugin converts all directory values to leaf values in the “set” direction by adding new keys with the postfix <code>___dirdata</code>. Theses keys then store the old value of their parent keys</p>
<div class="fragment"><div class="line">user/grandparent                    =</div><div class="line">user/grandparent/___dirdata         = Grandparent</div><div class="line">user/grandparent/leaf               = Leaf</div><div class="line">user/grandparent/parent             =</div><div class="line">user/grandparent/parent/___dirdata  = Parent</div><div class="line">user/grandparent/parent/child       = Child</div><div class="line">user/mother                         =</div><div class="line">user/mother/___dirdata              = Mother</div><div class="line">user/mother/daughter                = Daugther</div><div class="line">user/mother/son                     = Son</div></div><!-- fragment --><p>. You might ask why we need the Directory Value plugin at all. The reason why we created this plugin is that some storage plugins like <a class="el" href="md_src_plugins_yajl_README.html#src_plugins_yajl_README_md">`yajl`</a> or <a class="el" href="md_src_plugins_yajl_README.html#src_plugins_yajl_README_md">`yamlcpp`</a> are only able to save values inside leaf keys. By loading the Directory Value plugin these storage plugins are also able to represent directory values properly.</p>
<h3>Array Values</h3>
<p>The Directory value plugin also converts array values. Let us take a look at an example key set:</p>
<div class="fragment"><div class="line">user/array    = Array Value</div><div class="line">user/array/#0 = Firt Value</div><div class="line">user/array/#1 = Second Value</div><div class="line">user/array/#2 = Third Value</div></div><!-- fragment --><p>. The plugin <b>does not</b> convert this key set into:</p>
<div class="fragment"><div class="line">user/array            =</div><div class="line">user/array/___dirdata = Array Value</div><div class="line">user/array/#0         = First Value</div><div class="line">user/array/#1         = Second Value</div><div class="line">user/array/#2         = Third Value</div></div><!-- fragment --><p>, since then <code>user/array</code> <b>would not be an array</b> any more. Instead the plugin inserts a new element at index 0 with the <b>value prefix</b> <code>___dirdata:</code>:</p>
<div class="fragment"><div class="line">user/array            =</div><div class="line">user/array/#0         = ___dirdata: Array Value</div><div class="line">user/array/#1         = First Value</div><div class="line">user/array/#2         = Second Value</div><div class="line">user/array/#3         = Third Value</div></div><!-- fragment --><p>. This way a storage plugin such as YAJL or YAML CPP are still able to store <code>user/array</code> as an array.</p>
<p><b>Remark:</b> The plugin only converts array parents that store <b>string values</b>.</p>
<h2>Usage</h2>
<p>To mount the plugin use the command:</p>
<p>``<code> &lt;h1&gt;Mount plugin to cascading namespace</code>/examples/directoryvalue` sudo kdb mount config.file /examples/directoryvalue directoryvalue </p><div class="fragment"><div class="line">. To unmount the plugin use the command</div></div><!-- fragment --><p> sudo kdb umount /examples/directoryvalue </p><div class="fragment"><div class="line">.</div><div class="line"></div><div class="line">## Example</div></div><!-- fragment --> <h1>Mount plugin to cascading namespace <code>/examples/directoryvalue</code></h1>
<p>sudo kdb mount config.file /examples/directoryvalue directoryvalue</p>
<h1>Add a directory value</h1>
<p>kdb set /examples/directoryvalue/harold 'Father of SpongeBob SquarePants' </p><h1>Add a leaf value</h1>
<p>kdb set /examples/directoryvalue/harold/spongebob 'I am ready!'</p>
<h1>Add an array</h1>
<p>kdb set /examples/directoryvalue/patrick Star kdb set /examples/directoryvalue/patrick/#0 'Being grown-up is boring. Besides, I don’t get Jazz.'</p>
<h1>Since the plugin converts values back in the get direction</h1>
<h1>a user of the database will not notice any changes.</h1>
<p>kdb ls /examples/directoryvalue #&gt; user/examples/directoryvalue/harold #&gt; user/examples/directoryvalue/harold/spongebob #&gt; user/examples/directoryvalue/patrick #&gt; user/examples/directoryvalue/patrick/#0</p>
<p>kdb get /examples/directoryvalue/harold #&gt; Father of SpongeBob SquarePants kdb get /examples/directoryvalue/harold/spongebob #&gt; I am ready!</p>
<p>kdb get /examples/directoryvalue/patrick #&gt; Star kdb get /examples/directoryvalue/patrick/#0 #&gt; Being grown-up is boring. Besides, I don’t get Jazz.</p>
<h1>Retrieve index of last element in array.</h1>
<h1>This also works if the storage plugin does not store this index.</h1>
<p>kdb getmeta /examples/directoryvalue/patrick array #&gt; #0</p>
<h1>Undo changes to the key database</h1>
<p>kdb rm -r /examples/directoryvalue sudo kdb umount /examples/directoryvalue ```</p>
<h1>Limitations</h1>
<p><b>Escaping</b> is currently <b>not possible</b>. If you use the Directory Value plugin you can not</p>
<ul>
<li>use the name <code>___dirdata</code> as the last part of a normal key,</li>
<li>use <code>___dirdata:</code> at the beginning of a normal value in the first array element</li>
</ul>
<p>! </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

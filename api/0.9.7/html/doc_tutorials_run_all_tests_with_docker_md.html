<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_tutorials_run_all_tests_with_docker"></a> Running all the tests like the build server requires multiple dependencies. To overcome this problem, instead of trying to install all the necessary dependencies on your own, an appropriate Docker image can be used. This way you can easily and quickly run all the tests.</p>
<h1><a class="anchor" id="autotoc_md3682"></a>
Who Is This Guide For?</h1>
<p>For anyone who wants to run all the tests, like it is done by the build server.</p>
<p>This is a step-by-step guide. Just follow the steps and you are good to go!</p>
<h1><a class="anchor" id="autotoc_md3683"></a>
Prerequisites</h1>
<ul>
<li>Docker for Linux containers has to be preinstalled. Please refer to <a href="https://docs.docker.com/install/">https://docs.docker.com/install/</a> if you haven't installed it yet. Your host OS can be either Linux, macOS or Windows of course.</li>
<li>Basic knowledge of Docker (not mandatory)</li>
</ul>
<h1><a class="anchor" id="autotoc_md3684"></a>
What to Begin With?</h1>
<h2><a class="anchor" id="autotoc_md3685"></a>
1. Docker Image</h2>
<p>To build your own Docker image, run the following command from the source root directory:</p>
<div class="fragment"><div class="line">docker build -t buildelektra-sid \</div>
<div class="line">        --build-arg JENKINS_USERID=$(id -u) \</div>
<div class="line">        --build-arg JENKINS_GROUPID=$(id -g) \</div>
<div class="line">        -f scripts/docker/debian/sid/Dockerfile \</div>
<div class="line">        scripts/docker/debian/sid/</div>
</div><!-- fragment --><p>The build process depends on your Internet connection speed and the overall performance of your hardware. Most likely, it will take at least 5 minutes. Please be patient. Once you have built the image, you can reuse it multiple times.</p>
<p>The image tag <code>buildelektra-sid</code> we suggested can be replaced by a name of your own choosing.</p>
<p>Another alternative but not recommended(!) option would be to pick one of the publicly available Docker images of Elektra. If you do not know the difference, just pick this one --&gt; "build-elektra-debian-stretch". Unfortunately, it will take some time to download it, since it is pretty big, but you can be sure you'll have all the needed dependencies. You can choose a light-weight Alpine image which won't take long to download, however it is not recommended. This image does not contain all necessary dependencies.</p>
<p>If you want to view all the available images, execute this command:</p>
<div class="fragment"><div class="line">docker run --rm anoxis/registry-cli -r https://hub-public.libelektra.org</div>
</div><!-- fragment --><p>You will see something like this:</p>
<div class="fragment"><div class="line">---------------------------------</div>
<div class="line">Image: build-elektra-debian-stretch</div>
<div class="line">  tag: 201906-ecf9161f41a8b472b3b0282a85a9f91d1f0f45357756e5451ae043fce8d0100e</div>
<div class="line">  tag: 201902-b6d49f470e1171348248b2f87ef397d58d7a2dae14d201f4073564079ce0c070</div>
<div class="line">  tag: 201903-b95dc56352aa684e16dfb8628bded4c69c712223f5d7ed99ebdd644852a32123</div>
<div class="line">  tag: 201905-ecf9161f41a8b472b3b0282a85a9f91d1f0f45357756e5451ae043fce8d0100e</div>
<div class="line">  tag: 201901-6b08855f13ba26e3ad1fa80e399b87df860cc24889f2d1854fa0050834567b26</div>
<div class="line">  tag: 201904-ecf9161f41a8b472b3b0282a85a9f91d1f0f45357756e5451ae043fce8d0100e</div>
<div class="line">  tag: 201904-1a6be7b9c3740a2338b14d08c757332cae5254ce58219b6cc2908c7bd6e4f460</div>
<div class="line">  tag: 201903-1a6be7b9c3740a2338b14d08c757332cae5254ce58219b6cc2908c7bd6e4f460</div>
<div class="line">  tag: 201903-6b08855f13ba26e3ad1fa80e399b87df860cc24889f2d1854fa0050834567b26</div>
<div class="line">  tag: 201902-6b08855f13ba26e3ad1fa80e399b87df860cc24889f2d1854fa0050834567b26</div>
</div><!-- fragment --><p>Afterwards pull your desired image as you would do from any public registry:</p>
<div class="fragment"><div class="line">docker pull hub-public.libelektra.org/&lt;image_name&gt;:&lt;tag_name&gt;</div>
</div><!-- fragment --><p>Example:</p>
<div class="fragment"><div class="line">docker pull hub-public.libelektra.org/build-elektra-debian-stretch:201905-9dfe329fec01a6e40972ec4cc71874210f69933ab5f9e750a1c586fa011768ab</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3686"></a>
2. Run the Docker Container</h2>
<p>You have to be in the root of the source directory of the Elektra Initiative, so that the container can properly map all the source files.</p>
<p>So from your root source folder run the following:</p>
<div class="fragment"><div class="line">docker run -it --rm \</div>
<div class="line">-v &quot;$PWD:/home/jenkins/workspace&quot; \</div>
<div class="line">-w /home/jenkins/workspace \</div>
<div class="line">buildelektra-sid</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3687"></a>
3. Build</h2>
<p>After starting the container, you should be automatically inside it in the working directory <code>/home/jenkins/workspace</code>.</p>
<p>Create folder folder where Elektra will be installed, create another folder for building the source and <code>cd</code> to it and like this:</p>
<div class="fragment"><div class="line">mkdir elektra-install &amp;&amp; mkdir elektra-build-docker &amp;&amp; cd elektra-build-docker</div>
</div><!-- fragment --><p>Build it with</p>
<div class="fragment"><div class="line"> cmake /home/jenkins/workspace \</div>
<div class="line">-DBINDINGS=&quot;ALL;-DEPRECATED&quot; \</div>
<div class="line">-DPLUGINS=&quot;ALL;-DEPRECATED&quot; \</div>
<div class="line">-DTOOLS=&quot;ALL&quot; \</div>
<div class="line">-DENABLE_DEBUG=&quot;ON&quot; \</div>
<div class="line">-DKDB_DB_HOME=&quot;/home/jenkins/workspace/elektra-build-docker/.config/kdb/home&quot; \</div>
<div class="line">-DKDB_DB_SYSTEM=&quot;/home/jenkins/workspace/elektra-build-docker/.config/kdb/system&quot; \</div>
<div class="line">-DKDB_DB_SPEC=&quot;/home/jenkins/workspace/elektra-build-docker/.config/kdb/spec&quot; \</div>
<div class="line">-DBUILD_DOCUMENTATION=&quot;OFF&quot; \</div>
<div class="line">-DCMAKE_RULE_MESSAGES=&quot;OFF&quot; \</div>
<div class="line">-DCMAKE_INSTALL_PREFIX=&quot;/home/jenkins/workspace/elektra-install&quot; \</div>
<div class="line">-DCOMMON_FLAGS=&quot;-Werror&quot;</div>
</div><!-- fragment --><p>and then with</p>
<div class="fragment"><div class="line">make -j 10</div>
</div><!-- fragment --><p>The number 10 can be changed as follows: number of supported simultaneous threads by your CPU + 2. But don't worry, this can only affect the speed of the building, it cannot really break it.</p>
<p>Additionally, you may want to install Elektra inside the container, because the installed tests rely on it. The build server also does this and it is possible that the installed tests have different results (e.g. if test data is missing) Just run this command:</p>
<div class="fragment"><div class="line">make install</div>
</div><!-- fragment --><p>After Elektra has been installed we need to add it to the PATH variable, meaning you and the tests can interact with Elektra by typing/executing <code>kdb</code> in the command line.</p>
<div class="fragment"><div class="line">export PATH=&quot;/home/jenkins/workspace/elektra-install/bin:$PATH&quot;</div>
<div class="line">export LD_LIBRARY_PATH=&quot;/home/jenkins/workspace/elektra-install/lib:$LD_LIBRARY_PATH&quot;</div>
<div class="line">export LUA_CPATH=&quot;/home/jenkins/workspace/elektra-install/lib/lua/5.2/?.so;&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3688"></a>
4. Run Tests</h2>
<p>Finally run the tests. There are two sets of tests. Run the first one with this command:</p>
<div class="fragment"><div class="line">make run_all</div>
</div><!-- fragment --><p>For the second set to run, remember to execute <code>make install</code> from the previous step. Run the second set with this command:</p>
<div class="fragment"><div class="line">kdb run_all</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

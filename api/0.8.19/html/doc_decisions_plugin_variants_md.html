<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Elektra: Plugin Variants</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.19</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin Variants </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Issue</h2>
<p>Some plugins are generic in the sense that they cannot fully define their contract statically. (Note: if they can decide it statically, you should prefer <a class="el" href="doc_tutorials_compilation-variants_md.html">compilation variants</a>.) Instead their contract is based on their configuration. We will call every combination of plugins+configuration where we get a different contract <b>plugin variant</b>.</p>
<p>The current issue is that there is no way to enumerate possible plugin variants as needed to list all functionality of Elektra.</p>
<h2>Constraints</h2>
<ul>
<li>User Customizability:<ul>
<li>Users must be able to add new plugin variants</li>
<li>Users should be able to suppress plugin variants</li>
</ul>
</li>
<li>Modularity:<ul>
<li>The plugins themselves yield a list of plugin variants</li>
<li>The code defining variants is part of the plugin's code</li>
<li>To get a full list of all variants of all plugins, one simply has to iterate over all plugins and ask the plugins for possible variants.</li>
</ul>
</li>
<li>libtool should provide a convenience layer for easy access of all plugin variants. In this case there should also be a performance optimization, that plugins do not need to be reopened required multiple times.</li>
</ul>
<h2>Assumptions</h2>
<ul>
<li>The number of variants needs to be bounded: plugin variants need to be fully enumerable</li>
</ul>
<h2>Considered Alternatives</h2>
<p>A specification of the plugin's configuration and a tool that can enumerate all possible essential configurations. Issues here are:</p>
<ul>
<li>Plugins might need to self-reference (a validation plugin might have plugin variants, too)</li>
<li>Elektra's specification language was not complete nor consistent at point of writing</li>
<li>Does not fit with the <code>checkconf</code> (<a href="http://git.libelektra.org/issues/559">see here</a>) approach.</li>
</ul>
<h2>Decision</h2>
<ol type="1">
<li>Provide a function <code>int genconf (KeySet * ks, Key * errorKey)</code> where <code>ks</code> is filled with a list of all variants with the essential configuration (subkeys <code>config</code>) and the changed parts of the contract (subkeys <code>infos</code>).</li>
<li>Keys defined in <code>system/elektra/plugins/variants</code> have the same content, but take precedence. If a variant with the same name is defined, only <code>config</code> or <code>infos</code> from <code>genconf</code> are considered if they are not mentioned in <code>system/elektra/plugins/variants</code>. If the keys <code>config</code> or <code>infos</code> are present, it will be overwritten (deleted), if only subkeys thereof are present, it will be enhanced.</li>
<li>Empty <code>config</code> and <code>infos</code> mean:<ul>
<li><code>config</code>: The "default variant" (without any parameter) should be also available (has useful functionality)</li>
<li><code>infos</code>: It is not possible to determine the changes of the contract, the user need to instantiate the plugin and enquiry the contract.</li>
</ul>
</li>
</ol>
<h3>Example</h3>
<p><code>genconf</code> for augeas yields: ``` access access/config access/config/lens = Access.lns access/infos access/infos/format = access aliases aliases/config aliases/config/lens = Aliases.lns aliases/config/path = /etc/aliases aliases/infos aliases/infos/format = aliases ```</p>
<p><code>genconf</code> for python yields: ``` configparser/config configparser/config/script = python_configparser.py ```</p>
<p>the user specifies: ``` system/elektra/plugins/variants/access system/elektra/plugins/variants/aliases/infos/status = 10000 system/elektra/plugins/variants/configparser system/elektra/plugins/variants/configparser/config system/elektra/plugins/variants/configparser/config/script = mybetter_configparser.py ```</p>
<p>then the plugin variant:</p>
<ol type="1">
<li><code>access</code> is not available (<code>system/elektra/plugins/variants/access</code> overrides <code>genconf</code>)</li>
<li><code>aliases</code> as defined from <code>genconf</code>, but with changes in contract (<code>infos/status</code>)</li>
<li><code>configparser</code> is completely redefined (result from <code>genconf</code> will not be considered)</li>
</ol>
<h2>Argument</h2>
<ul>
<li>The <code>genconf</code> API was chosen to be consistent with <code>checkconf</code>. The pluginhandle might be missing for some scenarios. If it is needed, we should change both APIs for consistency reasons.</li>
<li>The very verbose (deeply nested) subkeys (and names instead of arrays) provide better customizability and extensibility.</li>
</ul>
<h2>Implications</h2>
<ul>
<li><code>genconf</code> needs to be implemented for the plugins:<ul>
<li>augeas</li>
<li>jni</li>
<li>lua</li>
<li>python</li>
<li>python2</li>
</ul>
</li>
<li><code>PluginDatabase</code> needs an extension to list all plugin variants</li>
<li><code>kdb list</code> should be able to list all variants, e.g. like: <code>augeas lens=Access.lns</code> <code>augeas format=access</code> so that a user can copy and paste this for the <code>kdb mount</code> command.</li>
</ul>
<h2>Related decisions</h2>
<ul>
<li><a class="el" href="doc_decisions_global_plugins_md.html">Global Plugins</a></li>
</ul>
<h2>Notes</h2>
<p>Discussions took place <a href="http://git.libelektra.org/issues/1006">here</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>

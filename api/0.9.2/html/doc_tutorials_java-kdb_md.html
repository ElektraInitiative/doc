<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: How-To: Java kdb</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How-To: Java kdb </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md2676"></a>
Introduction</h1>
<p>When programming in Java it is possible to access the key database, changing values of existing keys or adding new ones and a few other things. It is also possible to write plugins for Elektra in Java but we will focus on using the Java binding in this tutorial.</p>
<h1><a class="anchor" id="autotoc_md2677"></a>
First Steps</h1>
<p>In order to use <code>kdb</code> you need to include the dependency in your project. Here you can find a detailed tutorial on how to do that.</p>
<p>After that you can start loading a <code>KDB</code> object as follows:</p>
<div class="fragment"><div class="line">Key key = Key.create(<span class="stringliteral">&quot;user/kdbsession/javabinding&quot;</span>);</div>
<div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open(key)) {</div>
<div class="line">    <span class="comment">//Your code to manipulate keys</span></div>
<div class="line">} <span class="keywordflow">catch</span> (KDB.KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that <code>KDB</code> implements <code>AutoClosable</code> which allows <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resouces</a>.</p>
<p>You can also pass a <code>Key</code> object with an empty string on the first line. The passed key (<code>user/kdbsession/javabinding</code> in this case) is being used for the session and stores warnings and error information.</p>
<h1><a class="anchor" id="autotoc_md2678"></a>
Fetching keys</h1>
<p>First I will show you how you can retrieve a key which is already part of the database. The first thing we need to do is to create a <code>KeySet</code> in which our keys will be stored.</p>
<div class="fragment"><div class="line">KeySet <span class="keyword">set</span> = KeySet.create();</div>
</div><!-- fragment --><p>Now we load all keys and provide a parent key from which all keys below will be loaded</p>
<div class="fragment"><div class="line"><a class="code" href="namespacekdb.html">kdb</a>.get(<span class="keyword">set</span>, Key.create(<span class="stringliteral">&quot;user&quot;</span>));</div>
</div><!-- fragment --><p>Now we can simply fetch the desired key's value as follows:</p>
<div class="fragment"><div class="line">String str = <span class="keyword">set</span>.lookup(<span class="stringliteral">&quot;user/my/presaved/key&quot;</span>).getString()</div>
</div><!-- fragment --><p>So for example if you have executed before the application starts <code>kdb set user/my/test it_works!</code>, the method call <code>set.lookup("user/my/test").getString()</code> would return <code>it_works!</code>.</p>
<h1><a class="anchor" id="autotoc_md2679"></a>
Saving Keys</h1>
<p>Next I will show you how to save a new key into the database. First we need need to create an empty <code>KeySet</code> again. We also <b>need to fetch</b> all keys for the namespace before we will be able to save a new key.</p>
<div class="fragment"><div class="line">KeySet <span class="keyword">set</span> = KeySet.create();</div>
<div class="line">Key <span class="keyword">namespace </span>= Key.create(&quot;user&quot;);</div>
<div class="line"><a class="code" href="namespacekdb.html">kdb</a>.get(<span class="keyword">set</span>, <span class="keyword">namespace</span>);    <span class="comment">//Fetch all keys for the namespace</span></div>
<div class="line"><span class="keyword">set</span>.append(Key.create(<span class="stringliteral">&quot;user/somekey&quot;</span>, <span class="stringliteral">&quot;myValue&quot;</span>));</div>
<div class="line"><a class="code" href="namespacekdb.html">kdb</a>.set(<span class="keyword">set</span>, key);</div>
</div><!-- fragment --><p>If you try to save a key without fetching it beforehand, a <code>KDBException</code> will be thrown, telling you to call get before set.</p>
<p>The <em>user</em> namespace is accessible without special rights, but if you try to write to <em>system</em> you will need to have root privileges. Take a look at <a class="el" href="doc_TESTING_md.html">TESTING.md</a> to see how to access the system namespace as non-root user. This should only be done in testing environments though as it is not intended for productive systems.</p>
<h1><a class="anchor" id="autotoc_md2680"></a>
Examples</h1>
<h2><a class="anchor" id="autotoc_md2681"></a>
Traversing Keys in a &lt;tt&gt;KeySet&lt;/tt&gt;</h2>
<div class="fragment"><div class="line">Key key = Key.create(<span class="stringliteral">&quot;user/errors&quot;</span>);</div>
<div class="line"><span class="keywordflow">try</span> (KDB <a class="code" href="namespacekdb.html">kdb</a> = KDB.open(key)) {</div>
<div class="line">    KeySet <span class="keyword">set</span> = KeySet.create();</div>
<div class="line">    Key <span class="keyword">namespace </span>= Key.create(&quot;user&quot;);       <span class="comment">//Select a namespace from which all keys should be fetched</span></div>
<div class="line">    <a class="code" href="namespacekdb.html">kdb</a>.get(<span class="keyword">set</span>, <span class="keyword">namespace</span>);                  <span class="comment">//Fetch all keys into the set object</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <span class="keyword">set</span>.length(); i++) {  <span class="comment">//Traverse the set</span></div>
<div class="line">        String keyAndValue = String.format(<span class="stringliteral">&quot;%s: %s&quot;</span>,</div>
<div class="line">                <span class="keyword">set</span>.at(i).getName(),          <span class="comment">//Fetch the key&#39;s name</span></div>
<div class="line">                <span class="keyword">set</span>.at(i).getString());       <span class="comment">//Fetch the key&#39;s value</span></div>
<div class="line">        System.out.println(keyAndValue);</div>
<div class="line">    }</div>
<div class="line">} <span class="keywordflow">catch</span> (KDB.KDBException e) {</div>
<div class="line">    e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><p>First we create a new <code>KDB</code> object and fetch all keys for the desired namespace, in this example the <code>user</code> namespace. Since it saves all keys in our passed <code>set</code> variable we can then iterate through it by a simple for loop. The <code>at(int)</code> method gives us the key on the corresponding position which we will print out in this example.</p>
<h2><a class="anchor" id="autotoc_md2682"></a>
Read Multiple Keys From KDB</h2>
<p>This example shows how to read multiple keys. It provides comments for further clarification. Before building and running this example, add first your jar file like described here. Then build the project with this command from the root directory:</p>
<div class="fragment"><div class="line">mvn clean package</div>
</div><!-- fragment --><p>Afterwards run it with (change VERSION in the command below!):</p>
<div class="fragment"><div class="line">java -cp target/read-keys-example-jar-with-dependencies.jar:lib/libelektra4j-VERSION.jar org.libelektra.app.App</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2683"></a>
Java Plugin Tutorial</h1>
<p>For the tutorial on how to write java plugins, please check out <a class="el" href="doc_tutorials_java-plugins_md.html">this</a> page. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespacekdb_html"><div class="ttname"><a href="namespacekdb.html">kdb</a></div><div class="ttdoc">This is the main namespace for the C++ binding and libraries.</div><div class="ttdef"><b>Definition:</b> backend.hpp:30</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: glob</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: glob </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about glob plugin is in keys below</li>
<li>infos/author = Felix Berlakovich <a href="#" onclick="location.href='mai'+'lto:'+'ele'+'kt'+'ra@'+'be'+'rla'+'ko'+'vic'+'h.'+'net'; return false;">elekt<span style="display: none;">.nosp@m.</span>ra@b<span style="display: none;">.nosp@m.</span>erlak<span style="display: none;">.nosp@m.</span>ovic<span style="display: none;">.nosp@m.</span>h.net</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = apply</li>
<li>infos/needs =</li>
<li>infos/recommends =</li>
<li>infos/ordering = check keytometa</li>
<li>infos/stacking = no</li>
<li>infos/placements = presetstorage postgetstorage</li>
<li>infos/status = unittest nodep libc configurable difficult</li>
<li>infos/description = copies metadata to keys with the help of globbing</li>
</ul>
<h1><a class="anchor" id="src_plugins_glob_README_md"></a>
Introduction</h1>
<p>The glob plugin provides coping metadata given by the plugin's configuration to keys identified using <em>glob expressions</em>. Globbing resembles regular expressions. They do not have the same expressive power, but are easier to use. The semantics are more suitable to match path names:</p>
<ul>
<li><code>*</code> matches any key name of just one hierarchy. This means it complies with any character except slash or null.</li>
<li><code>?</code> satisfies single characters with the same exclusions.</li>
<li>Additionally, there are ranges and character classes. They can also be inverted.</li>
</ul>
<p>So this plugin adds metadata to keys identified by globbing expressions. The plugin copies the metadata of the corresponding globbing keys in its configuration. Globbing can be applied in get and set direction or both.</p>
<h1><a class="anchor" id="autotoc_md231"></a>
Globbing Keys</h1>
<p>The plugin is configured with globbing keys in its configuration. Each key below the configuration is interpreted as a globbing key. The value of the key contains the globbing expression. When a key matching the glob expression contained in one of the globbing keys is found, the metakeys of the corresponding globbing key are copied. Once a match is found, no further keys will be considered for globbing. The reason for this are catch all globbing keys that can be used to match all keys that have not been matched by a preceding globbing key.</p>
<h2><a class="anchor" id="autotoc_md232"></a>
Globbing Direction</h2>
<p>Globbing keys located directly below the configuration (e.g <code>config/glob/#1</code>) are applied in both directions (get and set). Keys below "get" (e.g. <code>config/glob/get/#1</code>) are applied only in the get direction and keys below set (e.g. <code>config/glob/set/#1</code>) are applied only in the set direction.</p>
<p>So the glob plugin iterates over a list of glob expressions for every key. Metadata is applied only for the first expression that matches. So later expressions can be used as default values.</p>
<h2><a class="anchor" id="autotoc_md233"></a>
Globbing Flags</h2>
<p>Globbing keys may contain a subkey named "flags". This optional key contains the flags to be passed to the globbing function (currently fnmatch) as a comma separated list. Unknown flag names will be ignored. The allowed flag names are</p>
<ul>
<li>"noescape" which enables the FNM_NOESCAPE flag</li>
<li>"pathname" which enables the FNM_PATHNAME flag</li>
<li>"period" which enables the FNM_PERIOD flag</li>
</ul>
<p>If the flag key does not exist, FNM_PATHNAME is used as a default (see fnmatch(3) for more details). An empty string disables all flags (i.e. also the default flag).</p>
<h1><a class="anchor" id="autotoc_md234"></a>
Contracts</h1>
<p>Glob statements are very useful together with contracts. Storage plugins can request the glob plugin to fill up metadata before they receive the keys in <code>elektraPluginSet()</code>. In <code>config/needs</code>, the plugin declares which keys should obtain which metadata. If the glob expression starts with a slash, the contract checker will automatically prepend the mount point.</p>
<p>For example, the hosts plugin contract contained:</p>
<div class="fragment"><div class="line"><a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a> (30,</div>
<div class="line">  <span class="comment">// …</span></div>
<div class="line">  <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/hosts/config/needs/glob/#1&quot;</span>,</div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a>, <span class="stringliteral">&quot;/*&quot;</span>,</div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a>, <span class="stringliteral">&quot;check/ipaddr&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* Preferred way to check */</span></div>
<div class="line">          <span class="comment">/* Can be checked additionally */</span></div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a>, <span class="stringliteral">&quot;check/validation&quot;</span>, <span class="stringliteral">&quot;^[0-9.:]+$&quot;</span>,</div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a>, <span class="stringliteral">&quot;check/validation/message&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;Character present not suitable for ip address&quot;</span>,</div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">  <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/hosts/config/needs/glob/#2&quot;</span>,</div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a>, <span class="stringliteral">&quot;/*/*&quot;</span>,</div>
<div class="line">          <span class="comment">/* Strict character validation */</span></div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a>, <span class="stringliteral">&quot;check/validation&quot;</span>, <span class="stringliteral">&quot;^[0-9a-zA-Z.:]+$&quot;</span>,</div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a>, <span class="stringliteral">&quot;check/validation/message&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;Character present not suitable for host address&quot;</span>,</div>
<div class="line">      <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">  <span class="comment">// …</span></div>
<div class="line">);</div>
<div class="ttc" id="agroup__key_html_gad23c65b44bf48d773759e1f9a4d43b89"><div class="ttname"><a href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a></div><div class="ttdeci">Key * keyNew(const char *name,...)</div><div class="ttdoc">A practical way to fully create a Key object in one step.</div><div class="ttdef"><b>Definition:</b> key.c:138</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a></div><div class="ttdeci">@ KEY_META</div><div class="ttdef"><b>Definition:</b> kdbenum.c:92</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a></div><div class="ttdeci">@ KEY_END</div><div class="ttdef"><b>Definition:</b> kdbenum.c:95</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a></div><div class="ttdeci">@ KEY_VALUE</div><div class="ttdef"><b>Definition:</b> kdbenum.c:88</div></div>
<div class="ttc" id="agroup__keyset_html_ga671e1aaee3ae9dc13b4834a4ddbd2c3c"><div class="ttname"><a href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a></div><div class="ttdeci">KeySet * ksNew(size_t alloc,...)</div><div class="ttdoc">Allocate, initialize and return a new KeySet object.</div><div class="ttdef"><b>Definition:</b> keyset.c:213</div></div>
</div><!-- fragment --><p>We see that the <code>hosts</code> plugin added two glob statements with the clause <code>config/needs</code>. The first one matches with hostnames, the second with aliases.</p>
<p>The glob plugin only fills the metadata in <code><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a></code>. This makes a difference compared with adding the metadata already in <code><a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a></code>. Using the glob plugin, the user will not see the metadata, but later plugins in <code><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a></code> will.</p>
<p>To sum up, the glob plugin replenishes the keys with metadata. The plugin applies metadata in a flexible way. This metadata can be used for later checks. Limited configuration storage plugins, like the <code>hosts</code> plugin, use this feature. They need it because they are not able to store metadata themselves. It is obviously not possible to apply values to non-existing keys. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>


\begin{DoxyItemize}
\item infos = Information about the yanlr plugin is in keys below
\item infos/author = René Schwaiger \href{mailto:sanssecours@me.com}{\tt sanssecours@me.\+com}
\item infos/licence = B\+SD
\item infos/needs = directoryvalue yamlsmith
\item infos/provides = storage/yaml
\item infos/recommends =
\item infos/placements = getstorage
\item infos/status = maintained unittest preview experimental unfinished nodoc concept discouraged
\item infos/metadata =
\item infos/description = This storage plugin use a parser generated by A\+N\+T\+LR to read Y\+A\+ML files
\end{DoxyItemize}\hypertarget{md_src_plugins_yanlr_README_src_plugins_yanlr_README_md}{}\section{Yan LR}\label{md_src_plugins_yanlr_README_src_plugins_yanlr_README_md}
\subsection*{Introduction}

This plugin uses A\+N\+T\+LR to generate a parser for the \href{http://yaml.org}{\tt Y\+A\+ML} serialization format. Apart from the hand written \href{/home/markus/Projekte/Elektra/current/src/plugins/yanlr/yaml_lexer.cpp}{\tt lexer}, all other parts of the plugin use standard A\+N\+T\+LR tools, such as


\begin{DoxyItemize}
\item an A\+N\+T\+LR parser grammar,
\item a \href{/home/markus/Projekte/Elektra/current/src/plugins/yanlr/listener.cpp}{\tt listener}, that reacts to matches in the grammar building a key set, and
\item an \href{/home/markus/Projekte/Elektra/current/src/plugins/yanlr/error_listener.cpp}{\tt error listener} that reacts to syntax errors
\end{DoxyItemize}

\subsection*{Dependencies}

The plugin requires


\begin{DoxyItemize}
\item \href{https://www.antlr.org}{\tt A\+N\+T\+LR} {\ttfamily 4.\+7.\+1} or later (\href{https://repology.org/metapackage/antlr4}{\tt {\ttfamily antlr4}}), and
\item \href{https://github.com/antlr/antlr4/tree/master/runtime/Cpp}{\tt A\+N\+T\+LR 4’s C++ runtime} (\href{https://repology.org/metapackage/antlr4-cpp-runtime}{\tt {\ttfamily antlr4-\/cpp-\/runtime}} or \href{https://packages.debian.org/search?searchon=names&keywords=libantlr4-runtime-dev}{\tt {\ttfamily libantlr4-\/runtime-\/dev}})
\end{DoxyItemize}

. If packages for those libraries are not available for your system, you can install them manually. For more information about that please take a look \href{https://www.antlr.org}{\tt at A\+N\+T\+L\+R’s homepage} and at the \href{https://github.com/antlr/antlr4/tree/master/runtime/Cpp}{\tt Read\+Me of the A\+N\+T\+LR C++ runtime}.

\subsection*{Examples}

\subsubsection*{Mappings}

``{\ttfamily  $<$h1$>$Mount plugin to namespace}user/tests/yanlr` sudo kdb mount config.\+yaml user/tests/yanlr yanlr

\section*{Manually add some mappings to the configuration file}

printf \textquotesingle{}all \+: circles presuppose~\newline
\textquotesingle{} $>$ {\ttfamily kdb file user/tests/yanlr} printf \textquotesingle{}hello \+: world~\newline
\textquotesingle{} $>$$>$ {\ttfamily kdb file user/tests/yanlr}

kdb ls /tests/yanlr \#$>$ user/tests/yanlr/all \#$>$ user/tests/yanlr/hello

kdb get user/tests/yanlr/all \#$>$ circles presuppose

\section*{Store value at root of mountpoint}

kdb set user/tests/yanlr \textquotesingle{}Mount Eerie\textquotesingle{} kdb get user/tests/yanlr \#$>$ Mount Eerie

\section*{Add new key-\/value pairs}

\section*{Yan LR actually uses the Y\+A\+ML Smith plugin to write data}

kdb set user/tests/yanlr/brand new kdb set user/tests/yanlr/brand/new eyes kdb set user/tests/yanlr/dance/gavin \textquotesingle{}Dance!\textquotesingle{}

kdb ls /tests/yanlr \#$>$ user/tests/yanlr \#$>$ user/tests/yanlr/all \#$>$ user/tests/yanlr/brand \#$>$ user/tests/yanlr/brand/new \#$>$ user/tests/yanlr/dance/gavin \#$>$ user/tests/yanlr/hello

kdb get /tests/yanlr/hello \#$>$ world kdb get user/tests/yanlr/brand \#$>$ new kdb get /tests/yanlr/dance/gavin \#$>$ Dance!

\section*{Undo modifications to the key database}

kdb rm -\/r user/tests/yanlr sudo kdb umount user/tests/yanlr 
\begin{DoxyCode}
### Arrays
\end{DoxyCode}
 \section*{Mount plugin to cascading namespace {\ttfamily /tests/yanlr}}

sudo kdb mount config.\+yaml user/tests/yanlr yanlr

\section*{Manually add a sequences to the configuration file}

printf \textquotesingle{}primes\+:~\newline
\textquotesingle{} $>$ {\ttfamily kdb file user/tests/yanlr} printf \textquotesingle{} -\/ two~\newline
\textquotesingle{} $>$$>$ {\ttfamily kdb file user/tests/yanlr} printf \textquotesingle{} -\/ three~\newline
\textquotesingle{} $>$$>$ {\ttfamily kdb file user/tests/yanlr} printf \textquotesingle{} -\/ five~\newline
\textquotesingle{} $>$$>$ {\ttfamily kdb file user/tests/yanlr}

kdb ls user/tests/yanlr \#$>$ user/tests/yanlr/primes \#$>$ user/tests/yanlr/primes/\#0 \#$>$ user/tests/yanlr/primes/\#1 \#$>$ user/tests/yanlr/primes/\#2

kdb set user/tests/yanlr/primes/\#3 seven

\section*{Retrieve index of last array element}

kdb getmeta user/tests/yanlr/primes array \#$>$ \#3

\section*{Undo modifications to the key database}

kdb rm -\/r user/tests/yanlr sudo kdb umount user/tests/yanlr 
\begin{DoxyCode}
### Error Messages
\end{DoxyCode}
 \section*{Mount plugin}

sudo kdb mount config.\+yaml user/tests/yanlr yanlr

\section*{Manually add syntactically incorrect data}

printf -- \textquotesingle{}key\+: -\/ element 1~\newline
\textquotesingle{} $>$ {\ttfamily kdb file user/tests/yanlr} printf -- \textquotesingle{}-\/ element 2 \# Incorrect Indentation!\textquotesingle{} $>$$>$ {\ttfamily kdb file user/tests/yanlr}

\section*{The plugin reports the location of the error}

kdb ls user/tests/yanlr \section*{R\+ET\+: 5}

\section*{S\+T\+D\+E\+RR\+: .$\ast$/config.yaml\+:2\+:1\+: mismatched input \textquotesingle{}-\/ \textquotesingle{} expecting end of map.$\ast$}

\section*{Let us look at the error message more closely.}

\section*{Since the location of {\ttfamily config.\+yaml} depends on the current user and OS,}

\section*{we store the text before {\ttfamily config.\+yaml} as {\ttfamily user/tests/error/prefix}.}

kdb set user/tests/error \char`\"{}\$(2$>$\&1 kdb ls user/tests/yanlr)\char`\"{} kdb set user/tests/error/prefix \char`\"{}\$(kdb get user/tests/error $\vert$ grep \textquotesingle{}config.\+yaml\textquotesingle{} $\vert$ head -\/1 $\vert$ sed -\/\+E \textquotesingle{}s/(.$\ast$)config.\+yaml.$\ast$/\textbackslash{}1/\textquotesingle{})\char`\"{} kdb get user/tests/error/prefix \section*{We also store the length of the prefix, so we can remove it from every}

\section*{line of the error message.}

kdb set user/tests/error/prefix/length \char`\"{}\$(kdb get user/tests/error/prefix $\vert$ wc -\/c $\vert$ sed \textquotesingle{}s/\mbox{[} \mbox{]}$\ast$//g\textquotesingle{})\char`\"{}

\section*{Since we only want to look at the “reason” of the error, we}

\section*{remove the other part of the error message with {\ttfamily head} and {\ttfamily tail}.}

kdb get user/tests/error $\vert$ tail -\/n11 $\vert$ head -\/n6 $\vert$ cut -\/c\char`\"{}\$(kdb get user/tests/error/prefix/length $\vert$ tr -\/d \textquotesingle{}\textbackslash{}n\textquotesingle{})\char`\"{}-\/ \#$>$ config.\+yaml\+:2\+:1\+: mismatched input \textquotesingle{}-\/ \textquotesingle{} expecting end of map \#$>$ -\/ element 2 \# Incorrect Indentation! \#$>$ $^\wedge$$^\wedge$ \#$>$ config.\+yaml\+:2\+:37\+: extraneous input \textquotesingle{}end of map\textquotesingle{} expecting end of document \#$>$ -\/ element 2 \# Incorrect Indentation! \#$>$ $^\wedge$

\section*{Fix syntax error}

printf -- \textquotesingle{}key\+: -\/ element 1~\newline
\textquotesingle{} $>$ {\ttfamily kdb file user/tests/yanlr} printf -- \textquotesingle{} -\/ element 2 \# Fixed!\textquotesingle{} $>$$>$ {\ttfamily kdb file user/tests/yanlr}

kdb ls user/tests/yanlr \#$>$ user/tests/yanlr/key \#$>$ user/tests/yanlr/key/\#0 \#$>$ user/tests/yanlr/key/\#1

\section*{Undo modifications}

kdb rm -\/r user/tests/error kdb rm -\/r user/tests/yanlr sudo kdb umount user/tests/yanlr 
\begin{DoxyCode}
## Limitations

- The plugin does **not support**

  - plain scalars that span **multiple lines**,
  - **special characters** inside double quoted scalars,
  - other **line endings** than `\(\backslash\)n` (Unix line endings),
  - **block scalars**,
  - **flow collections**,
  - **tags**,
  - **anchors & aliases**,
  - **multiple documents**, and
  - document **start and end markers**

  .

- Yan LR does not provide write support for data. Please use the [YAML Smith](@ref
       src\_plugins\_yamlsmith\_README\_md) plugin for that purpose.

### Comments

The [lexer](/home/markus/Projekte/Elektra/current/src/plugins/yanlr/yaml\_lexer.cpp) does currently tokenize
       comments. Consequently the [plugin grammar](@ref src\_plugins\_yanlr\_YAML\_g4) of the plugin does also match
       comments. However, the [listener](/home/markus/Projekte/Elektra/current/src/plugins/yanlr/listener.cpp) does
       currently **ignore comments**.

### Indentation

The lexer does not check for incorrect indentation. Consequently the following YAML data:



```yaml
        value
\end{DoxyCode}


will produce a plain scalar containing a tab character followed by the text {\ttfamily value}. The correct behavior would be to report an error, since Y\+A\+ML does not allow tab characters in indentation.

\subsubsection*{Error Messages}

Visualized error messages (containing {\ttfamily $^\wedge$} markers) might not point to the correct error location, if the input contains tabs or unicode characters with a length other than {\ttfamily 1}. 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: toml</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: toml </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the toml plugin is in keys below</li>
<li>infos/author = Jakob Fischer <a href="#" onclick="location.href='mai'+'lto:'+'jak'+'ob'+'fis'+'ch'+'er9'+'3@'+'gma'+'il'+'.co'+'m'; return false;">jakob<span style="display: none;">.nosp@m.</span>fisc<span style="display: none;">.nosp@m.</span>her93<span style="display: none;">.nosp@m.</span>@gma<span style="display: none;">.nosp@m.</span>il.co<span style="display: none;">.nosp@m.</span>m</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = storage/toml</li>
<li>infos/needs = base64</li>
<li>infos/recommends = type</li>
<li>infos/placements = getstorage setstorage</li>
<li>infos/status = experimental unfinished</li>
<li>infos/metadata = order comment/# comment/#/start comment/#/space type tomltype origvalue</li>
<li>infos/description = This storage plugin reads and writes TOML files using Flex and Bison.</li>
</ul>
<h1><a class="anchor" id="src_plugins_toml_README_md"></a>
Introduction</h1>
<p>This plugin is a storage plugin for reading and writing TOML files. The plugin retains most of the file structure of a read TOML file such as comments, empty lines and TOML tables. It supports all kinds of TOML specific types and tables, including nested inline tables and multiline strings.</p>
<h1><a class="anchor" id="autotoc_md525"></a>
Requirements</h1>
<p>The plugin needs Flex (&gt;=2.6.2) and Bison (&gt;=3) for parsing TOML files.</p>
<h1><a class="anchor" id="autotoc_md526"></a>
Types</h1>
<h2><a class="anchor" id="autotoc_md527"></a>
Reading</h2>
<p>On reading, the plugin will set the <code>type</code> metakey for strings, integers, floats and boolean values, if applicable. For decimal integers, the metakey is set to <code>long_long</code>. For binary/octal/hexadecimal integers, the metakey is set to <code>unsigned_long_long</code>. For floats, the metakey will be set to <code>double</code>. These types are chosen to conform with the TOML format as stated on the offical <a href="https://toml.io/en/v1.0.0-rc.1">TOML</a> page.</p>
<p>On reading, non-decimal integers will get converted to decimal. The non-decimal representation will be stored in the <code>origvalue</code> metakey of the key. When writing a key, the value of that metakey will be written instead, in order to retain the original format. Note that the <code>origvalue</code> metakey gets removed if the value of the key changes.</p>
<div class="fragment"><div class="line">sudo kdb mount test.toml user:/tests/storage/types toml type</div>
<div class="line"> </div>
<div class="line"># Create a TOML file with 4 keys</div>
<div class="line">echo &#39;plain_decimal = 1000&#39; &gt;&gt; `kdb file user:/tests/storage/types`</div>
<div class="line">echo &#39;file_permissions = 0o777&#39; &gt;&gt; `kdb file user:/tests/storage/types`</div>
<div class="line">echo &#39;pi = 3.1415&#39; &gt;&gt; `kdb file user:/tests/storage/types`</div>
<div class="line">echo &#39;division_gone_wrong = -inf&#39; &gt;&gt; `kdb file user:/tests/storage/types`</div>
<div class="line"> </div>
<div class="line"># Print the content of the toml file</div>
<div class="line">cat `kdb file user:/tests/storage/types`</div>
<div class="line"># &gt; plain_decimal = 1000</div>
<div class="line"># &gt; file_permissions = 0o777</div>
<div class="line"># &gt; pi = 3.1415</div>
<div class="line"># &gt; division_gone_wrong = -inf</div>
<div class="line"> </div>
<div class="line"># Print types and values of the keys with `kdb`</div>
<div class="line"> </div>
<div class="line">kdb meta-get &#39;user:/tests/storage/types/plain_decimal&#39; &#39;type&#39;</div>
<div class="line"># &gt; long_long</div>
<div class="line">kdb get &#39;user:/tests/storage/types/plain_decimal&#39;</div>
<div class="line"># &gt; 1000</div>
<div class="line"> </div>
<div class="line">kdb meta-get &#39;user:/tests/storage/types/file_permissions&#39; &#39;type&#39;</div>
<div class="line"># &gt; unsigned_long_long</div>
<div class="line"># The octal value will be converted to decimal</div>
<div class="line">kdb get &#39;user:/tests/storage/types/file_permissions&#39;</div>
<div class="line"># &gt; 511</div>
<div class="line"> </div>
<div class="line">kdb meta-get &#39;user:/tests/storage/types/pi&#39; &#39;type&#39;</div>
<div class="line"># &gt; double</div>
<div class="line">kdb get &#39;user:/tests/storage/types/pi&#39;</div>
<div class="line"># &gt; 3.1415</div>
<div class="line"> </div>
<div class="line">kdb meta-get &#39;user:/tests/storage/types/division_gone_wrong&#39; &#39;type&#39;</div>
<div class="line"># &gt; double</div>
<div class="line">kdb get &#39;user:/tests/storage/types/division_gone_wrong&#39;</div>
<div class="line"># &gt; -inf</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage/types</div>
<div class="line">sudo kdb umount user:/tests/storage/types</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md528"></a>
Writing</h2>
<p>On writing, for most values, the plugin will infer the appropriate type and will write them accordingly. This means, values, that match a TOML float, integer or date will be written without any quotes around them. If a value does not match any of these types, it will be written as a string.</p>
<p>The plugin uses an existing <code>type</code> metakey only to check if it should write a value as a <code>string</code> or a <code>boolean</code>.</p>
<p>With this functionality, numbers can be written as a string to the file, if wanted.</p>
<p>To write a boolean value, the <code>type</code> metakey must be set to <code>boolean</code> for the key. Otherwise, no conversion to the TOML boolean values will take place. Per default, Elektra uses 0/1 to represent boolean values.</p>
<div class="fragment"><div class="line">sudo kdb mount test.toml user:/tests/storage/types toml type</div>
<div class="line"> </div>
<div class="line"># Create a key, which may be a integer, boolean or string</div>
<div class="line">kdb set &#39;user:/tests/storage/types/value&#39; &#39;1&#39;</div>
<div class="line"> </div>
<div class="line"># The plugin infers `long_long` for this value</div>
<div class="line">kdb meta-get &#39;user:/tests/storage/types/value&#39; &#39;type&#39;</div>
<div class="line"># &gt; long_long</div>
<div class="line"> </div>
<div class="line"># The value is written as an integer</div>
<div class="line">cat `kdb file user:/tests/storage/types`</div>
<div class="line"># &gt; value = 1</div>
<div class="line"> </div>
<div class="line"># Manually set the `type` metakey to boolean</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/types/value&#39; &#39;type&#39; &#39;boolean&#39;</div>
<div class="line"> </div>
<div class="line"># The value is written as a boolean</div>
<div class="line">cat `kdb file user:/tests/storage/types`</div>
<div class="line"># &gt; value = true</div>
<div class="line"> </div>
<div class="line"># Manually set the `type` metakey to string</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/types/value&#39; &#39;type&#39; &#39;string&#39;</div>
<div class="line"> </div>
<div class="line"># The value is written as a string</div>
<div class="line">cat `kdb file user:/tests/storage/types`</div>
<div class="line"># &gt; value = &quot;1&quot;</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage/types</div>
<div class="line">sudo kdb umount user:/tests/storage/types</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md529"></a>
Numbers</h1>
<p>The plugin supports reading and writing of any kind of number supported by the TOML format, such as floating point numbers and binary/octal/decimal/hexadecimal integers. To write a non-decimal integer, add the corresponding prefix to the number (<code>0b</code> for binary, <code>0o</code> for octal, <code>0x</code> for hexadecimal). The value will be written in the given base to the file, but converted to decimal within Elektra (see <a href="##reading">Reading</a>). Note that the plugin doesn't warn about invalid prefix/digit combinations. If the combination is not valid, it will be written as a string instead.</p>
<p>If the <code>type</code> plugin is enabled and you want to change the value of an existing number key which needs conversion (all keys which have a <code>origvalue</code>), you have to change the value of <code>origvalue</code> instead of the key value. Otherwise the <code>type</code> plugin will give an error.</p>
<div class="fragment"><div class="line"># Mount a new TOML file</div>
<div class="line">sudo kdb mount test.toml user:/tests/storage/numbers toml type</div>
<div class="line"> </div>
<div class="line"># Write an octal value</div>
<div class="line">kdb set &#39;user:/tests/storage/numbers/a&#39; &#39;0o777&#39;</div>
<div class="line"> </div>
<div class="line"># Get the converted decimal value</div>
<div class="line">kdb get &#39;user:/tests/storage/numbers/a&#39;</div>
<div class="line"># &gt; 511</div>
<div class="line"> </div>
<div class="line"># Get the original octal value</div>
<div class="line">kdb meta-get &#39;user:/tests/storage/numbers/a&#39; &#39;origvalue&#39;</div>
<div class="line"># &gt; 0o777</div>
<div class="line"> </div>
<div class="line"># Get the type of the number; since it&#39;s originally octal, we get `unsigned_long_long`</div>
<div class="line">kdb meta-get &#39;user:/tests/storage/numbers/a&#39; &#39;type&#39;</div>
<div class="line"># &gt; unsigned_long_long</div>
<div class="line"> </div>
<div class="line"># Change the value by changing the `origvalue` metakey</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/numbers/a&#39; &#39;origvalue&#39; &#39;0o666&#39;</div>
<div class="line"> </div>
<div class="line"># Get the new value as decimal</div>
<div class="line">kdb get &#39;user:/tests/storage/numbers/a&#39;</div>
<div class="line"># &gt; 438</div>
<div class="line"> </div>
<div class="line"># Change the value to an invalid octal value.</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/numbers/a&#39; &#39;origvalue&#39; &#39;0o888&#39;</div>
<div class="line"> </div>
<div class="line"># The key value is no longer considered a number</div>
<div class="line">kdb meta-get &#39;user:/tests/storage/numbers/a&#39; &#39;type&#39;</div>
<div class="line"># &gt; string</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage/numbers</div>
<div class="line">sudo kdb umount user:/tests/storage/numbers</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md530"></a>
Strings</h1>
<p>The plugin can read any kind of TOML string: bare, basic, literal, basic multiline and literal multiline. However, it will write back all non-bare strings as basic strings or it's multiline version. Therefore, any string set with <code>kdb set</code> must be treated as a basic string and possible escape sequences and special meanings of quotation characters must be taken care of.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_strings.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># setting a string containing a newline escape sequence</div>
<div class="line">kdb set &#39;user:/tests/storage/string&#39; &#39;I am a basic string\not a literal one.&#39;</div>
<div class="line"> </div>
<div class="line">kdb get &#39;user:/tests/storage/string&#39;</div>
<div class="line"># &gt; I am a basic string</div>
<div class="line"># &gt; ot a literal one</div>
<div class="line"> </div>
<div class="line"># setting the string again, but escape the backslash with another backslash</div>
<div class="line">kdb set &#39;user:/tests/storage/string&#39; &#39;I am a basic string\\not a literal one.&#39;</div>
<div class="line"> </div>
<div class="line">kdb get &#39;user:/tests/storage/string&#39;</div>
<div class="line"># &gt; I am a basic string\not a literal one</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><p>The plugin supports all kinds of escape sequences used by TOML in basic and basic multiline strings, like <code>\n</code>, <code>\r</code>, <code>\t</code> and even <code>\u</code>/<code>\U</code> for Unicode escape sequences. <code>\t</code> is interpreted to be 4 spaces.</p>
<h1><a class="anchor" id="autotoc_md531"></a>
Binary/NULL values</h1>
<p>The plugin handles binary values by using the <a class="el" href="md_src_plugins_base64_README.html#src_plugins_base64_README_md">base64</a> plugin. As a result, binary values get written as base64 encoded strings, which start with the special prefix <code>@BASE64</code>. <code>NULL</code> key values are written as special strings of value <code>@NULL</code>.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_binary.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># Creating a key with a NULL value</div>
<div class="line">kdb set &#39;user:/tests/storage/nullkey&#39;</div>
<div class="line"># &gt; Create a new key user:/test/nullkey with null value</div>
<div class="line"> </div>
<div class="line"># Print file content</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line"># &gt; nullkey = &#39;@NULL&#39;</div>
<div class="line"> </div>
<div class="line"># Write base64 encoded data to the file</div>
<div class="line">echo &quot;base64 = &#39;@BASE64SSBhbSBiYXNlIDY0IGVuY29kZWQgZm9yIG5vIHJlYXNvbi4=&#39;&quot; &gt; `kdb file user:/test`</div>
<div class="line"> </div>
<div class="line"># Print the value of the key, which is a binary value</div>
<div class="line">kdb get &#39;user:/test/base64&#39;</div>
<div class="line">#&gt; \x49\x20\x61\x6d\x20\x62\x61\x73\x65\x20\x36\x34\x20\x65\x6e\x63\x6f\x64\x65\x64\x20\x66\x6f\x72\x20\x6e\x6f\x20\x72\x65\x61\x73\x6f\x6e\x2e</div>
<div class="line"> </div>
<div class="line"># Print the value again, but apply the escape codes</div>
<div class="line">echo -e `kdb get &#39;user:/test/base64&#39;`</div>
<div class="line">#&gt; I am base 64 encoded for no reason.</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md532"></a>
TOML specific structures</h1>
<p>TOML specific structures are represented by the metakey <code>tomltype</code> on a certain key. It will be set when the TOML plugin reads a TOML structure from a file. Additionally, this metakey can be set by the user, if they want a certain TOML structure to be written. No automatic inference of this metakey is done on writing.</p>
<h2><a class="anchor" id="autotoc_md533"></a>
Simple Tables</h2>
<p>TOML's simple tables are represented by setting the <code>tomltype</code> metakey to <code>simpletable</code>.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_table.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># Create three keys, which are all a subkey of &#39;common&#39;,</div>
<div class="line"># but we have no &#39;common&#39; simple table key yet</div>
<div class="line">kdb set &#39;user:/tests/storage/common/a&#39; &#39;0&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/common/b&#39; &#39;1&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/common/c&#39; &#39;2&#39;</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; common.a = 0</div>
<div class="line">#&gt; common.b = 1</div>
<div class="line">#&gt; common.c = 2</div>
<div class="line"> </div>
<div class="line"># Create a simple table key</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/common&#39; &#39;tomltype&#39; &#39;simpletable&#39;</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; [common]</div>
<div class="line">#&gt; a = 0</div>
<div class="line">#&gt; b = 1</div>
<div class="line">#&gt; c = 2</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md534"></a>
Table Arrays</h2>
<p>Table arrays are represented by setting the <code>tomltype</code> metakey to <code>tablearray</code>. It is not required to also set the array metakey, since the plugin will set the metakey, if it is missing.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_table_array.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># Create a table array containing two entries, each with a key &#39;a&#39; and &#39;b&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/tablearray&#39; &#39;tomltype&#39; &#39;tablearray&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/tablearray/#0/a&#39; &#39;1&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/tablearray/#0/b&#39; &#39;2&#39;</div>
<div class="line"> </div>
<div class="line">kdb set &#39;user:/tests/storage/tablearray/#1/a&#39; &#39;3&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/tablearray/#1/b&#39; &#39;4&#39;</div>
<div class="line"> </div>
<div class="line"># Print the highest index of the table array</div>
<div class="line">kdb meta-get &#39;user:/tests/storage/tablearray&#39; &#39;array&#39;</div>
<div class="line">#&gt; #1</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; [[tablearray]]</div>
<div class="line">#&gt; a = 1</div>
<div class="line">#&gt; b = 2</div>
<div class="line">#&gt; [[tablearray]]</div>
<div class="line">#&gt; a = 3</div>
<div class="line">#&gt; b = 4</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md535"></a>
Inline Tables</h2>
<p>Inline tables are represented by setting the <code>tomltype</code> metakey to <code>inlinetable</code>. The plugin also supports reading/writing nested inline tables.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_inline_table.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># Create a table array containing two entries, each with a key &#39;a&#39; and &#39;b&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/inlinetable&#39; &#39;tomltype&#39; &#39;inlinetable&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/inlinetable/a&#39; &#39;1&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/inlinetable/b&#39; &#39;2&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/inlinetable/nested&#39; &#39;tomltype&#39; &#39;inlinetable&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/inlinetable/nested/x&#39; &#39;3&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/inlinetable/nested/y&#39; &#39;4&#39;</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; inlinetable = { a = 1, b = 2, nested = { x = 3, y = 4 } }</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md536"></a>
Arrays</h2>
<p>Arrays are recognized by the <code>array</code> metakey. On writing, the plugin will detect arrays automatically and set the appropriate metakey if it is missing.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_array.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># Create array elements</div>
<div class="line">kdb set &#39;user:/tests/storage/array/#0&#39; &#39;1&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/array/#1&#39; &#39;2&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/array/#2&#39; &#39;3&#39;</div>
<div class="line"> </div>
<div class="line"># Print the highest index of the array</div>
<div class="line">kdb meta-get &#39;user:/tests/storage/array&#39; &#39;array&#39;</div>
<div class="line">#&gt; #2</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; array = [1, 2, 3]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md537"></a>
Comments and Empty Lines</h1>
<p>The plugin preserves all comments with only one limitation for arrays. The amount of whitespace in front of a comment is also saved. For this purpose, each tab will get translated to 4 spaces.</p>
<p>Comments can also be created by assigning meta keys to a key. The meta keys must be of the form <code>comment/#n</code>, where <code>n</code> is a positive number, indicating the position of the comment relative to the key. An index of 0 is always the inline comment of the key. Indices greater than zero are for comments preceding the given key, where 1 is the top-most comment and the highest index comment is right above the key.</p>
<p>Spaces can be added to a comment by creating a <code>comment/#n/space</code> metakey with the amount of spaces to the key.</p>
<p>File ending comments must be assigned to the file root key.</p>
<p>Empty lines in front of a key can be created by adding an empty <code>comment/#n/start</code> entry to it. In this case, no <code>comment/#n</code> key is needed.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_comments.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># create a key-value pair, ready for comment decoration</div>
<div class="line"> </div>
<div class="line">kdb set &#39;user:/tests/storage/key&#39; &#39;1&#39;</div>
<div class="line"> </div>
<div class="line"># add an inline comment with 4 leading spaces</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/key&#39; &#39;comment/#0&#39; &#39; This value is very interesting&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/key&#39; &#39;comment/#0/space&#39; &#39;4&#39;</div>
<div class="line"> </div>
<div class="line"># add some comments preceding the key</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/key&#39; &#39;comment/#1&#39; &#39; I am the top-most comment relative to my key.&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/key&#39; &#39;comment/#2&#39; &#39; I am in the middle. Just boring.&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/key&#39; &#39;comment/#3&#39; &#39; I am in the line right above my key.&#39;</div>
<div class="line"> </div>
<div class="line"># add file ending comments and empty lines</div>
<div class="line">kdb meta-set &#39;user:/tests/storage&#39; &#39;comment/#1&#39; &#39; First file-ending comment&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage&#39; &#39;comment/#2/start&#39; &#39;&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage&#39; &#39;comment/#3&#39; &#39; Second file-ending comment. I am the last line of the file.&#39;</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; # I am the top-most comment relative to my key.</div>
<div class="line">#&gt; # I am in the middle. Just boring.</div>
<div class="line">#&gt; # I am in the line right above my key.</div>
<div class="line">#&gt; key = 1    # This value is very interesting</div>
<div class="line">#&gt; # First file-ending comment</div>
<div class="line">#&gt;</div>
<div class="line">#&gt; # Second file-ending comment. I am the last line of the file.</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md538"></a>
Comments in Arrays</h2>
<p>Any amount of comments can be placed between array elements or between the first element and the opening brackets.</p>
<p>However, only one comment - an inline comment - can be placed after the last element and the closing brackets. On reading, the plugin discards any non-inline comments between the last element and the closing brackets.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_array_comments.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># Create array elements</div>
<div class="line">kdb set &#39;user:/tests/storage/array/#0&#39; &#39;1&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/array/#1&#39; &#39;2&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/array/#2&#39; &#39;3&#39;</div>
<div class="line"> </div>
<div class="line"># Add inline comment after the array</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array&#39; &#39;comment/#0&#39; &#39; Inline comment after the array&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array&#39; &#39;comment/#0/start&#39; &#39;#&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array&#39; &#39;comment/#0/space&#39; &#39;5&#39;</div>
<div class="line"> </div>
<div class="line"># Add comments for array elements</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#0&#39; &#39; Inline comment of first element&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#0/start&#39; &#39;#&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#0/space&#39; &#39;4&#39;</div>
<div class="line"> </div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#1&#39; &#39; Comment preceding the first element&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#1/start&#39; &#39;#&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#1/space&#39; &#39;4&#39;</div>
<div class="line"> </div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#2&#39; &#39; Another comment preceding the first element&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#2/start&#39; &#39;#&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#0&#39; &#39;comment/#2/space&#39; &#39;6&#39;</div>
<div class="line"> </div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#1&#39; &#39;comment/#0&#39; &#39; Inline comment of second element&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#1&#39; &#39;comment/#0/start&#39; &#39;#&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#1&#39; &#39;comment/#0/space&#39; &#39;4&#39;</div>
<div class="line"> </div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#1&#39; &#39;comment/#1&#39; &#39; Comment preceding the second element&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#1&#39; &#39;comment/#1/start&#39; &#39;#&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#1&#39; &#39;comment/#1/space&#39; &#39;6&#39;</div>
<div class="line"> </div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#2&#39; &#39;comment/#0&#39; &#39; Inline comment of the last element&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#2&#39; &#39;comment/#0/start&#39; &#39;#&#39;</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/array/#2&#39; &#39;comment/#0/space&#39; &#39;5&#39;</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; array = [    # Comment preceding the first element</div>
<div class="line">#&gt;       # Another comment preceding the first element</div>
<div class="line">#&gt; 1,    # Inline comment of first element</div>
<div class="line">#&gt;       # Comment preceding the second element</div>
<div class="line">#&gt; 2,    # Inline comment of second element</div>
<div class="line">#&gt; 3     # Inline comment of the last element</div>
<div class="line">#&gt; ]     # Inline comment after the array</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md539"></a>
Order</h1>
<p>The plugin preserves the file order by the usage of the metakey <code>order</code>. When reading a file, the order metakey will be set according to the order as read in the file. If new keys are added, eg. via <code>kdb set</code>, the order of the set key will be set to the next-to-highest order value present in the existing key set.</p>
<p>However, the order is only relevant between elements with the same TOML-parent. For example keys of a simple table are only sorted with respect to each other, not with any keys outside that table. If that table has it's order changed and moves to another position in the file, so will it's subkeys.</p>
<p>When sorting elements under the same TOML-parent, tables (simple and array) will always be sorted after non-table elements, regardless of their order. With this limitation, we prevent that a newly set key, that is not part of a certain table array/simple table, would be placed after the table declaration, making it a member of that table on a subsequent read.</p>
<div class="fragment"><div class="line"># Mount TOML file</div>
<div class="line">sudo kdb mount test_order.toml user:/tests/storage toml type</div>
<div class="line"> </div>
<div class="line"># Create three keys in reverse alphabetical order under the subkey common</div>
<div class="line"># Additionally, create one key not in the common subkey space</div>
<div class="line"> </div>
<div class="line">kdb set &#39;user:/tests/storage/common/c&#39; &#39;0&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/common/b&#39; &#39;1&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/common/a&#39; &#39;2&#39;</div>
<div class="line">kdb set &#39;user:/tests/storage/d&#39; &#39;3&#39;</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line"># The keys are ordered as they were set</div>
<div class="line"> </div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; common.c = 0</div>
<div class="line">#&gt; common.b = 1</div>
<div class="line">#&gt; common.a = 2</div>
<div class="line">#&gt; d = 3</div>
<div class="line"> </div>
<div class="line"># Create a simple table for the three keys under `common`</div>
<div class="line">kdb meta-set &#39;user:/tests/storage/common&#39; &#39;tomltype&#39; &#39;simpletable&#39;</div>
<div class="line"> </div>
<div class="line"># Print the content of the resulting TOML file</div>
<div class="line">cat `kdb file user:/tests/storage`</div>
<div class="line">#&gt; d = 3</div>
<div class="line">#&gt; [common]</div>
<div class="line">#&gt; c = 0</div>
<div class="line">#&gt; b = 1</div>
<div class="line">#&gt; a = 2</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kdb rm -r user:/tests/storage</div>
<div class="line">sudo kdb umount user:/tests/storage</div>
</div><!-- fragment --><p>In this example, <code>d</code> and <code>common</code> have the same parent, the file root. This means, they need to be sorted with each other. <code>d</code> would be placed before <code>common</code> by it's order, since it was set before, and thus, has lesser order. However, their order never gets compared, since <code>common</code> is a simple table and <code>d</code> is not, so <code>d</code> will get sorted before the table regardless of order.</p>
<h1><a class="anchor" id="autotoc_md540"></a>
Limitations</h1>
<p>While the plugin has good capabilities in handling the TOML file format, it currently lacks some features possible with Elektra:</p>
<ul>
<li>Sparse arrays are not preserved on writing, they get a continuous array without index holes.</li>
<li>Values on non-leaf keys are currently not supported, they get discarded.</li>
<li>Custom metakeys cannot be written by the plugin, so they get discarded.</li>
</ul>
<p>Additionally, there are some minor limitations related to the TOML file format, mostly related to the preservation of the original file structure:</p>
<ul>
<li>On writing, each string is written as a TOML basic string (single or multiline). See <a href="#Strings">Strings</a></li>
<li>Comments and newlines between the last array element and closing brackets are discarded.</li>
<li>Trailing commas in arrays and inline tables are discarded</li>
<li>Only spaces in front of comments are preserved. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

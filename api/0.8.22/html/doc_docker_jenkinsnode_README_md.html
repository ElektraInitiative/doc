<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Configuring Elektra as a Jenkins build node with Docker</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.22</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Configuring Elektra as a Jenkins build node with Docker </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This Dockerfile builds a dockerimage based on debian:stretch including all requirements to build Elektra and most of its bindings/plugins to act as a build node for Jenkins. It contains an ssh server and a java environment to allow jenkins to connect to the container and execute commands on top of that.</p>
<p>Before building the image, you may want to adjust the password for jenkins to something more secure, so adjust the line <code>echo "jenkins:&lt;password&gt;" | chpasswd &amp;&amp; \</code> in the Dockerfile.</p>
<p>Optionally you can modify the file <code>run_make</code> if you want to increase the number of jobs for the make command on the build container. You can also modify <code>run_ionice</code> to adjust the build process' priority, which is set to idle by default in order to keep the host system responsive. In case you want to disable that, change the line <code>ionice -c 3 nice $*</code> in <code>run_ionice</code> to simply <code>$*</code>.</p>
<p>Now build the image with the following command:</p>
<div class="fragment"><div class="line">$ docker build -t buildelektra-stretch .</div></div><!-- fragment --><p>After the build process has completed you can create and run a Docker container that uses the image we just created. Additionally you need to forward the ssh port to some port you want to use on the container's host so jenkins can connect to it. We give this container a name to easily refer to it at runtime.</p>
<div class="fragment"><div class="line">$ docker run -d -p 22222:22 --name build-v2 buildelektra-stretch</div></div><!-- fragment --><p>Now you should be able to connect to the container locally via the host machine:</p>
<div class="fragment"><div class="line">$ ssh jenkins@localhost -p 22222</div></div><!-- fragment --><p>Afterwards you need to ensure that this ssh port is also accessible from the outside, so that the jenkins master server can connect to the build node. As this greatly depends on the given network setup we can't give an exact explanation for it, but you may need to expose the local port to the outside or even use SSH tunneling or forwarding in case your build node doesn't have direct access to the jenkins master server.</p>
<p>Once this works, you have to add the credentials for the container's jenkins user to the main jenkins server and connect to it. All done! </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

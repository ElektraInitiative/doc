<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Header File Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.9</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Header File Structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_decisions_header_file_structure"></a> </p>
<h1><a class="anchor" id="autotoc_md1906"></a>
Problem</h1>
<p>kdb.h contains the public API for both libelektra-core and libelektra-kdb. It is confusing and makes it hard to see what library a function actually belongs to.</p>
<p>The big problem is <a class="el" href="kdbprivate_8h.html" title="Private declarations.">kdbprivate.h</a>. It has two main problems:</p>
<ol type="1">
<li>It contains stuff from many different libraries. I found at least libelektra-core, libelektra-kdb and libelektra-highlevel.</li>
<li>It contains things that are different levels of "private".</li>
</ol>
<h1><a class="anchor" id="autotoc_md1907"></a>
Constraints</h1>
<h1><a class="anchor" id="autotoc_md1908"></a>
Assumptions</h1>
<h1><a class="anchor" id="autotoc_md1909"></a>
Considered Alternatives</h1>
<h1><a class="anchor" id="autotoc_md1910"></a>
Decision</h1>
<ol type="1">
<li>Some parts are truly private, i.e. shouldn't be used outside the library that defines them. These things are only there because a library was split into multiple .c files. This includes e.g. splitNew and struct _Split. Here it would be better to use a local header file in the library's source folder. Symbols belonging to this category should not appear at all in the symbols.map file.</li>
<li>Other things truly private, but must be tested. This includes e.g. most other split* functions or the elektraKeyName* functions. Here a local header could be used as well (requires longer relative includes), or we could create a src/include/testing folder (could be added to include path). Symbols belonging to this category should only appear in the private section of the symbols.map file (we could also create a second private section, if is just there for testing, or adjust some compiler configs for testing).</li>
<li>Then there are things that I would call internal or pseudo-private. This includes the struct _Key and struct _KeySet, but also keyClearSync or elektraMalloc and the high-level functions needed for codegen. These are things that shouldn't be part of the public API, because we don't want to make all the guarantees associated with that, but nonetheless cannot truly be private. In other words, each of these functions/structs/symbols has a specific "target audience" that may use it. Here I would either create a separate <a class="el" href="kdbinternal_8h.html" title="Includes most internal header files.">kdbinternal.h</a> or just keep <a class="el" href="kdbprivate_8h.html" title="Private declarations.">kdbprivate.h</a>, as long as it is a separate file from 4. Symbols belonging to this category should only appear in the private section of the symbols.map file.</li>
<li>Finally, there is what I'd call unstable or pseudo-public. This includes e.g. ksFindHierarchy or elektraReadArrayNumber. These functions could be public, but for various reasons are not. Maybe they are not well-tested or maybe we just don't want to commit to the function yet. Many of these (but not all) can't be part of libelektra-ease, because the rely on something more private (e.g. directly access the array in a KeySet). Here I would either create a separate <a class="el" href="kdbinternal_8h.html" title="Includes most internal header files.">kdbinternal.h</a> or just keep <a class="el" href="kdbprivate_8h.html" title="Private declarations.">kdbprivate.h</a>, as long as it is a separate file from 3. Symbols belonging to this category should only appear in the private section of the symbols.map file.</li>
</ol>
<h1><a class="anchor" id="autotoc_md1911"></a>
Rationale</h1>
<h1><a class="anchor" id="autotoc_md1912"></a>
Implications</h1>
<h1><a class="anchor" id="autotoc_md1913"></a>
Related Decisions</h1>
<h1><a class="anchor" id="autotoc_md1914"></a>
Notes</h1>
<p>Initial text copied from @kodebach <a href="https://github.com/ElektraInitiative/libelektra/issues/4219">https://github.com/ElektraInitiative/libelektra/issues/4219</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

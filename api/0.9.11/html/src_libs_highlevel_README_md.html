<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: High-Level API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">High-Level API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_libs_highlevel_README"></a> </p>
<h1><a class="anchor" id="autotoc_md5"></a>
Introduction</h1>
<p>The goal of the high-level API is to increase the usability of libelektra for developers who want to integrate Elektra into their applications. Applications usually do not want to use low-level APIs. <code>KDB</code> and <code>KeySet</code> are useful for plugins and to implement APIs, but not to be directly used in applications. The high-level API should be extremely easy to get started with and at the same time it should be hard to use it in a wrong way. This tutorial gives an introduction for developers who want to elektrify their application using the high-level API.</p>
<p>The API supports all CORBA Basic Data Types, except for <code>wchar</code>, as well as the <code>string</code> type (see also <a href="#data-types">Data Types</a> below).</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Setup</h1>
<p>First you have to add <code>elektra-highlevel</code>, <code>elektra-kdb</code> and <code>elektra-ease</code> to the linked libraries of your application. To be able to use it in your source file, just include the main header with <code>#include &lt;<a class="el" href="elektra_8h.html" title="Elektra High Level API.">elektra.h</a>&gt;</code> at the top of your file.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Quickstart</h1>
<p>The quickest way to get started is to adapt the following piece of code to your needs:</p>
<div class="fragment"><div class="line">ElektraError * error = NULL;</div>
<div class="line">Elektra * elektra = <a class="code" href="group__highlevel.html#ga45de58b05c7a8ab02f6c54ddd31a56e1">elektraOpen</a> (<span class="stringliteral">&quot;/sw/org/myapp/#0/current&quot;</span>, NULL, NULL, &amp;error);</div>
<div class="line"><span class="keywordflow">if</span> (elektra == NULL)</div>
<div class="line">{</div>
<div class="line">        printf (<span class="stringliteral">&quot;An error occurred: %s&quot;</span>, <a class="code" href="group__highlevel.html#ga781cda83af3981a55321e7c613afbef0">elektraErrorDescription</a> (error));</div>
<div class="line">        <a class="code" href="group__highlevel.html#ga591f7ed4b57a341928bf7bb3d7adb693">elektraErrorReset</a> (&amp;error);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">kdb_long_t mylong = <a class="code" href="group__highlevel.html#gad4198ec223f01c3a6cfb1b78de34bc9e">elektraGetLong</a> (elektra, <span class="stringliteral">&quot;mylong&quot;</span>);</div>
<div class="line">printf (<span class="stringliteral">&quot;got long &quot;</span> ELEKTRA_LONG_F <span class="stringliteral">&quot;\n&quot;</span>, mylong);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__highlevel.html#ga3d703756b43b1ca85296f894e80e22e2">elektraSetBoolean</a> (elektra, <span class="stringliteral">&quot;mybool&quot;</span>, <span class="keyword">true</span>, &amp;error);</div>
<div class="line"><span class="keywordflow">if</span> (error != NULL)</div>
<div class="line">{</div>
<div class="line">        printf (<span class="stringliteral">&quot;An error occurred: %s&quot;</span>, <a class="code" href="group__highlevel.html#ga781cda83af3981a55321e7c613afbef0">elektraErrorDescription</a> (error));</div>
<div class="line">        <a class="code" href="group__highlevel.html#ga591f7ed4b57a341928bf7bb3d7adb693">elektraErrorReset</a> (&amp;error);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__highlevel.html#ga9b688b7250e5f9d8ea6701cc2cc269af">elektraClose</a> (elektra);</div>
<div class="ttc" id="agroup__highlevel_html_ga3d703756b43b1ca85296f894e80e22e2"><div class="ttname"><a href="group__highlevel.html#ga3d703756b43b1ca85296f894e80e22e2">elektraSetBoolean</a></div><div class="ttdeci">void elektraSetBoolean(Elektra *elektra, const char *keyname, kdb_boolean_t value, ElektraError **error)</div><div class="ttdoc">Sets a boolean value.</div><div class="ttdef"><b>Definition:</b> elektra_value.c:402</div></div>
<div class="ttc" id="agroup__highlevel_html_ga45de58b05c7a8ab02f6c54ddd31a56e1"><div class="ttname"><a href="group__highlevel.html#ga45de58b05c7a8ab02f6c54ddd31a56e1">elektraOpen</a></div><div class="ttdeci">Elektra * elektraOpen(const char *application, KeySet *defaults, KeySet *contract, ElektraError **error)</div><div class="ttdoc">Initializes a new Elektra instance.</div><div class="ttdef"><b>Definition:</b> elektra.c:67</div></div>
<div class="ttc" id="agroup__highlevel_html_ga591f7ed4b57a341928bf7bb3d7adb693"><div class="ttname"><a href="group__highlevel.html#ga591f7ed4b57a341928bf7bb3d7adb693">elektraErrorReset</a></div><div class="ttdeci">void elektraErrorReset(ElektraError **error)</div><div class="ttdoc">Frees the memory used by the error and sets the referenced error variable to NULL.</div><div class="ttdef"><b>Definition:</b> elektra_error.c:315</div></div>
<div class="ttc" id="agroup__highlevel_html_ga781cda83af3981a55321e7c613afbef0"><div class="ttname"><a href="group__highlevel.html#ga781cda83af3981a55321e7c613afbef0">elektraErrorDescription</a></div><div class="ttdeci">const char * elektraErrorDescription(const ElektraError *error)</div><div class="ttdef"><b>Definition:</b> elektra_error.c:306</div></div>
<div class="ttc" id="agroup__highlevel_html_ga9b688b7250e5f9d8ea6701cc2cc269af"><div class="ttname"><a href="group__highlevel.html#ga9b688b7250e5f9d8ea6701cc2cc269af">elektraClose</a></div><div class="ttdeci">void elektraClose(Elektra *elektra)</div><div class="ttdoc">Releases all resources used by the given elektra instance.</div><div class="ttdef"><b>Definition:</b> elektra.c:509</div></div>
<div class="ttc" id="agroup__highlevel_html_gad4198ec223f01c3a6cfb1b78de34bc9e"><div class="ttname"><a href="group__highlevel.html#gad4198ec223f01c3a6cfb1b78de34bc9e">elektraGetLong</a></div><div class="ttdeci">kdb_long_t elektraGetLong(Elektra *elektra, const char *keyname)</div><div class="ttdoc">Gets a long value.</div><div class="ttdef"><b>Definition:</b> elektra_value.c:272</div></div>
</div><!-- fragment --><p>To run the application, the configuration should be specified:</p>
<div class="fragment"><div class="line">sudo kdb meta-set /sw/org/myapp/#0/current/mylong type long</div>
<div class="line">sudo kdb meta-set /sw/org/myapp/#0/current/mylong default 5</div>
</div><!-- fragment --><p>The getter and setter functions follow the simple naming scheme <code>elektra</code>(<code>Get</code>/<code>Set</code>)[Type]. Additionally for each one there is a variant to access array elements with the suffix <code>ArrayElement</code>. For more information see <a href="#reading-and-writing-values">below</a>.</p>
<p>You can find a complete example at the end of this document and here.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Core Concepts</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Metadata and Specification</h2>
<p>In Elektra keys may have <a class="el" href="doc_help_elektra-metadata_md.html">attached metadata</a> describing additional properties of the key. By using <a class="el" href="doc_tutorials_namespaces_md.html">Elektra's</a>namespaces" and @ref doc_tutorials_cascading_md "cascading keys" it is also possible to have a full specification of your applications configuration.</p>
<p>This specification should be placed into the <code>spec</code> namespace. From there the high-level API and Elektra's plugins will access it. A specification for use with the high-level API has to <b>define at least the <code>default</code> and the <code>type</code> metadata for each key the application is going to use</b>. The <code>default</code> metakey simply defines which value will be returned, if the user didn't set a value. <code>type</code> defines the data type of key. For more information on data types <a href="#data-types">see below</a>.</p>
<p>The API also supports passing a <code>KeySet</code> to <code>elektraOpen</code> that contains the specification. This is, however, not recommended for general use and is mainly useful for debugging and testing purposes.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Struct &lt;tt&gt;Elektra&lt;/tt&gt;</h2>
<p><code>Elektra</code> is the handle you use to access the underlying KDB (hierarchical key database) that stores the configuration key-value pairs. All key-value read and write operations expect this handle to be passed as in as a parameter. To create the handle, you simply write:</p>
<div class="fragment"><div class="line">ElektraError * error = NULL;</div>
<div class="line">Elektra * elektra = <a class="code" href="group__highlevel.html#ga45de58b05c7a8ab02f6c54ddd31a56e1">elektraOpen</a> (<span class="stringliteral">&quot;/sw/org/myapp/#0/current&quot;</span>, NULL, NULL, &amp;error);</div>
</div><!-- fragment --><p>Please replace <code>"/sw/org/myapp/#0/current"</code> with an appropriate value for your application (see <a class="el" href="doc_tutorials_application-integration_md.html">here</a> for more information). You can use the parameter <code>defaults</code> to pass a <code>KeySet</code> containing <code>Key</code>s with default values to the <code>Elektra</code> instance.</p>
<p>The <code>ElektraError</code> can be used to check for initialization errors. You can detect initialization errors by comparing the result of <code>elektraOpen</code> to NULL:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (elektra == NULL)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// handle the error, e.g. print description</span></div>
<div class="line">  <a class="code" href="group__highlevel.html#ga591f7ed4b57a341928bf7bb3d7adb693">elektraErrorReset</a>(&amp;error);</div>
<div class="line">}</div>
</div><!-- fragment --><p>If an error occurred, you must call <code>elektraErrorReset</code> before using the same error pointer in any other function calls (e.g. <code>elektraSet*</code> calls). It is also safe to call <code>elektraErrorReset</code>, if no error occurred.</p>
<p>In order to give Elektra the chance to clean up all its allocated resources, you have to close your instance, when you are done using it, by calling:</p>
<div class="fragment"><div class="line"><a class="code" href="group__highlevel.html#ga9b688b7250e5f9d8ea6701cc2cc269af">elektraClose</a> (elektra);</div>
</div><!-- fragment --><p><em>NOTE:</em> Elektra is only thread-safe when you use one handle per thread or protect your handle. If you have multiple threads accessing key-values, create a separate handle for each thread to avoid concurrency issues.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Struct &lt;tt&gt;ElektraError&lt;/tt&gt;</h2>
<p>The library is designed to shield developers from the many errors one can encounter when using KDB directly. However it is not possible to hide all those issues. As with every library, things can go wrong and there needs to be a way to react to errors once they have occurred at runtime. Therefore the high-level API introduces a struct called <code>ElektraError</code>, which encapsulates all information necessary for the developer to handle runtime-errors appropriately in the application.</p>
<p>Functions that can produce errors, despite correct use of the API, accept an <code>ElektraError</code> pointer as parameter, for example:</p>
<div class="fragment"><div class="line">Elektra * <a class="code" href="group__highlevel.html#ga45de58b05c7a8ab02f6c54ddd31a56e1">elektraOpen</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> * application, KeySet * defaults, KeySet * contract, ElektraError ** error);</div>
</div><!-- fragment --><p>In most cases you'll want to set the error variable to <code>NULL</code> before passing it to the function. You can do this either by declaring and initializing a new variable with <code>ElektraError * error = NULL</code> or by reusing an already existing error variable by resetting it with <code>elektraErrorReset (&amp;error)</code>.</p>
<p>Notice, that you should always check if an error occurred by comparing it to <code>NULL</code> after the function call.</p>
<p>If an error happened, it is often useful to show an error message to the user. A description of what went wrong is provided in the <code>ElektraError</code> struct and can be accessed using <code>elektraErrorDescription (error)</code>. Additionally the error code can be accessed through <code>elektraErrorCode (error)</code>. NOTE: The error API is still a work in progress, so more functions will likely be added in the future.</p>
<p>To avoid leakage of memory, you have to call <code>elektraErrorReset (&amp;error)</code> (ideally as soon as you are finished resolving the error):</p>
<div class="fragment"><div class="line">ElektraError * error = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Call a function and pass the error variable as an argument.</span></div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (error != NULL)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// An error occurred, do something about it.</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__highlevel.html#ga591f7ed4b57a341928bf7bb3d7adb693">elektraErrorReset</a> (&amp;error);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Configuration</h2>
<p>Currently there is only one way to configure an <code>Elektra</code> instance:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__highlevel.html#ga496441e9e1dd80ed14a239dfc4c08c40">elektraFatalErrorHandler</a> (Elektra * elektra, ElektraErrorHandler fatalErrorHandler);</div>
<div class="ttc" id="agroup__highlevel_html_ga496441e9e1dd80ed14a239dfc4c08c40"><div class="ttname"><a href="group__highlevel.html#ga496441e9e1dd80ed14a239dfc4c08c40">elektraFatalErrorHandler</a></div><div class="ttdeci">void elektraFatalErrorHandler(Elektra *elektra, ElektraErrorHandler fatalErrorHandler)</div><div class="ttdoc">Sets the fatal error handler that will be called, whenever a fatal error occurs.</div><div class="ttdef"><b>Definition:</b> elektra.c:500</div></div>
</div><!-- fragment --><p>This allows you to set the callback called by Elektra, when a fatal error occurs. Technically a fatal error could occur at any time, but the most common use case for this callback is inside of functions that do not take a separate <code>ElektraError</code> argument. For example, this function will be called, when any of the getter-functions is called on a non-existent key which is not part of any specification, and therefore has no specified default value.</p>
<p>If you provide your own callback, it must interrupt the thread of execution in some way (e.g. by calling <code>exit()</code> or throwing an exception in C++). It <em>must not</em> return to the calling function.</p>
<p>The handler will also be called whenever you pass <code>NULL</code> where a function expects an <code>ElektraError **</code>. In this case the error code will be <code>ELEKTRA_ERROR_CODE_NULL_ERROR</code>.</p>
<p>The default callback simply logs the error with <code>ELEKTRA_LOG_DEBUG</code> and then calls <code>exit()</code> with exit code <code>EXIT_FAILURE</code> It is expected that you implement your own callback, so that you get proper error message logged in your applications preferred format. Using the default callback is only viable for very simple applications, because you won't get any indication as to which key caused the error (unless you compiled Elektra with debug logging enabled).</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Data Types</h1>
<p>The API determines the data type of a given key, by reading its <code>type</code> metadata. The API supports the following types, which are taken from the CORBA specification:</p>
<ul>
<li><b>String</b>: a string of characters, represented by <code>string</code> in metadata</li>
<li><b>Boolean</b>: a boolean value <code>true</code> or <code>false</code>, represented by <code>boolean</code> in metadata, in the KDB the raw value <code>"1"</code> is regarded as true, <code>"0"</code> regarded as false and any other value is an error</li>
<li><b>Char</b>: a single character, represented by <code>char</code> in metadata</li>
<li><b>Octet</b>: a single byte, represented by <code>octet</code> in metadata</li>
<li>**(Unsigned) Short**: a 16-bit (unsigned) integer, represented by <code>short</code> (<code>unsigned_short</code>) in metadata</li>
<li>**(Unsigned) Long**: a 32-bit (unsigned) integer, represented by <code>long</code> (<code>unsigned_long</code>) in metadata</li>
<li>**(Unsigned) Long Long**: a 64-bit (unsigned) integer, represented by <code>long_long</code> (<code>unsigned_long_long</code>) in metadata</li>
<li><b>Float</b>: whatever your compiler treats as <code>float</code>, probably IEEE-754 single-precision, represented by <code>float</code> in metadata</li>
<li><b>Double</b>: whatever your compiler treats as <code>double</code>, probably IEEE-754 double-precision, represented by <code>double</code> in metadata</li>
<li><b>Long Double</b>: whatever your compiler treats as <code>long double</code>, not always available, represented by <code>long_double</code> in metadata</li>
</ul>
<p>The API contains one header that is not automatically included from <code><a class="el" href="elektra_8h.html" title="Elektra High Level API.">elektra.h</a></code>. You can use it with <code>#include &lt;<a class="el" href="conversion_8h.html" title="Elektra conversion.">elektra/conversion.h</a>&gt;</code>. The header provides the functions Elektra uses to convert your configuration values to and from strings. In most cases, you won't need to use these functions directly, but they might still be useful sometimes (e.g. in combination with <code>elektraGetType</code> and <code>elektraGetRawString</code>). We also provide a <code>KDB_TPYE_*</code> constant for each of the types listed above. Again, most users won't use these but, if you ever do need to use the raw type metadata using constants enables code completion and protects against typos.</p>
<p>There is also the type <code>enum</code> with constant <code>KDB_TYPE_ENUM</code>. It is only supported via the <a class="el" href="doc_help_elektra-highlevel-gen_md.html">code-generation API</a>.</p>
<h4><a class="anchor" id="autotoc_md14"></a>
Note about Floating Point Types</h4>
<p>We enforce a few minimum properties for floating point types. They are taken from the IEE-754 specification and are:</p>
<ul>
<li>For <code>float</code>: 32 bits, binary, 24 mantissa digits and exponent range of at least -125 to 128</li>
<li>For <code>double</code>: 64 bits, binary, 53 mantissa digits and exponent range of at least -1021 to 1024</li>
<li>For <code>long double</code>: at least 80 bits, binary, at least 64 mantissa digits and exponent range of at least -2^14 + 3 to 2^14</li>
</ul>
<p>Additionally for C++ compilers we use a <code>static_assert</code> that will fail if <code>std::numeric_limits&lt;T&gt;::is_iec559</code> is <code>false</code> when <code>T</code> is any of <code>float</code>, <code>double</code> or <code>long double</code>.</p>
<p>While these checks won't ensure actual IEEE-754 arithmetic, they will at least ensure all values can be represented correctly.</p>
<p><a class="anchor" id="reading-and-writing-values"></a></p>
<h1><a class="anchor" id="autotoc_md15"></a>
Reading and Writing Values</h1>
<h2><a class="anchor" id="autotoc_md16"></a>
Key Names</h2>
<p>When calling <code>elektraOpen</code> you pass the parent key for your application. Afterwards getters and setters get passed in only the part below that key in the KDB. For example, if you call <code>elektraOpen</code> with <code>"/sw/org/myapp/#0/current"</code>, you can access your applications configuration value for the key <code>"/sw/org/myapp/#0/current/message"</code> with the provided getters and setters by passing them only <code>"message"</code> as the name for the configuration value.</p>
<p><a class="anchor" id="read-values-from-the-kdb"></a></p>
<h2><a class="anchor" id="autotoc_md17"></a>
Read Values from the KDB</h2>
<p>A typical application wants to read some configuration values at start. This should be made as easy as possible for the developer. Reading configuration data in most cases is not part of the business logic of the application and therefore should not "pollute" the applications source code with cumbersome setup and file-parsing code. This is exactly where Elektra comes in handy, because you can leave all the configuration file handling and parsing to the underlying layers of Elektra and just use the high-level API to access the desired data. Reading values from KDB can be done with elektra-getter functions that follow a simple naming scheme:</p>
<p><code>elektraGet</code> + the type of the value you want to read.</p>
<p>For example, you can get the value for the key named "message" like this:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * message = <a class="code" href="group__highlevel.html#ga08df058ca39c5ac17c26924d301bb742">elektraGetString</a> (elektra, <span class="stringliteral">&quot;message&quot;</span>);</div>
<div class="ttc" id="agroup__highlevel_html_ga08df058ca39c5ac17c26924d301bb742"><div class="ttname"><a href="group__highlevel.html#ga08df058ca39c5ac17c26924d301bb742">elektraGetString</a></div><div class="ttdeci">const char * elektraGetString(Elektra *elektra, const char *keyname)</div><div class="ttdoc">Gets a string value.</div><div class="ttdef"><b>Definition:</b> elektra_value.c:188</div></div>
</div><!-- fragment --><p>Sometimes you'll want to access arrays as well. You can access single elements of an array using the provided array-getters following again a simple naming scheme:</p>
<p><code>elektraGet</code> + the type of the value you want to read + <code>ArrayElement</code>.</p>
<p>For example, you can get the value at index 3 for the array "message" like this:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * message = <a class="code" href="group__highlevel.html#gaf445216facccfc7ad6740b594e7a8f6e">elektraGetStringArrayElement</a> (elektra, <span class="stringliteral">&quot;message&quot;</span>, 3);</div>
<div class="ttc" id="agroup__highlevel_html_gaf445216facccfc7ad6740b594e7a8f6e"><div class="ttname"><a href="group__highlevel.html#gaf445216facccfc7ad6740b594e7a8f6e">elektraGetStringArrayElement</a></div><div class="ttdeci">const char * elektraGetStringArrayElement(Elektra *elektra, const char *keyname, kdb_long_long_t index)</div><div class="ttdoc">Gets a string value array element.</div><div class="ttdef"><b>Definition:</b> elektra_array_value.c:266</div></div>
</div><!-- fragment --><p>To get the size of the array you would like to access you can use the function <code>elektraArraySize</code>:</p>
<div class="fragment"><div class="line">kdb_long_long_t arraySize = <a class="code" href="group__highlevel.html#gaf0413286c6faebdc951b739924111909">elektraArraySize</a> (elektra, <span class="stringliteral">&quot;message&quot;</span>);</div>
<div class="ttc" id="agroup__highlevel_html_gaf0413286c6faebdc951b739924111909"><div class="ttname"><a href="group__highlevel.html#gaf0413286c6faebdc951b739924111909">elektraArraySize</a></div><div class="ttdeci">kdb_long_long_t elektraArraySize(Elektra *elektra, const char *name)</div><div class="ttdoc">Gets the size of an array.</div><div class="ttdef"><b>Definition:</b> elektra_array_value.c:61</div></div>
</div><!-- fragment --><p>For some background information on arrays in Elektra see the <a class="el" href="doc_tutorials_arrays_md.html">Array</a> tutorial, as well as our <a class="el" href="doc_decisions_array_md.html">decision document</a> on this topic. Please note that the high level API does not support arrays with missing elements. If an element is missing (and the specification provides no default value), getters will fail.</p>
<p>Notice that both the getters for primitive types and the getters for array types do not accept error parameters. The library expects you to run a correct Elektra setup. If the configuration is well specified, no runtime errors can occur when reading a value. Therefore the getters do not accept an error variable as argument. If there is however a severe internal error, or you try to access a key which you have not specified correctly, then the library will call the error callback set with <code>elektraFatalErrorHandler</code> to prevent data inconsistencies or exceptions further down in your application.</p>
<p>You can find the complete list of the available functions for all supported value types in <a href="/home/jenkins/workspace/libelektra-release/src/include/elektra.h">elektra.h</a></p>
<h2><a class="anchor" id="autotoc_md18"></a>
Writing Values to the KDB</h2>
<p>Sometimes, after having read a value from the KDB, you will want to write back a modified value. As described in <a href="#read-values-from-the-kdb">Read values from the KDB</a> we follow a naming scheme for getters. The high-level API provides setters follow an analogous naming scheme as well. For example, to write back a modified "message", you can call <code>elektraSetString</code>:</p>
<div class="fragment"><div class="line"><a class="code" href="group__highlevel.html#ga563a695658e8e6f74183cca674edd1a7">elektraSetString</a> (elektra, <span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;This is the new message&quot;</span>, NULL);</div>
<div class="ttc" id="agroup__highlevel_html_ga563a695658e8e6f74183cca674edd1a7"><div class="ttname"><a href="group__highlevel.html#ga563a695658e8e6f74183cca674edd1a7">elektraSetString</a></div><div class="ttdeci">void elektraSetString(Elektra *elektra, const char *keyname, const char *value, ElektraError **error)</div><div class="ttdoc">Sets a string value.</div><div class="ttdef"><b>Definition:</b> elektra_value.c:387</div></div>
</div><!-- fragment --><p>The counterpart for array-getters again follows the same naming scheme:</p>
<div class="fragment"><div class="line"><a class="code" href="group__highlevel.html#gaa5bba7a5c811437562d947420034fd03">elektraSetStringArrayElement</a> (elektra, <span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;This is the third new message&quot;</span>, NULL);</div>
<div class="ttc" id="agroup__highlevel_html_gaa5bba7a5c811437562d947420034fd03"><div class="ttname"><a href="group__highlevel.html#gaa5bba7a5c811437562d947420034fd03">elektraSetStringArrayElement</a></div><div class="ttdeci">void elektraSetStringArrayElement(Elektra *elektra, const char *keyname, kdb_long_long_t index, const char *value, ElektraError **error)</div><div class="ttdoc">Sets a string value array element.</div><div class="ttdef"><b>Definition:</b> elektra_array_value.c:478</div></div>
</div><!-- fragment --><p>Because even the best specification and perfect usage as intended can not prevent any error from occurring, when saving the configuration, all setter-functions take an additional <code>ElektraError</code> argument, which will be set if an error occurs.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Raw Values</h2>
<p>You can use <code>const char * elektraGetRawString (Elektra * elektra, const char * name)</code> to read the raw (string) value of a key. No type checking or type conversion will be attempted. Additionally this function does not call the fatal error handler. It will simply return <code>NULL</code>, if the key was not found.</p>
<p>If you want to set a raw value, use <code>void elektraSetRawString (Elektra * elektra, const char * name, const char * value, KDBType type, ElektraError ** error)</code>. Obviously you have to provide a type for the value you set, so that the API can perform type checking, when reading the value next time.</p>
<p>Similar functions are provided for array elements:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__highlevel.html#ga1b704f49a8e87262b670cd191ba61bb3">elektraGetRawStringArrayElement</a> (Elektra * elektra, <span class="keyword">const</span> <span class="keywordtype">char</span> * name, kdb_long_long_t index);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__highlevel.html#ga965e0b2ce7d5e8938965259c3f584600">elektraSetRawStringArrayElement</a> (Elektra * elektra, <span class="keyword">const</span> <span class="keywordtype">char</span> * name, kdb_long_long_t index, <span class="keyword">const</span> <span class="keywordtype">char</span> * value, KDBType type, ElektraError ** error);</div>
<div class="ttc" id="agroup__highlevel_html_ga1b704f49a8e87262b670cd191ba61bb3"><div class="ttname"><a href="group__highlevel.html#ga1b704f49a8e87262b670cd191ba61bb3">elektraGetRawStringArrayElement</a></div><div class="ttdeci">const char * elektraGetRawStringArrayElement(Elektra *elektra, const char *name, kdb_long_long_t index)</div><div class="ttdoc">Get the raw string value of an array element key.</div><div class="ttdef"><b>Definition:</b> elektra_array_value.c:204</div></div>
<div class="ttc" id="agroup__highlevel_html_ga965e0b2ce7d5e8938965259c3f584600"><div class="ttname"><a href="group__highlevel.html#ga965e0b2ce7d5e8938965259c3f584600">elektraSetRawStringArrayElement</a></div><div class="ttdeci">void elektraSetRawStringArrayElement(Elektra *elektra, const char *name, kdb_long_long_t index, const char *value, KDBType type, ElektraError **error)</div><div class="ttdoc">Set the raw string value of an array element key.</div><div class="ttdef"><b>Definition:</b> elektra_array_value.c:221</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md20"></a>
Type Information</h3>
<p>The type information is stored in the <code>"type"</code> metakey. <code>KDBType elektraGetType (Elektra * elektra, const char * keyname)</code> (or <code>KDBType elektraGetArrayElementType (Elektra * elektra, const char * name, kdb_long_long_t index)</code> for array elements) lets you access this information. A setter is not provided, because Elektra assumes keys to always have the same type (as specified).</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Use cases for raw values</h3>
<p><code>elektraGetType</code>, <code>elektraGetRawString</code> and <code>elektraSetRawString</code> can be used together to create custom data types. If your application for example uses arbitrary-precision integers, you could something similar to these functions:</p>
<div class="fragment"><div class="line">bignum * elektraGetBigNum (Elektra * elektra, <span class="keyword">const</span> <span class="keywordtype">char</span> * keyname)</div>
<div class="line">{</div>
<div class="line">  KDBType type = <a class="code" href="group__highlevel.html#ga34afc074c83cf9ccd0a183573f8498a1">elektraGetType</a> (elektra, keyname);</div>
<div class="line">  <span class="keywordflow">if</span> (strcmp (type, <span class="stringliteral">&quot;bignum&quot;</span>) != 0)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * rawValue = <a class="code" href="group__highlevel.html#gae6c8eff14fb431cce5afb405fa2511e3">elektraGetRawString</a> (elektra, keyname);</div>
<div class="line">  <span class="keywordflow">return</span> rawValue == NULL ? NULL : stringToBigNum (rawValue);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> elektraSetBigNum (Elektra * elektra, <span class="keyword">const</span> <span class="keywordtype">char</span> * keyname, bignum * value, ElektraError ** error)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * rawValue = bigNumToString (value);</div>
<div class="line">  <a class="code" href="group__highlevel.html#ga67d2f8d48b040d79c3d4a665c4f6410f">elektraSetRawString</a> (elektra, keyname, rawValue, <span class="stringliteral">&quot;bignum&quot;</span>, error);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__highlevel_html_ga34afc074c83cf9ccd0a183573f8498a1"><div class="ttname"><a href="group__highlevel.html#ga34afc074c83cf9ccd0a183573f8498a1">elektraGetType</a></div><div class="ttdeci">KDBType elektraGetType(Elektra *elektra, const char *keyname)</div><div class="ttdoc">Reads the type metadata of a given key.</div><div class="ttdef"><b>Definition:</b> elektra_value.c:126</div></div>
<div class="ttc" id="agroup__highlevel_html_ga67d2f8d48b040d79c3d4a665c4f6410f"><div class="ttname"><a href="group__highlevel.html#ga67d2f8d48b040d79c3d4a665c4f6410f">elektraSetRawString</a></div><div class="ttdeci">void elektraSetRawString(Elektra *elektra, const char *name, const char *value, KDBType type, ElektraError **error)</div><div class="ttdoc">Set the raw string value of a key.</div><div class="ttdef"><b>Definition:</b> elektra_value.c:160</div></div>
<div class="ttc" id="agroup__highlevel_html_gae6c8eff14fb431cce5afb405fa2511e3"><div class="ttname"><a href="group__highlevel.html#gae6c8eff14fb431cce5afb405fa2511e3">elektraGetRawString</a></div><div class="ttdeci">const char * elektraGetRawString(Elektra *elektra, const char *name)</div><div class="ttdoc">Get the raw string value of a key.</div><div class="ttdef"><b>Definition:</b> elektra_value.c:144</div></div>
</div><!-- fragment --><p>To get the <code>type</code> plugin to validate your custom types you should make sure the <code>check/type</code> metadata is set to <code>string</code> (or <code>any</code>) on all keys that use custom types. This works, because the <code>type</code> plugin prefers the value of <code>check/type</code> over that of <code>type</code>.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Binary Values</h2>
<p>The high-level API does not support binary key values at this time.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Example</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="elektra_8h.html">elektra.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> ()</div>
<div class="line">{</div>
<div class="line">  ElektraError * error = NULL;</div>
<div class="line">  Elektra * elektra = <a class="code" href="group__highlevel.html#ga45de58b05c7a8ab02f6c54ddd31a56e1">elektraOpen</a> (<span class="stringliteral">&quot;/sw/org/myapp/#0/current&quot;</span>, NULL, NULL, &amp;error);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (elektra == NULL)</div>
<div class="line">  {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Sorry, there seems to be an error with your Elektra setup: %s\n&quot;</span>, <a class="code" href="group__highlevel.html#ga781cda83af3981a55321e7c613afbef0">elektraErrorDescription</a> (error));</div>
<div class="line">    <a class="code" href="group__highlevel.html#ga591f7ed4b57a341928bf7bb3d7adb693">elektraErrorReset</a> (&amp;error);</div>
<div class="line"> </div>
<div class="line">    printf (<span class="stringliteral">&quot;Will exit now...\n&quot;</span>);</div>
<div class="line">    exit (EXIT_FAILURE);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * message = <a class="code" href="group__highlevel.html#ga08df058ca39c5ac17c26924d301bb742">elektraGetString</a> (elektra, <span class="stringliteral">&quot;message&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  printf (<span class="stringliteral">&quot;%s&quot;</span>, message);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__highlevel.html#ga9b688b7250e5f9d8ea6701cc2cc269af">elektraClose</a> (elektra);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aelektra_8h_html"><div class="ttname"><a href="elektra_8h.html">elektra.h</a></div><div class="ttdoc">Elektra High Level API.</div></div>
<div class="ttc" id="atestio__doc_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdoc">[kdbio testsuite main]</div><div class="ttdef"><b>Definition:</b> testio_doc.c:48</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

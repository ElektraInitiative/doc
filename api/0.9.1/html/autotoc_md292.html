<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: ini</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: ini </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the ini plugin is in keys below</li>
<li>infos/author = Thomas Waser <a href="#" onclick="location.href='mai'+'lto:'+'tho'+'ma'+'s.w'+'as'+'er@'+'li'+'bel'+'ek'+'tra'+'.o'+'rg'; return false;">thoma<span style="display: none;">.nosp@m.</span>s.wa<span style="display: none;">.nosp@m.</span>ser@l<span style="display: none;">.nosp@m.</span>ibel<span style="display: none;">.nosp@m.</span>ektra<span style="display: none;">.nosp@m.</span>.org</a></li>
<li>infos/licence = BSD</li>
<li>infos/needs =</li>
<li>infos/provides = storage/ini</li>
<li>infos/recommends = binary</li>
<li>infos/placements = getstorage setstorage</li>
<li>infos/status = unittest shelltest nodep libc configurable</li>
<li>infos/metadata = order</li>
<li>infos/description = storage plugin for INI files</li>
</ul>
<p>This plugin allows Elektra's users to read and write INI files. INI files consist of simple key value pairs of the form <code>key=value</code>. Additionally keys can be categorized into different sections. Sections must be enclosed in "[]", for example "[section]". Each section is converted into a directory key (without value) and keys below the section are located below the section key. If the same section appears multiple times, the keys of all sections with the same name are merged together under the section key.</p>
<p>On the one hand the ini plugin is feature rich and customizable, on the other hand it is quite buggy and shows unexpected behavior in some of its features.</p>
<p>If you want to add an INI file to the global key database, simply use mount:</p>
<div class="fragment"><div class="line">sudo kdb mount file.ini user/tests/ini ini</div></div><!-- fragment --><p>Then you can modify the contents of the INI file using set:</p>
<div class="fragment"><div class="line">kdb set user/tests/ini/key value</div><div class="line">#&gt; Create a new key user/tests/ini/key with string &quot;value&quot;</div><div class="line">kdb set user/tests/ini/section</div><div class="line">#&gt; Create a new key user/tests/ini/section with null value</div><div class="line">kdb set user/tests/ini/section/key value</div><div class="line">#&gt; Create a new key user/tests/ini/section/key with string &quot;value&quot;</div></div><!-- fragment --><p>Find out which file you modified:</p>
<div class="fragment"><div class="line">kdb file user/tests/ini</div><div class="line"># STDOUT-REGEX: .+/file.ini</div><div class="line"></div><div class="line"># Undo modifications</div><div class="line">kdb rm -r user/tests/ini</div><div class="line">sudo kdb umount user/tests/ini</div></div><!-- fragment --><p>The ini plugin supports the use of comments. Comment lines start with a ';' or a '#'. Comments are put into the comment metadata of the key following the comment. This can be either a section key or a normal key. When creating new comments (e.g. via <code>kdb meta-set</code>) you can prefix your comment with the comment indicator of your choice (';' or '#') which will be used when writing the comment to the file. If the comment is not prefixed with a comment indicator, the ini plugin will use the character defined by the <code>comment</code> option, or default to '#'.</p>
<p>The ini plugin supports multiline values. Continuations of previous values have to start with whitespace characters.</p>
<p>For example consider the following INI file:</p>
<div class="fragment"><div class="line">key1=value1</div><div class="line">key2=value2</div><div class="line">        with continuation</div><div class="line">        lines</div></div><!-- fragment --><p>This would result in a KeySet containing two keys. One key named <code>key1</code> with the value <code>value1</code> and another key named <code>key2</code> with the value <code>value2\nwith continuation\nlines</code>.</p>
<p>By default this feature is enabled. The default continuation character is tab (<code>\t</code>). If you want to use another character, then please specify the configuration option <code>linecont</code>.</p>
<p>The ini plugin handles repeating keys by turning them into an elektra array when the <code>array</code> config is set.</p>
<p>For example an INI file looking like:</p>
<div class="fragment"><div class="line">[sec]</div><div class="line">a=1</div><div class="line">a=2</div><div class="line">a=3</div><div class="line">a=4</div></div><!-- fragment --><p>will be interpreted as</p>
<div class="fragment"><div class="line">/sec</div><div class="line">/sec/a</div><div class="line">/sec/a/#0</div><div class="line">/sec/a/#1</div><div class="line">/sec/a/#2</div><div class="line">/sec/a/#3</div></div><!-- fragment --><p>The following example shows how you can store and retrieve array values using the <code>ini</code> plugin.</p>
<div class="fragment"><div class="line"># Mount the INI plugin with array support</div><div class="line">sudo kdb mount config.ini user/tests/ini ini array=true</div><div class="line"></div><div class="line"># Add an array storing song titles</div><div class="line">kdb set user/tests/ini/songs/#0 &quot;Non-Zero Possibility&quot;</div><div class="line">kdb set user/tests/ini/songs/#1 &quot;Black Art Number One&quot;</div><div class="line">kdb set user/tests/ini/songs/#2 &quot;A Story Of Two Convicts&quot;</div><div class="line"></div><div class="line"># Check if INI saved all array entries</div><div class="line">kdb ls user/tests/ini/songs</div><div class="line">#&gt; user/tests/ini/songs</div><div class="line">#&gt; user/tests/ini/songs/#0</div><div class="line">#&gt; user/tests/ini/songs/#1</div><div class="line">#&gt; user/tests/ini/songs/#2</div><div class="line"></div><div class="line"># Retrieve an array item</div><div class="line">kdb get user/tests/ini/songs/#2</div><div class="line">#&gt; A Story Of Two Convicts</div><div class="line"></div><div class="line"># Check the file written by the INI plugin</div><div class="line">kdb file user/tests/ini | xargs cat</div><div class="line">#&gt; songs=Non-Zero Possibility</div><div class="line">#&gt; songs=Black Art Number One</div><div class="line">#&gt; songs=A Story Of Two Convicts</div><div class="line"></div><div class="line"># Undo modifications</div><div class="line">kdb rm -r user/tests/ini</div><div class="line">sudo kdb umount user/tests/ini</div></div><!-- fragment --><p>By default the INI plugin does not support binary data. You can use the <a class="el" href="autotoc_md52.html#src_plugins_base64_README_md">Base64 plugin</a> to remove this limitation.</p>
<p>``` </p>
<h1><a class="anchor" id="autotoc_md298"></a>
Mount INI and recommended plugin Base64</h1>
<h1><a class="anchor" id="autotoc_md299"></a>
We add the required plugin &lt;tt&gt;base64&lt;/tt&gt; (which provides &lt;tt&gt;binary&lt;/tt&gt;) at the end too,</h1>
<h1><a class="anchor" id="autotoc_md300"></a>
since otherwise this command leaks memory.</h1>
<p>sudo kdb mount &ndash;with-recommends config.ini user/tests/ini ini base64</p>
<h1><a class="anchor" id="autotoc_md301"></a>
Add empty binary value</h1>
<p>printf 'nothing="@BASE64"<br />
' &gt; <code>kdb file user/tests/ini</code> </p>
<h1><a class="anchor" id="autotoc_md302"></a>
Copy binary data</h1>
<p>kdb cp system/elektra/modules/ini/exports/get user/tests/ini/binary </p>
<h1><a class="anchor" id="autotoc_md303"></a>
Add textual data</h1>
<p>kdb set user/tests/ini/text 'Na na na na na na na na na na na na na na na na Batman!'</p>
<h1><a class="anchor" id="autotoc_md304"></a>
Print empty binary value</h1>
<p>kdb get user/tests/ini/nothing #&gt;</p>
<h1><a class="anchor" id="autotoc_md305"></a>
Print binary data</h1>
<p>kdb get user/tests/ini/binary </p>
<h1><a class="anchor" id="autotoc_md306"></a>
STDOUT-REGEX: ^(\x[0-9a-f]{1,2})+$</h1>
<h1><a class="anchor" id="autotoc_md307"></a>
Print textual data</h1>
<p>kdb get user/tests/ini/text #&gt; Na na na na na na na na na na na na na na na na Batman!</p>
<p>kdb rm -r user/tests/ini sudo kdb umount user/tests/ini </p><div class="fragment"><div class="line">## Metadata</div><div class="line"></div><div class="line">The INI plugin also supports to store arbitrary metadata in comments after the `@META` declarative.</div></div><!-- fragment --><p> sudo kdb mount config.ini user/tests/ini ini</p>
<h1><a class="anchor" id="autotoc_md308"></a>
Add a new key and some metadata</h1>
<p>kdb set user/tests/ini/brand new kdb meta-set user/tests/ini/brand description "The Devil And God Are Raging Inside Me" kdb meta-set user/tests/ini/brand rationale "Because I Love It"</p>
<h1><a class="anchor" id="autotoc_md309"></a>
The plugin stores metadata as comments inside the INI file</h1>
<p>kdb file user/tests/ini | xargs cat #&gt; #@META description = The Devil And God Are Raging Inside Me #&gt; #@META rationale = Because I Love It #&gt; brand=new</p>
<h1><a class="anchor" id="autotoc_md310"></a>
Retrieve metadata</h1>
<p>kdb meta-ls user/tests/ini/brand | grep -v 'internal' </p>
<h1><a class="anchor" id="autotoc_md311"></a>
rationale</h1>
<h1><a class="anchor" id="autotoc_md312"></a>
description</h1>
<p>kdb meta-get user/tests/ini/brand description #&gt; The Devil And God Are Raging Inside Me kdb meta-get user/tests/ini/brand rationale #&gt; Because I Love It</p>
<h1><a class="anchor" id="autotoc_md313"></a>
The plugin ignores some metadata such as &lt;tt&gt;comment&lt;/tt&gt;!</h1>
<p>kdb meta-set user/tests/ini/brand comment "Where Art Thou?" kdb meta-get user/tests/ini/brand comment </p>
<h1><a class="anchor" id="autotoc_md314"></a>
STDERR: Metakey not found</h1>
<h1><a class="anchor" id="autotoc_md315"></a>
RET: 2</h1>
<p>kdb rm -r user/tests/ini sudo kdb umount user/tests/ini ```</p>
<h2><a class="anchor" id="autotoc_md316"></a>
Sections</h2>
<p>The ini plugin supports 3 different sectioning modes (via <code>section=</code>):</p>
<ul>
<li><code>NONE</code> sections wont be printed as <code>[Section]</code> but as part of the key name <code>section/key</code></li>
<li><code>NULL</code> only empty keys will be printed as <code>[Section]</code></li>
<li><code>ALWAYS</code> sections will be created automatically. This is the default setting:</li>
</ul>
<div class="fragment"><div class="line">sudo kdb mount /empty.ini dir/tests ini</div><div class="line">kdb set dir/tests/a/b ab</div><div class="line">kdb get dir/tests/a       # &lt;-- key is suddenly here</div><div class="line">cat empty.ini</div><div class="line">#&gt; [a]</div><div class="line">#&gt; b=ab</div><div class="line"></div><div class="line"># Undo modifications</div><div class="line">kdb rm -r dir/tests</div><div class="line">sudo kdb umount dir/tests</div></div><!-- fragment --><p>By changing the option <code>section</code> you can suppress the automatic creation of keys. E.g., if you use <code>NULL</code> instead you only get a section if you explicitly create it:</p>
<div class="fragment"><div class="line">sudo kdb mount /empty.ini dir/tests ini section=NULL</div><div class="line">kdb set dir/tests/a/b ab</div><div class="line">kdb get dir/tests/a       # no key here</div><div class="line"># RET: 11</div><div class="line">cat empty.ini</div><div class="line">#&gt; a/b=ab</div><div class="line">kdb rm dir/tests/a/b</div><div class="line">kdb set dir/tests/a    # create section first</div><div class="line">kdb set dir/tests/a/b ab</div><div class="line">cat empty.ini</div><div class="line">#&gt; [a]</div><div class="line">#&gt; b=ab</div><div class="line"></div><div class="line"># Undo modifications</div><div class="line">kdb rm -r dir/tests</div><div class="line">sudo kdb umount dir/tests</div></div><!-- fragment --><h3><a class="anchor" id="autotoc_md317"></a>
Merge Sections</h3>
<p>The ini plugin supports merging duplicated section entries when the <code>mergesections</code> config is set. The keys will be appended to the first occurrence of the section key.</p>
<h2><a class="anchor" id="autotoc_md318"></a>
Ordering</h2>
<p>The ini plugin preserves the order. Inserted subsections get appended to the corresponding parent section and new sections by name.</p>
<p>Example:</p>
<div class="fragment"><div class="line">sudo kdb mount test.ini /tests/ini ini</div><div class="line"></div><div class="line">cat &gt; `kdb file /tests/ini` &lt;&lt;EOF \</div><div class="line">[Section1]\</div><div class="line">key1=val1\</div><div class="line">[Section3]\</div><div class="line">key3=val3\</div><div class="line">EOF</div><div class="line"></div><div class="line">kdb file /tests/ini | xargs cat</div><div class="line">#&gt; [Section1]</div><div class="line">#&gt; key1=val1</div><div class="line">#&gt; [Section3]</div><div class="line">#&gt; key3=val3</div><div class="line"></div><div class="line">kdb set /tests/ini/Section1/Subsection1/subkey1 subval1</div><div class="line">kdb set /tests/ini/Section2/key2 val2</div><div class="line">kdb file /tests/ini | xargs cat</div><div class="line">#&gt; [Section1]</div><div class="line">#&gt; key1=val1</div><div class="line">#&gt; [Section1/Subsection1]</div><div class="line">#&gt; subkey1=subval1</div><div class="line">#&gt; [Section2]</div><div class="line">#&gt; key2=val2</div><div class="line">#&gt; [Section3]</div><div class="line">#&gt; key3=val3</div><div class="line"></div><div class="line"># Undo modifications</div><div class="line">kdb rm -r /tests/ini</div><div class="line">sudo kdb umount /tests/ini</div></div><!-- fragment --><p>The current implementation of the ordering sometimes breaks compatibility with the cache plugin <a href="https://github.com/ElektraInitiative/libelektra/issues/2592">(see ini bug)</a>.</p>
<h2><a class="anchor" id="autotoc_md319"></a>
Special Characters</h2>
<p>The INI plugin also supports values and keys containing delimiter characters (<code>=</code>) properly.</p>
<p>``` sudo kdb mount test.ini user/tests/ini ini</p>
<p>printf '[section1]<br />
' &gt; <code>kdb file user/tests/ini</code> printf 'hello=world<br />
' &gt;&gt; <code>kdb file user/tests/ini</code></p>
<p>kdb get user/tests/ini/section1/hello #&gt; world</p>
<p>kdb set user/tests/ini/section1/x=x 'a + b=b + a' kdb get user/tests/ini/section1/x=x #&gt; a + b=b + a</p>
<h1><a class="anchor" id="autotoc_md320"></a>
Undo modifications</h1>
<p>kdb rm -r user/tests/ini sudo kdb umount user/tests/ini ``` </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin Variants</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin Variants </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Issue</h2>
<p>Some plugins are generic in the sense that they cannot fully define their contract statically. (Note: if they can decide it statically, you should prefer <a class="el" href="doc_tutorials_compilation-variants_md.html">compilation variants</a>.) Instead their contract is based on their configuration. We will call every combination of plugins+configuration where we get a different contract <b>plugin variant</b>.</p>
<p>The current issue is that there is no way to enumerate possible plugin variants as needed to list all functionality of Elektra.</p>
<h2>Constraints</h2>
<ul>
<li>User Customizability:<ul>
<li>Users must be able to add new plugin variants</li>
<li>Users should be able to suppress plugin variants</li>
</ul>
</li>
<li>Modularity:<ul>
<li>The plugins themselves yield a list of plugin variants</li>
<li>The code defining variants is part of the plugin's code</li>
<li>To get a full list of all variants of all plugins, one simply has to iterate over all plugins and ask the plugins for possible variants.</li>
</ul>
</li>
<li>libtool should provide a convenience layer for easy access of all plugin variants. In this case there should also be a performance optimization, that plugins do not need to be reopened required multiple times.</li>
</ul>
<h2>Assumptions</h2>
<ul>
<li>The number of variants needs to be bounded: plugin variants need to be fully enumerable</li>
</ul>
<h2>Considered Alternatives</h2>
<p>A specification of the plugin's configuration and a tool that can enumerate all possible essential configurations. Issues here are:</p>
<ul>
<li>Plugins might need to self-reference (a validation plugin might have plugin variants, too)</li>
<li>Elektraâ€™s specification language was not complete nor consistent at point of writing</li>
<li>Does not fit with the <code>checkconf</code> (<a href="https://git.libelektra.org/issues/559">see here</a>) approach.</li>
</ul>
<h2>Decision</h2>
<ol type="1">
<li>Provide a function <code>int genconf (KeySet * ks, Key * errorKey)</code> where <code>ks</code> is filled with a list of all variants with the essential configuration (subkeys <code>config</code>) and the changed parts of the contract (subkeys <code>infos</code>).</li>
<li>Keys defined in <code>system/elektra/plugins/&lt;plugin&gt;/variants/&lt;variantname&gt;</code> have the same content, but take precedence. If a variant with the same name is defined, only <code>config</code> or <code>infos</code> from <code>genconf</code> are considered if they are not mentioned in <code>system/elektra/plugins/variants</code>.</li>
<li>If the bool key <code>override</code> (for a plugin or a variant) is true, it will be overwritten (content of <code>genconf</code> ignored, but instead a plugin or variant as given is created).</li>
<li>If the bool key <code>disable</code> (for a plugin or a variant) is true the plugin or a variant of the plugin will not be available.</li>
<li>Empty <code>config</code> and <code>infos</code> mean:<ul>
<li><code>config</code>: The "default variant" (without any parameter) should be also available (has useful functionality)</li>
<li><code>infos</code>: It is not possible to determine the changes of the contract, the user need to instantiate the plugin and enquiry the contract.</li>
</ul>
</li>
</ol>
<h3>Example</h3>
<p><code>genconf</code> for augeas yields: </p><div class="fragment"><div class="line">system/access</div><div class="line">system/access/config</div><div class="line">system/access/config/lens = Access.lns</div><div class="line">system/access/infos</div><div class="line">system/access/infos/provides = storage/access</div><div class="line">system/aliases</div><div class="line">system/aliases/config</div><div class="line">system/aliases/config/lens = Aliases.lns</div><div class="line">system/aliases/infos</div><div class="line">system/aliases/infos/provides = storage/aliases</div></div><!-- fragment --><p><code>genconf</code> for python might yield: </p><div class="fragment"><div class="line">user/configparser/config</div><div class="line">user/configparser/config/script = python_configparser.py</div></div><!-- fragment --><p>The user/admin specifies: </p><div class="fragment"><div class="line">system/elektra/plugins/jni/disable = 1</div><div class="line">system/elektra/plugins/augeas/variants/access</div><div class="line">system/elektra/plugins/augeas/variants/access/disable = 1</div><div class="line">system/elektra/plugins/augeas/variants/aliases</div><div class="line">system/elektra/plugins/augeas/variants/aliases/infos</div><div class="line">system/elektra/plugins/augeas/variants/aliases/infos/status = 10000</div><div class="line">system/elektra/plugins/python/variants/configparser</div><div class="line">system/elektra/plugins/python/variants/configparser/override = 1</div><div class="line">system/elektra/plugins/python/variants/configparser/config</div><div class="line">system/elektra/plugins/python/variants/configparser/config/script = mybetter_configparser.py</div></div><!-- fragment --><p>As result we get:</p>
<ol type="1">
<li><code>access</code> of plugin <code>augeas</code> is not available</li>
<li><code>aliases</code> of plugin <code>augeas</code> as defined from <code>genconf</code>, but with changes in contract (<code>infos/status</code>)</li>
<li><code>configparser</code> of plugin <code>python</code> is completely redefined (result from <code>genconf</code> will not be considered) but it will be considered as specified.</li>
<li>the plugin <code>jni</code> will not be available</li>
</ol>
<p>To have a space-separated simpleini one would use: </p><div class="fragment"><div class="line">system/elektra/plugins/simpleini/variants/spacesep</div><div class="line">system/elektra/plugins/simpleini/variants/spacesep/config</div><div class="line">system/elektra/plugins/simpleini/variants/spacesep/config/format = &quot;% %&quot;</div></div><!-- fragment --><h2>Argument</h2>
<ul>
<li>The <code>genconf</code> API was chosen to be consistent with <code>checkconf</code>. The pluginhandle might be missing for some scenarios. If it is needed, we should change both APIs for consistency reasons.</li>
<li>The very verbose (deeply nested) subkeys (and names instead of arrays) provide better customizability and extensibility.</li>
</ul>
<h2>Implications</h2>
<ul>
<li><code>genconf</code> needs to be implemented for the plugins:<ul>
<li>augeas</li>
<li>jni</li>
<li>lua</li>
<li>python</li>
<li>python2</li>
</ul>
</li>
<li><code>PluginDatabase</code> needs an extension to list all plugin variants</li>
<li><code>kdb list</code> should be able to list all variants, e.g. like: <code>augeas lens=Access.lns</code> so that a user can copy and paste this for the <code>kdb mount</code> command.</li>
</ul>
<h2>Current state</h2>
<p>Currently only overrides of plugin configuration (<code>config/...</code>) is possible, overrides of other plugin information (contract information) does not work yet.</p>
<p>It is also not possible to add additional information to a variant, only overrides work. E.g. </p><div class="fragment"><div class="line">system/elektra/plugins/augeas/variants/aliases</div><div class="line">system/elektra/plugins/augeas/variants/aliases/override = 1</div><div class="line">system/elektra/plugins/augeas/variants/aliases/config</div><div class="line">system/elektra/plugins/augeas/variants/aliases/config/lens = Aliases.lns</div><div class="line">system/elektra/plugins/augeas/variants/aliases/config/otherparam = 0</div></div><!-- fragment --><p> works, while </p><div class="fragment"><div class="line">system/elektra/plugins/augeas/variants/aliases</div><div class="line">system/elektra/plugins/augeas/variants/aliases/config</div><div class="line">system/elektra/plugins/augeas/variants/aliases/config/otherparam = 0</div></div><!-- fragment --><p> gets ignored.</p>
<h2>Related decisions</h2>
<ul>
<li><a class="el" href="doc_decisions_global_plugins_md.html">Global Plugins</a></li>
</ul>
<h2>Notes</h2>
<p>Discussions took place <a href="https://git.libelektra.org/issues/1006">here</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

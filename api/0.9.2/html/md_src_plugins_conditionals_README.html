<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: conditionals</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: conditionals </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the conditionals plugin is in keys below</li>
<li>infos/author = Thomas Waser <a href="#" onclick="location.href='mai'+'lto:'+'tho'+'ma'+'s.w'+'as'+'er@'+'li'+'bel'+'ek'+'tra'+'.o'+'rg'; return false;">thoma<span style="display: none;">.nosp@m.</span>s.wa<span style="display: none;">.nosp@m.</span>ser@l<span style="display: none;">.nosp@m.</span>ibel<span style="display: none;">.nosp@m.</span>ektra<span style="display: none;">.nosp@m.</span>.org</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides =</li>
<li>infos/needs =</li>
<li>infos/recommends =</li>
<li>infos/placements = postgetstorage presetstorage</li>
<li>infos/status = unittest nodep libc global preview</li>
<li>infos/metadata = check/condition assign/condition condition/validsuffix check/condition/any/# check/condition/all/# check/condition/none/# assign/condition/#</li>
<li>infos/description = ensures key values through conditions</li>
</ul>
<h1><a class="anchor" id="src_plugins_conditionals_README_md"></a>
Introduction</h1>
<p>This plugin uses if-then-else like conditions. It also works as global plugin.</p>
<h1><a class="anchor" id="autotoc_md87"></a>
Check Syntax</h1>
<p>Stored in the metakey <code>check/condition</code> to validate data is:</p>
<p><code>(IF-condition) ? (THEN-condition) : (ELSE-condition)</code> where the ELSE-condition is optional</p>
<p>Condition: <code>Key</code> <em>Operation</em> &lsquo;('String&rsquo; | '1234.56' | Key | '')`</p>
<p>Operations: <code>!=, ==, &lt;, &lt;=, =&gt;, &gt;, :=</code>, where:</p>
<ul>
<li><code>:=</code> is used to set a key value</li>
<li>others are for comparison as in C</li>
</ul>
<h2><a class="anchor" id="autotoc_md88"></a>
Testing if Key Exists</h2>
<p><code>(! a/key)</code> evaluates to true if the key <code>a/key</code> doesn't exist, to false if it exists.</p>
<h2><a class="anchor" id="autotoc_md89"></a>
Assign Syntax</h2>
<div class="fragment"><div class="line">(IF-condition) ? (&#39;ThenValue&#39;) : (&#39;ElseValue&#39;)</div>
</div><!-- fragment --><p>Depending on if the condition is met, either 'ThenValue' or 'ElseValue' will be assigned as key value if the metakey <code>assign/condition</code> is used.</p>
<h2><a class="anchor" id="autotoc_md90"></a>
Experimental: Nested Conditions</h2>
<p>Multiple conditions can be nested and combined using parentheses and <code>&amp;&amp;</code> (logical AND) or <code>||</code> (logical OR). Additional parentheses must be used to form valid conditions again. <code>(</code> <code>(condition 1) &amp;&amp; (condition 2)</code> <code>)</code></p>
<h2><a class="anchor" id="autotoc_md91"></a>
Valid Suffix</h2>
<p>The <code>condition/validsuffix</code> can be used to define a list of valid suffixes to numeric values. If two operants have the same valid suffix or one of them no suffix they will be treated by their numeric value ignoring their suffix. &lsquo;condition/validsuffix = 'm&rsquo;, 'cm', 'km'<code>would treat</code>2.3m<code>just as the numeric value</code>2.3` when comparing to another value having the same or no suffix.</p>
<h2><a class="anchor" id="autotoc_md92"></a>
Keynames</h2>
<p>Keynames are all either relative to to-be-tested key (starting with <code>./</code> or <code>../</code>), relative to the parentkey (starting with <code>@/</code>) or absolute (e.g. <code>system/key</code>).</p>
<h2><a class="anchor" id="autotoc_md93"></a>
Multiple Statements</h2>
<p>It's also possible to test multiple conditions using <code>check/condition/{any,all,none}</code> as a meta array. Where <code>any</code> means that at least one statement has to evaluate to true, <code>all</code> that all statements have to evaluate to true, and <code>none</code> that no statement is allowed to evaluate to false (default). For multiple assign statements use <code>assign/condition</code> as a meta array. The first <code>assign/condition/#</code> statement that evaluates to true will be assigned and the rest ignored.</p>
<h1><a class="anchor" id="autotoc_md94"></a>
Example</h1>
<div class="fragment"><div class="line">(this/key  != &#39;value&#39;) ? (then/key == some/other/key) : (or/key &lt;= &#39;125&#39;)</div>
</div><!-- fragment --><p>Meaning: IF <code>this/key</code> NOT EQUAL TO &lsquo;'value&rsquo;<code>THEN</code>then/key<code>MUST EQUAL</code>some/other/key<code>ELSE</code>or/key<code>MUST BE LESS THAN</code>125`</p>
<p>Another full example:</p>
<div class="fragment"><div class="line">#Backup-and-Restore:user/tests/conditionals</div>
<div class="line"> </div>
<div class="line">sudo kdb mount conditionals.dump user/tests/conditionals conditionals dump</div>
<div class="line"> </div>
<div class="line">kdb set user/tests/conditionals/fkey 3.0</div>
<div class="line">kdb set user/tests/conditionals/hkey hello</div>
<div class="line"> </div>
<div class="line"># will succeed</div>
<div class="line">kdb meta-set user/tests/conditionals/key check/condition &quot;(../hkey == &#39;hello&#39;) ? (../fkey == &#39;3.0&#39;)&quot;</div>
<div class="line"> </div>
<div class="line"># will fail</div>
<div class="line">kdb meta-set user/tests/conditionals/key check/condition &quot;(../hkey == &#39;hello&#39;) ? (../fkey == &#39;5.0&#39;)&quot;</div>
<div class="line"># RET:5</div>
<div class="line"># ERROR:C03200</div>
</div><!-- fragment --><p>Assignment example:</p>
<div class="fragment"><div class="line">kdb set user/tests/conditionals/hkey Hello</div>
<div class="line">kdb meta-set user/tests/conditionals/hkey assign/condition &quot;(./ == &#39;Hello&#39;) ? (&#39;World&#39;)&quot;</div>
<div class="line"># alternative syntax: &quot;(../hkey == &#39;Hello&#39;) ? (&#39;World&#39;)</div>
<div class="line"> </div>
<div class="line">kdb get user/tests/conditionals/hkey</div>
<div class="line">#&gt; World</div>
<div class="line"> </div>
<div class="line"># cleanup</div>
<div class="line">kdb rm -r user/tests/conditionals</div>
<div class="line">sudo kdb umount user/tests/conditionals</div>
</div><!-- fragment --><p>Global plugin example:</p>
<p>``` </p>
<h1><a class="anchor" id="autotoc_md95"></a>
Backup old list of global plugins</h1>
<p>kdb set user/tests/msr  kdb export system/elektra/globalplugins &gt; $(kdb get user/tests/msr)</p>
<p>sudo kdb mount main.ini /tests/conditionals ni sudo kdb mount sub.ini /tests/conditionals/sub ini</p>
<h1><a class="anchor" id="autotoc_md96"></a>
mount conditionals as global plugin</h1>
<p>sudo kdb global-mount conditionals || $(exit 0)</p>
<h1><a class="anchor" id="autotoc_md97"></a>
create testfiles</h1>
<p>echo 'key1=val1' &gt; <code>kdb file /tests/conditionals</code> echo '[key1]' &gt;&gt; <code>kdb file /tests/conditionals</code> echo "check/condition=(./ == 'val1') ? (../sub/key == 'true')" &gt;&gt; <code>kdb file /tests/conditionals</code></p>
<p>echo "key=false" &gt; <code>kdb file /tests/conditionals/sub</code></p>
<h1><a class="anchor" id="autotoc_md98"></a>
should fail and yield an error</h1>
<p>kdb export /tests/conditionals ini </p>
<h1><a class="anchor" id="autotoc_md99"></a>
ERROR:C03200</h1>
<h1><a class="anchor" id="autotoc_md100"></a>
Sorry, module conditionals issued the error C03200:</h1>
<h1><a class="anchor" id="autotoc_md101"></a>
Validation failed: Validation of Key key1: (./ == 'val1') ? (../sub/key == 'true') failed. ((../sub/key == 'true') failed)</h1>
<p>kdb set /tests/conditionals/sub/key true</p>
<h1><a class="anchor" id="autotoc_md102"></a>
should succeed</h1>
<p>kdb export /tests/conditionals ini #&gt; sub/key=true #&gt; #@META check/condition = (./ == 'val1') ? (../sub/key == 'true') #&gt; key1=val1</p>
<h1><a class="anchor" id="autotoc_md103"></a>
cleanup</h1>
<p>kdb rm -r /tests/conditionals sudo kdb umount /tests/conditionals/sub sudo kdb umount /tests/conditionals</p>
<p>sudo kdb global-umount conditionals</p>
<p>kdb rm -r system/elektra/globalplugins kdb import system/elektra/globalplugins &lt; $(kdb get user/tests/msr) rm $(kdb get user/tests/msr) kdb rm user/tests/msr ``` </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>

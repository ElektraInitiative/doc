<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: VISION</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.9.14</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">VISION </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_VISION"></a> The vision of Elektra is to have systems in which every configuration setting is easily accessible and specifiable.</p>
<p>We will use Samba and its configuration value <code>global/workgroup</code> as running example.</p>
<h1><a class="anchor" id="autotoc_md4612"></a>
Problem</h1>
<p>Currently, the administrator would first need to locate the configuration file, it could be <code>/etc/samba/smb.conf</code>, learn the <a href="https://www.samba.org/samba/docs/current/man-html/smb.conf.5.html">syntax</a> and then implement some configuration management code to add or replace the value. Furthermore, application developers need to implement the parser, design tools like <a href="https://www.samba.org/samba/docs/old/Samba3-HOWTO/SWAT.html">SWAT</a>, and document in detail how to configure their specific software. This is a huge effort on both sides.</p>
<h1><a class="anchor" id="autotoc_md4613"></a>
Configuration Management</h1>
<p>We envision, that instead a key-value interface allows us to change any configuration value as desired.</p>
<p>Either by either invoking <a class="el" href="doc_help_kdb_md.html">command-line tools</a>:</p>
<div class="fragment"><div class="line">kdb set system:/sw/samba/#0/current/global/workgroup MYGROUP</div>
</div><!-- fragment --><p>Also by importing an INI file with the information:</p>
<div class="fragment"><div class="line">kdb import system:/sw/samba/#0/current ini &lt;&lt; HERE</div>
<div class="line">[global]</div>
<div class="line">workgroup=MYGROUP</div>
<div class="line">HERE</div>
</div><!-- fragment --><p>Or using some compiled language like C (shown code uses the <a class="el" href="src_libs_highlevel_README_md.html">high-level API</a>, with neither code generation nor error handling):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="elektra_8h.html">elektra.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> ()</div>
<div class="line">{</div>
<div class="line">        ElektraError* error;</div>
<div class="line">        Elektra * elektra = <a class="code" href="group__highlevel.html#ga45de58b05c7a8ab02f6c54ddd31a56e1">elektraOpen</a> (<span class="stringliteral">&quot;system:/sw/samba/#0/current&quot;</span>, 0, &amp;error);</div>
<div class="line">        <a class="code" href="group__highlevel.html#ga563a695658e8e6f74183cca674edd1a7">elektraSetString</a> (elektra, <span class="stringliteral">&quot;global/workgroup&quot;</span>, <span class="stringliteral">&quot;MYGROUP&quot;</span>, &amp;error);</div>
<div class="line">        <a class="code" href="group__highlevel.html#ga9b688b7250e5f9d8ea6701cc2cc269af">elektraClose</a> (elektra);</div>
<div class="line">}</div>
<div class="ttc" id="aelektra_8h_html"><div class="ttname"><a href="elektra_8h.html">elektra.h</a></div><div class="ttdoc">Elektra High Level API.</div></div>
<div class="ttc" id="agroup__highlevel_html_ga45de58b05c7a8ab02f6c54ddd31a56e1"><div class="ttname"><a href="group__highlevel.html#ga45de58b05c7a8ab02f6c54ddd31a56e1">elektraOpen</a></div><div class="ttdeci">Elektra * elektraOpen(const char *application, KeySet *defaults, KeySet *contract, ElektraError **error)</div><div class="ttdoc">Initializes a new Elektra instance.</div><div class="ttdef"><b>Definition:</b> elektra.c:67</div></div>
<div class="ttc" id="agroup__highlevel_html_ga563a695658e8e6f74183cca674edd1a7"><div class="ttname"><a href="group__highlevel.html#ga563a695658e8e6f74183cca674edd1a7">elektraSetString</a></div><div class="ttdeci">void elektraSetString(Elektra *elektra, const char *keyname, const char *value, ElektraError **error)</div><div class="ttdoc">Sets a string value.</div><div class="ttdef"><b>Definition:</b> elektra_value.c:387</div></div>
<div class="ttc" id="agroup__highlevel_html_ga9b688b7250e5f9d8ea6701cc2cc269af"><div class="ttname"><a href="group__highlevel.html#ga9b688b7250e5f9d8ea6701cc2cc269af">elektraClose</a></div><div class="ttdeci">void elektraClose(Elektra *elektra)</div><div class="ttdoc">Releases all resources used by the given elektra instance.</div><div class="ttdef"><b>Definition:</b> elektra.c:484</div></div>
<div class="ttc" id="atestio__doc_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdoc">[kdbio testsuite main]</div><div class="ttdef"><b>Definition:</b> testio_doc.c:48</div></div>
</div><!-- fragment --><p>Or using some interpreted language like Python (shown code uses the <a class="el" href="doc_tutorials_python-kdb_md.html">Python binding of the low-level API</a>):</p>
<div class="fragment"><div class="line">import kdb</div>
<div class="line">k = kdb.KDB()</div>
<div class="line">ks = kdb.KeySet()</div>
<div class="line">s = &quot;system:/sw/samba/#0/current&quot;</div>
<div class="line">k.get (ks, s)</div>
<div class="line">ks.append(kdb.Key(s+&quot;/global/workgroup&quot;, kdb.KEY_VALUE, &quot;MYGROUP&quot;))</div>
<div class="line">k.set (ks, s)</div>
</div><!-- fragment --><p>Or if you already use configuration management tools, the vision is that a single statement within the configuration management tool suffices to change a configuration value.</p>
<p>Key-value access in <a href="https://puppet.libelektra.org">puppet-libelektra</a>:</p>
<div class="fragment"><div class="line">kdbkey {&#39;system:/sw/samba/#0/current/global/workgroup&#39;:</div>
<div class="line">        ensure =&gt; &#39;present&#39;,</div>
<div class="line">        value =&gt; &#39;MYGROUP&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Key-value access in Chef:</p>
<div class="fragment"><div class="line">kdbset &#39;system:/sw/samba/#0/current/global/workgroup&#39; do</div>
<div class="line">        value &#39;MYGROUP&#39;</div>
<div class="line">        action :create</div>
<div class="line">end</div>
</div><!-- fragment --><p>Key-value access in Ansible:</p>
<div class="fragment"><div class="line">- name: setup samba workgroup</div>
<div class="line">  connection: local</div>
<div class="line">  hosts: localhost</div>
<div class="line">  collections:</div>
<div class="line">    - elektra_initiative.libelektra</div>
<div class="line">  tasks:</div>
<div class="line">    - name: set workgroup</div>
<div class="line">      elektra:</div>
<div class="line">        mountpoint: system:/sw/samba/#0/current/global</div>
<div class="line">        keys:</div>
<div class="line">          workgroup:</div>
<div class="line">            value: MYGROUP</div>
</div><!-- fragment --><p>In all these examples, we have set <code>system:/sw/samba/#0/current/global/workgroup</code> to <code>MYGROUP</code>.</p>
<h1><a class="anchor" id="autotoc_md4614"></a>
Application Integration</h1>
<p>Different to other solutions, in Elektra <a class="el" href="doc_tutorials_application-integration_md.html">applications itself can be integrated</a>, too. In Samba we would simply replace the configuration file parser with code like (<a href="https://doc.libelektra.org/api/latest/html/group__key.html">low-level C code</a>, no error-handling and no cleanup):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kdb.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        KeySet * myConfig = <a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a> (0, <a class="code" href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a>);</div>
<div class="line">        Key * key = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;/sw/samba/#0/current&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">        KDB * handle = <a class="code" href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5">kdbOpen</a> (NULL, key);</div>
<div class="line">        <a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1">kdbGet</a> (handle, myConfig, key);</div>
<div class="line"> </div>
<div class="line">        Key * result = <a class="code" href="group__keyset.html#gad65d2cdcbb5381194a1688e169af8a83">ksLookupByName</a> (myConfig, <span class="stringliteral">&quot;/sw/samba/#0/current/global/workgroup&quot;</span>, 0);</div>
<div class="line">        printf (<span class="stringliteral">&quot;My workgroup is %s&quot;</span>, <a class="code" href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05">keyString</a> (result));</div>
<div class="line">}</div>
<div class="ttc" id="agroup__kdb_html_ga28e385fd9cb7ccfe0b2f1ed2f62453a1"><div class="ttname"><a href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1">kdbGet</a></div><div class="ttdeci">int kdbGet(KDB *handle, KeySet *ks, Key *parentKey)</div><div class="ttdoc">Retrieve Keys from the Key database in an atomic and universal way.</div><div class="ttdef"><b>Definition:</b> kdb.c:1697</div></div>
<div class="ttc" id="agroup__kdb_html_ga844e1299a84c3fbf1d3a905c5c893ba5"><div class="ttname"><a href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5">kdbOpen</a></div><div class="ttdeci">KDB * kdbOpen(const KeySet *contract, Key *errorKey)</div><div class="ttdoc">Opens the session with the Key database.</div><div class="ttdef"><b>Definition:</b> kdb.c:924</div></div>
<div class="ttc" id="agroup__key_html_gad23c65b44bf48d773759e1f9a4d43b89"><div class="ttname"><a href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a></div><div class="ttdeci">Key * keyNew(const char *name,...)</div><div class="ttdoc">A practical way to fully create a Key object in one step.</div><div class="ttdef"><b>Definition:</b> key.c:144</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a></div><div class="ttdeci">@ KEY_END</div><div class="ttdef"><b>Definition:</b> kdbenum.c:95</div></div>
<div class="ttc" id="agroup__keyset_html_ga671e1aaee3ae9dc13b4834a4ddbd2c3c"><div class="ttname"><a href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a></div><div class="ttdeci">KeySet * ksNew(size_t alloc,...)</div><div class="ttdoc">Allocate, initialize and return a new KeySet object.</div><div class="ttdef"><b>Definition:</b> keyset.c:282</div></div>
<div class="ttc" id="agroup__keyset_html_ga7a28fce3773b2c873c94ac80b8b4cd54"><div class="ttname"><a href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a></div><div class="ttdeci">#define KS_END</div><div class="ttdoc">End of a list of keys.</div><div class="ttdef"><b>Definition:</b> kdbenum.c:156</div></div>
<div class="ttc" id="agroup__keyset_html_gad65d2cdcbb5381194a1688e169af8a83"><div class="ttname"><a href="group__keyset.html#gad65d2cdcbb5381194a1688e169af8a83">ksLookupByName</a></div><div class="ttdeci">Key * ksLookupByName(KeySet *ks, const char *name, elektraLookupFlags options)</div><div class="ttdoc">Convenience method to look for a Key contained in ks with name name.</div><div class="ttdef"><b>Definition:</b> keyset.c:2781</div></div>
<div class="ttc" id="agroup__keyvalue_html_ga880936f2481d28e6e2acbe7486a21d05"><div class="ttname"><a href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05">keyString</a></div><div class="ttdeci">const char * keyString(const Key *key)</div><div class="ttdoc">Get a pointer to the c-string representing the value.</div><div class="ttdef"><b>Definition:</b> keyvalue.c:208</div></div>
</div><!-- fragment --><p>If any of the codes above were executed, the application will print <code>My workgroup is MYGROUP</code>.</p>
<p>Applications that were modified to directly use Elektra are called to be <code>elektrified</code>.</p>
<p>But the vision also includes legacy applications which do not directly use Elektra. Then distributions can mount configuration files, so that the configuration is visible within Elektra.</p>
<p>Elektra uses the same configuration to configure itself, so every way shown above can be used. To make mounting more simple, we introduced an extra tool:</p>
<div class="fragment"><div class="line">kdb mount /etc/samba/smb.conf system:/sw/samba/#0/current ini</div>
</div><!-- fragment --><p>Mounting can also be done via configuration management tools.</p>
<p>Mounting in puppet-libelektra:</p>
<div class="fragment"><div class="line">kdbmount {&#39;system:/sw/samba/#0/current&#39;:</div>
<div class="line">        ensure =&gt; &#39;present&#39;,</div>
<div class="line">        file =&gt; &#39;/etc/samba/smb.conf&#39;,</div>
<div class="line">        plugins =&gt; &#39;ini&#39;</div>
<div class="line">}</div>
<div class="line">kdbkey {&#39;system:/sw/samba/global/log level&#39;:</div>
<div class="line">        ensure =&gt; &#39;absent&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Mounting in Ansible:</p>
<div class="fragment"><div class="line">- name: setup samba workgroup</div>
<div class="line">  connection: local</div>
<div class="line">  hosts: localhost</div>
<div class="line">  tasks:</div>
<div class="line">    - name: set workgroup</div>
<div class="line">    elektra:</div>
<div class="line">      mountpoint: system:/sw/samba</div>
<div class="line">      file: /etc/samba/smb.conf</div>
<div class="line">      plugins: ini</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4615"></a>
Specifications</h1>
<p>Ideally, applications specify their settings. This way, we know which keys exist on a system and which values are expected for these keys. Then administrators do not need to guess.</p>
<p>Next to the documentation for humans, specifications also provide information for software. For example, the Web UI automatically gives input fields according to the type of the configuration setting. For example, a boolean configuration setting gets a checkbox.</p>
<p>Also the specifications are integrated within Elektra in the same way. Again, we can use any of the above ways to specify configuration.</p>
<p>Either by either invoking <a class="el" href="doc_help_kdb_md.html">command-line tools</a>:</p>
<div class="fragment"><div class="line">kdb set-meta /sw/samba/#0/current/global/workgroup type string</div>
<div class="line">kdb set-meta /sw/samba/#0/current/global/workgroup description &quot;This controls what workgroup your server will appear to be in when queried by clients. Note that this parameter also controls the Domain name used with the security = domain setting.&quot;</div>
</div><!-- fragment --><p>Key-value specifications in <a href="https://puppet.libelektra.org">puppet-libelektra</a>:</p>
<div class="fragment"><div class="line">kdbkey {&#39;system:/sw/samba/#0/current/global/workgroup&#39;:</div>
<div class="line">        ensure =&gt; &#39;present&#39;,</div>
<div class="line">        check =&gt; {</div>
<div class="line">                &#39;type&#39; =&gt; &#39;string&#39;,</div>
<div class="line">                &#39;default&#39; =&gt; &#39;WORKGROUP&#39;,</div>
<div class="line">                &#39;description&#39; =&gt; &#39;This controls what workgroup</div>
<div class="line">                        your server will appear to be in when</div>
<div class="line">                        queried by clients. Note that this</div>
<div class="line">                        parameter also controls the Domain</div>
<div class="line">                        name used with the security = domain</div>
<div class="line">                        setting.&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note, that the specification (in both examples above) actually lands up in <code>spec:/sw/samba/#0/current/global/workgroup</code>. The unique path to the configuration setting is <code>/sw/samba/#0/current/global/workgroup</code>, but the specification gets written to the <a class="el" href="doc_tutorials_namespaces_md.html">namespace</a> <code>spec</code>, while the system-configuration gets written to the namespace <code>system</code>.</p>
<h1><a class="anchor" id="autotoc_md4616"></a>
Conclusion</h1>
<p>Here we have shown how Elektra can be used to configure systems more easily. Both application developers and administrators can save time.</p>
<p>The main technique to achieve the vision is unique key names: Every configuration setting can be addressed by its unique key name.</p>
<p>With this unique key name, we get an identifier, which can be used at all places throughout the system.</p>
<ul>
<li>Continue reading <a class="el" href="doc_BIGPICTURE_md.html">big picture</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

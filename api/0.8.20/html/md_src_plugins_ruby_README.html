<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: ruby</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: ruby </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about RUBY plugin is in keys below</li>
<li>infos/author = Bernhard Denner <a href="#" onclick="location.href='mai'+'lto:'+'ber'+'nh'+'ard'+'.d'+'enn'+'er'+'@gm'+'ai'+'l.c'+'om'; return false;">bernh<span style="display: none;">.nosp@m.</span>ard.<span style="display: none;">.nosp@m.</span>denne<span style="display: none;">.nosp@m.</span>r@gm<span style="display: none;">.nosp@m.</span>ail.c<span style="display: none;">.nosp@m.</span>om</a></li>
<li>infos/licence = BSD</li>
<li>infos/needs =</li>
<li>infos/provides = storage</li>
<li>infos/placements = getstorage setstorage</li>
<li>infos/recommends =</li>
<li>infos/status = maintained reviewed tested nodep configurable preview memleak experimental</li>
<li>infos/description = Ruby plugin bridge, implement Elektra plugins with Ruby</li>
</ul>
<p>This plugin is an Elektra to Ruby bridge and makes is possible to implement Elektra plugins with Ruby.</p>
<h2>Configuration Options</h2>
<p>The plugin has the following configuration options:</p>
<ul>
<li><code>script</code>: path to the Ruby plugin to use (mandatory)</li>
</ul>
<h2>Usage</h2>
<p>Mount a configuration file using this plugin, which specifying the concrete Ruby Elektra plugin:</p>
<div class="fragment"><div class="line">kdb mount /.ssh/authorized_keys user/ssh/authorized_keys ruby script=&lt;path to elektra</div><div class="line">source&gt;/src/plugins/ruby/ruby/ssh_authorized_keys.rb</div><div class="line">kdb ls user/ssh/authorized_keys</div></div><!-- fragment --><h2>Implementing Ruby Plugins</h2>
<p>The following example illustrates how to implement a Elektra plugin with Ruby:</p>
<div class="fragment"><div class="line">require &#39;kdb&#39;</div><div class="line"></div><div class="line"># call the static function &#39;define&#39; to define a new Plugin. This</div><div class="line"># function expects one argument and a block, which implements the plugin</div><div class="line">Kdb::Plugin.define :somename do</div><div class="line"></div><div class="line">  # this is automatically defined</div><div class="line">  #@plugin_name = &quot;somename&quot;</div><div class="line"></div><div class="line"></div><div class="line">  # &#39;Open&#39; method, called during Elektra plugin initialization</div><div class="line">  # parameter:</div><div class="line">  #  - errorKey: Kdb::Key, add error information if required</div><div class="line">  # returns:</div><div class="line">  #  - nil or 0: no error</div><div class="line">  #  - -1      : error during initialization</div><div class="line">  def open(errorKey)</div><div class="line"></div><div class="line">    # generally it is save to simply throw an exception. This has the same</div><div class="line">    # semantic as returning -1</div><div class="line">  end</div><div class="line"></div><div class="line">  # the close method is currently not supported, since this will crash the </div><div class="line">  # Ruby-VM if this method should be called during the VM.finializaion !!!</div><div class="line">  #def close(errorKey)</div><div class="line">  #</div><div class="line">  #end</div><div class="line"></div><div class="line"></div><div class="line">  # &#39;check_conf&#39; method, called before this plugin is used for mounting to check</div><div class="line">  # if the supplied config is valid. Missing or invalid config settings can be</div><div class="line">  # &#39;corrected&#39; or added.</div><div class="line">  # Parameter:</div><div class="line">  #  - errorKey: Kdb::Key, to add error information</div><div class="line">  #  - config: Kdb::KeySet, holds all plugin configuration setting</div><div class="line">  # returns:</div><div class="line">  #  - nil or 1 : success and the plugin configuration was NOT changed</div><div class="line">  #  -        0 : the plugin configuration was changed and is now OK</div><div class="line">  #  -       -1 : the configuration is NOT OK</div><div class="line">  def check_conf(errorKey, config)</div><div class="line"></div><div class="line">  end</div><div class="line"></div><div class="line"></div><div class="line">  # &#39;get&#39; method, is called during a get cycle, to query all keys</div><div class="line">  #</div><div class="line">  # Parameter:</div><div class="line">  #  - returned : Kdb::KeySet, already holding keys to be manipulated or to be</div><div class="line">  #               filled by a storage plugin. All added keys have to have the same</div><div class="line">  #               key name prefix as given by parentKey.</div><div class="line">  #  - parentKey: Kdb::Key, defining the current Elektra path. The value of this key</div><div class="line">  #               holds the configuration file name to read from</div><div class="line">  # Returns:</div><div class="line">  #  - nil or 1 : on success</div><div class="line">  #  -        0 : OK but nothing was to do</div><div class="line">  #  -       -1 : failure</div><div class="line">  def get(returned, parentKey)</div><div class="line"></div><div class="line">  end</div><div class="line"></div><div class="line"></div><div class="line">  # &#39;set&#39; method, is called when writing a configuration file</div><div class="line">  #</div><div class="line">  # Parameter:</div><div class="line">  #  - returned : Kdb::KeySet, holding all keys which should be written to the</div><div class="line">  #               config file.</div><div class="line">  #  - parentKey: Kdb::Key, defining the current Elektra path. The value of this key</div><div class="line">  #               holds the configuration file name to write to</div><div class="line">  # Returns:</div><div class="line">  #  - nil or 1 : on success</div><div class="line">  #           0 : on success with no changed keys in database</div><div class="line">  #          -1 : failure</div><div class="line">  def set(returned, parentKey)</div><div class="line"></div><div class="line">  end</div><div class="line"></div><div class="line"></div><div class="line">  # &#39;error&#39; method, is called when some plugin had a problem during a write cycle</div><div class="line">  #</div><div class="line">  # Parameter:</div><div class="line">  #  - returned : Kdb::KeySet, holding all keys which should be written to the</div><div class="line">  #               config file.</div><div class="line">  #  - parentKey: Kdb::Key, defining the current Elektra path. The value of this key</div><div class="line">  #               holds the configuration file name to write to</div><div class="line">  # Returns:</div><div class="line">  #  - nil or 1 : on success</div><div class="line">  #           0 : on success with no action</div><div class="line">  #          -1 : failure</div><div class="line">  def set(returned, parentKey)</div><div class="line"></div><div class="line">  end</div><div class="line"></div><div class="line">end</div></div><!-- fragment --><h2>Known Issues</h2>
<ul>
<li>The plugin might cause a SIGSEGV crash on application shutdown. This is a result of missing RubyVM de initialization, which is silently ignored as we can't determine if the Ruby VM is still needed or not (libelektra might be used by an Ruby application).</li>
<li>The plugin does not work correctly with Ruby version managers like <code>rbenv</code> or <code>rvm</code> and is intended to be used with the Ruby ecosystem installed in system context.</li>
<li>Automated test cases are missing </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

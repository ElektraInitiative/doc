<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: augeas</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.26</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: augeas </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about augeas plugin is in keys below</li>
<li>infos/author = Felix Berlakovich <a href="#" onclick="location.href='mai'+'lto:'+'ele'+'kt'+'ra@'+'be'+'rla'+'ko'+'vic'+'h.'+'net'; return false;">elekt<span style="display: none;">.nosp@m.</span>ra@b<span style="display: none;">.nosp@m.</span>erlak<span style="display: none;">.nosp@m.</span>ovic<span style="display: none;">.nosp@m.</span>h.net</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = storage</li>
<li>infos/needs =</li>
<li>infos/recommends = glob keytometa</li>
<li>infos/placements = getstorage setstorage</li>
<li>infos/status = maintained unittest libc configurable</li>
<li>infos/metadata = order</li>
<li>infos/description = reading and writing configurations via libaugeas</li>
</ul>
<p>This is a plugin for reading and writing configuration files with help from Augeas. The plugin should be able to read all configuration files for which an Augeas lens exists. However, not all stock lenses of Augeas have been tested yet. A detailed description of the lens language and a tutorial on how to write new lenses can be found at <a href="http://augeas.net/">http://augeas.net/</a></p>
<h2>Dependencies</h2>
<ul>
<li><code>libaugeas-dev</code>: You need version 0.16 or higher</li>
</ul>
<h2>Installation</h2>
<p>If you have installed Augeas manually, it may be necessary to update the ld configuration. This is especially true if an older version of Augeas is installed also. Such a situation may lead to an error similar to this: </p><pre class="fragment">/usr/lib/libaugeas.so.0: version `AUGEAS_0.16.0` not found (required by kdb)
</pre><p>This is because <code>ld</code> tries to link <code>/usr/lib/libaugeas.so.0</code> which is an older version of Augeas. Simply add the path to the newer library to your ld search paths (consult your system documentation on how to do this).</p>
<h2>Mounting and Configuration</h2>
<p>In order to mount the hosts file with the augeas plugin, issue the following command: </p><pre class="fragment">kdb mount /etc/hosts system/hosts augeas lens=Hosts.lns
</pre><p>The value of the plugin configuration option "lens" should be the module name of the lens (Hosts in the example) with a '.lns' suffix. Depending on your distribution and kind of installation, lenses can be found at <code>/usr/share/augeas/lenses/dist</code>, <code>/usr/local/share/augeas/lenses/dist</code>, or something similar. The lens module name is equal to the filename without extension in pascal notation. For example, the lens <code>/usr/share/augeas/lenses/dist/hosts.aug</code> contains the module Hosts.</p>
<p>Note that, without configuring the plugin to use a lens, the plugin will print an error message on the first usage: </p><pre class="fragment">kdb ls system/hosts
The command ls terminated unsuccessfully with the info: Error (#85) occurred!
Description: an Augeas error occurred
Ingroup: plugin
Module: storage
At: /path/augeas.c:166
Reason: Lens not found
</pre><p>This happens because the plugin does not know which lens it should use to read and write the configuration. For that reason, the lens configuration option was supplied together with the mount command.</p>
<h2>Restrictions</h2>
<h3>Inner node values</h3>
<p>Currently no Augeas lens supports values for inner nodes. Unfortunately no validation plugin exists yet that would prevent such modifications early: </p><pre class="fragment">kdb set system/hosts/1 somevalue
The command set terminated unsuccessfully with the info: Error (#85) occurred!
Description: an Augeas error occurred
Ingroup: plugin
Module: storage
At: /path/augeas.c:166
Reason: Malformed child node '1'
</pre><p>The operation simply fails with an undescriptive error.</p>
<h3>Leaky abstraction of order</h3>
<p>Most Augeas lenses require subtrees to be in a specific order. For example the hosts lens requires the ipaddr node of an entry to precede the canonical node. Unfortunately the Augeas storage plugin has no knowledge about this required order. Therefore the correct order must be ensured via order metakeys. Otherwise saving the KeySet may fail. As an example consider the following kdb shell script: </p><pre class="fragment">kdbGet system/hosts
keySetName system/hosts/6
ksAppendKey
keySetName system/hosts/6/ipaddr
keySetString 14.14.14.14
ksAppendKey
keySetName system/hosts/6/canonical
keySetString newhost
ksAppendKey
kdbSet system/hosts
</pre><p>This fails with an error similar to this </p><pre class="fragment">Description: an Augeas error occurred
Ingroup: plugin
Module: storage
At: /path/augeas.c:179
Reason: Failed to match
some augeas match expression
with tree
{ \"canonical\" = \"newhost\" } { \"ipaddr\" = \"14.14.14.14\" }
</pre><p>Whereas the following script succeeds due to the correct order </p><pre class="fragment">kdbGet system/hosts
keySetName system/hosts/6
ksAppendKey
keySetName system/hosts/6/ipaddr
keySetString 14.14.14.14
keySetMeta order 100
ksAppendKey
keySetName system/hosts/6/canonical
keySetString newhost
keySetMeta order 110
ksAppendKey
kdbSet system/hosts
</pre><h2>Planned Improvements</h2>
<ul>
<li>a validation plugin preventing inner node values </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: augeas</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.9</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: augeas </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about augeas plugin is in keys below</li>
<li>infos/author = Felix Berlakovich <a href="#" onclick="location.href='mai'+'lto:'+'ele'+'kt'+'ra@'+'be'+'rla'+'ko'+'vic'+'h.'+'net'; return false;">elekt<span style="display: none;">.nosp@m.</span>ra@b<span style="display: none;">.nosp@m.</span>erlak<span style="display: none;">.nosp@m.</span>ovic<span style="display: none;">.nosp@m.</span>h.net</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = storage</li>
<li>infos/needs =</li>
<li>infos/recommends = glob keytometa</li>
<li>infos/placements = getstorage setstorage</li>
<li>infos/status = maintained unittest libc configurable</li>
<li>infos/metadata = order</li>
<li>infos/description = reading and writing configurations via libaugeas</li>
</ul>
<h1><a class="anchor" id="src_plugins_augeas_README_md"></a>
Introduction</h1>
<p>This is a plugin for reading and writing configuration files with help from Augeas. The plugin should be able to read all configuration files for which an Augeas lens exists. However, not all stock lenses of Augeas have been tested yet. A detailed description of the lens language and a tutorial on how to write new lenses can be found at <a href="http://augeas.net/">http://augeas.net/</a></p>
<h1><a class="anchor" id="autotoc_md44"></a>
Dependencies</h1>
<ul>
<li><code>libaugeas-dev</code>: You need version 0.16 or higher</li>
</ul>
<h1><a class="anchor" id="autotoc_md45"></a>
Installation</h1>
<p>See <a class="el" href="doc_INSTALL_md.html">installation</a>. The package is called <code>libelektra5-augeas</code>.</p>
<p>If you have installed Augeas manually, it may be necessary to update the ld configuration. This is especially true if an older version of Augeas is installed also. Such a situation may lead to an error similar to this:</p>
<div class="fragment"><div class="line">/usr/lib/libaugeas.so.0: version `AUGEAS_0.16.0` not found (required by kdb)</div>
</div><!-- fragment --><p>This is because <code>ld</code> tries to link <code>/usr/lib/libaugeas.so.0</code> which is an older version of Augeas. Simply add the path to the newer library to your ld search paths (consult your system documentation on how to do this).</p>
<h1><a class="anchor" id="autotoc_md46"></a>
Mounting and Configuration</h1>
<p>In order to mount the hosts file with the augeas plugin, issue the following command:</p>
<div class="fragment"><div class="line">sudo kdb mount /etc/hosts system:/tests/hosts augeas lens=Hosts.lns</div>
</div><!-- fragment --><p>And to unmount the file run:</p>
<div class="fragment"><div class="line">sudo kdb umount system:/tests/hosts</div>
</div><!-- fragment --><p>The value of the plugin configuration option "lens" should be the module name of the lens (Hosts in the example) with a '.lns' suffix. Depending on your distribution and kind of installation, lenses can be found at <code>/usr/share/augeas/lenses/dist</code>, <code>/usr/local/share/augeas/lenses/dist</code>, or something similar. The lens module name is equal to the filename without extension in pascal notation. For example, the lens <code>/usr/share/augeas/lenses/dist/hosts.aug</code> contains the module Hosts.</p>
<p>Note that, without configuring the plugin to use a lens, the plugin will print an error message on the first usage:</p>
<div class="fragment"><div class="line">sudo kdb mount /etc/hosts system:/tests/hosts augeas #The lens is missing here!</div>
<div class="line">kdb ls system:/tests/hosts</div>
<div class="line"># RET: 5</div>
<div class="line"># ERROR: *C01200*</div>
</div><!-- fragment --><p>This happens because the plugin does not know which lens it should use to read and write the configuration. For that reason, the lens configuration option was supplied together with the mount command.</p>
<p>And again to unmount the <code>hosts</code> file simply run:</p>
<div class="fragment"><div class="line">sudo kdb umount system:/tests/hosts</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md47"></a>
Restrictions</h1>
<h2><a class="anchor" id="autotoc_md48"></a>
Inner Node Values</h2>
<p>Currently no Augeas lens supports values for inner nodes. Unfortunately no validation plugin exists yet that would prevent such modifications early:</p>
<div class="fragment"><div class="line">sudo kdb mount /etc/hosts system:/tests/hosts augeas lens=Hosts.lns</div>
<div class="line">kdb set system:/tests/hosts/1 somevalue</div>
<div class="line"># RET: 5</div>
<div class="line"># ERROR: *C01100*</div>
</div><!-- fragment --><p>The operation simply fails with an undescriptive error.</p>
<p>Finally, to unmount the <code>hosts</code> file simply run:</p>
<div class="fragment"><div class="line">sudo kdb umount system:/tests/hosts</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md49"></a>
Leaky Abstraction of Order</h2>
<p>Most Augeas lenses require subtrees to be in a specific order. For example the hosts lens requires the ipaddr node of an entry to precede the canonical node. Unfortunately the Augeas storage plugin has no knowledge about this required order. Therefore the correct order must be ensured via order metakeys. Otherwise saving the KeySet may fail. As an example consider the following kdb shell script:</p>
<div class="fragment"><div class="line">kdbGet system:/hosts</div>
<div class="line">keySetName system:/hosts/6</div>
<div class="line">ksAppendKey</div>
<div class="line">keySetName system:/hosts/6/ipaddr</div>
<div class="line">keySetString 14.14.14.14</div>
<div class="line">ksAppendKey</div>
<div class="line">keySetName system:/hosts/6/canonical</div>
<div class="line">keySetString newhost</div>
<div class="line">ksAppendKey</div>
<div class="line">kdbSet system:/hosts</div>
</div><!-- fragment --><p>This fails with an error similar to this</p>
<div class="fragment"><div class="line">Sorry, module storage issued the error C03100:</div>
<div class="line">an Augeas error occurred: Failed to match</div>
<div class="line">some augeas match expression</div>
<div class="line">with tree</div>
<div class="line">{ \&quot;canonical\&quot; = \&quot;newhost\&quot; } { \&quot;ipaddr\&quot; = \&quot;14.14.14.14\&quot; }</div>
</div><!-- fragment --><p>Whereas the following script succeeds due to the correct order</p>
<div class="fragment"><div class="line">kdbGet system:/hosts</div>
<div class="line">keySetName system:/hosts/6</div>
<div class="line">ksAppendKey</div>
<div class="line">keySetName system:/hosts/6/ipaddr</div>
<div class="line">keySetString 14.14.14.14</div>
<div class="line">keySetMeta order 100</div>
<div class="line">ksAppendKey</div>
<div class="line">keySetName system:/hosts/6/canonical</div>
<div class="line">keySetString newhost</div>
<div class="line">keySetMeta order 110</div>
<div class="line">ksAppendKey</div>
<div class="line">kdbSet system:/hosts</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md50"></a>
Planned Improvements</h1>
<ul>
<li>a validation plugin preventing inner node values </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

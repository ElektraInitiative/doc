<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Using Xfconf with Elektra</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Using Xfconf with Elektra </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_tutorials_xfconf"></a> Elektra provides the ability to work hand in hand with Xfconf. Depending on what you want, you can use Elektra in different ways.</p>
<h1><a class="anchor" id="autotoc_md4732"></a>
Altering Existing Xfconf Settings</h1>
<p>Elektra provides an Xfconf storage plugin that allows you to change all the configuration settings made by Xfconf.</p>
<p>To access the properties which are owned by Xfconf, the appropriate channel must be mounted. Some known channel names are</p>
<ul>
<li><b>Thunar</b>: thunar</li>
<li><b>Xfwm</b>: xfwm4</li>
<li><b>Xfce Panel</b>: xfce4-panel</li>
</ul>
<p>Assuming that the properties of Thunar anf Xfwm are to be changed, the following command can be used to mount the channels. If you are operating in a headless console session (e.g. docker), make sure that dbus is running. If it is not, <code>export $(dbus-launch)</code> can be used for that.</p>
<div class="fragment"><div class="line">touch none</div>
<div class="line">kdb mount -R noresolver none /sw/xfce4/thunar xfconf channel=thunar</div>
<div class="line">kdb mount -R noresolver none /sw/xfce4/xfwm4 xfconf channel=xfwm4</div>
</div><!-- fragment --><p><b>Warning</b>: The following operations will cause permanent changes to your system, please handle with care.</p>
<p>Thunar should now be ready to be configured by Elektra. The following commands can be used to configure some selected options of Xfce.</p>
<div class="fragment"><div class="line"># Use the details view instead of the grid view in Thunar</div>
<div class="line">kdb set system:/sw/xfce4/thunar/last-view ThunarDetailsView</div>
<div class="line">#&gt; Create a new key system:/sw/xfce4/thunar/last-view with string &quot;ThunarDetailsView&quot;</div>
<div class="line"> </div>
<div class="line"># Do not perform a recursive search on network directories</div>
<div class="line">kdb set system:/sw/xfce4/thunar/misc-recursive-search THUNAR_RECURSIVE_SEARCH_LOCAL</div>
<div class="line">#&gt; Create a new key system:/sw/xfce4/thunar/misc-recursive-search with string &quot;THUNAR_RECURSIVE_SEARCH_LOCAL&quot;</div>
<div class="line"> </div>
<div class="line"># Move the window buttons to the left</div>
<div class="line">kdb set system:/sw/xfce4/xfwm4/general/button_layout &quot;CM|O&quot;</div>
<div class="line">#&gt; Create a new key system:/sw/xfce4/xfwm4/general/button_layout with string &quot;CM|O&quot;</div>
</div><!-- fragment --><p>The result can then be verified using both Elektra and <code>xfconf-query</code>.</p>
<div class="fragment"><div class="line">kdb get /sw/xfce4/thunar/last-view</div>
<div class="line">#&gt; ThunarDetailsView</div>
<div class="line"> </div>
<div class="line">xfconf-query -c thunar -p /last-view</div>
<div class="line">#&gt; ThunarDetailsView</div>
<div class="line"> </div>
<div class="line">kdb get /sw/xfce4/thunar/misc-recursive-search</div>
<div class="line">#&gt; THUNAR_RECURSIVE_SEARCH_LOCAL</div>
<div class="line"> </div>
<div class="line">xfconf-query -c thunar -p /misc-recursive-search</div>
<div class="line">#&gt; THUNAR_RECURSIVE_SEARCH_LOCAL</div>
<div class="line"> </div>
<div class="line">kdb get /sw/xfce4/xfwm4/general/button_layout</div>
<div class="line">#&gt; CM|O</div>
<div class="line"> </div>
<div class="line">xfconf-query -c thunar -p /xfwm4/general/button_layout</div>
<div class="line">#&gt; CM|O</div>
</div><!-- fragment --><p>Using a text editor, you can also view the changes in the file <code>${XDG_CONFIG_HOME:-$HOME/.config}/xfce4/xfconf/xfce-perchannel-xml/thunar.xml</code>. However, this file may not be up-to-date since the Xfconf daemon has a caching mechanism.</p>
<p>When you are finished configuring the Xfce component, you should unmount the corresponding channel with the following command.</p>
<div class="fragment"><div class="line">kdb umount /sw/xfce4/thunar/</div>
<div class="line">kdb umount /sw/xfce4/xfwm4/</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4733"></a>
Replacing Xfconf with Elektra</h1>
<p>It is also possible to replace Xfconf entirely with Elektra. The Xfconf binding in Elektra implements the Xfconf API in such a way that it can be used as a drop-in replacement.</p>
<h2><a class="anchor" id="autotoc_md4734"></a>
Setup</h2>
<p>To start, the Xfconf library must be replaced with the Xfconf binding. Replacing the system libraries may require root privileges.</p>
<div class="fragment"><div class="line"># Use Elektra instead of Xfconf system-wide</div>
<div class="line">kdb xfconf-system-lib-replace</div>
<div class="line"> </div>
<div class="line"># Use Elektra instead of Xfconf only for the current user</div>
<div class="line">kdb xfconf-user-lib-replace &amp;&amp; source ~/.xprofile</div>
</div><!-- fragment --><p>Note that a system upgrade may reset the system library replacement.</p>
<p>All applications that normally use Xfconf will now use Elektra instead. This can be verified using both <code>xfconf-query</code> and <code>kdb</code>.</p>
<div class="fragment"><div class="line"># Set an Xfconf property with Elektra</div>
<div class="line">kdb set system:/sw/org/xfce/xfconf/test/hello world</div>
<div class="line">#&gt; Create a new key system:/sw/org/xfce/xfconf/test/hello with string &quot;world&quot;</div>
<div class="line"> </div>
<div class="line"># Verify it with Xfconf</div>
<div class="line">xfconf-query -c test -p /hello</div>
<div class="line">#&gt; world</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4735"></a>
Run Xfce Using Elektra</h2>
<p>The Xfce desktop provides some default settings which are loaded on first login. However, if you are using Elektra instead of Xfconf, you will need to load these defaults manually. This can be done entirely using <code>kdb</code>.</p>
<div class="fragment"><div class="line">kdb xfconf-populate</div>
</div><!-- fragment --><p>Once this is done, an Xfce session can be started either from the login manager or manually. From this point on, the Xfce desktop will read and write to the Elektra database. However, Xfce also uses some properties that are not stored in Xfconf. These properties will not work properly. An example of such a property is the Gtk theme.</p>
<h2><a class="anchor" id="autotoc_md4736"></a>
Reverting the Libraries</h2>
<p>If you want to stop using Elektra instead of Xfconf, you have to choose the right option depending on how you did the setup.</p>
<p>If you did the setup using the system libraries, it is sufficient to run it:</p>
<div class="fragment"><div class="line">kdb xfconf-system-lib-restore</div>
</div><!-- fragment --><p>If you have chosen the user only way, you will need to edit your <code>~/.xprofile</code> file and remove the statements where the <code>LD_*</code> variables contain anything related to Xfconf.</p>
<h1><a class="anchor" id="autotoc_md4737"></a>
Data-Types Used in Xfconf</h1>
<p>Xfconf uses the glib2 type system. This system is not fully compatible with Elektra. However, all values are stored in Elektra in their string representation when used as a drop-in replacement. In addition, the name of the glib2 type is stored in Elektra as a metakey. This makes Xfconf's type system completely independent of Elektra, at the cost of memory and computational resources.</p>
<p>The following table shows a comparison between the different type systems.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Xfconf   </th><th class="markdownTableHeadNone">Elektra   </th><th class="markdownTableHeadNone">Xfce Property Example (Channel, Property)   </th><th class="markdownTableHeadNone">Note    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>string</code>   </td><td class="markdownTableBodyNone"><code>char*</code>   </td><td class="markdownTableBodyNone"><code>xfce4-panel</code>, <code>/panels/panel-1/position</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>uchar</code>   </td><td class="markdownTableBodyNone"><code>kdb_octet_t</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Not implemented in the Xfconf binding.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>char</code>   </td><td class="markdownTableBodyNone"><code>kdb_char_t</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Not implemented in the Xfconf binding.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>uint16</code>   </td><td class="markdownTableBodyNone"><code>kdb_unsigned_short_t</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Not implemented in the Xfconf binding.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>int16</code>   </td><td class="markdownTableBodyNone"><code>kdb_short_t</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Not implemented in the Xfconf binding.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>uint</code>   </td><td class="markdownTableBodyNone"><code>kdb_unsigned_long_t</code>   </td><td class="markdownTableBodyNone"><code>xfce4-panel</code>, <code>/panels/panel-1/length</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>int</code>   </td><td class="markdownTableBodyNone"><code>kdb_long_t</code>   </td><td class="markdownTableBodyNone"><code>xfce4-session</code>, <code>/sessions/Count</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>uint64</code>   </td><td class="markdownTableBodyNone"><code>kdb_unsigned_long_long_t</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>int64</code>   </td><td class="markdownTableBodyNone"><code>kdb_long_long_t</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>float</code>   </td><td class="markdownTableBodyNone"><code>kdb_float_t</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>double</code>   </td><td class="markdownTableBodyNone"><code>kdb_double_t</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>bool</code>   </td><td class="markdownTableBodyNone"><code>kdb_boolean_t</code>   </td><td class="markdownTableBodyNone"><code>xfce4-panel</code>, <code>/panels/panel-1/position-locked</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>array</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><code>xfce4-panel</code>, <code>/panels</code>   </td><td class="markdownTableBodyNone">No direct type in Elektra. The key name structure determines whether it is an array or not.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>empty</code>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><code>xfce4-panel</code>, <code>/panels/panel-1</code>   </td><td class="markdownTableBodyNone">Does not exist in Elektra. Paths in Elektra which are no leaf nodes will be equally handled.   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

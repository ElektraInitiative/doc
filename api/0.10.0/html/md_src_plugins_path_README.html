<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: path</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.10.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: path </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about path plugin is in keys below</li>
<li>infos/author = Markus Raab <a href="#" onclick="location.href='mai'+'lto:'+'ele'+'kt'+'ra@'+'li'+'bel'+'ek'+'tra'+'.o'+'rg'; return false;">elekt<span style="display: none;">.nosp@m.</span>ra@l<span style="display: none;">.nosp@m.</span>ibele<span style="display: none;">.nosp@m.</span>ktra<span style="display: none;">.nosp@m.</span>.org</a></li>
<li>infos/licence = BSD</li>
<li>infos/placements = presetstorage</li>
<li>infos/needs =</li>
<li>infos/provides = check</li>
<li>infos/status = maintained nodep libc nodoc</li>
<li>infos/metadata = check/path check/path/mode check/path/user</li>
<li>infos/description = Checks if keys enriched with appropriate metadata contain valid paths as values as well as correct permissions</li>
</ul>
<h1><a class="anchor" id="src_plugins_path_README_md"></a>
Introduction</h1>
<p>This plugin checks whether the value of a key is a valid file system path and optionally if correct permissions are set for a certain user.</p>
<h1><a class="anchor" id="autotoc_md391"></a>
Installation</h1>
<p>See <a class="el" href="doc_INSTALL_md.html">installation</a>. The package is called <code>libelektra5-extra</code>.</p>
<h1><a class="anchor" id="autotoc_md392"></a>
Purpose</h1>
<p>The motivation to write this plugin is given by the two paths that exist in /etc/fstab: the device file and the mountpoint. A missing file is not necessarily an error, because the device file may appear later when a device is plugged in and the mountpoint may be there when another subsequent mount was executed. So only warnings are yielded in that case. One situation, however, presents an error: Only an absolute path is allowed to occur for both device and mountpoint. When checking for relative files, it is not enough to look at the first character if it is a <code>/</code>, because remote file systems and some special names are valid, too.</p>
<p>If <code>check/path/mode = &lt;permission&gt;</code> is also present it will check for the correct permissions of the file/directory. Optionally, you can also add <code>check/path/user = &lt;user&gt;"</code> which then checks the permissions for the given user. When calling <code>kdb set</code> on the actual key, you have to run as <code>root</code> user or the file permissions cannot be checked (you will receive an error message). It is also possible to leave the <code>check/path/user</code> empty (just provide an empty string) which then takes the executing user as target to check. So for example <code>sudo kdb set ...</code> will check if <code>root</code> can access the target file/directory whereas <code>kdb set ...</code> will take the current executing process/user. If <code>check/path/user</code> is not given at all, the plugin will check accessibility for the <code>root</code> user only (which again requires <code>sudo</code>)</p>
<p><code>check/path/mode = rw</code> and <code>check/path/user = tomcat</code> for example will check if the user <code>tomcat</code> has read and write access to the path which was set for the key. Please note that the file has to exist already and it is not checked if the user has the right to create a file in the directory.</p>
<p>Permissions available:</p>
<ul>
<li><code>r</code>: **R**ead</li>
<li><code>w</code>: **W**rite</li>
<li><code>x</code>: e**X**ecute</li>
</ul>
<h1><a class="anchor" id="autotoc_md393"></a>
Usage</h1>
<p>If the metakey <code>check/path</code> is present, it is checked if the value is a valid absolute file system path. If a metavalue is present, an additional check will be done if it is a directory or device file.</p>
<h1><a class="anchor" id="autotoc_md394"></a>
Examples</h1>
<p>An example on which the user should have no permission at all for the root directory.</p>
<div class="fragment"><div class="line">sudo kdb mount test.dump user:/tests path dump</div>
<div class="line">sudo kdb set user:/tests/path &quot;$HOME&quot;</div>
<div class="line">sudo kdb meta-set user:/tests/path check/path &quot;&quot;</div>
<div class="line">sudo kdb meta-set user:/tests/path check/path/user &quot;&quot;</div>
<div class="line">sudo kdb meta-set user:/tests/path check/path/mode &quot;rw&quot;</div>
<div class="line"> </div>
<div class="line"># Standard users should not be able to read/write the root folder</div>
<div class="line">[ $(id -u) = 0 ] &amp;&amp; printf &gt;&amp;2 &#39;User is root\n&#39; || kdb set user:/tests/path &quot;/root&quot;</div>
<div class="line"># STDERR: User is root|.*C03200.*</div>
<div class="line"> </div>
<div class="line"># Set something which the current user can access for sure</div>
<div class="line">kdb set user:/tests/path &quot;$HOME&quot;</div>
<div class="line"># STDOUT-REGEX: .*Set string to &quot;/.*&quot;.*</div>
<div class="line"> </div>
<div class="line">#cleanup</div>
<div class="line">sudo kdb rm -r user:/tests</div>
<div class="line">sudo kdb umount user:/tests</div>
</div><!-- fragment --><p>An example where part of the permissions are missing for a tmp file</p>
<div class="fragment"><div class="line">sudo kdb mount test.dump user:/tests path dump</div>
<div class="line">sudo kdb set user:/tests/path &quot;$HOME&quot;</div>
<div class="line">sudo kdb meta-set user:/tests/path check/path &quot;&quot;</div>
<div class="line">sudo kdb meta-set user:/tests/path check/path/user &quot;&quot;</div>
<div class="line">sudo kdb meta-set user:/tests/path check/path/mode &quot;rwx&quot;</div>
<div class="line"> </div>
<div class="line"># Standard users should not be able to read/write the root folder</div>
<div class="line">kdb set user:/tests/path/tempfile $(mktemp)</div>
<div class="line">chmod +rw `kdb get user:/tests/path/tempfile`</div>
<div class="line">kdb set user:/tests/path `kdb get user:/tests/path/tempfile`</div>
<div class="line"># ERROR:C03200</div>
<div class="line"> </div>
<div class="line"># Set something which the current user can access for sure</div>
<div class="line">chmod +x `kdb get user:/tests/path/tempfile`</div>
<div class="line">kdb set user:/tests/path `kdb get user:/tests/path/tempfile`</div>
<div class="line"># STDOUT-REGEX: Set string to &quot;/.*&quot;.*</div>
<div class="line"> </div>
<div class="line">#cleanup</div>
<div class="line">sudo rm -rf `kdb get user:/tests/path/tempfile`</div>
<div class="line">sudo kdb rm -r user:/tests</div>
<div class="line">sudo kdb umount user:/tests</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md395"></a>
Future work</h1>
<p>Add a check which ensures that the given path is a file/directory/symbolic link/hard link/etc. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

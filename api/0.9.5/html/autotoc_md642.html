<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: toml</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: toml </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the toml plugin is in keys below</li>
<li>infos/author = Jakob Fischer <a href="#" onclick="location.href='mai'+'lto:'+'jak'+'ob'+'fis'+'ch'+'er9'+'3@'+'gma'+'il'+'.co'+'m'; return false;">jakob<span style="display: none;">.nosp@m.</span>fisc<span style="display: none;">.nosp@m.</span>her93<span style="display: none;">.nosp@m.</span>@gma<span style="display: none;">.nosp@m.</span>il.co<span style="display: none;">.nosp@m.</span>m</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = storage/toml</li>
<li>infos/needs = base64</li>
<li>infos/recommends = type</li>
<li>infos/placements = getstorage setstorage</li>
<li>infos/status = experimental unfinished</li>
<li>infos/metadata = order comment/# comment/#/start comment/#/space type tomltype origvalue</li>
<li>infos/description = This storage plugin reads and writes TOML files using Flex and Bison.</li>
</ul>
<h1><a class="anchor" id="src_plugins_toml_README_md"></a>
Introduction</h1>
<p>This plugin is a storage plugin for reading and writing TOML files. The plugin retains most of the file structure of a read TOML file such as comments, empty lines and TOML tables. It supports all kinds of TOML specific types and tables, including nested inline tables and multiline strings.</p>
<h1><a class="anchor" id="autotoc_md643"></a>
Requirements</h1>
<p>The plugin needs Flex (&gt;=2.6.2) and Bison (&gt;=3) for parsing TOML files.</p>
<h1><a class="anchor" id="autotoc_md644"></a>
Types</h1>
<h2><a class="anchor" id="autotoc_md645"></a>
Reading</h2>
<p>On reading, the plugin will set the <code>type</code> metakey for strings, integers, floats and boolean values, if applicable. For decimal integers, the metakey is set to <code>long_long</code>. For binary/octal/hexadecimal integers, the metakey is set to <code>unsigned_long_long</code>. For floats, the metakey will be set to <code>double</code>. These types are chosen to conform with the TOML format as stated on the offical <a href="https://toml.io/en/v1.0.0-rc.1">TOML</a> page.</p>
<p>On reading, non-decimal integers will get converted to decimal. The non-decimal representation will be stored in the <code>origvalue</code> metakey of the key. When writing a key, the value of that metakey will be written instead, in order to retain the original format. Note that the <code>origvalue</code> metakey gets removed if the value of the key changes.</p>
<p>``` sudo kdb mount test.toml user:/tests/storage/types toml type</p>
<h1><a class="anchor" id="autotoc_md646"></a>
Create a TOML file with 4 keys</h1>
<p>echo 'plain_decimal = 1000' &gt;&gt; <code>kdb file user:/tests/storage/types</code> echo 'file_permissions = 0o777' &gt;&gt; <code>kdb file user:/tests/storage/types</code> echo 'pi = 3.1415' &gt;&gt; <code>kdb file user:/tests/storage/types</code> echo 'division_gone_wrong = -inf' &gt;&gt; <code>kdb file user:/tests/storage/types</code></p>
<h1><a class="anchor" id="autotoc_md647"></a>
Print the content of the toml file</h1>
<p>cat <code>kdb file user:/tests/storage/types</code> </p>
<h1><a class="anchor" id="autotoc_md648"></a>
&gt; plain_decimal = 1000</h1>
<h1><a class="anchor" id="autotoc_md649"></a>
&gt; file_permissions = 0o777</h1>
<h1><a class="anchor" id="autotoc_md650"></a>
&gt; pi = 3.1415</h1>
<h1><a class="anchor" id="autotoc_md651"></a>
&gt; division_gone_wrong = -inf</h1>
<h1><a class="anchor" id="autotoc_md652"></a>
Print types and values of the keys with `kdb`</h1>
<p>kdb meta-get 'user:/tests/storage/types/plain_decimal' 'type' </p>
<h1><a class="anchor" id="autotoc_md653"></a>
&gt; long_long</h1>
<p>kdb get 'user:/tests/storage/types/plain_decimal' </p>
<h1><a class="anchor" id="autotoc_md654"></a>
&gt; 1000</h1>
<p>kdb meta-get 'user:/tests/storage/types/file_permissions' 'type' </p>
<h1><a class="anchor" id="autotoc_md655"></a>
&gt; unsigned_long_long</h1>
<h1><a class="anchor" id="autotoc_md656"></a>
The octal value will be converted to decimal</h1>
<p>kdb get 'user:/tests/storage/types/file_permissions' </p>
<h1><a class="anchor" id="autotoc_md657"></a>
&gt; 511</h1>
<p>kdb meta-get 'user:/tests/storage/types/pi' 'type' </p>
<h1><a class="anchor" id="autotoc_md658"></a>
&gt; double</h1>
<p>kdb get 'user:/tests/storage/types/pi' </p>
<h1><a class="anchor" id="autotoc_md659"></a>
&gt; 3.1415</h1>
<p>kdb meta-get 'user:/tests/storage/types/division_gone_wrong' 'type' </p>
<h1><a class="anchor" id="autotoc_md660"></a>
&gt; double</h1>
<p>kdb get 'user:/tests/storage/types/division_gone_wrong' </p>
<h1><a class="anchor" id="autotoc_md661"></a>
&gt; -inf</h1>
<h1><a class="anchor" id="autotoc_md662"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage/types sudo kdb umount user:/tests/storage/types </p><div class="fragment"><div class="line">## Writing</div><div class="line"></div><div class="line">On writing, for most values, the plugin will infer the appropriate type and will write them accordingly.</div><div class="line">This means, values, that match a TOML float, integer or date will be written without any quotes around them.</div><div class="line">If a value does not match any of these types, it will be written as a string.</div><div class="line"></div><div class="line">The plugin uses an existing `type` metakey only to check if it should write a value as a `string` or a `boolean`.</div><div class="line"></div><div class="line">With this functionality, numbers can be written as a string to the file, if wanted.</div><div class="line"></div><div class="line">To write a boolean value, the `type` metakey must be set to `boolean` for the key.</div><div class="line">Otherwise, no conversion to the TOML boolean values will take place.</div><div class="line">Per default, Elektra uses 0/1 to represent boolean values.</div></div><!-- fragment --><p> sudo kdb mount test.toml user:/tests/storage/types toml type</p>
<h1><a class="anchor" id="autotoc_md663"></a>
Create a key, which may be a integer, boolean or string</h1>
<p>kdb set 'user:/tests/storage/types/value' '1'</p>
<h1><a class="anchor" id="autotoc_md664"></a>
The plugin infers `long_long` for this value</h1>
<p>kdb meta-get 'user:/tests/storage/types/value' 'type' </p>
<h1><a class="anchor" id="autotoc_md665"></a>
&gt; long_long</h1>
<h1><a class="anchor" id="autotoc_md666"></a>
The value is written as an integer</h1>
<p>cat <code>kdb file user:/tests/storage/types</code> </p>
<h1><a class="anchor" id="autotoc_md667"></a>
&gt; value = 1</h1>
<h1><a class="anchor" id="autotoc_md668"></a>
Manually set the `type` metakey to boolean</h1>
<p>kdb meta-set 'user:/tests/storage/types/value' 'type' 'boolean'</p>
<h1><a class="anchor" id="autotoc_md669"></a>
The value is written as a boolean</h1>
<p>cat <code>kdb file user:/tests/storage/types</code> </p>
<h1><a class="anchor" id="autotoc_md670"></a>
&gt; value = true</h1>
<h1><a class="anchor" id="autotoc_md671"></a>
Manually set the `type` metakey to string</h1>
<p>kdb meta-set 'user:/tests/storage/types/value' 'type' 'string'</p>
<h1><a class="anchor" id="autotoc_md672"></a>
The value is written as a string</h1>
<p>cat <code>kdb file user:/tests/storage/types</code> </p>
<h1><a class="anchor" id="autotoc_md673"></a>
&gt; value = "1"</h1>
<h1><a class="anchor" id="autotoc_md674"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage/types sudo kdb umount user:/tests/storage/types </p><div class="fragment"><div class="line"># Numbers</div><div class="line"></div><div class="line">The plugin supports reading and writing of any kind of number supported by the TOML format, such as floating point numbers and binary/octal/decimal/hexadecimal integers.</div><div class="line">To write a non-decimal integer, add the corresponding prefix to the number (`0b` for binary, `0o` for octal, `0x` for hexadecimal).</div><div class="line">The value will be written in the given base to the file, but converted to decimal within Elektra (see [Reading](##reading)).</div><div class="line">Note that the plugin doesn&#39;t warn about invalid prefix/digit combinations. If the combination is not valid, it will be written as a string instead.</div><div class="line"></div><div class="line">If the `type` plugin is enabled and you want to change the value of an existing number key which needs conversion (all keys which have a `origvalue`),</div><div class="line">you have to change the value of `origvalue` instead of the key value. Otherwise the `type` plugin will give an error.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md675"></a>
Mount a new TOML file</h1>
<p>sudo kdb mount test.toml user:/tests/storage/numbers toml type</p>
<h1><a class="anchor" id="autotoc_md676"></a>
Write an octal value</h1>
<p>kdb set 'user:/tests/storage/numbers/a' '0o777'</p>
<h1><a class="anchor" id="autotoc_md677"></a>
Get the converted decimal value</h1>
<p>kdb get 'user:/tests/storage/numbers/a' </p>
<h1><a class="anchor" id="autotoc_md678"></a>
&gt; 511</h1>
<h1><a class="anchor" id="autotoc_md679"></a>
Get the original octal value</h1>
<p>kdb meta-get 'user:/tests/storage/numbers/a' 'origvalue' </p>
<h1><a class="anchor" id="autotoc_md680"></a>
&gt; 0o777</h1>
<h1><a class="anchor" id="autotoc_md681"></a>
Get the type of the number; since it's originally octal, we get `unsigned_long_long`</h1>
<p>kdb meta-get 'user:/tests/storage/numbers/a' 'type' </p>
<h1><a class="anchor" id="autotoc_md682"></a>
&gt; unsigned_long_long</h1>
<h1><a class="anchor" id="autotoc_md683"></a>
Change the value by changing the `origvalue` metakey</h1>
<p>kdb meta-set 'user:/tests/storage/numbers/a' 'origvalue' '0o666'</p>
<h1><a class="anchor" id="autotoc_md684"></a>
Get the new value as decimal</h1>
<p>kdb get 'user:/tests/storage/numbers/a' </p>
<h1><a class="anchor" id="autotoc_md685"></a>
&gt; 438</h1>
<h1><a class="anchor" id="autotoc_md686"></a>
Change the value to an invalid octal value.</h1>
<p>kdb meta-set 'user:/tests/storage/numbers/a' 'origvalue' '0o888'</p>
<h1><a class="anchor" id="autotoc_md687"></a>
The key value is no longer considered a number</h1>
<p>kdb meta-get 'user:/tests/storage/numbers/a' 'type' </p>
<h1><a class="anchor" id="autotoc_md688"></a>
&gt; string</h1>
<h1><a class="anchor" id="autotoc_md689"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage/numbers sudo kdb umount user:/tests/storage/numbers </p><div class="fragment"><div class="line"># Strings</div><div class="line"></div><div class="line">The plugin can read any kind of TOML string: bare, basic, literal, basic multiline and literal multiline.</div><div class="line">However, it will write back all non-bare strings as basic strings or it&#39;s multiline version.</div><div class="line">Therefore, any string set with `kdb set` must be treated as a basic string and possible escape sequences and special meanings of quotation characters must be taken care of.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md690"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_strings.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md691"></a>
setting a string containing a newline escape sequence</h1>
<p>kdb set 'user:/tests/storage/string' 'I am a basic string a literal one.'</p>
<p>kdb get 'user:/tests/storage/string' </p>
<h1><a class="anchor" id="autotoc_md692"></a>
&gt; I am a basic string</h1>
<h1><a class="anchor" id="autotoc_md693"></a>
&gt; ot a literal one</h1>
<h1><a class="anchor" id="autotoc_md694"></a>
setting the string again, but escape the backslash with another backslash</h1>
<p>kdb set 'user:/tests/storage/string' 'I am a basic string\not a literal one.'</p>
<p>kdb get 'user:/tests/storage/string' </p>
<h1><a class="anchor" id="autotoc_md695"></a>
&gt; I am a basic string\not a literal one</h1>
<h1><a class="anchor" id="autotoc_md696"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage </p><div class="fragment"><div class="line">The plugin supports all kinds of escape sequences used by TOML in basic and basic multiline strings, like `\n`, `\r`, `\t` and</div><div class="line">even `\u`/`\U` for Unicode escape sequences. `\t` is interpreted to be 4 spaces.</div><div class="line"></div><div class="line"># Binary/NULL values</div><div class="line"></div><div class="line">The plugin handles binary values by using the [base64](@ref src_plugins_base64_README_md) plugin.</div><div class="line">As a result, binary values get written as base64 encoded strings, which start with the special prefix `@BASE64`.</div><div class="line">`NULL` key values are written as special strings of value `@NULL`.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md697"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_binary.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md698"></a>
Creating a key with a NULL value</h1>
<p>kdb set 'user:/tests/storage/nullkey' </p>
<h1><a class="anchor" id="autotoc_md699"></a>
&gt; Create a new key user:/test/nullkey with null value</h1>
<h1><a class="anchor" id="autotoc_md700"></a>
Print file content</h1>
<p>cat <code>kdb file user:/tests/storage</code> </p>
<h1><a class="anchor" id="autotoc_md701"></a>
&gt; nullkey = '@NULL'</h1>
<h1><a class="anchor" id="autotoc_md702"></a>
Write base64 encoded data to the file</h1>
<p>echo "base64 = '@BASE64SSBhbSBiYXNlIDY0IGVuY29kZWQgZm9yIG5vIHJlYXNvbi4='" &gt; <code>kdb file user:/test</code></p>
<h1><a class="anchor" id="autotoc_md703"></a>
Print the value of the key, which is a binary value</h1>
<p>kdb get 'user:/test/base64' #&gt; </p>
<h1><a class="anchor" id="autotoc_md704"></a>
Print the value again, but apply the escape codes</h1>
<p>echo -e <code>kdb get 'user:/test/base64'</code> #&gt; I am base 64 encoded for no reason.</p>
<h1><a class="anchor" id="autotoc_md705"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage </p><div class="fragment"><div class="line"># TOML specific structures</div><div class="line"></div><div class="line">TOML specific structures are represented by the metakey `tomltype` on a certain key.</div><div class="line">It will be set when the TOML plugin reads a TOML structure from a file. Additionally, this metakey can be set by the user, if they want a certain TOML structure to be written.</div><div class="line">No automatic inference of this metakey is done on writing.</div><div class="line"></div><div class="line">## Simple Tables</div><div class="line"></div><div class="line">TOML&#39;s simple tables are represented by setting the `tomltype` metakey to `simpletable`.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md706"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_table.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md707"></a>
Create three keys, which are all a subkey of 'common',</h1>
<h1><a class="anchor" id="autotoc_md708"></a>
but we have no 'common' simple table key yet</h1>
<p>kdb set 'user:/tests/storage/common/a' '0' kdb set 'user:/tests/storage/common/b' '1' kdb set 'user:/tests/storage/common/c' '2'</p>
<h1><a class="anchor" id="autotoc_md709"></a>
Print the content of the resulting TOML file</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; common.a = 0 #&gt; common.b = 1 #&gt; common.c = 2</p>
<h1><a class="anchor" id="autotoc_md710"></a>
Create a simple table key</h1>
<p>kdb meta-set 'user:/tests/storage/common' 'tomltype' 'simpletable'</p>
<h1><a class="anchor" id="autotoc_md711"></a>
Print the content of the resulting TOML file</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; [common] #&gt; a = 0 #&gt; b = 1 #&gt; c = 2</p>
<h1><a class="anchor" id="autotoc_md712"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage </p><div class="fragment"><div class="line">## Table Arrays</div><div class="line"></div><div class="line">Table arrays are represented by setting the `tomltype` metakey to `tablearray`. It is not required to also set the array metakey, since the plugin will set the metakey, if it is missing.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md713"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_table_array.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md714"></a>
Create a table array containing two entries, each with a key 'a' and 'b'</h1>
<p>kdb meta-set 'user:/tests/storage/tablearray' 'tomltype' 'tablearray' kdb set 'user:/tests/storage/tablearray/#0/a' '1' kdb set 'user:/tests/storage/tablearray/#0/b' '2'</p>
<p>kdb set 'user:/tests/storage/tablearray/#1/a' '3' kdb set 'user:/tests/storage/tablearray/#1/b' '4'</p>
<h1><a class="anchor" id="autotoc_md715"></a>
Print the highest index of the table array</h1>
<p>kdb meta-get 'user:/tests/storage/tablearray' 'array' #&gt; #1</p>
<h1><a class="anchor" id="autotoc_md716"></a>
Print the content of the resulting TOML file</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; [[tablearray]] #&gt; a = 1 #&gt; b = 2 #&gt; [[tablearray]] #&gt; a = 3 #&gt; b = 4</p>
<h1><a class="anchor" id="autotoc_md717"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage </p><div class="fragment"><div class="line">## Inline Tables</div><div class="line"></div><div class="line">Inline tables are represented by setting the `tomltype` metakey to `inlinetable`. The plugin also supports reading/writing nested inline tables.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md718"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_inline_table.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md719"></a>
Create a table array containing two entries, each with a key 'a' and 'b'</h1>
<p>kdb meta-set 'user:/tests/storage/inlinetable' 'tomltype' 'inlinetable' kdb set 'user:/tests/storage/inlinetable/a' '1' kdb set 'user:/tests/storage/inlinetable/b' '2' kdb meta-set 'user:/tests/storage/inlinetable/nested' 'tomltype' 'inlinetable' kdb set 'user:/tests/storage/inlinetable/nested/x' '3' kdb set 'user:/tests/storage/inlinetable/nested/y' '4'</p>
<h1><a class="anchor" id="autotoc_md720"></a>
Print the content of the resulting TOML file</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; inlinetable = { a = 1, b = 2, nested = { x = 3, y = 4 } }</p>
<h1><a class="anchor" id="autotoc_md721"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage </p><div class="fragment"><div class="line">## Arrays</div><div class="line"></div><div class="line">Arrays are recognized by the `array` metakey. On writing, the plugin will detect arrays automatically and set the appropriate metakey if it is missing.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md722"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_array.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md723"></a>
Create array elements</h1>
<p>kdb set 'user:/tests/storage/array/#0' '1' kdb set 'user:/tests/storage/array/#1' '2' kdb set 'user:/tests/storage/array/#2' '3'</p>
<h1><a class="anchor" id="autotoc_md724"></a>
Print the highest index of the array</h1>
<p>kdb meta-get 'user:/tests/storage/array' 'array' #&gt; #2</p>
<h1><a class="anchor" id="autotoc_md725"></a>
Print the content of the resulting TOML file</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; array = [1, 2, 3]</p>
<h1><a class="anchor" id="autotoc_md726"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage </p><div class="fragment"><div class="line"># Comments and Empty Lines</div><div class="line"></div><div class="line">The plugin preserves all comments with only one limitation for arrays. The amount of whitespace in front of a comment is also saved.</div><div class="line">For this purpose, each tab will get translated to 4 spaces.</div><div class="line"></div><div class="line">Comments can also be created by assigning meta keys to a key.</div><div class="line">The meta keys must be of the form `comment/#n`, where `n` is a positive number, indicating the position of the comment relative to the key.</div><div class="line">An index of 0 is always the inline comment of the key.</div><div class="line">Indices greater than zero are for comments preceding the given key, where 1 is the top-most comment and the highest index comment is right above the key.</div><div class="line"></div><div class="line">Spaces can be added to a comment by creating a `comment/#n/space` metakey with the amount of spaces to the key.</div><div class="line"></div><div class="line">File ending comments must be assigned to the file root key.</div><div class="line"></div><div class="line">Empty lines in front of a key can be created by adding an empty `comment/#n/start` entry to it. In this case, no `comment/#n` key is needed.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md727"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_comments.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md728"></a>
create a key-value pair, ready for comment decoration</h1>
<p>kdb set 'user:/tests/storage/key' '1'</p>
<h1><a class="anchor" id="autotoc_md729"></a>
add an inline comment with 4 leading spaces</h1>
<p>kdb meta-set 'user:/tests/storage/key' 'comment/#0' ' This value is very interesting' kdb meta-set 'user:/tests/storage/key' 'comment/#0/space' '4'</p>
<h1><a class="anchor" id="autotoc_md730"></a>
add some comments preceding the key</h1>
<p>kdb meta-set 'user:/tests/storage/key' 'comment/#1' ' I am the top-most comment relative to my key.' kdb meta-set 'user:/tests/storage/key' 'comment/#2' ' I am in the middle. Just boring.' kdb meta-set 'user:/tests/storage/key' 'comment/#3' ' I am in the line right above my key.'</p>
<h1><a class="anchor" id="autotoc_md731"></a>
add file ending comments and empty lines</h1>
<p>kdb meta-set 'user:/tests/storage' 'comment/#1' ' First file-ending comment' kdb meta-set 'user:/tests/storage' 'comment/#2/start' '' kdb meta-set 'user:/tests/storage' 'comment/#3' ' Second file-ending comment. I am the last line of the file.'</p>
<h1><a class="anchor" id="autotoc_md732"></a>
Print the content of the resulting TOML file</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; # I am the top-most comment relative to my key. #&gt; # I am in the middle. Just boring. #&gt; # I am in the line right above my key. #&gt; key = 1 # This value is very interesting #&gt; # First file-ending comment #&gt; #&gt; # Second file-ending comment. I am the last line of the file.</p>
<h1><a class="anchor" id="autotoc_md733"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage </p><div class="fragment"><div class="line">## Comments in Arrays</div><div class="line"></div><div class="line">Any amount of comments can be placed between array elements or between the first element and the opening brackets.</div><div class="line"></div><div class="line">However, only one comment - an inline comment - can be placed after the last element and the closing brackets.</div><div class="line">On reading, the plugin discards any non-inline comments between the last element and the closing brackets.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md734"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_array_comments.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md735"></a>
Create array elements</h1>
<p>kdb set 'user:/tests/storage/array/#0' '1' kdb set 'user:/tests/storage/array/#1' '2' kdb set 'user:/tests/storage/array/#2' '3'</p>
<h1><a class="anchor" id="autotoc_md736"></a>
Add inline comment after the array</h1>
<p>kdb meta-set 'user:/tests/storage/array' 'comment/#0' ' Inline comment after the array' kdb meta-set 'user:/tests/storage/array' 'comment/#0/start' '#' kdb meta-set 'user:/tests/storage/array' 'comment/#0/space' '5'</p>
<h1><a class="anchor" id="autotoc_md737"></a>
Add comments for array elements</h1>
<p>kdb meta-set 'user:/tests/storage/array/#0' 'comment/#0' ' Inline comment of first element' kdb meta-set 'user:/tests/storage/array/#0' 'comment/#0/start' '#' kdb meta-set 'user:/tests/storage/array/#0' 'comment/#0/space' '4'</p>
<p>kdb meta-set 'user:/tests/storage/array/#0' 'comment/#1' ' Comment preceding the first element' kdb meta-set 'user:/tests/storage/array/#0' 'comment/#1/start' '#' kdb meta-set 'user:/tests/storage/array/#0' 'comment/#1/space' '4'</p>
<p>kdb meta-set 'user:/tests/storage/array/#0' 'comment/#2' ' Another comment preceding the first element' kdb meta-set 'user:/tests/storage/array/#0' 'comment/#2/start' '#' kdb meta-set 'user:/tests/storage/array/#0' 'comment/#2/space' '6'</p>
<p>kdb meta-set 'user:/tests/storage/array/#1' 'comment/#0' ' Inline comment of second element' kdb meta-set 'user:/tests/storage/array/#1' 'comment/#0/start' '#' kdb meta-set 'user:/tests/storage/array/#1' 'comment/#0/space' '4'</p>
<p>kdb meta-set 'user:/tests/storage/array/#1' 'comment/#1' ' Comment preceding the second element' kdb meta-set 'user:/tests/storage/array/#1' 'comment/#1/start' '#' kdb meta-set 'user:/tests/storage/array/#1' 'comment/#1/space' '6'</p>
<p>kdb meta-set 'user:/tests/storage/array/#2' 'comment/#0' ' Inline comment of the last element' kdb meta-set 'user:/tests/storage/array/#2' 'comment/#0/start' '#' kdb meta-set 'user:/tests/storage/array/#2' 'comment/#0/space' '5'</p>
<h1><a class="anchor" id="autotoc_md738"></a>
Print the content of the resulting TOML file</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; array = [ # Comment preceding the first element #&gt; # Another comment preceding the first element #&gt; 1, # Inline comment of first element #&gt; # Comment preceding the second element #&gt; 2, # Inline comment of second element #&gt; 3 # Inline comment of the last element #&gt; ] # Inline comment after the array</p>
<h1><a class="anchor" id="autotoc_md739"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage </p><div class="fragment"><div class="line"># Order</div><div class="line"></div><div class="line">The plugin preserves the file order by the usage of the metakey `order`. When reading a file, the order metakey will be set according to the order as read in the file.</div><div class="line">If new keys are added, eg. via `kdb set`, the order of the set key will be set to the next-to-highest order value present in the existing key set.</div><div class="line"></div><div class="line">However, the order is only relevant between elements with the same TOML-parent. For example keys of a simple table are only sorted with respect to each other, not with any keys outside that table. If that table has it&#39;s order changed and moves to another position in the file, so will it&#39;s subkeys.</div><div class="line"></div><div class="line">When sorting elements under the same TOML-parent, tables (simple and array) will always be sorted after non-table elements, regardless of their order.</div><div class="line">With this limitation, we prevent that a newly set key, that is not part of a certain table array/simple table, would be placed after the table declaration, making it a member of that table on a subsequent read.</div></div><!-- fragment --> <h1><a class="anchor" id="autotoc_md740"></a>
Mount TOML file</h1>
<p>sudo kdb mount test_order.toml user:/tests/storage toml type</p>
<h1><a class="anchor" id="autotoc_md741"></a>
Create three keys in reverse alphabetical order under the subkey common</h1>
<h1><a class="anchor" id="autotoc_md742"></a>
Additionally, create one key not in the common subkey space</h1>
<p>kdb set 'user:/tests/storage/common/c' '0' kdb set 'user:/tests/storage/common/b' '1' kdb set 'user:/tests/storage/common/a' '2' kdb set 'user:/tests/storage/d' '3'</p>
<h1><a class="anchor" id="autotoc_md743"></a>
Print the content of the resulting TOML file</h1>
<h1><a class="anchor" id="autotoc_md744"></a>
The keys are ordered as they were set</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; common.c = 0 #&gt; common.b = 1 #&gt; common.a = 2 #&gt; d = 3</p>
<h1><a class="anchor" id="autotoc_md745"></a>
Create a simple table for the three keys under `common`</h1>
<p>kdb meta-set 'user:/tests/storage/common' 'tomltype' 'simpletable'</p>
<h1><a class="anchor" id="autotoc_md746"></a>
Print the content of the resulting TOML file</h1>
<p>cat <code>kdb file user:/tests/storage</code> #&gt; d = 3 #&gt; [common] #&gt; c = 0 #&gt; b = 1 #&gt; a = 2</p>
<h1><a class="anchor" id="autotoc_md747"></a>
Cleanup</h1>
<p>kdb rm -r user:/tests/storage sudo kdb umount user:/tests/storage ```</p>
<p>In this example, <code>d</code> and <code>common</code> have the same parent, the file root. This means, they need to be sorted with each other. <code>d</code> would be placed before <code>common</code> by it's order, since it was set before, and thus, has lesser order. However, their order never gets compared, since <code>common</code> is a simple table and <code>d</code> is not, so <code>d</code> will get sorted before the table regardless of order.</p>
<h1><a class="anchor" id="autotoc_md748"></a>
Limitations</h1>
<p>While the plugin has good capabilities in handling the TOML file format, it currently lacks some features possible with Elektra:</p>
<ul>
<li>Sparse arrays are not preserved on writing, they get a continuous array without index holes.</li>
<li>Values on non-leaf keys are currently not supported, they get discarded.</li>
<li>Custom metakeys cannot be written by the plugin, so they get discarded.</li>
</ul>
<p>Additionally, there are some minor limitations related to the TOML file format, mostly related to the preservation of the original file structure:</p>
<ul>
<li>On writing, each string is written as a TOML basic string (single or multiline). See <a href="#Strings">Strings</a></li>
<li>Comments and newlines between the last array element and closing brackets are discarded.</li>
<li>Trailing commas in arrays and inline tables are discarded</li>
<li>Only spaces in front of comments are preserved. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

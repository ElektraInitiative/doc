<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Compile</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.23</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Compile </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Dependencies</h2>
<p>For the base system you only need <a href="https://cmake.org/cmake/help/v3.0/">cmake3</a>, <a href="https://git-scm.com/">git</a>, and essential build tools (make, gcc, and some standard Unix tools; alternatively ninja and clang are also supported but not described here): </p><pre class="fragment">    sudo apt-get install cmake git build-essential
</pre><p>Or on RPM based systems (CentOS): </p><pre class="fragment">    sudo yum install -y cmake3 git gcc-c++
</pre><p>Or on macOS Sierra, most of the build tools can be obtained by installing Xcode (from the App Store). Other required tools may be installed using <a href="http://brew.sh/">brew</a>. First install brew as described on their website. Then issue the following command to get cmake to complete the basic requirements: </p><pre class="fragment">    brew install cmake git
</pre><h2>Quick Guide</h2>
<p>Run the following commands to compile Elektra with non-experimental parts where your system happens to fulfil the dependences (continue reading the rest of the document for details about these steps):</p>
<div class="fragment"><div class="line">git clone https://github.com/ElektraInitiative/libelektra.git</div><div class="line">cd libelektra</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake ..  # watch output to see if everything needed is included</div><div class="line">ccmake .. # optional: overview of the available build settings (needs cmake-curses-gui)</div><div class="line">make -j 5</div><div class="line">make run_nokdbtests  # optional: run tests</div></div><!-- fragment --><p>The last line only runs tests not writing into your system. See <a class="el" href="doc_TESTING_md.html">TESTING</a> for how to run more tests. Afterwards you can use <code>sudo make install &amp;&amp; sudo ldconfig</code> to install Elektra. See <a class="el" href="doc_INSTALL_md.html">INSTALL</a> for more information about installation of self-compiled Elektra (such as how to uninstall it).</p>
<h2>Optional Dependences</h2>
<blockquote class="doxtable">
<p>Note: You do not need to install the dependencies listed here. If they are not available, some of the functionality gets disabled automatically. The core of Elektra never depends on other libraries. </p>
</blockquote>
<p>To build documentation you need doxygen (we recommend 1.8.8+), graphviz and <a href="https://github.com/rtomayko/ronn/blob/master/INSTALLING#files">ronn</a>: </p><pre class="fragment">    apt-get install doxygen graphviz ruby-ronn
</pre><p>Or on RPM based systems: </p><pre class="fragment">    sudo yum install -y doxygen docbook-style-xsl graphviz ruby
    gem install ronn
</pre><p>Or on macOS Sierra using brew: </p><pre class="fragment">    brew install doxygen graphviz
    brew install ruby (in case ruby is not already installed)
    gem install ronn
</pre><p>To build PDF documentation you need <code>pdflatex</code> with </p><pre class="fragment">    apt-get install pdflatex texlive-fonts-recommended texlive-latex-recommended texlive-latex-extra
</pre><p>For the plugins, please refer to the README.md of the respective plugin. For example, for CentOS: </p><pre class="fragment">    sudo yum install -y boost-devel libdb-devel GConf2-devel libxml2-devel yajl-devel   \
    libcurl-devel augeas-devel libgit2-devel lua-devel swig python34-devel python-devel \
    java-1.8.0-openjdk-devel jna ruby-devel byacc
</pre><p>For the Debian package, please refer to debian/control (in the debian branch).</p>
<h2>Preparation</h2>
<p>Elektra uses <a href="https://cmake.org/cmake/help/v3.0/">cmake3</a>. Tested are cmake version 3.0.2 and 3.7.2 among others.</p>
<p>To configure Elektra graphically (with curses) run (<code>..</code> belongs to command): </p><pre class="fragment">mkdir build &amp;&amp; cd build &amp;&amp; ccmake ..
</pre><p>and press 'c' to configure the cache (might be necessary multiple times, and once on the first time in case you don‘t see any settings). After applying the desired settings, press 'g' to generate the make file.</p>
<p>All options described here, can also be used with cmake rather than ccmake (<code>..</code> does also here belong to the command): </p><pre class="fragment">mkdir build &amp;&amp; cd build &amp;&amp; cmake -D&lt;OPTION1&gt;=&lt;VAR1&gt; -D&lt;OPTION2&gt;=&lt;VAR2&gt; ..
</pre><p>For information what you can use as <code>OPTION1</code> and <code>OPTION2</code>, see above. Note: You have to enclose a value with quotes <code>""</code> if it contains a semicolon (<code>;</code>). E.g.: </p><pre class="fragment">cmake -DPLUGINS="dump;resolver;yajl;list;spec" ..
</pre><p>Some scripts in the folder of the same name may help you running cmake.</p>
<h3>Compilers</h3>
<p>For supported compilers have a look at the automatic build farm on <a href="https://build.libelektra.org/">https://build.libelektra.org/</a></p>
<table class="doxtable">
<tr>
<th>Compiler </th><th>Version </th><th>Target  </th></tr>
<tr>
<td>gcc </td><td>gcc (Debian 6.3.0-18) 6.3.0 </td><td>amd64 </td></tr>
<tr>
<td>gcc </td><td>gcc (Debian 4.7.2-5) 4.7.2 </td><td>i386 </td></tr>
<tr>
<td>gcc </td><td>gcc (Debian 4.7.2-5) 4.7.2 </td><td>amd64 </td></tr>
<tr>
<td>gcc </td><td>gcc 4.8 </td><td>amd64 </td></tr>
<tr>
<td>gcc </td><td>gcc 4.9 </td><td>amd64 </td></tr>
<tr>
<td>gcc </td><td>(Debian 4.4.5-8) 4.4.5 </td><td>amd64 </td></tr>
<tr>
<td>gcc </td><td>(Debian 4.4.5-8) 4.3 </td><td>amd64 </td></tr>
<tr>
<td>gcc </td><td>4.6 </td><td>armhf </td></tr>
<tr>
<td>mingw </td><td>4.6 </td><td>i386 </td></tr>
<tr>
<td>clang </td><td>3.8 </td><td>x86_64-pc-linux-gnu </td></tr>
<tr>
<td>clang </td><td>5.0 </td><td>x86_64-pc-linux-gnu </td></tr>
<tr>
<td>clang </td><td>6.0 </td><td>x86_64-pc-linux-gnu </td></tr>
<tr>
<td>clang </td><td>8.1.0 </td><td>macOS </td></tr>
<tr>
<td>icc </td><td>14.0.2 20140120 </td><td>x86_64-pc-linux-gnu </td></tr>
<tr>
<td>gcc/g++ </td><td></td><td>openbsd 4.9.3 (*) </td></tr>
</table>
<blockquote class="doxtable">
<p>(*) OpenBSD ships an old version of GCC per default, which can not compile Elektra. A manual installation of egcc/eg++ is required. Note that not every OpenBSD mirror provides the eg++ package. Elektra builds are confirmed with egcc/eg++ 4.9.3 in OpenBSD 5.9. The packages are called gcc and g++. Compile with <code>CC=/usr/local/bin/egcc CXX=/usr/local/bin/eg++</code>. </p>
</blockquote>
<p>To change the compiler, use cmake settings <code>CMAKE_C_COMPILER</code> and <code>CMAKE_CXX_COMPILER</code>.</p>
<p>To use gcc-4.3 for example </p><pre class="fragment">cmake -DCMAKE_C_COMPILER=gcc-4.3 -DCMAKE_CXX_COMPILER=g++-4.3 ..
</pre><p>To change the compiler with ccmake, you may need to toggle advanced options (key 't').</p>
<h3>Options</h3>
<p>Some options, i.e. <code>PLUGINS</code>, <code>BINDINGS</code> and <code>TOOLS</code> are either:</p>
<ul>
<li>a list of elements separated with a semicolon (<code>;</code>) (note that shells typically need <code>;</code> to be escaped)</li>
<li>a special uppercase element that gets replaced by a list of elements, that are:<ul>
<li><code>ALL</code> to include all elements (except elements with unfulfilled dependencies)</li>
<li><code>NODEP</code> to include all elements without dependencies</li>
</ul>
</li>
<li>elements prefixed with a minus symbol (<code>-</code>) to exclude an element</li>
</ul>
<p>Examples for this are especially in the subsection <code>PLUGINS</code> below, but they work in the same fashion for <code>BINDINGS</code> and <code>TOOLS</code>.</p>
<h4>Plugins</h4>
<p>Read about available plugins <a class="el" href="md_src_plugins_README.html#src_plugins_README_md">here</a>.</p>
<p>Because the core of elektra is minimal, plugins are needed to actually read and write to configuration files (<em>storage plugins</em>), commit the changes (<em>resolver plugins</em>, also takes care about how the configuration files are named) and also do many other tasks related to configuration.</p>
<p>The minimal set of plugins you should add:</p>
<ul>
<li><a class="el" href="md_src_plugins_dump_README.html#src_plugins_dump_README_md">dump</a> is the default storage. If you remove it, make sure you add another one and set <code>KDB_DEFAULT_STORAGE</code> to it.</li>
<li><a class="el" href="md_src_plugins_resolver_README.html#src_plugins_resolver_README_md">resolver</a> is the default resolver. If you remove it, make sure you add another one and set <code>KDB_DEFAULT_RESOLVER</code> to it.</li>
<li><a class="el" href="md_src_plugins_list_README.html#src_plugins_list_README_md">list</a> delegates work to a list of plugins. Needed for tests. (Required with <code>ENABLE_TESTING</code>.)</li>
<li><a class="el" href="md_src_plugins_spec_README.html#src_plugins_spec_README_md">spec</a> copies metadata from spec namespace to other namespaces. Needed for tests. (Required with <code>ENABLE_TESTING</code>, except on mingw.)</li>
<li><a class="el" href="md_src_plugins_sync_README.html#src_plugins_sync_README_md">sync</a> is very useful to not lose any data. If you do not want to include it, make sure to set <code>/sw/elektra/kdb/#0/current/plugins</code> to a value not containing sync (e.g. an empty value). See <a class="el" href="md_doc_help_kdb-mount.html#doc_help_kdb-mount_md">kdb-mount(1)</a>.</li>
</ul>
<p>By default nearly all plugins are added. Only experimental plugins will be omitted: </p><pre class="fragment">-DPLUGINS="ALL;-EXPERIMENTAL"
</pre><p>To add also experimental plugins, you can use: </p><pre class="fragment">-DPLUGINS=ALL
</pre><blockquote class="doxtable">
<p>Note that plugins get dropped automatically if dependences are not satisfied. </p>
</blockquote>
<p>To add all plugins except some plugins you can use: </p><pre class="fragment">-DPLUGINS="ALL;-plugin1;-plugin2"
</pre><p>For example, if you want all plugins except the jni plugin you would use: </p><pre class="fragment">-DPLUGINS="ALL;-jni"
</pre><p>To add all plugins not having additional dependencies (they need only POSIX), you can use </p><pre class="fragment">-DPLUGINS=NODEP
</pre><p>Note, that every <code>infos/provides</code> and <code>infos/status</code> field written uppercase can be used to select plugins that way (see README of <a class="el" href="md_src_plugins_README.html#src_plugins_README_md">individual plugins</a>). You also can combine any of these fields and add/remove other plugins to/from it, e.g. to include all plugins without deps, that provide storage (except <code>yajl</code>) and are maintained, but not include all plugins that are experimental, you would use: </p><pre class="fragment">-DPLUGINS="NODEP;STORAGE;-yajl;MAINTAINED;-EXPERIMENTAL"
</pre><p>The inclusion is determined by following preferences:</p>
<ol type="1">
<li>if the plugin is explicit excluded with <code>-plugin</code></li>
<li>if the plugin is explicit included with <code>plugin</code></li>
<li>if the plugin is excluded via a category <code>-CATEGORY</code></li>
<li>if the plugin is included via a category <code>CATEGORY</code></li>
<li>plugins are excluded if they are not mentioned at all (neither by category nor by name)</li>
</ol>
<p>Note, that changing <code>PLUGINS</code> will not modify the defaults used after Elektra was installed. For this endeavour you need to change: </p><pre class="fragment">-DKDB_DEFAULT_RESOLVER=resolver
</pre><p>and </p><pre class="fragment">-DKDB_DEFAULT_STORAGE=dump
</pre><p>The default resolver and storage will write to <code>KDB_DB_FILE</code> and <code>KDB_DB_INIT</code> (<a class="el" href="md_doc_help_elektra-bootstrapping.html#doc_help_elektra-bootstrapping_md">for bootstrapping</a>).</p>
<p>Obviously, you can pass the exact list of plugins you want, e.g.: </p><pre class="fragment">-DPLUGINS="resolver;sync;dump"
</pre><p>Some plugins are compile-time configurable. Then you can choose which features are compiled in or out. This is especially important in the bootstrapping phase, because then only the compiled in configuration applies. To compile-time-configure a plugin, you just pass a underscore (<code>_</code>) and flags after the name of the plugin.</p>
<p>The resolver for example distinguish between 3 different kind of flags: </p><pre class="fragment">-DPLUGINS="resolver_baseflags_userflags_systemflags"
</pre><p>Following baseflags are available:</p>
<ul>
<li><code>c</code> for debugging conflicts</li>
<li><code>f</code> for enabling file locking</li>
<li><code>m</code> for enabling mutex locking</li>
</ul>
<p>The user flags are (the order matters!):</p>
<ul>
<li><code>p</code> use passwd/ldap to lookup home directory using <code>getpwuid_r</code></li>
<li><code>h</code> use the environment variable HOME</li>
<li><code>u</code> use the environment variable USER</li>
<li><code>b</code> use the built-in default cmake variable <code>KDB_DB_HOME</code></li>
</ul>
<p>The system flags are (the order matters!):</p>
<ul>
<li><code>x</code> use the environment variable <code>XDG_CONFIG_DIRS</code> (<code>:</code> are interpreted as part of filename, no searching is done!) This option is not recommended (unless for testing), because it allows users to fake system configuration.</li>
<li><code>b</code> use the built-in default cmake variable <code>KDB_DB_SYSTEM</code></li>
<li>note: if a path that begins with a slash (<code>/</code>) is chosen, the system flags are irrelevant and the path is taken as-is.</li>
</ul>
<p>For example, one may use: </p><pre class="fragment">-DPLUGINS="resolver_lm_uhpb_b"
</pre><p>To add <code>resolver_l_h_b</code> you need to specify </p><pre class="fragment">-DPLUGINS="resolver;resolver_l_h_b"
</pre><p>You can add resolver with any combination of the flags, even if they are not available in <code>ALL</code>.</p>
<h4>Tools</h4>
<p>Tools are used to add extra functionality to Elektra. The flag used to specify which tools are compiled is <code>-DTOOLS</code>, thus flag works similarly to the <code>-DPLUGINS</code> flag, but is more limited in its functionality (which does not matter, because there are not so many tools).</p>
<p>To add all non-experimental tools, you can use:: </p><pre class="fragment">-DTOOLS=ALL
</pre><blockquote class="doxtable">
<p>Note that the behavior is different to PLUGINS which includes all PLUGINS if ALL is used. </p>
</blockquote>
<p>To add all tools except of race, you can use: </p><pre class="fragment">-DTOOLS="ALL;-race"
</pre><p>To specify specific tools you can use, e.g.: </p><pre class="fragment">-DTOOLS=qt-gui;kdb
</pre><h4>Bindings</h4>
<p>Bindings are used in a like as <code>PLUGINS</code>. For example, to build all maintained bindings and exclude experimental bindings you can use: </p><pre class="fragment">-DBINDINGS=MAINTAINED;-EXPERIMENTAL
</pre><p>Note that the same languages are sometimes available over GI and SWIG. In this case, the SWIG bindings are preferred. The SWIG executable may be specified with: </p><pre class="fragment">-DSWIG_EXECUTABLE=/usr/bin/swig3.0
</pre><p>If this option is not used, cmake will find the first occurrence of <code>swig</code> in your environment's path. To build GI bindings (deprecated) and gsettings (experimental) use: </p><pre class="fragment">-DBINDINGS="GI;gsettings"
</pre><p>Some bindings provide different APIs (and not a different language), e.g:</p>
<ul>
<li><code>gsettings</code></li>
<li><code>INTERCEPT</code> with <code>intercept_fs</code> and <code>intercept_env</code></li>
<li><code>IO</code> with <code>io_uv</code></li>
</ul>
<p>To not add such APIs, but only <code>swig</code> bindings and <code>cpp</code>, you can use: </p><pre class="fragment">-DBINDINGS="SWIG;cpp"
</pre><p>For a list of available bindings see binding's README.md.</p>
<h4>CMAKE_BUILD_TYPE</h4>
<p><code>Debug</code>, <code>Release</code> or <code>RelWithDebInfo</code> See help bar at bottom of ccmake for that option or: <a href="http://www.cmake.org/Wiki/CMake_Useful_Variables">http://www.cmake.org/Wiki/CMake_Useful_Variables</a></p>
<h3>BUILD_SHARED BUILD_FULL BUILD_STATIC</h3>
<p><code>BUILD_SHARED</code> is the typical build you want to have on systems that support <code>dlopen</code>. It can be used for desktop builds, but also embedded systems as long as they support <code>dlopen</code>, for example, <code>BUILD_SHARED</code> is used on OpenWRT with musl. Using <code>BUILD_SHARED</code> every plugin is its own shared object.</p>
<p><code>BUILD_FULL</code> links together all parts of Elektra as a single shared <code>.so</code> library. This is ideal if shared libraries are available, but you want to avoid <code>dlopen</code>. Some tests only work with <code>BUILD_FULL</code>, so you might turn it on to get full coverage.</p>
<p><code>BUILD_STATIC</code> also links together all parts but as static <code>.a</code> library. It is only useful for systems without <code>dlopen</code> or if the overhead of <code>dlopen</code> needs to be avoided.</p>
<p>All three forms of builds can be intermixed freely.</p>
<p>For example, to enable shared and full build, but disable static build, one would use: </p><pre class="fragment">cmake -DBUILD_SHARED=ON -DBUILD_FULL=ON -DBUILD_STATIC=OFF ..
</pre><h4>ELEKTRA_DEBUG_BUILD and ELEKTRA_VERBOSE_BUILD</h4>
<p>Only needed by Elektra developers. Make the library to output logging information. It is not recommended to use these options.</p>
<h4>BUILD_DOCUMENTATION</h4>
<p>Build documentation with doxygen (API) and ronn (man pages).</p>
<h4>Developer Options</h4>
<p>As developer you should enable <code>ENABLE_DEBUG</code> and <code>ENABLE_LOGGER</code>. By default no logging will take place, see <a class="el" href="doc_CODING_md.html">CODING</a> for information about logging.</p>
<p>Then continue reading <a class="el" href="doc_TESTING_md.html">testing</a> for options about testing.</p>
<h4>CMAKE_INSTALL_PREFIX</h4>
<p><code>CMAKE_INSTALL_PREFIX</code> defaults to <code>/usr/local</code>. So by default most files will installed below <code>/usr/local</code>. Exceptions to this are files handled by <a href="#install_system_files">INSTALL_SYSTEM_FILES</a>.</p>
<p>Edit that cache entry to change that behavior. Also called system prefix within the documentation.</p>
<p>If you want to create a package afterwards it is ok to use paths that you can write to (e.g. <code>-DCMAKE_INSTALL_PREFIX=/home/username/</code>)</p>
<h4>LIB_SUFFIX</h4>
<p>Lets you install libraries into architecture specific folder. E.g. for 32/64 bit systems you might install libraries under <code>lib64</code>. Set <code>LIB_SUFFIX</code> to <code>64</code> to achieve exactly that. So the system library folder will be <code>CMAKE_INSTALL_PREFIX/lib64</code> then.</p>
<h4>TARGET_INCLUDE_FOLDER</h4>
<p>By default include folders will be installed below <code>CMAKE_INSTALL_PREFIX/include/elektra</code>. This entry let you change the elektra. If the entry is empty, the include files will be installed directly to <code>CMAKE_INSTALL_PREFIX/include</code>.</p>
<h4>TARGET_PLUGIN_FOLDER</h4>
<p>Similar to above, but with the plugins. Default is: <code>CMAKE_INSTALL_PREFIX/lib${LIB_SUFFIX}/elektra</code> It can be also left empty to install plugins next to other libraries.</p>
<h4>GTEST_ROOT</h4>
<p>Specifies the root of the GoogleTest sources, to be used for some of the tests. A <code>CMakeLists.txt</code> inside <code>GTEST_ROOT</code> will be searched as way to detect a valid GoogleTest source directory. If it is empty (<code>""</code>), an internal version of gtest will be used.</p>
<p>It is recommended that you browse through all of the options using ccmake. Afterwards press 'c' again (maybe multiple times until all variables are resolved) and then 'g' to generate. Finally press 'e' to exit.</p>
<h4>INSTALL_BUILD_TOOLS</h4>
<p>Specifies that the build tools, i.e. <code>elektra-export-symbols</code> and <code>elektra-export-symbols</code> are installed (by default off). Is needed for cross-compilation.</p>
<h4>INSTALL_SYSTEM_FILES</h4>
<p>Some of Elektra’s targets require to be installed into specific folders in the file system hierarchy to work properly.</p>
<p>This variable is enabled by default but requires the install target to have the rights to write into the corresponding folders. Set <code>-DINSTALL_SYSTEM_FILES=OFF</code> if you do not need any of them.</p>
<p>If you do not have root rights you can copy them manually to your user folder.</p>
<p>Currently the installed system files are as following:</p>
<table class="doxtable">
<tr>
<th>Module </th><th>Description </th><th>Install Path  </th></tr>
<tr>
<td>bash-completion </td><td>bash tab auto completion file </td><td><code>completionsdir</code> from pkg-config (*) </td></tr>
<tr>
<td>zsh-completion </td><td>zsh tab auto completion file </td><td>/usr/share/zsh/vendor-completions </td></tr>
<tr>
<td>GIR </td><td>introspection file for bindings </td><td><code>INTROSPECTION_GIRDIR</code> from pkg-config </td></tr>
<tr>
<td>GSettings </td><td>GSettings backend module </td><td><code>GIO_MODULE_DIR</code> from pkg-config </td></tr>
</table>
<blockquote class="doxtable">
<p>(*) Or <code>/usr/share/bash-completion/completions</code> as fallback. </p>
</blockquote>
<h4>ENABLE_OPTIMIZATIONS</h4>
<p>In order to keep the binaries as small as possible this flag allows to trade memory for speed.</p>
<h2>Building</h2>
<h3>Without IDE</h3>
<p>To build the source use: </p><pre class="fragment">make
</pre><p>You can pass:</p><ul>
<li><code>-j</code> for parallel builds</li>
<li><code>VERBOSE=1</code> to see the invocations of the compiler</li>
</ul>
<p>Continue by reading <a class="el" href="doc_INSTALL_md.html">INSTALL</a>.</p>
<h3>With CodeBlocks</h3>
<p>You can build Elektra using Code::Blocks under Gentoo:</p>
<p>Precondition: Make sure you have a compiler, xml2 (for kdb tool) and xsl (see later) installed. cmake configure will help you with that, it will make sure you don't forget something essential.</p>
<p>For Most Linux system all you have to do is open up a console and </p><pre class="fragment">mkdir build
cd build
cmake .. -G 'CodeBlocks - Unix Makefiles'
make package
</pre><p>Note 1: You can use other editor if you like just type cmake at the console to get a list of option you can pass to cmake as long as well as a list of what code editor project cmake can create.</p>
<p>Note 2: For Unix if you have nCurses install you can run ccmake to set important option after running cmake like to enable debug symbol.</p>
<p>Note 3: for Gentoo is recommend to emerge sys-apps/lsb-release to name the package right even thou not required.</p>
<h2>Maintainer's Guide</h2>
<h3>Multiarch</h3>
<p>On multiarch (multiple architectures installed in one system), you need to set <code>LIB_SUFFIX</code>. For example, if you want to have the binaries in <code>lib64</code> and <code>lib32</code>, you would use for the libraries to be installed in <code>${CMAKE_INSTALL_PREFIX}/lib64</code>: </p><pre class="fragment">    -DLIB_SUFFIX="64"
</pre><p>If there is a directory for different architectures, simply prepend an <code>/</code>. For example, for Debian: </p><pre class="fragment">    -DLIB_SUFFIX="/$(DEB_HOST_MULTIARCH)"
</pre><h3>RPATH</h3>
<p>By default Elektra uses <code>RPATH</code> to hide its plugins. This makes it obvious that external applications should <em>not</em> link against plugins. Instead every application should use the <code>elektraModulesLoad()</code> API to load Elektra’s modules.</p>
<p>The folder where the plugins are located is a subdirectory of where the libraries are installed. The name of the subdirectory can be specified using <code>TARGET_PLUGIN_FOLDER</code> and is <code>elektra</code> by default. You might want to encode Elektra’s <code>SOVERSION</code> into the folders name, if you want different major versions of Elektra be co-installable.</p>
<p>Elektra’s use case for <code>RPATH</code> is considered acceptable, so we recommend to use it because:</p>
<ul>
<li>plugins do not clutter the library folder nor the <code>ld.so.cache</code></li>
<li>it works well with multiarch (<code>LIB_SUFFIX</code> is also honored for plugins)</li>
<li>which plugins are used should be decided at mount-time and be globally available in the same way for every application. <code>RPATH</code> supports exactly that because it even overrides <code>LD_LIBRARY_PATH</code>.</li>
</ul>
<p>Unfortunately, there are also drawbacks:</p>
<ul>
<li>it makes Elektra non-relocatable (<code>RPATH</code> is decided at compile-time, so you cannot simply move Elektra’s installations within the file system (e.g. from <code>/usr/local</code> to <code>/usr</code>)</li>
<li>it requires modern <code>ld.so</code> implementations that honor <code>RPATH</code> from libraries. This is the case for most <code>libc</code> implementations including Linux and macOS, but not for, e.g., <code>musl</code>.</li>
</ul>
<p>If you want Elektra to <em>not</em> use <code>RPATH</code>, you can add: </p><pre class="fragment">    -DTARGET_PLUGIN_FOLDER="" -DCMAKE_SKIP_INSTALL_RPATH=ON
</pre><p>Then all plugins are directly installed to the library directory and loaded like other libraries (in any of <code>ld.so</code> paths).</p>
<p>Alternatively, which gives you the advantage not to clutter the main library path, is to add the plugin folder in <code>/etc/ld.so.conf.d/elektra</code>. Note that it still allows applications to link against plugins.</p>
<h2>Troubleshooting</h2>
<h3>Missing Links/Libraries</h3>
<p>If you get errors that <code>libelektra-resolver.so</code> or <code>libelektra-storage.so</code> are missing, or the links do not work, you can use as workaround: </p><pre class="fragment">    cmake -DBUILD_SHARED=OFF -DBUILD_FULL=ON ..
</pre><p>This issue was reported for:</p>
<ul>
<li>OpenSuse 42 (when running <code>make run_all</code>)</li>
<li>CLion IDE (does not allow to build)</li>
</ul>
<h3>Dependencies not Available for Cent OS</h3>
<p>Please enable EPEL <a href="https://fedoraproject.org/wiki/EPEL">https://fedoraproject.org/wiki/EPEL</a> </p><pre class="fragment">    # Install EPEL for RHEL 7
    curl -o epel-release-7-8.noarch.rpm \
      http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm
    sudo rpm -ivh epel-release-7-8.noarch.rpm
    sudo yum update
</pre><p>For Bindings swig3 is recommended. swig2 only works on some distributions. E.g., for Debian Jessie the bindings will crash.</p>
<p>At time of writing, no swig 3 was available, not even in EPEL. Thus you need to install swig3 manually: </p><pre class="fragment">    curl https://codeload.github.com/swig/swig/tar.gz/rel-3.0.10 | tar xz
    cd swig-rel-3.0.10 &amp;&amp; ./autogen.sh &amp;&amp; ./configure &amp;&amp; make
    sudo make install
    cd ..
</pre><p>Also, no ronn was available, thus you need to do: </p><pre class="fragment">    gem install ronn
</pre><h3>Cross Compiling</h3>
<p>In Elektra cross compiling needs two steps. If you get errors like <code>elektra-export-errors_EXE_LOC</code> not found, go on reading.</p>
<p>In the first step, you need to compile Elektra for the host architecture and install the build tools: </p><pre class="fragment">    cmake -DINSTALL_BUILD_TOOLS=ON \
          -DINSTALL_SYSTEM_FILES=OFF \
          -DCMAKE_PREFIX_PATH=$(STAGING_DIR_HOST) \
          ..
    make -j 5
    make install -j 5
</pre><p>Where <code></code> must be a directory to be found in the later build process. In particular, <code>/bin</code> must be in a directory found by a later <code>find_program</code>.</p>
<p>Then you need to compile Elektra again, but for the target architecture. Now, the build tools such as <code>elektra-export-errors</code> should be found in the <code>/bin</code> where they were installed before.</p>
<p>For reference, you can look into the <a href="https://github.com/openwrt/packages/blob/master/libs/elektra/Makefile">OpenWRT Elektra Makefile</a> and the <a href="https://github.com/openwrt/openwrt/blob/master/include/cmake.mk">CMake in OpenWRT</a>.</p>
<h2>See also</h2>
<ul>
<li><a class="el" href="doc_INSTALL_md.html">INSTALL</a>.</li>
<li><a class="el" href="doc_TESTING_md.html">TESTING</a>. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

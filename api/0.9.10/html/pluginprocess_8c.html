<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: pluginprocess.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_87a455bccb09a92130c26a11a880c98a.html">libs</a></li><li class="navelem"><a class="el" href="dir_50ba3f1b5541e9cc2f26972d95766272.html">pluginprocess</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">pluginprocess.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Source for the pluginprocess library.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;kdbpluginprocess.h&quot;</code><br />
<code>#include &lt;<a class="el" href="kdberrors_8h.html">kdberrors.h</a>&gt;</code><br />
<code>#include &lt;kdbinvoke.h&gt;</code><br />
<code>#include &lt;<a class="el" href="kdblogger_8h.html">kdblogger.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="kdbprivate_8h.html">kdbprivate.h</a>&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for pluginprocess.c:</div>
<div class="dyncontent">
<div class="center"><img src="pluginprocess_8c__incl.png" border="0" usemap="#apluginprocess_8c" alt=""/></div>
<map name="apluginprocess_8c" id="apluginprocess_8c">
<area shape="rect" title="Source for the pluginprocess library." alt="" coords="1473,5,1595,32"/>
<area shape="rect" href="kdberrors_8h.html" title="Provides all macros and definitions which are used for emitting error or warnings." alt="" coords="147,155,243,181"/>
<area shape="rect" href="kdblogger_8h.html" title="Logger Interface." alt="" coords="22,229,121,256"/>
<area shape="rect" href="kdbprivate_8h.html" title="Private declarations." alt="" coords="962,80,1066,107"/>
<area shape="rect" title=" " alt="" coords="1388,304,1456,331"/>
<area shape="rect" title=" " alt="" coords="1357,155,1428,181"/>
<area shape="rect" title=" " alt="" coords="1497,80,1571,107"/>
<area shape="rect" title=" " alt="" coords="1595,80,1662,107"/>
<area shape="rect" title=" " alt="" coords="1687,80,1757,107"/>
<area shape="rect" title=" " alt="" coords="1782,80,1867,107"/>
<area shape="rect" title=" " alt="" coords="1891,80,1987,107"/>
<area shape="rect" title=" " alt="" coords="2011,80,2086,107"/>
<area shape="rect" title=" " alt="" coords="862,304,921,331"/>
<area shape="rect" href="kdbhelper_8h.html" title="Helper for memory management." alt="" coords="195,229,294,256"/>
<area shape="rect" href="kdbmacros_8h.html" title="Macros by Elektra." alt="" coords="325,304,431,331"/>
<area shape="rect" title=" " alt="" coords="497,304,592,331"/>
<area shape="rect" title=" " alt="" coords="127,304,202,331"/>
<area shape="rect" title=" " alt="" coords="226,304,301,331"/>
<area shape="rect" title=" " alt="" coords="5,304,103,331"/>
<area shape="rect" href="elektra_8h.html" title="Elektra High Level API." alt="" coords="569,155,649,181"/>
<area shape="rect" href="error_8h.html" title="Elektra error." alt="" coords="1219,229,1334,256"/>
<area shape="rect" href="kdbextension_8h.html" title="Extension functionality." alt="" coords="1102,155,1225,181"/>
<area shape="rect" href="kdbio_8h.html" title="Elektra&#45;I/O structures for I/O bindings, plugins and applications." alt="" coords="1359,229,1429,256"/>
<area shape="rect" href="kdbnotificationinternal_8h.html" title="Elektra&#45;Notification structures and declarations for developing notification and transport plugins." alt="" coords="795,155,977,181"/>
<area shape="rect" href="kdbplugin_8h.html" title="Methods for plugin programing." alt="" coords="929,229,1027,256"/>
<area shape="rect" href="kdbglobal_8h.html" title="Defines for global plugins." alt="" coords="673,155,771,181"/>
<area shape="rect" title=" " alt="" coords="1235,304,1318,331"/>
<area shape="rect" href="kdbmeta_8h.html" title="metadata functions" alt="" coords="1103,229,1195,256"/>
<area shape="rect" href="kdbnotification_8h.html" title="Elektra&#45;Notification structures and declarations for application developers." alt="" coords="723,229,854,256"/>
<area shape="rect" title=" " alt="" coords="945,304,1016,331"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa45f0e358d30fcaa11cef6b4da6c9860"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginprocess_8c.html#aa45f0e358d30fcaa11cef6b4da6c9860">elektraPluginProcessStart</a> (Plugin *handle, ElektraPluginProcess *pp)</td></tr>
<tr class="memdesc:aa45f0e358d30fcaa11cef6b4da6c9860"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the child process' command loop.  <a href="pluginprocess_8c.html#aa45f0e358d30fcaa11cef6b4da6c9860">More...</a><br /></td></tr>
<tr class="separator:aa45f0e358d30fcaa11cef6b4da6c9860"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb351eb50b21c443b1e8bc67a75eee47"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginprocess_8c.html#afb351eb50b21c443b1e8bc67a75eee47">elektraPluginProcessSend</a> (const ElektraPluginProcess *pp, pluginprocess_t command, KeySet *originalKeySet, Key *key)</td></tr>
<tr class="memdesc:afb351eb50b21c443b1e8bc67a75eee47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call a plugin's function in a child process.  <a href="pluginprocess_8c.html#afb351eb50b21c443b1e8bc67a75eee47">More...</a><br /></td></tr>
<tr class="separator:afb351eb50b21c443b1e8bc67a75eee47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff49312d0e6fb866b1fc78bc230e9150"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a> (const ElektraPluginProcess *pp)</td></tr>
<tr class="memdesc:aff49312d0e6fb866b1fc78bc230e9150"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a given plugin process is the parent or the child process.  <a href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">More...</a><br /></td></tr>
<tr class="separator:aff49312d0e6fb866b1fc78bc230e9150"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0733d8e60e00cc01ea0a1adf9c9e905"><td class="memItemLeft" align="right" valign="top">ElektraPluginProcess *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginprocess_8c.html#ac0733d8e60e00cc01ea0a1adf9c9e905">elektraPluginProcessInit</a> (Key *errorKey)</td></tr>
<tr class="memdesc:ac0733d8e60e00cc01ea0a1adf9c9e905"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a plugin to be executed in its own process.  <a href="pluginprocess_8c.html#ac0733d8e60e00cc01ea0a1adf9c9e905">More...</a><br /></td></tr>
<tr class="separator:ac0733d8e60e00cc01ea0a1adf9c9e905"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabd3645799a694d6bde9ae201d536d01"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginprocess_8c.html#aabd3645799a694d6bde9ae201d536d01">elektraPluginProcessOpen</a> (ElektraPluginProcess *pp, Key *errorKey)</td></tr>
<tr class="memdesc:aabd3645799a694d6bde9ae201d536d01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call a plugin's open function in a child process.  <a href="pluginprocess_8c.html#aabd3645799a694d6bde9ae201d536d01">More...</a><br /></td></tr>
<tr class="separator:aabd3645799a694d6bde9ae201d536d01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adeaf83dde28bceb8542f06b2fba7d8ab"><td class="memItemLeft" align="right" valign="top">ElektraPluginProcessCloseResult&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginprocess_8c.html#adeaf83dde28bceb8542f06b2fba7d8ab">elektraPluginProcessClose</a> (ElektraPluginProcess *pp, Key *errorKey)</td></tr>
<tr class="memdesc:adeaf83dde28bceb8542f06b2fba7d8ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup a plugin process.  <a href="pluginprocess_8c.html#adeaf83dde28bceb8542f06b2fba7d8ab">More...</a><br /></td></tr>
<tr class="separator:adeaf83dde28bceb8542f06b2fba7d8ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81c73c8722be15e96ca094e84958dbf9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginprocess_8c.html#a81c73c8722be15e96ca094e84958dbf9">elektraPluginProcessSetData</a> (ElektraPluginProcess *pp, void *data)</td></tr>
<tr class="memdesc:a81c73c8722be15e96ca094e84958dbf9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store a pointer to any plugin related data that is being executed inside an own process.  <a href="pluginprocess_8c.html#a81c73c8722be15e96ca094e84958dbf9">More...</a><br /></td></tr>
<tr class="separator:a81c73c8722be15e96ca094e84958dbf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9f64944a775a8ae8ad24f3590d6f6d5"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginprocess_8c.html#aa9f64944a775a8ae8ad24f3590d6f6d5">elektraPluginProcessGetData</a> (const ElektraPluginProcess *pp)</td></tr>
<tr class="memdesc:aa9f64944a775a8ae8ad24f3590d6f6d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a pointer to any plugin related data stored before.  <a href="pluginprocess_8c.html#aa9f64944a775a8ae8ad24f3590d6f6d5">More...</a><br /></td></tr>
<tr class="separator:aa9f64944a775a8ae8ad24f3590d6f6d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Source for the pluginprocess library. </p>
<p>Executes plugins in a separate process via fork and uses a simple communication protocol based on the dump plugin via named pipes.</p>
<p>The communication protocol works as follows, where Child and Parent stand for the child and the parent process: 1) Four pipes are created to handle the communication in a reliable way</p><ul>
<li>parentCommandPipe is used for a keyset containing metainformation about the communication protocol, going from Parent to Child</li>
<li>parentPayloadPipe is used for transferring the actual payload that gets passed to a plugin, going from Parent to Child</li>
<li>childCommandPipe is used for a keyset containing metainformation about the communication protocol, going from Child to Parent</li>
<li>childPayloadPipe is used for transferring the actual payload that gets passed to a plugin, going from Child to Parent 2) The parent constructs a keyset called commandKeySet, containing:</li>
<li>/pluginprocess/parent a copy of the parent key passed to the plugin interface</li>
<li>/pluginprocess/parent/name the name of the parent key passed to the plugin interface</li>
<li>/pluginprocess/command the command that should be executed by the child process</li>
<li>/pluginprocess/payload/size the size of the payload keyset, -1 if there is no payload</li>
<li>/pluginprocess/version a number indicating the version of this communication protocol 3) The parent sends over the commandKeySet over the parentCommandPipe 4) For operations requiring a keyset, the parent sends the keyset (originalKeySet) that is passed to this plugin over the parentPayloadPipe 5) Child receives the commandKeySet 6) Child receives the keyset if one exists 7) Child executes the plugin on the keyset with the originalKey 8) Child adds the result value of the plugin operation to the commandKeySet into the key /pluginprocess/result 9) Child sends the commandKeySet over the childCommandPipe 10) For operations requiring a keyset, Child sends the keyset over the childPayloadPipe 11) Parent receives the commandKeySet and interprets /pluginprocess/result 12) For operations requiring a keyset, Parent receives the keyset and copies it back to originalKeySet set 13) Parent returns the result value from the child process</li>
</ul>
<dl class="section copyright"><dt>Copyright</dt><dd>BSD License (see LICENSE.md or <a href="https://www.libelektra.org">https://www.libelektra.org</a>) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="adeaf83dde28bceb8542f06b2fba7d8ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adeaf83dde28bceb8542f06b2fba7d8ab">&#9670;&nbsp;</a></span>elektraPluginProcessClose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ElektraPluginProcessCloseResult elektraPluginProcessClose </td>
          <td>(</td>
          <td class="paramtype">ElektraPluginProcess *&#160;</td>
          <td class="paramname"><em>pp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>errorKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleanup a plugin process. </p>
<p>This will decrease the internal counter how often open/close has been called, closing opened pipes when the counter reaches 0. This will not delete the plugin data associated with the handle as it may contain other data out of the scope of this library, so this has to be done manually like </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> elektraPluginClose (Plugin * handle, Key * errorKey)</div>
<div class="line">{</div>
<div class="line">        ElektraPluginProcess * pp = <a class="code" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a> (handle);</div>
<div class="line">        <span class="keywordflow">if</span> (pp &amp;&amp; <a class="code" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a> (pp)) {</div>
<div class="line">                ElektraPluginProcessCloseResult result = <a class="code" href="pluginprocess_8c.html#adeaf83dde28bceb8542f06b2fba7d8ab">elektraPluginProcessClose</a> (pp, errorKey);</div>
<div class="line">                <span class="keywordflow">if</span> (result.cleanedUp) <a class="code" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">elektraPluginSetData</a> (handle, NULL);</div>
<div class="line">                <span class="keywordflow">return</span> result.result;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// actual plugin functionality to be executed in a child process</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="kdbplugin_8h.html#a7ae271ada880a1447179094ce6f66821">ELEKTRA_PLUGIN_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__plugin_html_gaafcf3216b46292f222b8cc7828b4dd20"><div class="ttname"><a href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a></div><div class="ttdeci">void * elektraPluginGetData(Plugin *plugin)</div><div class="ttdoc">Get a pointer to the plugin specific data stored before.</div><div class="ttdef"><b>Definition:</b> plugin/plugin.c:147</div></div>
<div class="ttc" id="agroup__plugin_html_gaf4b941a52ff55d0ca2a9158d90208ef2"><div class="ttname"><a href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">elektraPluginSetData</a></div><div class="ttdeci">void elektraPluginSetData(Plugin *plugin, void *data)</div><div class="ttdoc">Store a pointer to plugin specific data.</div><div class="ttdef"><b>Definition:</b> plugin/plugin.c:130</div></div>
<div class="ttc" id="akdbplugin_8h_html_a7ae271ada880a1447179094ce6f66821"><div class="ttname"><a href="kdbplugin_8h.html#a7ae271ada880a1447179094ce6f66821">ELEKTRA_PLUGIN_STATUS_SUCCESS</a></div><div class="ttdeci">#define ELEKTRA_PLUGIN_STATUS_SUCCESS</div><div class="ttdoc">Everything went fine.</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:85</div></div>
<div class="ttc" id="apluginprocess_8c_html_adeaf83dde28bceb8542f06b2fba7d8ab"><div class="ttname"><a href="pluginprocess_8c.html#adeaf83dde28bceb8542f06b2fba7d8ab">elektraPluginProcessClose</a></div><div class="ttdeci">ElektraPluginProcessCloseResult elektraPluginProcessClose(ElektraPluginProcess *pp, Key *errorKey)</div><div class="ttdoc">Cleanup a plugin process.</div><div class="ttdef"><b>Definition:</b> pluginprocess.c:579</div></div>
<div class="ttc" id="apluginprocess_8c_html_aff49312d0e6fb866b1fc78bc230e9150"><div class="ttname"><a href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a></div><div class="ttdeci">int elektraPluginProcessIsParent(const ElektraPluginProcess *pp)</div><div class="ttdoc">Check if a given plugin process is the parent or the child process.</div><div class="ttdef"><b>Definition:</b> pluginprocess.c:389</div></div>
</div><!-- fragment --><p>Note that pp might be null here if the initialization failed!</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pp</td><td>the data structure containing the plugin's process information </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>if the data structure got cleaned up </td></tr>
    <tr><td class="paramname">0</td><td>if the data structure is still used </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa9f64944a775a8ae8ad24f3590d6f6d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9f64944a775a8ae8ad24f3590d6f6d5">&#9670;&nbsp;</a></span>elektraPluginProcessGetData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* elektraPluginProcessGetData </td>
          <td>(</td>
          <td class="paramtype">const ElektraPluginProcess *&#160;</td>
          <td class="paramname"><em>pp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a pointer to any plugin related data stored before. </p>
<p>If elektraPluginProcessSetData was not called earlier, NULL will be returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pp</td><td>the data structure containing the plugin's process information </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">a</td><td>pointer to the data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac0733d8e60e00cc01ea0a1adf9c9e905"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0733d8e60e00cc01ea0a1adf9c9e905">&#9670;&nbsp;</a></span>elektraPluginProcessInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ElektraPluginProcess* elektraPluginProcessInit </td>
          <td>(</td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>errorKey</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a plugin to be executed in its own process. </p>
<p>This will prepare all the required resources and then fork the current process. After the initialization the child process will typically call the command loop while the parent starts to send commands to it. Also the resulting process information has to be stored for the plugin. In order to allow users to handle custom plugin data this will not automatically call elektraPluginSetData.</p>
<p>Typically called in a plugin's open function like (assuming no custom plugin data): </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="elektra_2plugin_8c.html#a32a70a7876542c51d153164ac5108a57">elektraPluginOpen</a> (Plugin * handle, Key * errorKey)</div>
<div class="line">{</div>
<div class="line">        ElektraPluginProcess * pp = <a class="code" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a> (handle);</div>
<div class="line">        <span class="keywordflow">if</span> (pp == NULL)</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordflow">if</span> ((pp = <a class="code" href="pluginprocess_8c.html#ac0733d8e60e00cc01ea0a1adf9c9e905">elektraPluginProcessInit</a> (errorKey)) == NULL) <span class="keywordflow">return</span> <a class="code" href="kdbplugin_8h.html#a0a5d59c7d1a2ce87a1d060c7be0261a4">ELEKTRA_PLUGIN_STATUS_ERROR</a>;</div>
<div class="line">                <a class="code" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">elektraPluginSetData</a> (handle, pp);</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a> (pp)) <a class="code" href="pluginprocess_8c.html#aa45f0e358d30fcaa11cef6b4da6c9860">elektraPluginProcessStart</a> (handle, pp);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a> (pp)) <span class="keywordflow">return</span> <a class="code" href="pluginprocess_8c.html#aabd3645799a694d6bde9ae201d536d01">elektraPluginProcessOpen</a> (pp, errorKey);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// actual plugin functionality to be executed in a child process</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="kdbplugin_8h.html#a7ae271ada880a1447179094ce6f66821">ELEKTRA_PLUGIN_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aelektra_2plugin_8c_html_a32a70a7876542c51d153164ac5108a57"><div class="ttname"><a href="elektra_2plugin_8c.html#a32a70a7876542c51d153164ac5108a57">elektraPluginOpen</a></div><div class="ttdeci">Plugin * elektraPluginOpen(const char *name, KeySet *modules, KeySet *config, Key *errorKey)</div><div class="ttdoc">Opens a plugin.</div><div class="ttdef"><b>Definition:</b> elektra/plugin.c:240</div></div>
<div class="ttc" id="akdbplugin_8h_html_a0a5d59c7d1a2ce87a1d060c7be0261a4"><div class="ttname"><a href="kdbplugin_8h.html#a0a5d59c7d1a2ce87a1d060c7be0261a4">ELEKTRA_PLUGIN_STATUS_ERROR</a></div><div class="ttdeci">#define ELEKTRA_PLUGIN_STATUS_ERROR</div><div class="ttdoc">An error occurred inside the plugin function.</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:82</div></div>
<div class="ttc" id="apluginprocess_8c_html_aa45f0e358d30fcaa11cef6b4da6c9860"><div class="ttname"><a href="pluginprocess_8c.html#aa45f0e358d30fcaa11cef6b4da6c9860">elektraPluginProcessStart</a></div><div class="ttdeci">void elektraPluginProcessStart(Plugin *handle, ElektraPluginProcess *pp)</div><div class="ttdoc">Start the child process' command loop.</div><div class="ttdef"><b>Definition:</b> pluginprocess.c:127</div></div>
<div class="ttc" id="apluginprocess_8c_html_aabd3645799a694d6bde9ae201d536d01"><div class="ttname"><a href="pluginprocess_8c.html#aabd3645799a694d6bde9ae201d536d01">elektraPluginProcessOpen</a></div><div class="ttdeci">int elektraPluginProcessOpen(ElektraPluginProcess *pp, Key *errorKey)</div><div class="ttdoc">Call a plugin's open function in a child process.</div><div class="ttdef"><b>Definition:</b> pluginprocess.c:545</div></div>
<div class="ttc" id="apluginprocess_8c_html_ac0733d8e60e00cc01ea0a1adf9c9e905"><div class="ttname"><a href="pluginprocess_8c.html#ac0733d8e60e00cc01ea0a1adf9c9e905">elektraPluginProcessInit</a></div><div class="ttdeci">ElektraPluginProcess * elektraPluginProcessInit(Key *errorKey)</div><div class="ttdoc">Initialize a plugin to be executed in its own process.</div><div class="ttdef"><b>Definition:</b> pluginprocess.c:465</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>the plugin's handle </td></tr>
    <tr><td class="paramname">errorKey</td><td>a key where error messages will be set </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>if the initialization failed </td></tr>
    <tr><td class="paramname">a</td><td>pointer to the information </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aff49312d0e6fb866b1fc78bc230e9150"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff49312d0e6fb866b1fc78bc230e9150">&#9670;&nbsp;</a></span>elektraPluginProcessIsParent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraPluginProcessIsParent </td>
          <td>(</td>
          <td class="paramtype">const ElektraPluginProcess *&#160;</td>
          <td class="paramname"><em>pp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if a given plugin process is the parent or the child process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pp</td><td>the data structure containing the plugin's process information </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>if it's the child process </td></tr>
    <tr><td class="paramname">the</td><td>child process' pid otherwise </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aabd3645799a694d6bde9ae201d536d01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabd3645799a694d6bde9ae201d536d01">&#9670;&nbsp;</a></span>elektraPluginProcessOpen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraPluginProcessOpen </td>
          <td>(</td>
          <td class="paramtype">ElektraPluginProcess *&#160;</td>
          <td class="paramname"><em>pp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>errorKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call a plugin's open function in a child process. </p>
<p>This will increase the internal counter how often open/close has been called, so the opened pipes and forks will not be closed too early.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pp</td><td>the data structure containing the plugin's process information </td></tr>
    <tr><td class="paramname">errorKey</td><td>a key where error messages will be set </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">the</td><td>return value of the plugin's open function </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="pluginprocess_8c.html#ac0733d8e60e00cc01ea0a1adf9c9e905" title="Initialize a plugin to be executed in its own process.">elektraPluginProcessInit</a> for an example how and where this function is typically used </dd></dl>

</div>
</div>
<a id="afb351eb50b21c443b1e8bc67a75eee47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb351eb50b21c443b1e8bc67a75eee47">&#9670;&nbsp;</a></span>elektraPluginProcessSend()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraPluginProcessSend </td>
          <td>(</td>
          <td class="paramtype">const ElektraPluginProcess *&#160;</td>
          <td class="paramname"><em>pp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pluginprocess_t&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">KeySet *&#160;</td>
          <td class="paramname"><em>originalKeySet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call a plugin's function in a child process. </p>
<p>This will wrap all the required information to execute the given command in a keyset and send it over to the child process. Then it waits for the child process's answer and copies the result back into the original plugin keyset and plugin key.</p>
<p>Typically called like </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> elektraPluginSet (Plugin * handle, KeySet * returned, Key * parentKey)</div>
<div class="line">{</div>
<div class="line">        ElektraPluginProcess * pp = <a class="code" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a> (handle);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a> (pp)) <span class="keywordflow">return</span> <a class="code" href="pluginprocess_8c.html#afb351eb50b21c443b1e8bc67a75eee47">elektraPluginProcessSend</a> (pp, ELEKTRA_PLUGINPROCESS_SET, returned, parentKey);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// actual plugin functionality to be executed in a child process</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="kdbplugin_8h.html#a7ae271ada880a1447179094ce6f66821">ELEKTRA_PLUGIN_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="ttc" id="apluginprocess_8c_html_afb351eb50b21c443b1e8bc67a75eee47"><div class="ttname"><a href="pluginprocess_8c.html#afb351eb50b21c443b1e8bc67a75eee47">elektraPluginProcessSend</a></div><div class="ttdeci">int elektraPluginProcessSend(const ElektraPluginProcess *pp, pluginprocess_t command, KeySet *originalKeySet, Key *key)</div><div class="ttdoc">Call a plugin's function in a child process.</div><div class="ttdef"><b>Definition:</b> pluginprocess.c:262</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pp</td><td>the data structure containing the plugin's process information </td></tr>
    <tr><td class="paramname">command</td><td>the plugin command that should be executed, e.g. ELEKTRA_PLUGINPROCESS_GET </td></tr>
    <tr><td class="paramname">originalKeySet</td><td>the original key set that the parent process receives </td></tr>
    <tr><td class="paramname">key</td><td>the original key the parent process receives </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ELEKTRA_PLUGIN_STATUS_ERROR</td><td>if the child process communication failed </td></tr>
    <tr><td class="paramname">the</td><td>called plugin's return value otherwise </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150" title="Check if a given plugin process is the parent or the child process.">elektraPluginProcessIsParent</a> for checking if we are in the parent or child process </dd></dl>

</div>
</div>
<a id="a81c73c8722be15e96ca094e84958dbf9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81c73c8722be15e96ca094e84958dbf9">&#9670;&nbsp;</a></span>elektraPluginProcessSetData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void elektraPluginProcessSetData </td>
          <td>(</td>
          <td class="paramtype">ElektraPluginProcess *&#160;</td>
          <td class="paramname"><em>pp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store a pointer to any plugin related data that is being executed inside an own process. </p>
<p>This is required in case additional arbitrary plugin data should be stored. Pluginprocess has to be stored using elektraPluginSetData. Plugin data for the child process has to be stored using this function like </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="elektra_2plugin_8c.html#a32a70a7876542c51d153164ac5108a57">elektraPluginOpen</a> (Plugin * handle, Key * errorKey)</div>
<div class="line">{</div>
<div class="line">        ElektraPluginProcess * pp = <a class="code" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a> (handle);</div>
<div class="line">        <span class="keywordflow">if</span> (pp == NULL)</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordflow">if</span> ((pp = <a class="code" href="pluginprocess_8c.html#ac0733d8e60e00cc01ea0a1adf9c9e905">elektraPluginProcessInit</a> (errorKey)) == NULL) <span class="keywordflow">return</span> <a class="code" href="kdbplugin_8h.html#a0a5d59c7d1a2ce87a1d060c7be0261a4">ELEKTRA_PLUGIN_STATUS_ERROR</a>;</div>
<div class="line">                ArbitraryPluginData * data = <span class="comment">// initialize your plugin data</span></div>
<div class="line">                <a class="code" href="pluginprocess_8c.html#a81c73c8722be15e96ca094e84958dbf9">elektraPluginProcessSetData</a> (pp, data);</div>
<div class="line">                <a class="code" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">elektraPluginSetData</a> (handle, pp);</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a> (pp)) <a class="code" href="pluginprocess_8c.html#aa45f0e358d30fcaa11cef6b4da6c9860">elektraPluginProcessStart</a> (handle, pp);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a> (pp)) <span class="keywordflow">return</span> <a class="code" href="pluginprocess_8c.html#aabd3645799a694d6bde9ae201d536d01">elektraPluginProcessOpen</a> (pp, errorKey);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// actual plugin functionality to be executed in a child process</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="kdbplugin_8h.html#a7ae271ada880a1447179094ce6f66821">ELEKTRA_PLUGIN_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="ttc" id="apluginprocess_8c_html_a81c73c8722be15e96ca094e84958dbf9"><div class="ttname"><a href="pluginprocess_8c.html#a81c73c8722be15e96ca094e84958dbf9">elektraPluginProcessSetData</a></div><div class="ttdeci">void elektraPluginProcessSetData(ElektraPluginProcess *pp, void *data)</div><div class="ttdoc">Store a pointer to any plugin related data that is being executed inside an own process.</div><div class="ttdef"><b>Definition:</b> pluginprocess.c:644</div></div>
</div><!-- fragment --><p>Furthermore ensure to cleanup the data after the plugin is done like </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> elektraPluginClose (Plugin * handle, Key * errorKey)</div>
<div class="line">{</div>
<div class="line">        ElektraPluginProcess * pp = <a class="code" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a> (handle);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pluginprocess_8c.html#aff49312d0e6fb866b1fc78bc230e9150">elektraPluginProcessIsParent</a> (pp)) {</div>
<div class="line">                ArbitraryPluginData * data = <a class="code" href="pluginprocess_8c.html#aa9f64944a775a8ae8ad24f3590d6f6d5">elektraPluginProcessGetData</a> (pp);</div>
<div class="line">                ElektraPluginProcessCloseResult result = <a class="code" href="pluginprocess_8c.html#adeaf83dde28bceb8542f06b2fba7d8ab">elektraPluginProcessClose</a> (pp, errorKey);</div>
<div class="line">                <span class="keywordflow">if</span> (result.cleanedUp)</div>
<div class="line">                {</div>
<div class="line">                        <a class="code" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">elektraPluginSetData</a> (handle, NULL);</div>
<div class="line">                        <span class="comment">// cleanup data here, this was the last call to the plugin</span></div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">return</span> result.result;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// actual plugin functionality to be executed in a child process</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="kdbplugin_8h.html#a7ae271ada880a1447179094ce6f66821">ELEKTRA_PLUGIN_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="ttc" id="apluginprocess_8c_html_aa9f64944a775a8ae8ad24f3590d6f6d5"><div class="ttname"><a href="pluginprocess_8c.html#aa9f64944a775a8ae8ad24f3590d6f6d5">elektraPluginProcessGetData</a></div><div class="ttdeci">void * elektraPluginProcessGetData(const ElektraPluginProcess *pp)</div><div class="ttdoc">Get a pointer to any plugin related data stored before.</div><div class="ttdef"><b>Definition:</b> pluginprocess.c:656</div></div>
</div><!-- fragment --><p>This way you can use elektraPluginProcessGetData (handle) in your child process to get the data you want your plugin to work with.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pp</td><td>the data structure containing the plugin's process information </td></tr>
    <tr><td class="paramname">data</td><td>the pointer to the data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa45f0e358d30fcaa11cef6b4da6c9860"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa45f0e358d30fcaa11cef6b4da6c9860">&#9670;&nbsp;</a></span>elektraPluginProcessStart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void elektraPluginProcessStart </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ElektraPluginProcess *&#160;</td>
          <td class="paramname"><em>pp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start the child process' command loop. </p>
<p>This will make the child process wait for plugin commands and execute them, returning the result to the parent. This is typically called in a plugin's open function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>the plugin's handle </td></tr>
    <tr><td class="paramname">pp</td><td>the data structure containing the plugin's process information </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="pluginprocess_8c.html#ac0733d8e60e00cc01ea0a1adf9c9e905" title="Initialize a plugin to be executed in its own process.">elektraPluginProcessInit</a> how to use this function in a <a class="el" href="group__plugin.html" title="Elektra plugin framework.">Plugins</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

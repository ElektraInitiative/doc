<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Notification Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Notification Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_tutorials_notifications"></a> </p>
<h1><a class="anchor" id="autotoc_md3666"></a>
Preface</h1>
<p><b>The features described in this document are experimental.</b></p>
<p>This document explains how notifications are implemented in Elektra and how they can be used by application developers.</p>
<h1><a class="anchor" id="autotoc_md3667"></a>
Notifications - Overview &amp; Concept</h1>
<p>Elektra's notification feature consists of several components. While sending and receiving notifications is implemented by plugins, applications use the notification API in order to use different plugins.</p>
<p>The <a href="https://doc.libelektra.org/api/latest/html/group__kdbnotification.html">notification API</a> implemented by the <code>elektra-notification</code> library allows receiving and handling notifications. An <a href="https://doc.libelektra.org/api/latest/html/group__kdbio.html">I/O abstraction layer</a> allows asynchronous notification processing by compatible plugins. The abstraction layer consists of an <em>interface</em> used by transport plugins and different implementations of that interface called <em>I/O bindings</em>. An I/O binding implements the actual I/O management functions for a specific event loop API. Applications typically use one I/O binding but can also use none or multiple I/O bindings. For more on I/O bindings see the <a href="https://doc.libelektra.org/api/latest/html/group__kdbio.html">API documenation</a>.</p>
<p>Transport plugins exchange notifications via different protocols like D-Bus or ZeroMQ. For each type of transport there are typically two types of plugins: One for sending and one for receiving notifications. Developers do not interact with those plugins directly. The underlying transports are transparent to them. The "internalnotification" plugin implements notification handling functions and feeds back configuration changes from within the application. It is only used internally by the <code>elektra-notification</code> library.</p>
<p><img src="../images/notifications.svg" alt="Overview" style="pointer-events: none;" class="inline"/></p>
<p>When a configuration key is changed Elektra can generate change notifications that allow applications to process those changes. Developers can choose whether and how they want to receive and handle those notifications but not whether notifications are sent or which transport is used. How notifications are sent is specified in the <em>notification configuration</em> by the system operator.</p>
<h1><a class="anchor" id="autotoc_md3668"></a>
Notification Configuration</h1>
<p>System operators can mount the desired transport plugins and configure them (e.g. set channel, host, port and credentials) globally.</p>
<p>They need to mount both sending and receiving plugins in order to use a transport.</p>
<div class="fragment"><div class="line">kdb global-mount dbus announce=once dbusrecv</div>
</div><!-- fragment --><p>Plugins usable as transport plugin are marked with <code>notification</code> on the <a href="https://www.libelektra.org/plugins/readme#notification-and-logging">plugin page</a>.</p>
<h1><a class="anchor" id="autotoc_md3669"></a>
How to integrate an I/O binding and send notifications asynchronously</h1>
<p>Developers do not need to change their programs in order to start sending notifications. However without the integration of an I/O binding notifications <em>may</em> be sent synchronously which would block normal program execution. For programs without time constraints (e.g. CLI programs) this may not be important, but for GUIs or network services this will have negative impact.</p>
<p>The "zeromqsend" and "dbus" plugins do not block program execution for sending as sending is handled asynchronously be the underlying libraries.</p>
<p>The following is a basic example of an application using Elektra extended by the initialization of an I/O binding.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;elektra/kdb.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;elektra/kdbio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;elektra/kdbio/uv.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="uv_8h.html">uv.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// Create libuv event loop</span></div>
<div class="line">        uv_loop_t * loop = uv_default_loop ();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Initialize I/O binding tied to event loop</span></div>
<div class="line">        <a class="code" href="kdbio_8h.html#aabcd87b8c09d4d4c1033fc1baa417391">ElektraIoInterface</a> * binding = <a class="code" href="uv_8h.html#a45e8a50dca7d8097bc2c38c54b49958b">elektraIoUvNew</a> (loop);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Create contract that tells Elektra to use the I/O binding</span></div>
<div class="line">        KeySet * contract = <a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a> (0, <a class="code" href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a>);</div>
<div class="line">        <a class="code" href="io_8c.html#ada55d27e2530c2b98f10956fe40bbcbc">elektraIoContract</a> (contract, binding);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Open KDB (with contract)</span></div>
<div class="line">        Key * key = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;/sw/myorg/myapp/#0/current&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">        KDB * <a class="code" href="namespacekdb.html">kdb</a> = <a class="code" href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5">kdbOpen</a> (contract, key);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Normal application setup code ...</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Start the event loop</span></div>
<div class="line">        uv_run (loop, UV_RUN_DEFAULT);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Cleanup</span></div>
<div class="line">        <a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a> (contract);</div>
<div class="line">        <a class="code" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a> (<a class="code" href="namespacekdb.html">kdb</a>, key);</div>
<div class="line">        <a class="code" href="io_8c.html#a062e9d7d5305201dfe5ba437f3f03224">elektraIoBindingCleanup</a> (binding);</div>
<div class="line">        uv_loop_close (loop);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__kdb_html_ga844e1299a84c3fbf1d3a905c5c893ba5"><div class="ttname"><a href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5">kdbOpen</a></div><div class="ttdeci">KDB * kdbOpen(const KeySet *contract, Key *errorKey)</div><div class="ttdoc">Opens the session with the Key database.</div><div class="ttdef"><b>Definition:</b> kdb.c:417</div></div>
<div class="ttc" id="agroup__kdb_html_gadb54dc9fda17ee07deb9444df745c96f"><div class="ttname"><a href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a></div><div class="ttdeci">int kdbClose(KDB *handle, Key *errorKey)</div><div class="ttdoc">Closes the session with the Key database.</div><div class="ttdef"><b>Definition:</b> kdb.c:590</div></div>
<div class="ttc" id="agroup__key_html_gad23c65b44bf48d773759e1f9a4d43b89"><div class="ttname"><a href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a></div><div class="ttdeci">Key * keyNew(const char *name,...)</div><div class="ttdoc">A practical way to fully create a Key object in one step.</div><div class="ttdef"><b>Definition:</b> key.c:141</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a></div><div class="ttdeci">@ KEY_END</div><div class="ttdef"><b>Definition:</b> kdbenum.c:97</div></div>
<div class="ttc" id="agroup__keyset_html_ga27e5c16473b02a422238c8d970db7ac8"><div class="ttname"><a href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a></div><div class="ttdeci">int ksDel(KeySet *ks)</div><div class="ttdoc">A destructor for KeySet objects.</div><div class="ttdef"><b>Definition:</b> keyset.c:451</div></div>
<div class="ttc" id="agroup__keyset_html_ga671e1aaee3ae9dc13b4834a4ddbd2c3c"><div class="ttname"><a href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a></div><div class="ttdeci">KeySet * ksNew(size_t alloc,...)</div><div class="ttdoc">Allocate, initialize and return a new KeySet object.</div><div class="ttdef"><b>Definition:</b> keyset.c:229</div></div>
<div class="ttc" id="agroup__keyset_html_ga7a28fce3773b2c873c94ac80b8b4cd54"><div class="ttname"><a href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a></div><div class="ttdeci">#define KS_END</div><div class="ttdoc">End of a list of keys.</div><div class="ttdef"><b>Definition:</b> kdbenum.c:158</div></div>
<div class="ttc" id="aio_8c_html_a062e9d7d5305201dfe5ba437f3f03224"><div class="ttname"><a href="io_8c.html#a062e9d7d5305201dfe5ba437f3f03224">elektraIoBindingCleanup</a></div><div class="ttdeci">int elektraIoBindingCleanup(ElektraIoInterface *binding)</div><div class="ttdoc">Free memory used by I/O binding.</div><div class="ttdef"><b>Definition:</b> io.c:274</div></div>
<div class="ttc" id="aio_8c_html_ada55d27e2530c2b98f10956fe40bbcbc"><div class="ttname"><a href="io_8c.html#ada55d27e2530c2b98f10956fe40bbcbc">elektraIoContract</a></div><div class="ttdeci">int elektraIoContract(KeySet *contract, ElektraIoInterface *ioBinding)</div><div class="ttdoc">Creates a contract for use with kdbOpen() that sets up an I/O binding.</div><div class="ttdef"><b>Definition:</b> io.c:20</div></div>
<div class="ttc" id="akdbio_8h_html_aabcd87b8c09d4d4c1033fc1baa417391"><div class="ttname"><a href="kdbio_8h.html#aabcd87b8c09d4d4c1033fc1baa417391">ElektraIoInterface</a></div><div class="ttdeci">struct _ElektraIoInterface ElektraIoInterface</div><div class="ttdoc">I/O binding handle.</div><div class="ttdef"><b>Definition:</b> kdbio.h:22</div></div>
<div class="ttc" id="anamespacekdb_html"><div class="ttname"><a href="namespacekdb.html">kdb</a></div><div class="ttdoc">This is the main namespace for the C++ binding and libraries.</div><div class="ttdef"><b>Definition:</b> backend.hpp:31</div></div>
<div class="ttc" id="atestio__doc_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdoc">[kdbio testsuite main]</div><div class="ttdef"><b>Definition:</b> testio_doc.c:48</div></div>
<div class="ttc" id="auv_8h_html"><div class="ttname"><a href="uv_8h.html">uv.h</a></div><div class="ttdoc">Declarations for the uv I/O binding.</div></div>
<div class="ttc" id="auv_8h_html_a45e8a50dca7d8097bc2c38c54b49958b"><div class="ttname"><a href="uv_8h.html#a45e8a50dca7d8097bc2c38c54b49958b">elektraIoUvNew</a></div><div class="ttdeci">ElektraIoInterface * elektraIoUvNew(uv_loop_t *loop)</div><div class="ttdoc">Create and initialize a new I/O binding.</div></div>
</div><!-- fragment --><p>Make sure to compile/link with <code>pkg-config --libs --cflags elektra-io-uv</code>.</p>
<h1><a class="anchor" id="autotoc_md3670"></a>
How to receive notifications</h1>
<p>Since many different I/O management libraries exist (e.g. libuv, glib or libev) the transport plugins use the I/O interface for their I/O operations. Each I/O management library needs its own I/O binding. Developers can also create their own I/O binding for the I/O management library of their choice. This is described in the last section.</p>
<p>Each I/O binding has its own initialization function that creates a new I/O binding and connects it to the I/O management library. For this tutorial we will assume that libuv 1.x is used. For details on how to use a specific binding please look at available I/O bindings on the <a href="https://www.libelektra.org/bindings/readme">bindings page</a>.</p>
<p>In order to handle change notifications a developer can either register a variable or a callback.</p>
<h2><a class="anchor" id="autotoc_md3671"></a>
Register a variable</h2>
<p>Values of registered variables are automatically updated when the value of the assigned key has changed. In the following example we will register an integer variable.</p>
<p>The following examples are shortened for tangibility. The complete code is available in <a href="https://www.libelektra.org/examples/notificationasync">"notificationAsync" example</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;elektra/kdb.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;elektra/kdbio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;elektra/kdbio/uv.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;elektra/kdbnotification.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="uv_8h.html">uv.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> printVariable (<a class="code" href="kdbio_8h.html#a09c40c890207a8244fc39bb930fee1fa">ElektraIoTimerOperation</a> * timerOp)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> value = *(<span class="keywordtype">int</span> *) <a class="code" href="io_8c.html#aa5e164c1d42f58d27babd0f55c1a68a0">elektraIoTimerGetData</a> (timerOp);</div>
<div class="line">        printf (<span class="stringliteral">&quot;\nMy integer value is %d\n&quot;</span>, value);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// Create libuv event loop</span></div>
<div class="line">        uv_loop_t * loop = uv_default_loop ();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Initialize I/O binding tied to event loop</span></div>
<div class="line">        <a class="code" href="kdbio_8h.html#aabcd87b8c09d4d4c1033fc1baa417391">ElektraIoInterface</a> * binding = <a class="code" href="uv_8h.html#a45e8a50dca7d8097bc2c38c54b49958b">elektraIoUvNew</a> (loop);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Create contract that tells Elektra to use the I/O binding</span></div>
<div class="line">        KeySet * contract = <a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a> (0, <a class="code" href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a>);</div>
<div class="line">        <a class="code" href="io_8c.html#ada55d27e2530c2b98f10956fe40bbcbc">elektraIoContract</a> (contract, binding);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Add notifications to the contract</span></div>
<div class="line">        <a class="code" href="notification_8c.html#ad9290f444f315d3eac3f7cfdaf4efcda">elektraNotificationContract</a> (contract);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Open KDB</span></div>
<div class="line">        Key * key = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;/sw/myorg/myapp/#0/current&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">        KDB * <a class="code" href="namespacekdb.html">kdb</a> = <a class="code" href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5">kdbOpen</a> (contract, key);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Register &quot;value&quot; for updates</span></div>
<div class="line">        Key * registeredKey = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;/sw/myorg/myapp/#0/current/value&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">        <span class="keywordtype">int</span> value;</div>
<div class="line">        <a class="code" href="group__kdbnotification.html#ga362d557489c4199f6c765480a8a3cade">elektraNotificationRegisterInt</a> (<a class="code" href="namespacekdb.html">kdb</a>, registeredKey, &amp;value);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Create a timer to repeatedly print &quot;value&quot;</span></div>
<div class="line">        <a class="code" href="kdbio_8h.html#a09c40c890207a8244fc39bb930fee1fa">ElektraIoTimerOperation</a> * timer = <a class="code" href="io_8c.html#a67a0a81d263e0a7853809144c4ea5198">elektraIoNewTimerOperation</a> (2000, 1, printVariable, &amp;value);</div>
<div class="line">        <a class="code" href="io_8c.html#a1d61dca5ec35900c33224d82711c0bdb">elektraIoBindingAddTimer</a> (binding, timer);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get configuration</span></div>
<div class="line">        KeySet * config = <a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a>(0, <a class="code" href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a>);</div>
<div class="line">        <a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1">kdbGet</a> (<a class="code" href="namespacekdb.html">kdb</a>, config, key);</div>
<div class="line">        printVariable (timer);   <span class="comment">// &quot;value&quot; was automatically updated</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Start the event loop</span></div>
<div class="line">        uv_run (loop, UV_RUN_DEFAULT);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Cleanup</span></div>
<div class="line">        <a class="code" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a> (<a class="code" href="namespacekdb.html">kdb</a>, key);</div>
<div class="line">        <a class="code" href="io_8c.html#aeab10975f6a3f62b6697449b6024c2bd">elektraIoBindingRemoveTimer</a> (timer);</div>
<div class="line">        <a class="code" href="io_8c.html#a062e9d7d5305201dfe5ba437f3f03224">elektraIoBindingCleanup</a> (binding);</div>
<div class="line">        uv_loop_close (loop);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__kdb_html_ga28e385fd9cb7ccfe0b2f1ed2f62453a1"><div class="ttname"><a href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1">kdbGet</a></div><div class="ttdeci">int kdbGet(KDB *handle, KeySet *ks, Key *parentKey)</div><div class="ttdoc">Retrieve Keys from a Key database in an atomic and universal way.</div><div class="ttdef"><b>Definition:</b> kdb.c:1191</div></div>
<div class="ttc" id="agroup__kdbnotification_html_ga362d557489c4199f6c765480a8a3cade"><div class="ttname"><a href="group__kdbnotification.html#ga362d557489c4199f6c765480a8a3cade">elektraNotificationRegisterInt</a></div><div class="ttdeci">int elektraNotificationRegisterInt(KDB *kdb, Key *key, int *variable)</div><div class="ttdoc">Subscribe for automatic updates to a given variable when the given key value is changed.</div></div>
<div class="ttc" id="aio_8c_html_a1d61dca5ec35900c33224d82711c0bdb"><div class="ttname"><a href="io_8c.html#a1d61dca5ec35900c33224d82711c0bdb">elektraIoBindingAddTimer</a></div><div class="ttdeci">int elektraIoBindingAddTimer(ElektraIoInterface *binding, ElektraIoTimerOperation *timerOp)</div><div class="ttdoc">Add timer to I/O binding.</div><div class="ttdef"><b>Definition:</b> io.c:172</div></div>
<div class="ttc" id="aio_8c_html_a67a0a81d263e0a7853809144c4ea5198"><div class="ttname"><a href="io_8c.html#a67a0a81d263e0a7853809144c4ea5198">elektraIoNewTimerOperation</a></div><div class="ttdeci">ElektraIoTimerOperation * elektraIoNewTimerOperation(unsigned int interval, int enabled, ElektraIoTimerCallback callback, void *privateData)</div><div class="ttdoc">Create a new timer operation.</div><div class="ttdef"><b>Definition:</b> io.c:338</div></div>
<div class="ttc" id="aio_8c_html_aa5e164c1d42f58d27babd0f55c1a68a0"><div class="ttname"><a href="io_8c.html#aa5e164c1d42f58d27babd0f55c1a68a0">elektraIoTimerGetData</a></div><div class="ttdeci">void * elektraIoTimerGetData(ElektraIoTimerOperation *timerOp)</div><div class="ttdoc">Get private data from operation.</div><div class="ttdef"><b>Definition:</b> io.c:580</div></div>
<div class="ttc" id="aio_8c_html_aeab10975f6a3f62b6697449b6024c2bd"><div class="ttname"><a href="io_8c.html#aeab10975f6a3f62b6697449b6024c2bd">elektraIoBindingRemoveTimer</a></div><div class="ttdeci">int elektraIoBindingRemoveTimer(ElektraIoTimerOperation *timerOp)</div><div class="ttdoc">Remove timer from I/O binding.</div><div class="ttdef"><b>Definition:</b> io.c:208</div></div>
<div class="ttc" id="akdbio_8h_html_a09c40c890207a8244fc39bb930fee1fa"><div class="ttname"><a href="kdbio_8h.html#a09c40c890207a8244fc39bb930fee1fa">ElektraIoTimerOperation</a></div><div class="ttdeci">struct _ElektraIoTimerOperation ElektraIoTimerOperation</div><div class="ttdoc">timer operation handle</div><div class="ttdef"><b>Definition:</b> kdbio.h:28</div></div>
<div class="ttc" id="anotification_8c_html_ad9290f444f315d3eac3f7cfdaf4efcda"><div class="ttname"><a href="notification_8c.html#ad9290f444f315d3eac3f7cfdaf4efcda">elektraNotificationContract</a></div><div class="ttdeci">int elektraNotificationContract(KeySet *contract)</div><div class="ttdoc">Creates a contract for use with kdbOpen() that sets up notifications.</div><div class="ttdef"><b>Definition:</b> notification.c:34</div></div>
</div><!-- fragment --><p>After calling <code><a class="el" href="group__kdbnotification.html#ga362d557489c4199f6c765480a8a3cade" title="Subscribe for automatic updates to a given variable when the given key value is changed.">elektraNotificationRegisterInt()</a></code> the variable <code>value</code> will be automatically updated if the key in the program above is changed by another program (e.g. by using the <code>kdb</code> CLI command). For automatic updates to work transport plugins have to be mounted globally.</p>
<h2><a class="anchor" id="autotoc_md3672"></a>
Callbacks</h2>
<p>Registering a variable is suitable for programs where the key's value is simply displayed or used repeatedly (e.g. by a timer or in a loop). If an initialization code needs to be redone after configuration changes (e.g. a value sets the number of worker threads) updating a registered variable will not suffice. For these situations a callback should be used.</p>
<p>The following snippet shows how a callback can be used if the value of the changed key needs further processing.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// from https://en.wikipedia.org/wiki/ANSI_escape_code#Colors</span></div>
<div class="line"><span class="preprocessor">#define ANSI_COLOR_RED                  &quot;\x1b[31m&quot;</span></div>
<div class="line"><span class="preprocessor">#define ANSI_COLOR_GREEN                &quot;\x1b[32m&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setTerminalColor (Key * color, <span class="keywordtype">void</span> * context ELEKTRA_UNUSED)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// context contains whatever was passed as 4th parameter</span></div>
<div class="line">        <span class="comment">// to elektraNotificationRegisterCallback()</span></div>
<div class="line">        <span class="keywordtype">char</span> * value = <a class="code" href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05">keyString</a> (color);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (strcmp (value, <span class="stringliteral">&quot;red&quot;</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">                printf (ANSI_COLOR_RED);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (strcmp (value, <span class="stringliteral">&quot;green&quot;</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">                printf (ANSI_COLOR_GREEN);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="testio__doc_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        KDB * repo;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// ... initialization of KDB, I/O binding and notifications</span></div>
<div class="line"> </div>
<div class="line">        Key * color = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;/sw/myorg/myapp/#0/current/color&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Re-Initialize on key changes</span></div>
<div class="line">        <a class="code" href="group__kdbnotification.html#gab42738703162b3769b1336dcade47b18">elektraNotificationRegisterCallback</a>(repo, color, &amp;setTerminalColor, NULL);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// ... start loop, etc.</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__kdbnotification_html_gab42738703162b3769b1336dcade47b18"><div class="ttname"><a href="group__kdbnotification.html#gab42738703162b3769b1336dcade47b18">elektraNotificationRegisterCallback</a></div><div class="ttdeci">int elektraNotificationRegisterCallback(KDB *kdb, Key *key, ElektraNotificationChangeCallback callback, void *context)</div><div class="ttdoc">Subscribe for updates via callback when a given key value is changed.</div><div class="ttdef"><b>Definition:</b> notification.c:96</div></div>
<div class="ttc" id="agroup__keyvalue_html_ga880936f2481d28e6e2acbe7486a21d05"><div class="ttname"><a href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05">keyString</a></div><div class="ttdeci">const char * keyString(const Key *key)</div><div class="ttdoc">Get a pointer to the c-string representing the value.</div><div class="ttdef"><b>Definition:</b> keyvalue.c:206</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3673"></a>
How-To: Reload KDB when Elektra's configuration has changed</h2>
<p>This section shows how the notification feature is used to reload an application's KDB instance when Elektra's configuration has changed. This enables applications to apply changes to mount points or globally mounted plugins without restarting.</p>
<p><b>Step 1: Register for changes to Elektra's configuration</b></p>
<p>To achieve reloading on Elektra configuration changes we register for changes below the key <code>/elektra</code> using <code><a class="el" href="group__kdbnotification.html#ga374edd4f4fff527d6511ce4d0df62681" title="Subscribe for updates via callback when a given key or a key below changed.">elektraNotificationRegisterCallbackSameOrBelow()</a></code>.</p>
<div class="fragment"><div class="line">Key * elektraKey = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;/elektra&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line"><a class="code" href="group__kdbnotification.html#ga374edd4f4fff527d6511ce4d0df62681">elektraNotificationRegisterCallbackSameOrBelow</a> (<a class="code" href="namespacekdb.html">kdb</a>, elektraKey, elektraChangedCallback, NULL))</div>
<div class="line"><a class="code" href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a> (elektraKey);</div>
<div class="ttc" id="agroup__kdbnotification_html_ga374edd4f4fff527d6511ce4d0df62681"><div class="ttname"><a href="group__kdbnotification.html#ga374edd4f4fff527d6511ce4d0df62681">elektraNotificationRegisterCallbackSameOrBelow</a></div><div class="ttdeci">int elektraNotificationRegisterCallbackSameOrBelow(KDB *kdb, Key *key, ElektraNotificationChangeCallback callback, void *context)</div><div class="ttdoc">Subscribe for updates via callback when a given key or a key below changed.</div><div class="ttdef"><b>Definition:</b> notification.c:123</div></div>
<div class="ttc" id="agroup__key_html_ga3df95bbc2494e3e6703ece5639be5bb1"><div class="ttname"><a href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a></div><div class="ttdeci">int keyDel(Key *key)</div><div class="ttdoc">A destructor for Key objects.</div><div class="ttdef"><b>Definition:</b> key.c:500</div></div>
</div><!-- fragment --><p><b>Step 2: Create a function for reloading KDB</b></p>
<p>Since our application needs to repeatedly initialize KDB on configuration changes we need to create a function which cleans up and reinitializes KDB.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> initKdb (<a class="code" href="kdbio_8h.html#a09c40c890207a8244fc39bb930fee1fa">ElektraIoTimerOperation</a> * timerOp ELEKTRA_UNUSED)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="namespacekdb.html">kdb</a> != NULL)</div>
<div class="line">        {</div>
<div class="line">                <span class="comment">// Cleanup and close KDB</span></div>
<div class="line">                <a class="code" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a> (<a class="code" href="namespacekdb.html">kdb</a>, parentKey);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        KeySet * contract = <a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a> (0, <a class="code" href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a>);</div>
<div class="line">        <a class="code" href="io_8c.html#ada55d27e2530c2b98f10956fe40bbcbc">elektraIoContract</a> (contract, binding);</div>
<div class="line">        <a class="code" href="notification_8c.html#ad9290f444f315d3eac3f7cfdaf4efcda">elektraNotificationContract</a> (contract);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespacekdb.html">kdb</a> = <a class="code" href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5">kdbOpen</a> (parentKey);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Code for registration from snippet before</span></div>
<div class="line">        Key * elektraKey = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;/elektra&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">        <a class="code" href="group__kdbnotification.html#ga374edd4f4fff527d6511ce4d0df62681">elektraNotificationRegisterCallbackSameOrBelow</a> (<a class="code" href="namespacekdb.html">kdb</a>, elektraKey, elektraChangedCallback, NULL);</div>
<div class="line">        <a class="code" href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a> (elektraKey);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// TODO: add application specific registrations</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get configuration</span></div>
<div class="line">        <a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1">kdbGet</a> (<a class="code" href="namespacekdb.html">kdb</a>, config, parentKey);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Step 3: Handle configuration changes</b></p>
<p>The last step is to connect the registration for changes to the (re-)initialization function. Directly calling the function is discouraged due to tight coupling (see guidelines in the next section) and also results in an application crash since the notification API is closed while processing notification callbacks. Therefore we suggest to add a timer operation with a sufficiently small interval which is enabled only on configuration changes. This timer will then call the initialization function.</p>
<p>First, we create the timer in the main loop setup of the application.</p>
<div class="fragment"><div class="line"><span class="comment">// (global declaration)</span></div>
<div class="line"><a class="code" href="kdbio_8h.html#a09c40c890207a8244fc39bb930fee1fa">ElektraIoTimerOperation</a> * reload;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// main loop setup (e.g. main())</span></div>
<div class="line"><span class="comment">// the timer operation is disabled for now and</span></div>
<div class="line"><span class="comment">// will reload KDB after 100 milliseconds</span></div>
<div class="line">reload = <a class="code" href="io_8c.html#a67a0a81d263e0a7853809144c4ea5198">elektraIoNewTimerOperation</a> (100, 0, initKdb, NULL);</div>
<div class="line"><a class="code" href="io_8c.html#a1d61dca5ec35900c33224d82711c0bdb">elektraIoBindingAddTimer</a> (binding, reload);</div>
</div><!-- fragment --><p>Now we add the callback function for the registration from step 1:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> elektraChangedCallback (Key * changedKey, <span class="keywordtype">void</span> * context)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// Enable operation to reload KDB as soon as possible</span></div>
<div class="line">        <a class="code" href="io_8c.html#a301cebc4da212bdb3aac0ad84f70ad85">elektraIoTimerSetEnabled</a> (reload, 1);</div>
<div class="line">        <a class="code" href="io_8c.html#add5679a2ff842d88435938d629497e27">elektraIoBindingUpdateTimer</a> (reload);</div>
<div class="line">}</div>
<div class="ttc" id="aio_8c_html_a301cebc4da212bdb3aac0ad84f70ad85"><div class="ttname"><a href="io_8c.html#a301cebc4da212bdb3aac0ad84f70ad85">elektraIoTimerSetEnabled</a></div><div class="ttdeci">int elektraIoTimerSetEnabled(ElektraIoTimerOperation *timerOp, int enabled)</div><div class="ttdoc">Enable or disable timer operation.</div><div class="ttdef"><b>Definition:</b> io.c:417</div></div>
<div class="ttc" id="aio_8c_html_add5679a2ff842d88435938d629497e27"><div class="ttname"><a href="io_8c.html#add5679a2ff842d88435938d629497e27">elektraIoBindingUpdateTimer</a></div><div class="ttdeci">int elektraIoBindingUpdateTimer(ElektraIoTimerOperation *timerOp)</div><div class="ttdoc">Notifiy I/O binding about changes to timer structure.</div><div class="ttdef"><b>Definition:</b> io.c:198</div></div>
</div><!-- fragment --><p>Finally we disable the timer in the initialization function:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> initKdb (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// Stop reload task</span></div>
<div class="line">        <a class="code" href="io_8c.html#a301cebc4da212bdb3aac0ad84f70ad85">elektraIoTimerSetEnabled</a> (reload, 0);</div>
<div class="line">        <a class="code" href="io_8c.html#add5679a2ff842d88435938d629497e27">elektraIoBindingUpdateTimer</a> (reload);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="namespacekdb.html">kdb</a> != NULL)</div>
<div class="line">        {</div>
<div class="line">                <span class="comment">// Cleanup notifications and close KDB</span></div>
<div class="line">                <a class="code" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a> (<a class="code" href="namespacekdb.html">kdb</a>, parentKey);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>By correct application of these three steps any application can react to changes to Elektra's configuration. The snippets above omit error handling for brevity. The complete code including error handling is available in the <a href="https://www.libelektra.org/examples/notificationreload">"notification reload" example</a>. This example also omits globals by passing them as user data using the <code>elektraIo*GetData()</code> functions.</p>
<h1><a class="anchor" id="autotoc_md3674"></a>
Emergent Behavior Guidelines</h1>
<p>When applications react to configuration changes made by other applications this can lead to <em>emergent behavior</em>. We speak of emergent behavior when the parts of a system are functioning as designed but an unintended, unexpected or unanticipated behavior at system level occurs.</p>
<p>For example, take the following sequence of events:</p>
<ol type="1">
<li>application <code>A</code> changes its configuration</li>
<li>application <code>B</code> receives a notification about the change from <code>A</code> and updates its configuration</li>
</ol>
<p>Given these two steps the sequence could be a case of <em>wanted</em> emergent behavior: Maybe application <code>B</code> keeps track of the number of global configuration changes. Now consider adding the following events to the sequence:</p>
<ol type="1">
<li>application <code>A</code> receives a notification about the change from <code>B</code> and changes its configuration</li>
<li><em>continue at step 2</em></li>
</ol>
<p>The additional step causes an infinite cycle of configuration updates which introduces <em>unwanted</em> behavior.</p>
<p>When designing a system it is desirable to use components with predictable and well-defined behavior. As a system grows larger and gets more <em>complex</em> unpredictable behavior emerges that was neither intended by the system designer nor by the designer of the components. This system behavior is called <em>emergent behavior</em> if it cannot be explained from its components but only from analysis of the whole system.</p>
<p>Emergent behavior can be beneficial for a system, for example, useful cooperation in an ant colony but it also has disadvantages. Systems that bear <em>unwanted</em> emergent behavior are difficult to manage and experience failures in the worst case. This kind of unwanted emergent behavior is called <a href="https://dl.acm.org/doi/10.1145/1217935.1217964"><em>emergent misbehavior</em></a>. Examples of emergent misbehavior are traffic jams or the <a href="https://researchcourse.pbworks.com/f/structural+engineering.pdf">Millenium Footbridge</a> <a href="https://www.sciencedaily.com/releases/2005/11/051103080801.htm">incident in London</a>.</p>
<p>An evaluation of Elektra's notification feature shows that it can exhibit the following symptoms:</p>
<ul>
<li><b>Synchronization</b> occurs due to the shared notification medium. Multiple applications receive a notification at the same time and execute their configuration update logic. In turn shared resources like hard disk or CPU become overutilized.</li>
<li><b>Oscillation</b> occurs when applications are reacting to configuration changes by other applications.</li>
<li>In the worst case oscillation results in <b>livelock</b> when the frequency of configuration updates becomes so high that applications are only executing configuration update logic.</li>
<li><b>Phase change</b> is a sudden change of the system behavior in reaction to a minor change (e.g. incremental change of a configuration setting). Phase change is introduced by application logic.</li>
</ul>
<p>Building on these findings we will now present guidelines for preventing emergent misbehavior when using the notification API and callbacks in particular.</p>
<h2><a class="anchor" id="autotoc_md3675"></a>
Guideline 1: Avoid callbacks</h2>
<blockquote class="doxtable">
<p>Most of the guidelines are related to callbacks. With normal use of the notification API emergent behavior should not occur. </p>
</blockquote>
<p>Callbacks couple an application temporally to configuration changes of other applications or instances of the same application. This observation is the basis for <a href="#guideline-1-avoid-callbacks">Guidelines 1</a>, <a href="#guideline-2-wait-before-reacting-to-changes">2</a> and <a href="#guideline-3-avoid-updates-as-reaction-to-change">3</a>. While it is possible with registered variables to check for configuration changes at regular time intervals and react to changes the coupling is not as tight as with callbacks.</p>
<h2><a class="anchor" id="autotoc_md3676"></a>
Guideline 2: Wait before reacting to changes</h2>
<blockquote class="doxtable">
<p>Waiting after receiving a notification decouples an application from changes and reduces the risk for unwanted **_synchronization_**. </p>
</blockquote>
<p>In applications where applying changes has impact on resource usage (e.g. CPU or disk) applying a time delay as suggested by this Guideline is a sensible choice. But this guideline is not only limited to these applications.</p>
<p>Generally waiting before reacting to changes reduces the risk for unwanted synchronization by decoupling the application temporally. Waiting can be implemented using random time delays which further promotes decoupling since applications react at different points in time to changes. Waiting can also be implemented using a flag: Callbacks set the flag and when the control flow is in the main loop again, the pending updates are applied and the flag is cleared.</p>
<h2><a class="anchor" id="autotoc_md3677"></a>
Guideline 3: Avoid updates as reaction to change</h2>
<blockquote class="doxtable">
<p>Avoid changing the configuration as reaction to a change. This reduces the risk for unwanted **_oscillation_**. </p>
</blockquote>
<p>While this guideline does not forbid updating the key database using <code><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a></code> in a callback it advises to avoid it. If we recall the example from before we see how updating as reaction to change leads to unwanted oscillation. If necessary, the function <code><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a></code> should be temporally decoupled as suggested in <a href="#guideline-2-wait-before-reacting-to-changes">Guideline 2</a>.</p>
<p>This guideline applies especially to callbacks but is also relevant when variables are polled for changes by the application.</p>
<h2><a class="anchor" id="autotoc_md3678"></a>
Guideline 4: Do not use notifications for synchronization</h2>
<blockquote class="doxtable">
<p>Applications should not use notifications for synchronization as this can lead to **_phase change_**. </p>
</blockquote>
<p>This guideline limits the use of the notification API to notifications about configuration changes. There are better suited techiques for different use cases. Applications should not keep track of changes and change their behavior on certain conditions.</p>
<p>For example, this happens when applications synchronize themselves at startup by incrementing a counter in the key database. When a certain limit of application instances is reached the applications proceed with different behavior. If this behavior affects other applications phase change has occurred.</p>
<h2><a class="anchor" id="autotoc_md3679"></a>
Guideline 5: Apply changes immediately</h2>
<blockquote class="doxtable">
<p>Call <code><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a></code> to save updated configuration immediately after a change occurred. This reduces conflicting changes in the key database. </p>
</blockquote>
<p>When a configuration setting is updated within an application this guideline suggests to write the change immediately to the key database using <code><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a></code>. This ensures that other applications have the same view of the key database and operate on current settings.</p>
<h2><a class="anchor" id="autotoc_md3680"></a>
Guideline 6: Be careful on what to call inside callbacks</h2>
<blockquote class="doxtable">
<p>Notification callbacks are called from within Elektra. Calling <code><a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f" title="Closes the session with the Key database.">kdbClose()</a></code> in a callback will lead to undefined behavior or an application crash. </p>
</blockquote>
<p>Closing and cleaning up the KDB handle will cause an application crash because the control flow returns from the callback to now removed code. While this can be considered an implementation detail it aligns with <a href="#guidline-2-wait-before-reacting-to-changes">Guideline 2</a> since reinitialization of KDB uses more resources than other operations like <code><a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a></code> or <code><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a></code>.</p>
<h1><a class="anchor" id="autotoc_md3681"></a>
Logging</h1>
<p>In order to analyze application behavior the <a href="https://www.libelektra.org/plugins/readme#notification-and-logging">logging plugins</a> can be used with the <code>get=on</code> option when mounting:</p>
<div class="fragment"><div class="line">kdb global-mount syslog get=on</div>
</div><!-- fragment --><p>Now both reading from and writing to Elektra's key database is logged.</p>
<h1><a class="anchor" id="autotoc_md3682"></a>
How to create your own I/O Binding</h1>
<p>Developers can create their own bindings if the I/O management library of their choice is not supported by an existing I/O binding.</p>
<p>For details on see the <a class="el" href="md_src_bindings_io_doc_README.html#src_bindings_io_doc_README_md">example </a>doc" binding" or the <a href="https://doc.libelektra.org/api/latest/html/group__kdbio.html">API documentation</a>. Existing I/O bindings provide a good inspiration on how to implement a custom binding. Since a binding is generic and not application specific it is much appreciated if you contribute your I/O binding back to the Elektra Initiative.</p>
<h1><a class="anchor" id="autotoc_md3683"></a>
Logging</h1>
<p>In order to log and analyze application behavior the logging plugins <a href="https://www.libelektra.org/plugins/syslog">"syslog"</a>, <a href="https://www.libelektra.org/plugins/journald">"journald"</a> or <a href="https://www.libelektra.org/plugins/logchange">"logchange"</a> can be used. In order to log not only <code><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a></code> but also <code><a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a></code> the option <code>log/get=1</code> should be used when mounting these plugins.</p>
<p>For example:</p>
<div class="fragment"><div class="line">$ kdb global-mount syslog log/get=1</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: How-To: Logging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.10.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How-To: Logging </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_tutorials_logger"></a> </p>
<h1><a class="anchor" id="autotoc_md4466"></a>
Quickstart</h1>
<p>Enable logging by compiling with the CMake option <code>ENABLE_LOGGER=ON</code> (e.g. <code>cmake -DENABLE_LOGGER=ON</code>).</p>
<p>By default errors and warnings are logged to stderr and syslog, while notice and info message are only logged to syslog. Debug level message are not logged by default, but will be logged to syslog, if <code>ENABLE_DEBUG=ON</code> is set in CMake.</p>
<p>The file sink behaves like syslog, if it has been enabled (see below).</p>
<h1><a class="anchor" id="autotoc_md4467"></a>
Step by Step Guide</h1>
<h2><a class="anchor" id="autotoc_md4468"></a>
Preparation</h2>
<ol type="1">
<li>Import the logging library in your code:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdblogger_8h.html">kdblogger.h</a>&gt;</span></div>
<div class="ttc" id="akdblogger_8h_html"><div class="ttname"><a href="kdblogger_8h.html">kdblogger.h</a></div><div class="ttdoc">Logger Interface.</div></div>
</div><!-- fragment --><ol type="1">
<li>Insert logging statements:</li>
</ol>
<div class="fragment"><div class="line">ELEKTRA_LOG(<span class="stringliteral">&quot;Hello, %s!&quot;</span>, <span class="stringliteral">&quot;ðŸŒŽ&quot;</span>);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md4469"></a>
Log Everything</h3>
<p>If Elektra should display all log messages, then please follow the steps below.</p>
<ol type="1">
<li>Uncomment the line:</li>
</ol>
<div class="fragment"><div class="line"><span class="comment">// #define NO_FILTER</span></div>
</div><!-- fragment --><p>in the file <code><a class="el" href="log_8c.html" title="Non-C99 Logger Implementation.">src/libs/elektra/log.c</a></code>. (Alternatively you may define this macro via CMake.)</p>
<ol type="1">
<li>Optional: The logging levels are set in <code><a class="el" href="kdblogger_8h.html" title="Logger Interface.">src/include/kdblogger.h</a></code>. For example, if you want to see everything (including debug messages) on stderr, then change the line</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ELEKTRA_LOG_LEVEL_STDERR = <a class="code" href="kdblogger_8h.html#a4096a2ccd61c6f5ad60e9015fd1bbb4ba0524fff5c46e0cf07287c473c46cc8e2">ELEKTRA_LOG_LEVEL_WARNING</a>;</div>
<div class="ttc" id="akdblogger_8h_html_a4096a2ccd61c6f5ad60e9015fd1bbb4ba0524fff5c46e0cf07287c473c46cc8e2"><div class="ttname"><a href="kdblogger_8h.html#a4096a2ccd61c6f5ad60e9015fd1bbb4ba0524fff5c46e0cf07287c473c46cc8e2">ELEKTRA_LOG_LEVEL_WARNING</a></div><div class="ttdeci">@ ELEKTRA_LOG_LEVEL_WARNING</div><div class="ttdoc">something happened an end user would be interested in</div><div class="ttdef"><b>Definition:</b> kdblogger.h:35</div></div>
</div><!-- fragment --><p>to</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ELEKTRA_LOG_LEVEL_STDERR = <a class="code" href="kdblogger_8h.html#a4096a2ccd61c6f5ad60e9015fd1bbb4ba24c7a4c44a8b99b978dc99806d083386">ELEKTRA_LOG_LEVEL_DEBUG</a>;</div>
<div class="ttc" id="akdblogger_8h_html_a4096a2ccd61c6f5ad60e9015fd1bbb4ba24c7a4c44a8b99b978dc99806d083386"><div class="ttname"><a href="kdblogger_8h.html#a4096a2ccd61c6f5ad60e9015fd1bbb4ba24c7a4c44a8b99b978dc99806d083386">ELEKTRA_LOG_LEVEL_DEBUG</a></div><div class="ttdeci">@ ELEKTRA_LOG_LEVEL_DEBUG</div><div class="ttdoc">The debug log level.</div><div class="ttdef"><b>Definition:</b> kdblogger.h:65</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md4470"></a>
File Specific Logging</h3>
<p>If you want to only log messages below a specific directory prefix, then please follow the steps below.</p>
<ol type="1">
<li>Search for the code:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef NO_FILTER</span></div>
<div class="line">     <span class="comment">// XXX Filter level â€¦</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>in the file <code><a class="el" href="log_8c.html" title="Non-C99 Logger Implementation.">src/libs/elektra/log.c</a></code>.</p>
<ol type="1">
<li>Replace the code with something like:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef NO_FILTER</span></div>
<div class="line">     <span class="keywordflow">if</span> (strncmp (file, <span class="stringliteral">&quot;src/postfix/&quot;</span>, <span class="keyword">sizeof</span> (<span class="stringliteral">&quot;src/postfix&quot;</span>))) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>, where <code>src/postfix</code> contains all source files with logging statements that Elektra should log. For example, if you want to log everything from the <code>yamlcpp</code> plugin, then use the following code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef NO_FILTER</span></div>
<div class="line">     <span class="keywordflow">if</span> (strncmp (file, <span class="stringliteral">&quot;src/plugins/yamlcpp/&quot;</span>, <span class="keyword">sizeof</span> (<span class="stringliteral">&quot;src/plugins/yamlcpp&quot;</span>))) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>. To log messages from multiple source you can use the operator <code>&amp;&amp;</code> to chain multiple calls to <code>strncmp</code>. For example, to log messages from the <code>directoryvalue</code> and <code>yamlcpp</code> plugin use the code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef NO_FILTER</span></div>
<div class="line">     <span class="keywordflow">if</span> (strncmp (file, <span class="stringliteral">&quot;src/plugins/directoryvalue/&quot;</span>, <span class="keyword">sizeof</span> (<span class="stringliteral">&quot;src/plugins/directoryvalue&quot;</span>)) &amp;&amp;</div>
<div class="line">         strncmp (file, <span class="stringliteral">&quot;src/plugins/yamlcpp/&quot;</span>, <span class="keyword">sizeof</span> (<span class="stringliteral">&quot;src/plugins/yamlcpp&quot;</span>)))</div>
<div class="line">             <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4471"></a>
Enabling and Disabling Sinks</h2>
<p>The logging framework has 3 sinks: stderr, syslog and file.</p>
<p>The first to are enabled by default, while file is disabled. To enable it uncomment the line</p>
<div class="fragment"><div class="line"><span class="comment">// #define USE_FILE_SINK</span></div>
</div><!-- fragment --><p>in <code><a class="el" href="log_8c.html" title="Non-C99 Logger Implementation.">src/libs/elektra/log.c</a></code>. The file that log messages are written to is defined in this line</p>
<div class="fragment"><div class="line">elektraLoggerFileHandle = fopen (<span class="stringliteral">&quot;elektra.log&quot;</span>, <span class="stringliteral">&quot;a&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4472"></a>
Compilation</h2>
<ol type="1">
<li>Enable the logger: e.g. run <code>cmake</code> with the switch <code>-DENABLE_LOGGER=ON</code></li>
<li>Build Elektra</li>
</ol>
<h1><a class="anchor" id="autotoc_md4473"></a>
Log Levels</h1>
<p>There are four log levels (ERROR is reserved for aborts within <code>ELEKTRA_ASSERT</code>):</p>
<ul>
<li><code>ELEKTRA_LOG_WARNING</code>, something critical that should be shown to the user (e.g. API misuse), see <a class="el" href="kdblogger_8h.html#a4096a2ccd61c6f5ad60e9015fd1bbb4ba0524fff5c46e0cf07287c473c46cc8e2" title="something happened an end user would be interested in">ELEKTRA_LOG_LEVEL_WARNING</a></li>
<li><code>ELEKTRA_LOG_NOTICE</code>, something important developers are likely interested in, see <a class="el" href="kdblogger_8h.html#a4096a2ccd61c6f5ad60e9015fd1bbb4ba329fc1e04c797ab8e54a137b21f41baf" title="something important happened which usually should not">ELEKTRA_LOG_LEVEL_NOTICE</a></li>
<li><code>ELEKTRA_LOG</code>, standard level gives information what the code is doing without flooding the log, see <a class="el" href="kdblogger_8h.html#a4096a2ccd61c6f5ad60e9015fd1bbb4ba01618746c91d9d1090f599f604b9b832" title="The standard log level.">ELEKTRA_LOG_LEVEL_INFO</a></li>
<li><code>ELEKTRA_LOG_DEBUG</code>, for less important logs, see <a class="el" href="kdblogger_8h.html#a4096a2ccd61c6f5ad60e9015fd1bbb4ba24c7a4c44a8b99b978dc99806d083386" title="The debug log level.">ELEKTRA_LOG_LEVEL_DEBUG</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: directoryvalue</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: directoryvalue </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the directoryvalue plugin is in keys below</li>
<li>infos/author = René Schwaiger <a href="#" onclick="location.href='mai'+'lto:'+'san'+'ss'+'eco'+'ur'+'s@m'+'e.'+'com'; return false;">sanss<span style="display: none;">.nosp@m.</span>ecou<span style="display: none;">.nosp@m.</span>rs@me<span style="display: none;">.nosp@m.</span>.com</a></li>
<li>infos/licence = BSD</li>
<li>infos/needs =</li>
<li>infos/provides =</li>
<li>infos/recommends =</li>
<li>infos/placements = postgetstorage presetstorage</li>
<li>infos/status = unittest nodep preview</li>
<li>infos/metadata =</li>
<li>infos/description = This plugin converts directory keys to leaf keys in the set direction</li>
</ul>
<h1><a class="anchor" id="src_plugins_directoryvalue_README_md"></a>
Directory Value</h1>
<h2><a class="anchor" id="autotoc_md162"></a>
Introduction</h2>
<p>The Directory Value plugin converts</p>
<ol type="1">
<li>directory (non-leaf) keys to leaf keys in the “set” direction, and</li>
<li>converts them back to directory keys in the “get” direction.</li>
</ol>
<p>A directory key is a key that has children. For example in the key set:</p>
<div class="fragment"><div class="line">user:/grandparent                = Grandparent</div>
<div class="line">user:/grandparent/leaf           = Leaf</div>
<div class="line">user:/grandparent/parent         = Parent</div>
<div class="line">user:/grandparent/parent/child   = Child</div>
<div class="line">user:/mother                     = Mother</div>
<div class="line">user:/mother/daughter            = Daughter</div>
<div class="line">user:/mother/son                 = Son</div>
</div><!-- fragment --><p>the keys</p>
<div class="fragment"><div class="line">user:/grandparent</div>
<div class="line">user:/grandparent/parent</div>
<div class="line">user:/mother</div>
</div><!-- fragment --><p>represent directory keys, while the keys</p>
<div class="fragment"><div class="line">user:/grandparent/leaf</div>
<div class="line">user:/grandparent/parent/child</div>
<div class="line">user:/mother/daughter</div>
<div class="line">user:/mother/son</div>
</div><!-- fragment --><p>are leaf keys. You can easily check this by drawing the key set in the form of a rooted tree:</p>
<div class="fragment"><div class="line">             user</div>
<div class="line">      /               \</div>
<div class="line">  granparent        mother</div>
<div class="line">  /      |          /    \</div>
<div class="line">leaf  parent    daughter son</div>
<div class="line">         |</div>
<div class="line">       child</div>
</div><!-- fragment --><p>. The Directory Value plugin converts all directory keys to leaf keys in the “set” direction by adding new keys with the postfix <code>___dirdata</code>. Theses keys then store the old value of their parent keys</p>
<div class="fragment"><div class="line">user:/grandparent                    =</div>
<div class="line">user:/grandparent/___dirdata         = Grandparent</div>
<div class="line">user:/grandparent/leaf               = Leaf</div>
<div class="line">user:/grandparent/parent             =</div>
<div class="line">user:/grandparent/parent/___dirdata  = Parent</div>
<div class="line">user:/grandparent/parent/child       = Child</div>
<div class="line">user:/mother                         =</div>
<div class="line">user:/mother/___dirdata              = Mother</div>
<div class="line">user:/mother/daughter                = Daughter</div>
<div class="line">user:/mother/son                     = Son</div>
</div><!-- fragment --><p>. You might ask why we need the Directory Value plugin at all. The reason why we created this plugin is that some storage plugins like <a class="el" href="md_src_plugins_yajl_README.html#src_plugins_yajl_README_md">`yajl`</a> or <a class="el" href="md_src_plugins_yajl_README.html#src_plugins_yajl_README_md">`yamlcpp`</a> are only able to save values inside leaf keys. By loading the Directory Value plugin these storage plugins are also able to represent directory values properly.</p>
<h3><a class="anchor" id="autotoc_md163"></a>
Array Values</h3>
<p>The Directory value plugin also converts array values. Let us take a look at an example key set:</p>
<div class="fragment"><div class="line">user:/array    = Array Value</div>
<div class="line">user:/array/#0 = Firt Value</div>
<div class="line">user:/array/#1 = Second Value</div>
<div class="line">user:/array/#2 = Third Value</div>
</div><!-- fragment --><p>. The plugin <b>does not</b> convert this key set into:</p>
<div class="fragment"><div class="line">user:/array            =</div>
<div class="line">user:/array/___dirdata = Array Value</div>
<div class="line">user:/array/#0         = First Value</div>
<div class="line">user:/array/#1         = Second Value</div>
<div class="line">user:/array/#2         = Third Value</div>
</div><!-- fragment --><p>, since then <code>user:/array</code> <b>would not be an array</b> any more. Instead the plugin inserts a new element at index 0 with the <b>value prefix</b> <code>___dirdata:</code>:</p>
<div class="fragment"><div class="line">user:/array            =</div>
<div class="line">user:/array/#0         = ___dirdata: Array Value</div>
<div class="line">user:/array/#1         = First Value</div>
<div class="line">user:/array/#2         = Second Value</div>
<div class="line">user:/array/#3         = Third Value</div>
</div><!-- fragment --><p>. This way a storage plugin such as YAJL or YAML CPP are still able to store <code>user:/array</code> as an array.</p>
<h4><a class="anchor" id="autotoc_md164"></a>
Remarks</h4>
<ul>
<li>The plugin only converts array parents that store <b>string values</b></li>
<li>The <a class="el" href="doc_decisions_array_md.html">array metakey</a> of the array parent (increased by one) will still be stored in the original parent key after conversion. This is important, since otherwise the storage plugin would lose information about which key represents an array.</li>
</ul>
<h2><a class="anchor" id="autotoc_md165"></a>
Usage</h2>
<p>To mount the plugin use the command:</p>
<div class="fragment"><div class="line"># Mount plugin at `user:/tests/directoryvalue`</div>
<div class="line">sudo kdb mount config.file user:/tests/directoryvalue directoryvalue</div>
</div><!-- fragment --><p>. To unmount the plugin use the command</p>
<div class="fragment"><div class="line">sudo kdb umount user:/tests/directoryvalue</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md166"></a>
Example</h2>
<div class="fragment"><div class="line"># Mount plugin</div>
<div class="line">sudo kdb mount config.file user:/tests/directoryvalue directoryvalue</div>
<div class="line"> </div>
<div class="line"># Add a directory value</div>
<div class="line">kdb set user:/tests/directoryvalue/harold &#39;Father of SpongeBob SquarePants&#39;</div>
<div class="line"># Add a leaf value</div>
<div class="line">kdb set user:/tests/directoryvalue/harold/spongebob &#39;I am ready!&#39;</div>
<div class="line"> </div>
<div class="line"># Add an array</div>
<div class="line">kdb set user:/tests/directoryvalue/patrick Star</div>
<div class="line">kdb set user:/tests/directoryvalue/patrick/#0 &#39;Being grown-up is boring. Besides, I don’t get Jazz.&#39;</div>
<div class="line"># Elektra requires that the array parent contains the metakey `array`.</div>
<div class="line"># If this key is not present, then `user:/tests/directoryvalue/patrick`</div>
<div class="line"># is **not an array**.</div>
<div class="line">kdb meta-set user:/tests/directoryvalue/patrick array &#39;&#39;</div>
<div class="line"> </div>
<div class="line"># Since the plugin converts values back in the get direction</div>
<div class="line"># a user of the database will not notice any changes.</div>
<div class="line"> </div>
<div class="line">kdb ls user:/tests/directoryvalue</div>
<div class="line">#&gt; user:/tests/directoryvalue/harold</div>
<div class="line">#&gt; user:/tests/directoryvalue/harold/spongebob</div>
<div class="line">#&gt; user:/tests/directoryvalue/patrick</div>
<div class="line">#&gt; user:/tests/directoryvalue/patrick/#0</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/directoryvalue/harold</div>
<div class="line">#&gt; Father of SpongeBob SquarePants</div>
<div class="line">kdb get user:/tests/directoryvalue/harold/spongebob</div>
<div class="line">#&gt; I am ready!</div>
<div class="line"> </div>
<div class="line">kdb get user:/tests/directoryvalue/patrick</div>
<div class="line">#&gt; Star</div>
<div class="line">kdb get user:/tests/directoryvalue/patrick/#0</div>
<div class="line">#&gt; Being grown-up is boring. Besides, I don’t get Jazz.</div>
<div class="line"> </div>
<div class="line"># Retrieve index of last element in array.</div>
<div class="line"># This also works if the storage plugin does not store this index.</div>
<div class="line">kdb meta-get user:/tests/directoryvalue/patrick array</div>
<div class="line">#&gt; #0</div>
<div class="line"> </div>
<div class="line"># Undo changes to the key database</div>
<div class="line">kdb rm -r user:/tests/directoryvalue</div>
<div class="line">sudo kdb umount user:/tests/directoryvalue</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md167"></a>
Limitations</h1>
<ul>
<li><p class="startli"><b>Escaping</b> is currently <b>not possible</b>. If you use the Directory Value plugin you can not</p><ul>
<li>use the name <code>___dirdata</code> as the last part of a normal key,</li>
<li>use <code>___dirdata:</code> at the beginning of a normal value in the first array element</li>
</ul>
<p class="startli">! </p>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

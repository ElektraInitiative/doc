<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Elektra: How-To: kdb merge</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.14</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How-To: kdb merge </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>The kdb tool allows users to access and perform functions on the Elektra Key Database from the command line. We added a new command to this very useful tool, the merge command. This command allows a user to perform a three-way merge of KeySets from the kdb tool.</p>
<p>The command to use this tool is: </p><pre class="fragment">    kdb merge [options] ourpath theirpath basepath resultpath
</pre><p>The standard naming scheme for a three-way merge consists of ours, theirs, and base:</p><ul>
<li>ours refers to the local copy of a file</li>
<li>theirs refers to a remote copy</li>
<li>base refers to their common ancestor.</li>
</ul>
<p>This works very similarly for KeySets, especially ones that consist of mounted conffiles.</p>
<p>For mounted conffiles:</p><ul>
<li>ours should be the user's copy</li>
<li>theirs would be the maintainers copy,</li>
<li>base would be the previous version of the maintainer's copy.</li>
</ul>
<p>If the user is just trying to accomplish is a three-way merge using any two arbitrary keysets that share a base, it doesn't matter which ones are defined as ours or theirs as long as they use the correct base KeySet. In kdb merge, ourpath, theirpath, and basepath work just like ours, theirs, and base except each one represents the root of a KeySet. Resultpath is pretty self-explanatory, it is just where you want the result of the merge to be saved under. It's worth noting, resultpath should be empty before attempting a merge, otherwise there can be unintended consquences.</p>
<h2>Options</h2>
<p>As for the options, there are a few basic options: </p><pre class="fragment">-i  --interactive                   which attempts the merge in an interactive way

    -t  --test                                      which tests the proposed merge and informs you about possible conflicts

    -f --force                                      which overwrites any Keys in resultpath
</pre><h3>Strategies</h3>
<p>Additionally there is an option to specify a merge strategy, which is very important.</p>
<p>The option for strategy is: </p><pre class="fragment">    -s --strategy &lt;name&gt;            which is used to specify a strategy to use in case of a conflict
</pre><p>The current list of strategies are: </p><pre class="fragment">    preserve                        the merge will fail if a conflict is detected

    ours                            the merge will use our version during a conflict

    theirs                          the merge will use their version during a conflict

    base                            the merge will use the base version during a conflict
</pre><p>If no strategy is specified, the merge will default to the preserve strategy as to not risk making the wrong decision. If any of the other strategies are specified, when a conflict is detected, merge will use the Key specified by the strategy (ours, theirs, or base) for the resulting Key.</p>
<h2>Basic Example</h2>
<p>Basic Usage: </p><pre class="fragment">    kdb merge system/hosts/ours system/hosts/theirs system/hosts/base system/hosts/result
</pre><h2>Examples Using Strategies</h2>
<p>Here are examples of the same KeySets being merged using different strateigies. The KeySets are mounted using the simpleini file, the left side of '=' is the name of the Key, the right side is its string value.</p>
<p>We start with the base KeySet, system/base: </p><pre class="fragment">    key1=1  
    key2=2  
    key3=3  
    key4=4  
    key5=5  
</pre><p>Here is our KeySet, system/ours: </p><pre class="fragment">    key1=apple  
    key2=2  
    key3=3  
    key5=fish  
</pre><p>Here is their KeySet, system/theirs: </p><pre class="fragment">    key1=1  
    key2=pie  
    key4=banana  
    key5=5  
</pre><p>Now we will examine the result KeySet with the different strategies.</p>
<h3>Preserve</h3>
<pre class="fragment">    kdb merge -s preserve system/ours system/theirs system/base system/result
</pre><p>The merge will fail because of a conflict for key4 since key4 was deleted in our KeySet and edited in their KeySet. Since we used preserve, the merge fails and the result KeySet is not saved.</p>
<h3>Ours</h3>
<pre class="fragment">    kdb merge -s ours system/ours system/theirs system/base system/result
</pre><p>The result KeySet, system/result will be: </p><pre class="fragment">    key1=apple  
    key2=pie 
    key5=fish  
</pre><p>Because the conflict of key4 (it was deleted in ours but changed in theirs) is solved by using our copy thus deleting the key.</p>
<h3>Theirs</h3>
<pre class="fragment">    kdb merge -s theirs system/ours system/theirs system/base system/result
</pre><p>The result KeySet, system/result will be: </p><pre class="fragment">    key1=apple
    key2=pie
    key4=banana
    key5=fish
</pre><p>Here, the conflict of key4 is solved by using their copy, thus key4=banana.</p>
<h3>Base</h3>
<pre class="fragment">    kdb merge -s base system/ours system/theirs system/base system/result
</pre><p>The result KeySet, system/result will be: </p><pre class="fragment">    key1=apple
    key2=pie
    key4=4
    key5=5
</pre><p>The same conflict is found in key4, but here we use the base version to solve it so key4=4. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>

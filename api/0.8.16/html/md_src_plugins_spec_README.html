<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Elektra: Plugin: spec</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.16</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: spec </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the spec plugin is in keys below</li>
<li>infos/author = Thomas Waser <a href="#" onclick="location.href='mai'+'lto:'+'tho'+'ma'+'s.w'+'as'+'er@'+'li'+'bel'+'ek'+'tra'+'.o'+'rg'; return false;">thoma<span style="display: none;">.nosp@m.</span>s.wa<span style="display: none;">.nosp@m.</span>ser@l<span style="display: none;">.nosp@m.</span>ibel<span style="display: none;">.nosp@m.</span>ektra<span style="display: none;">.nosp@m.</span>.org</a></li>
<li>infos/licence = BSD</li>
<li>infos/needs =</li>
<li>infos/provides = check</li>
<li>infos/placements = postgetstorage presetstorage</li>
<li>infos/status = maintained preview global</li>
<li>infos/description =</li>
</ul>
<p>The spec plugin is a global plugin that copies metadata from the <code>spec</code>-namespace to other namespaces using their key names as globbing expressions. Globbing resembles regular expressions. They do not have the same expressive power, but are easier to use. The semantics are more suitable to match path names:</p>
<ul>
<li>_ matches any key name of just one hierarchy. This means it complies with any character except slash or null.</li>
<li>? satisfies single characters with the same exclusion.</li>
<li># matches elektra array elements.</li>
<li>Additionally, there are ranges and character classes. They can also be inverted.</li>
</ul>
<p>The plugin copies the metadata of the corresponding <code>spec</code> key to every matching key in the other namespaces.</p>
<p>The spec plugin also provides basic validation and struct checking.</p>
<p>It supports:</p>
<ul>
<li>detection of invalid array key names</li>
<li>detection of missing keys</li>
<li>validation of array ranges</li>
<li>validating the number of subkeys</li>
</ul>
<h2>CONFIGURATION</h2>
<h3>ACTIONS</h3>
<ul>
<li><code>ERROR</code> yields an error when a conflict occurres</li>
<li><code>WARNING</code> adds a warning when a conflict occurres</li>
<li><code>INFO</code> adds a metakey <code>logs/spec/info</code> which can be used by logging plugins</li>
<li><code>IGNORE</code> ignores the conflict, this is the default value</li>
</ul>
<h3>CONFLICTS</h3>
<ul>
<li>Invalid array <code>member</code>: an invalid array key has been detected. e.g. <code>/#abc</code></li>
<li>Out of <code>range</code>: the array has more or less elements than specified by the <code>array</code> option.</li>
<li>Invalid number of subkeys <code>count</code>: a key matching a <code>_</code> expression has more or less subkeys than specified by the <code>required</code> option.</li>
<li>Conflicting metadata <code>collision</code>: the metakey that's supposed to be added already exists.</li>
<li>Missing keys <code>missing</code>: the key structure doesn't contain the required subkeys flagged with the <code>require</code> metakey in the <code>spec</code> namespace.</li>
<li>Invalid keys <code>invalid</code>: keys that are subkeys of an invalid array member. e.g. <code>/#abc/key</code></li>
</ul>
<h3>BASIC CONFIGURATION</h3>
<p><code>conflict/set</code> and <code>conflict/get</code> are used to specify what actions should be taken on conflicts. e.g. <code>conflict/get = ERROR</code> yields an error on every conflict.</p>
<h3>PER CONFLICT CONFIGURATION</h3>
<p>Actions can also be specified on a per conflict basis. Those actions take precedence over basic configuration options.</p>
<p>Examples: ``` conflict/get/member = WARNING conflict/set/range = ERROR ```</p>
<h3>PER KEY CONFIGURATION</h3>
<p>Actions can also be specified per-key. Those will take precedence over basic and per-conflict configurations.</p>
<p>Example: ``` spec/test/# conflict/get/member = INFO ```</p>
<h2>EXAMPLES</h2>
<p>Ini files can be found in /examples/spec which should be PWD so that the example works: </p><pre class="fragment">    cd ~e/examples/spec
    kdb global-mount        # mounts spec plugin by default
    kdb mount $PWD/spec.ini spec ni
    kdb mount $PWD/spectest.ini /testkey ni
    kdb export /testkey ni     # note: spec can only applied on cascading access
</pre><p>With spec mount one can use (in this case battery.ini needs to be installed in <code>kdb file spec</code> (this should be preferred on non-development machines so that everything still works after the source is removed): </p><pre class="fragment">    cp battery.ini $(dirname $(kdb file spec))
    kdb mount battery.ini spec/example/battery ni
    kdb spec-mount /example/battery
    kdb lsmeta /example/battery/level    # we see it has a check/enum
    kdb getmeta /example/battery/level check/enum    # now we know allowed values
    kdb set /example/battery/level low   # success, low is ok!
    kdb set /example/battery/level x     # fails, not one of the allowed values!


    cp openicc.ini $(dirname $(kdb file spec)) 
    kdb mount openicc.ini spec/freedesktop/openicc ni
    kdb spec-mount /freedesktop/openicc

    kdb ls /freedesktop/openicc # lets see the whole configuration
    kdb export spec/freedesktop/openicc ni   # give us details about the specification
    kdb lsmeta /freedesktop/openicc/device/camera/#0/EXIF_serial   # seems like there is a check/type
    kdb set "/freedesktop/openicc/device/camera/#0/EXIF_serial" 203     # success, is a long
    kdb set "set "/freedesktop/openicc/device/camera/#0/EXIF_serial" x   # fails, not a long</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>

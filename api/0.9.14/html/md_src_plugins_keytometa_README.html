<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: keytometa</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.9.14</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin: keytometa </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about keytometa plugin is in keys below</li>
<li>infos/author = Felix Berlakovich <a href="#" onclick="location.href='mai'+'lto:'+'ele'+'kt'+'ra@'+'be'+'rla'+'ko'+'vic'+'h.'+'net'; return false;">elekt<span style="display: none;">.nosp@m.</span>ra@b<span style="display: none;">.nosp@m.</span>erlak<span style="display: none;">.nosp@m.</span>ovic<span style="display: none;">.nosp@m.</span>h.net</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = conv</li>
<li>infos/needs =</li>
<li>infos/placements = presetstorage postgetstorage</li>
<li>infos/status = unittest tested nodep libc configurable discouraged</li>
<li>infos/metadata =</li>
<li>infos/description = conversion of keys to metakeys and vice versa</li>
</ul>
<h1><a class="anchor" id="src_plugins_keytometa_README_md"></a>
Introduction</h1>
<blockquote class="doxtable">
<p>Note: This plugin uses a deprecated way to store comments. </p>
</blockquote>
<p>This plugin converts keys into metakeys of other keys. The keys to be converted are tagged with special metadata. Converting keys into metakeys basically raises two questions:</p>
<ul>
<li>which keys should be converted</li>
<li>which key to append the resulting metakeys to</li>
</ul>
<p>The keys to be converted are identified by metakeys below <code>convert</code> (e.g. <code>convert/append</code>). The keys receiving the resulting metadata are identified by append strategies. The plugin currently supports the following metakeys for controlling the conversion:</p>
<ul>
<li><code>convert/metaname</code> specifies the name of the resulting metakey. For example tagging the key <code>user:/config/key1</code> with <code>convert/metaname = comment</code> means that the key will be converted to a metakey with the name <code>comment</code>.</li>
<li><code>convert/append</code> specifies the append strategy (see below)</li>
<li><code>convert/append/samelevel</code> specifies that the key should only be written to the metadata of a key with the same hierarchy level (see below).</li>
</ul>
<p>The keys converted to metadata are restored as soon as the keyset is written back. However, the plugin is stateful. This means that a keyset must be read and keys must be converted by the plugin in order to undo this conversion in the set direction. Modifications to the metadata which resulted from converted keys are propagated back to the corresponding key (see merging for more details).</p>
<p>The keys are ordered by the "order" metadata. If two keys are equal according to the order metadata, they are ordered by name instead.</p>
<h1><a class="anchor" id="autotoc_md300"></a>
Installation</h1>
<p>See <a class="el" href="doc_INSTALL_md.html">installation</a>. The package is called <code>libelektra5-extra</code>.</p>
<h1><a class="anchor" id="autotoc_md301"></a>
Append Strategies</h1>
<p>The append strategy specifies which key will receive the resulting metadata. Currently the plugin supports the following strategies:</p>
<h2><a class="anchor" id="autotoc_md302"></a>
Parent Strategy</h2>
<p>The metadata is added to the first existing parent of the converted key. This does not necessarily have to be the parent of the keyset. If no such key is found, the first key in a sorted keyset will receive the metadata (this is usually the parent key of the keyset). For example consider the following keyset:</p>
<div class="fragment"><div class="line">user:/config/key1</div>
<div class="line">user:/config/key1/child1</div>
<div class="line">user:/config/key2</div>
<div class="line">user:/config/key2/deeper/child2</div>
<div class="line">user:/config/child3</div>
</div><!-- fragment --><p>If child1, child2 and child3 were tagged with <code>convert/append = parent</code>, key1 would receive the metadata from child1 and child3. Key2 would receive the metadata from child2.</p>
<h2><a class="anchor" id="autotoc_md303"></a>
Next Strategy</h2>
<p>The metadata is added to the key following the converted key in a sorted keyset. If no such key is found (for example because the key to be converted is the last one), the strategy is reverted to parent. For example consider the following keyset:</p>
<div class="fragment"><div class="line">user:/config/deeper/key1</div>
<div class="line">user:/config/key2</div>
<div class="line">user:/config/key3</div>
<div class="line">user:/config/key4</div>
</div><!-- fragment --><p>If key1 and key3 were tagged with <code>convert/append = next</code>, key2 would receive the metadata resulting from key1 and key4 would receive the metadata resulting from key3.</p>
<h2><a class="anchor" id="autotoc_md304"></a>
Previous Strategy</h2>
<p>The metadata is added to the key preceding the converted key in a sorted keyset. If no such key is found (for example because the key to be converted is the first one), the strategy is reverted to parent. For example consider the following keyset:</p>
<div class="fragment"><div class="line">user:/config/key1</div>
<div class="line">user:/config/deeper/key2</div>
<div class="line">user:/config/key3</div>
<div class="line">user:/config/key4</div>
</div><!-- fragment --><p>If key2 and key4 were tagged with <code>convert/append = previous</code>, key1 would receive the metadata resulting from key2 and key3 would receive the metadata resulting from key4.</p>
<h1><a class="anchor" id="autotoc_md305"></a>
Merging</h1>
<p>The metadata resulting from a converted key is never appended to another key which is going to be converted. This prevents that the data of converted keys is invisible after the conversion. Instead the metadata resulting from different converted keys with the same append strategy is merged together (separated by a newline). Keys with different append strategies are skipped, until either a key with the same strategy is found (which is simply merged as described above) or the target key is found. The keys are always processed in the order of an ordered keyset. For example consider the following keyset:</p>
<div class="fragment"><div class="line">user:/config/key0</div>
<div class="line">user:/config/key1 = value1</div>
<div class="line">user:/config/key2 = value2</div>
<div class="line">user:/config/key3 = value3</div>
<div class="line">user:/config/key4 = value4</div>
<div class="line">user:/config/key5</div>
</div><!-- fragment --><p>If key1 and key2 were tagged with <code>convert/append = next</code> and key3 and key4 were tagged with <code>convert/append = previous</code> the following would happen:</p>
<ul>
<li>the resulting metadata of key0 would contain <code>value3\nvalue4</code> (the values of key3 and key4 are merged together and key1 and key2 are skipped, as they have different append strategy)</li>
<li>the resulting metadata of key5 would contain <code>value1\nvalue2</code> (the values of key1 and key2 are merged together and key3 and key4 are skipped, as they have different append strategy)</li>
</ul>
<h2><a class="anchor" id="autotoc_md306"></a>
Same-Level Appending</h2>
<p>The option <code>convert/append/samelevel</code> can be used to force that the metadata is only appended to a key on the same hierarchy level. If no such key is found, the strategy is reverted to parent. Note, that the value of the samelevel key does not matter. Only its existence is relevant. For example consider the following keyset:</p>
<div class="fragment"><div class="line">user:/config/key0</div>
<div class="line">user:/config/key1/child1</div>
<div class="line">user:/config/key2</div>
<div class="line">user:/config/key3/child2</div>
<div class="line">user:/config/key4</div>
<div class="line">user:/config/key5</div>
<div class="line">user:/config/key6</div>
</div><!-- fragment --><p>If child1, child2 and key4 were each tagged with <code>convert/append = next</code> and child2 and key4 were tagged with <code>convert/append/samelevel</code>, key2 would receive the metadata resulting from child1. key0 would receive the metadata resulting from child2 (strategy reverted to parent, as the samelevel request cannot be fulfilled). key5 would receive the metadata resulting from key4.</p>
<h1><a class="anchor" id="autotoc_md307"></a>
Real World Example</h1>
<p>The keytometa plugin was initially developed to aid the integration of the Augeas plugin. The Augeas plugin represents comments in configuration files as keys. However, in Elektra comments are usually represented within comment metakeys. Therefore it would be desirable to convert all comment keys to comment metakeys. This is achieved by adding the following to the Augeas plugin contract.</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"><a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/augeas/config/needs/glob/get/#1&quot;</span>,</div>
<div class="line">    <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a>, <span class="stringliteral">&quot;*#comment*&quot;</span>,</div>
<div class="line">    <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a>, <span class="stringliteral">&quot;convert/metaname&quot;</span>, <span class="stringliteral">&quot;comment/#0&quot;</span>,</div>
<div class="line">    <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a>, <span class="stringliteral">&quot;convert/append&quot;</span>, <span class="stringliteral">&quot;next&quot;</span>,</div>
<div class="line">    <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line"><a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/augeas/config/needs/glob/get/#1/flags&quot;</span>,</div>
<div class="line">    <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a>, <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* disable the path matching mode */</span></div>
<div class="line">    <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>)</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line">;</div>
<div class="ttc" id="agroup__key_html_gad23c65b44bf48d773759e1f9a4d43b89"><div class="ttname"><a href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a></div><div class="ttdeci">Key * keyNew(const char *name,...)</div><div class="ttdoc">A practical way to fully create a Key object in one step.</div><div class="ttdef"><b>Definition:</b> key.c:144</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8a040582834bb2d90049947d7ef74e87e2">KEY_META</a></div><div class="ttdeci">@ KEY_META</div><div class="ttdef"><b>Definition:</b> kdbenum.c:92</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a></div><div class="ttdeci">@ KEY_END</div><div class="ttdef"><b>Definition:</b> kdbenum.c:95</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a></div><div class="ttdeci">@ KEY_VALUE</div><div class="ttdef"><b>Definition:</b> kdbenum.c:88</div></div>
</div><!-- fragment --><p>Tagging the keys to be converted to comment metakeys happens via the glob plugin. The metadata set on the key <code>glob/get/#1</code> is copied to each key that matches the pattern <code>*#comment*</code>, i.e. each comment key generated by the Augeas plugin. <code>convert/metaname = comment</code> because we want the comment keys to be converted to the comment metadata. <code>convert/append = next</code> is chosen because usually comments occur before the key they describe. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

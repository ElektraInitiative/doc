<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: fcrypt</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.25</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: fcrypt </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about fcrypt plugin is in keys below</li>
<li>infos/author = Peter Nirschl <a href="#" onclick="location.href='mai'+'lto:'+'pet'+'er'+'.ni'+'rs'+'chl'+'@g'+'mai'+'l.'+'com'; return false;">peter<span style="display: none;">.nosp@m.</span>.nir<span style="display: none;">.nosp@m.</span>schl@<span style="display: none;">.nosp@m.</span>gmai<span style="display: none;">.nosp@m.</span>l.com</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = sync filefilter crypto</li>
<li>infos/needs =</li>
<li>infos/recommends =</li>
<li>infos/placements = pregetstorage postgetstorage precommit</li>
<li>infos/ordering = sync</li>
<li>infos/status = unittest nodep configurable</li>
<li>infos/metadata =</li>
<li>infos/description = File Encryption</li>
</ul>
<h1><a class="anchor" id="src_plugins_fcrypt_README_md"></a>
fcrypt Plugin</h1>
<h2>Introduction</h2>
<p>This plugin enables file based encryption and decryption using GPG. Also an option for signing and verifying files using GPG is provided.</p>
<p>This plugin encrypts backend files before the commit is executed (thus <code>precommit</code>). The plugin decrypts the backend files before the getstorage opens it (thus <code>pregetstorage</code>). After the getstorage plugin has read the backend file, the plugin decrypts the backend file again (thus <code>postgetstorage</code>).</p>
<h2>Security Considerations</h2>
<p>There are two things to consider when using the <code>fcrypt</code> plugin:</p>
<ol type="1">
<li>Decrypted data is visible on the file system for a short period of time.</li>
<li>Decrypted data might end up on a hard disk or some other persistent storage.</li>
</ol>
<p>The plugin directs GPG to write its (decrypted) output to a temporary directory. From there on the data can be processed by other plugins. After the <code>get</code> phase is over, <code>fcrypt</code> overwrites the temporary file and unlinks it afterwards. However, if the application crashes during <code>get</code> the decrypted data may remain in the temporary directory.</p>
<p>If the temporary directory is mounted on a hard disk, GPG writes the decrypted data on that disk. Thus we recommend to either mount <code>/tmp</code> to a RAM disk or specify another path as temporary directory within the plugin configuration (see Configuration below).</p>
<h2>Known Issues</h2>
<p>If you encounter the following error at <code>kdb mount</code>: </p><pre class="fragment">    The command kdb mount terminated unsuccessfully with the info:
    Too many plugins!
    The plugin sync can't be positioned at position precommit anymore.
    Try to reduce the number of plugins!

    Failed because precommit with 7 is larger than 6
    Please report the issue at https://issues.libelektra.org/
</pre><p>you might want to consider disabling the sync plugin by entering: </p><pre class="fragment">    kdb set /sw/elektra/kdb/#0/current/plugins ""
    kdb set system/sw/elektra/kdb/#0/current/plugins ""
</pre><p>Please note that this is a workaround until a more sustainable solution is found.</p>
<h2>Dependencies</h2>
<h3>Crypto Plugin</h3>
<p>This plugin uses parts of the <code>crypto</code> plugin.</p>
<h3>GnuPG (GPG)</h3>
<p>Please refer to <a class="el" href="md_src_plugins_crypto_README.html#src_plugins_crypto_README_md">crypto</a>.</p>
<h2>Restrictions</h2>
<p>Please refer to <a class="el" href="md_src_plugins_crypto_README.html#src_plugins_crypto_README_md">crypto</a>.</p>
<h2>Examples</h2>
<p>You can mount the plugin with encryption enabled like this: </p><pre class="fragment">    kdb mount test.ecf /t fcrypt "encrypt/key=DDEBEF9EE2DC931701338212DAF635B17F230E8D"
</pre><p>If you only want to sign the configuration file, you can mount the plugin like this: </p><pre class="fragment">    kdb mount test.ecf /t fcrypt "sign/key=DDEBEF9EE2DC931701338212DAF635B17F230E8D"
</pre><p>Both options <code>encrypt/key</code> and <code>sign/key</code> can be combined: </p><pre class="fragment">    kdb mount test.ecf /t fcrypt "encrypt/key=DDEBEF9EE2DC931701338212DAF635B17F230E8D,sign/key=DDEBEF9EE2DC931701338212DAF635B17F230E8D"
</pre><p>If you create a key under <code>/t</code> </p><pre class="fragment">    kdb set /t/a "hello world"
</pre><p>you will notice that you can not read the plain text of <code>test.ecf</code> because it has been encrypted by GPG.</p>
<p>But you can still access <code>/t/a</code> with <code>kdb get</code>: </p><pre class="fragment">    kdb get /t/a
</pre><p>If you are looking for a more interactive example, have a look at the following ASCIIcast at:</p>
<p><a href="https://asciinema.org/a/153014">https://asciinema.org/a/153014</a></p>
<h2>Configuration</h2>
<h3>Signatures</h3>
<p>The GPG signature keys can be specified as <code>sign/key</code> directly. If you want to use more than one key for signing, just enumerate like: </p><pre class="fragment">sign/key/#0
sign/key/#1
</pre><p>If more than one key is defined, every private key is used to sign the file of the backend.</p>
<p>If a signature is attached to a file, <code>fcrypt</code> automatically verifies its content whenever the file is being read.</p>
<p>Note that the signed file is stored in the internal format of GPG. So you only see binary data when opening the signed configuration file directly. However, you can simply display the plain text content of the file by using GPG: </p><pre class="fragment">    gpg2 -d signed.ecf
</pre><h3>GPG Configuration</h3>
<p>The GPG Configuration is described in <a class="el" href="md_src_plugins_crypto_README.html#src_plugins_crypto_README_md">crypto</a>.</p>
<h3>Textmode</h3>
<p><code>fcrypt</code> operates in textmode per default. In textmode <code>fcrypt</code> uses the <code>--armor</code> option of GPG, thus the output of <code>fcrypt</code> is ASCII armored. If no encryption key is provided (i.e. only signature is requested) <code>fcrypt</code> uses the <code>--clearsign</code> option of GPG.</p>
<p>Textmode can be disabled by setting <code>fcrypt/textmode</code> to <code>0</code> in the plugin configuration.</p>
<h3>Temporary Directory</h3>
<p><code>fcrypt</code> uses the configuration option <code>fcrypt/tmpdir</code> to generate paths for temporary files during encryption and decryption. If no such configuration option is provided, <code>fcrypt</code> will try to use the environment variable <code>TMPDIR</code>. If <code>TMPDIR</code> is not set in the environment, <code>/tmp</code> is used as default directory.</p>
<p>The path of the temporary directory is forwarded to GPG via the <code>-o</code> option, so GPG will output to this path. The directory must be readable and writable by the user.</p>
<p>We recommend to specify a path that is mounted to a RAM disk. It is advisable to set restrictive access rules to this path, so that other users on the system can not access it. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Elektra: Plugin: jni</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.18</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: jni </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the jni plugin is in keys below</li>
<li>infos/author = Name <a href="#" onclick="location.href='mai'+'lto:'+'nam'+'e@'+'lib'+'el'+'ekt'+'ra'+'.or'+'g'; return false;">name@<span style="display: none;">.nosp@m.</span>libe<span style="display: none;">.nosp@m.</span>lektr<span style="display: none;">.nosp@m.</span>a.or<span style="display: none;">.nosp@m.</span>g</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides =</li>
<li>infos/needs =</li>
<li>infos/placements =</li>
<li>infos/status = maintained configurable experimental -500 memleak</li>
<li>infos/description =</li>
</ul>
<h1><a class="anchor" id="src_plugins_jni_README_md"></a>
Generic Java plugin</h1>
<h2>Introduction</h2>
<p>Allows you to write plugins in java.</p>
<p>Needs Java 8 or later. While the plugin internally uses JNI, the Java binding for your java-plugin may use something different, e.g. JNA. The requirements for the java bindings are:</p>
<ul>
<li>needs to have the classes elektra/Key and elektra/KeySet with<ul>
<li>a constructor that takes a C-Pointer as long (J)</li>
<li>a method "release" that gives up ownership (set internal pointer to NULL)</li>
</ul>
</li>
</ul>
<p>The java plugin itself needs to have the following methods:</p>
<ul>
<li>constructor without arguments (i.e. default constructor)</li>
<li>open with argument elektra/KeySet (the plugin's conf) and elektra/Key</li>
<li>close with argument elektra/Key</li>
<li>get with arguments elektra/KeySet and elektra/Key</li>
<li>set with arguments elektra/KeySet and elektra/Key</li>
<li>error with arguments elektra/KeySet and elektra/Key</li>
</ul>
<h2>Installation</h2>
<p>Please install java8 as package, e.g. <a href="http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html">for debian</a> and then let cmake actually find jdk8: </p><pre class="fragment">cd /usr/lib/jvm/ &amp;&amp; sudo rm -f default-java &amp;&amp; sudo ln -s java-8-oracle default-java
</pre><p>and for the runtime, create the file <code>/etc/ld.so.conf.d/java-8-oracle.conf</code> with the content (for amd64): </p><pre class="fragment">/usr/lib/jvm/default-java/jre/lib/amd64
/usr/lib/jvm/default-java/lib/amd64
/usr/lib/jvm/default-java/jre/lib/amd64/server
</pre><p>and run: </p><pre class="fragment">sudo ldconfig
</pre><p>Then enable the plugin using: </p><pre class="fragment">cmake -DPLUGINS="...;jni" /path/to/libelektra
</pre><p>Running </p><pre class="fragment">kdb-full
</pre><p>should work then, if you get one of these: </p><pre class="fragment">kdb-full: error while loading shared libraries: libmawt.so: cannot open shared object file: No such file or directory
kdb-full: error while loading shared libraries: libjawt.so: cannot open shared object file: No such file or directory
</pre><p>You missed one of the ldconfig steps.</p>
<h2>Plugin Config</h2>
<p>You need to pass :</p><ul>
<li>classname the classname to use as plugin, e.g. elektra/plugin/Echo</li>
<li>classpath the classpath where to find JNA, the package elektra and other classes needed</li>
</ul>
<p>Additionally, you can set:</p>
<ul>
<li>option allows you to pass a option to the jvm, default: -verbose:gc,class,jni</li>
<li>ignore allows you to ignore broken options, default: false</li>
<li>print allows you to print java exceptions for debugging purposes</li>
</ul>
<p>E.g. </p><pre class="fragment">kdb info -c classname=elektra/plugin/PropertiesStorage,classpath=.:/usr/share/java/jna.jar:/usr/lib/java:/path/to/libelektra/src/bindings/jna,print= jni
kdb check -c classname=elektra/plugin/PropertiesStorage,classpath=.:/usr/share/java/jna.jar:/usr/lib/java:/path/to/libelektra/src/bindings/jna,print= jni
kdb mount -c classname=elektra/plugin/PropertiesStorage,classpath=.:/usr/share/java/jna.jar:/usr/lib/java:/path/to/src/bindings/jna,print= file.properties /jni jni classname=elektra/plugin/PropertiesStorage,classpath=.:/usr/share/java/jna.jar:/usr/lib/java:/path/to/libelektra/src/bindings/jna,print=
</pre><p>Or if .jar is already installed: </p><pre class="fragment">bin/kdb mount -c classname=elektra/plugin/PropertiesStorage,classpath=.:/usr/share/java/jna.jar:/usr/share/java/elektra.jar,print= file.properties /jni jni classname=elektra/plugin/PropertiesStorage,classpath=.:/usr/share/java/jna.jar:/usr/share/java/elektra.jar,print=
</pre><p>Additionally, the java implementation can request any other additional configuration, read about it below in the section (specific java plugin). If you are reading this page on github, you won't see it, because the plugins dynamically append text after the end of this page.</p>
<h2>Development</h2>
<p>To know how the methods of your class are called, use: </p><pre class="fragment">javap -s YourClass
</pre><p>Also explained <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/types.html#wp15773">here</a></p>
<p><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/functions.html">JNI Functions</a> <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/invocation.html">Invocation</a></p>
<h2>Issues</h2>
<p>(Argumentation for -500 in status)</p>
<ul>
<li>In Debian Wheezy you cannot use openjdk: you get a linker error because of some missing private SUN symbols. Maybe just the cmake mechanism to find java is broken.</li>
<li>Only a single java plugin can be loaded</li>
<li>when this plugin is enabled, valgrind detects memory problems even if the plugin is not mounted. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>

<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: keyString() return value</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05" title="Get a pointer to the c-string representing the value.">keyString()</a> return value </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_decisions_1_problem_clear_key_string_return_value"></a> </p>
<h1><a class="anchor" id="autotoc_md1950"></a>
Problem</h1>
<p>When using <a class="el" href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05" title="Get a pointer to the c-string representing the value.">keyString()</a> on empty / binary values the return values are the literal strings (null) / (binary). This seems very awkward and unintuitive from a user's perspective.</p>
<h1><a class="anchor" id="autotoc_md1951"></a>
Constraints</h1>
<p>Because the return value of the function is <code>const char*</code>, there are not so many possibilities for a change to this behavior, as every possible return value - except for a NULL pointer - could just be the value of the string of the Key.</p>
<h1><a class="anchor" id="autotoc_md1952"></a>
Assumptions</h1>
<p>On one hand always returning a string allows things like <code>strlen(keyString(k)) == 0</code> to check for an empty string. But at the same time people might expect that <code>strlen(keyString(k)) &lt; MAX_LEN</code> also works. But this again might silently break code down the line, if <code>k</code> is binary and <code>strlen("(binary)") &lt; MAX_LEN</code>.</p>
<h1><a class="anchor" id="autotoc_md1953"></a>
Considered Alternatives</h1>
<p>An alternative would be to always store a zero byte after all key values, even if they are binary (might be done already). Then we can safely return <code>k-&gt;data.c == NULL ? "" : k-&gt;data.c</code>. It may contain incomplete data and the <code>MAX_LEN</code> problem from above still applies, but there are no segfaults and you don't get return values that have nothing to do with the actual data.</p>
<h1><a class="anchor" id="autotoc_md1954"></a>
Decision</h1>
<ul>
<li><code>key == NULL</code> return 0, error code via second channel</li>
<li><code>key-&gt;value == NULL</code> return 0, error code via second channel</li>
<li><code>key == &lt;binary&gt;</code> return 0, error code via second channel</li>
<li>everything else as is</li>
</ul>
<h1><a class="anchor" id="autotoc_md1955"></a>
Rationale</h1>
<ul>
<li>0 seems like the most intuitive value to return in case of an error, although this introduces the possibility of segfaults for users of the library. printf doesn't cause segfaults anymore, which improves this problem a lot.</li>
<li>With the introduction of a second channel for reporting errors, users can check the error messages in case of segfaults - which alleviates this issue. The first thing in case of an error should be checking the error message.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1956"></a>
Implications</h1>
<h1><a class="anchor" id="autotoc_md1957"></a>
Related Decisions</h1>
<h1><a class="anchor" id="autotoc_md1958"></a>
Notes</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Elektra: KDB</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.8.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">KDB</div>  </div>
</div><!--header-->
<div class="contents">

<p>General methods to access the Key database.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6808defe5870f328dd17910aacbdc6ca"><td class="memItemLeft" align="right" valign="top">KDB *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca">kdbOpen</a> (Key *errorKey)</td></tr>
<tr class="memdesc:ga6808defe5870f328dd17910aacbdc6ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Opens the session with the Key database.  <a href="#ga6808defe5870f328dd17910aacbdc6ca"></a><br/></td></tr>
<tr class="memitem:gadb54dc9fda17ee07deb9444df745c96f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a> (KDB *handle, Key *errorKey)</td></tr>
<tr class="memitem:ga28e385fd9cb7ccfe0b2f1ed2f62453a1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1">kdbGet</a> (KDB *handle, KeySet *ks, Key *parentKey)</td></tr>
<tr class="memdesc:ga28e385fd9cb7ccfe0b2f1ed2f62453a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve keys in an atomic and universal way.  <a href="#ga28e385fd9cb7ccfe0b2f1ed2f62453a1"></a><br/></td></tr>
<tr class="memitem:ga11436b058408f83d303ca5e996832bcf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf">kdbSet</a> (KDB *handle, KeySet *ks, Key *parentKey)</td></tr>
<tr class="memdesc:ga11436b058408f83d303ca5e996832bcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set keys in an atomic and universal way.  <a href="#ga11436b058408f83d303ca5e996832bcf"></a><br/></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<p>General methods to access the Key database. </p>
<p>To use them: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kdb.h&gt;</span></div>
</div><!-- fragment --><p>The kdb*() methods are used to access the storage, to get and set <a class="el" href="group__keyset.html">KeySets </a>.</p>
<p>They use some backend implementation to know the details about how to access the storage.</p>
<p>One backend consists of multiple plugins. See <a class="el" href="group__plugin.html">writing a new plugin </a> for information about how to write a plugin. </p>
<h2>Function Documentation</h2>
<a class="anchor" id="gadb54dc9fda17ee07deb9444df745c96f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kdbClose </td>
          <td>(</td>
          <td class="paramtype">KDB *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>errorKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Closes the session with the Key database.</p>
<p>This is the counterpart of <a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen()</a>.</p>
<p>You must call this method when you finished your affairs with the key database. You can manipulate Key and KeySet objects also after <a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose()</a>, but you must not use any kdb*() call afterwards. You can run <a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose()</a> in the atexit() handler.</p>
<p>The <code>handle</code> parameter will be finalized and all resources associated to it will be freed. After a <a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose()</a>, the <code>handle</code> can't be used anymore.</p>
<dl class="section pre"><dt>Precondition</dt><dd>The handle must be a valid handle as returned from <a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen()</a></dd>
<dd>
errorKey must be a valid key, e.g. created with <a class="el" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew()</a></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of <a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca">opened </a> key database </td></tr>
    <tr><td class="paramname">errorKey</td><td>the key which holds error information </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success </dd>
<dd>
-1 on NULL pointer </dd></dl>

</div>
</div>
<a class="anchor" id="ga28e385fd9cb7ccfe0b2f1ed2f62453a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kdbGet </td>
          <td>(</td>
          <td class="paramtype">KDB *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">KeySet *&#160;</td>
          <td class="paramname"><em>ks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>parentKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve keys in an atomic and universal way. </p>
<dl class="section pre"><dt>Precondition</dt><dd><a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen()</a> must be called before using this method.</dd>
<dd>
The <code>returned</code> KeySet must be a valid KeySet, e.g. constructed with <a class="el" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew()</a>.</dd></dl>
<p>The <code>returned</code> KeySet may already contain some keys from previous <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet()</a> calls. The new retrieved keys will be appended using <a class="el" href="group__keyset.html#gaa5a1d467a4d71041edce68ea7748ce45">ksAppendKey()</a>.</p>
<p>It will fully retrieve, at least, all keys under the <code>parentKey</code> folder, with all subfolders and their children.</p>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet()</a> might retrieve more keys then requested (that are not below parentKey). These keys must be passed to calls of <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set keys in an atomic and universal way.">kdbSet()</a>, otherwise they will be lost. This stems from the fact that the user has the only copy of the whole configuration and backends only write configuration that was passed to them. For example, if you <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet()</a> "system/mountpoint/interest" you will not only get all keys below system/mountpoint/interest, but also all keys below system/mountpoint (if system/mountpoint is a mountpoint as the name suggests, but system/mountpoint/interest is not a mountpoint). Make sure to not touch or remove keys outside the keys of interest, because others may need them!</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group__keyset.html#ga6b00cf82b59af4d883a9bad6cf4a4a4a">ksCut()</a> for further remarks on that topic.</dd></dl>
<dl class="section user"><dt>Example:</dt><dd></dd></dl>
<p>This example demonstrates the typical usecase within an application (without error handling).</p>
<div class="fragment"><div class="line">KeySet *myConfig = <a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a>(0,KS_END);</div>
<div class="line">Key *pkey = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a>(<span class="stringliteral">&quot;system/sw/MyApp&quot;</span>,<a class="code" href="group__key.html#gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">KDB *handle = <a class="code" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen</a>(pkey);</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet</a>(handle, myConfig, pkey); <span class="comment">// get the config initially</span></div>
<div class="line"></div>
<div class="line">Key *key = <a class="code" href="group__keyset.html#gad2e30fb6d4739d917c5abb2ac2f9c1a1">ksLookupByName</a>(myConfig,<span class="stringliteral">&quot;/sw/MyApp/key&quot;</span>, 0);</div>
<div class="line"><span class="comment">// check if key is not 0 and work with it...</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet</a>(handle, myConfig, pkey); <span class="comment">// get the config again</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a> (myConfig); <span class="comment">// delete the in-memory configuration</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a>(handle, pkey); <span class="comment">// no more affairs with the key database.</span></div>
<div class="line"><a class="code" href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a>(pkey);</div>
</div><!-- fragment --><dl class="section user"><dt>Details:</dt><dd></dd></dl>
<p>If you pass NULL on any parameter <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet()</a> will fail immediately without doing anything.</p>
<p>When a backend fails <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet()</a> will return -1 with all error and warning information in the <code>parentKey</code>. The parameter <code>returned</code> will not be changed.</p>
<dl class="section user"><dt>Updates:</dt><dd></dd></dl>
<p>In the first run of kdbGet all keys are retrieved. On subsequent calls only the keys are retrieved where something was changed inside the key database. The other keys stay unchanged in the keyset, even when they were manipulated.</p>
<p>It is your responsibility to save the original keyset if you need it afterwards.</p>
<p>If you must get the same keyset again, e.g. in another thread you need to open a second handle to the key database using <a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of <a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca">opened </a> key database </td></tr>
    <tr><td class="paramname">parentKey</td><td>parent key holds the information which keys should be get (it is possible that more are retrieved) - an invalid name gets all keys </td></tr>
    <tr><td class="paramname">ks</td><td>the (pre-initialized) KeySet returned with all keys found will not be changed on error or if no update is required </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group__keyset.html#gaa34fc43a081e6b01e4120daa6c112004">ksLookup()</a>, <a class="el" href="group__keyset.html#gad2e30fb6d4739d917c5abb2ac2f9c1a1">ksLookupByName()</a> for powerful lookups after the KeySet was retrieved </dd>
<dd>
<a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set keys in an atomic and universal way.">kdbSet()</a> to save the configuration afterwards and <a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose()</a> to finish affairs with the <a class="el" href="group__key.html" title="A Key is the essential class that encapsulates key name , value  and metainfo .">Key</a> database. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>if the keys were retrieved successfully </td></tr>
    <tr><td class="paramname">0</td><td>if there was no update - no changes are made to the keyset then </td></tr>
    <tr><td class="paramname">-1</td><td>on failure - no changes are made to the keyset then </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga6808defe5870f328dd17910aacbdc6ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">KDB* kdbOpen </td>
          <td>(</td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>errorKey</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Opens the session with the Key database. </p>
<p>The method will bootstrap itself the following way. The first step is to open the default backend. With it system/elektra/mountpoints will be loaded and all needed libraries and mountpoints will be determined. These libraries for backends will be loaded and with it the <code>KDB</code> datastructure will be initialized.</p>
<p>You must always call this method before retrieving or committing any keys to the database. In the end of the program, after using the key database, you must not forget to <a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose()</a>. You can use the atexit () handler for it.</p>
<p>The pointer to the <code>KDB</code> structure returned will be initialized like described above, and it must be passed along on any kdb*() method your application calls.</p>
<p>Get a <code>KDB</code> handle for every thread using elektra. Don't share the handle across threads, and also not the pointer accessing it: </p>
<div class="fragment"><div class="line">thread1</div>
<div class="line">{</div>
<div class="line">        KDB * h;</div>
<div class="line">        h = <a class="code" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen</a>(0);</div>
<div class="line">        <span class="comment">// fetch keys and work with them</span></div>
<div class="line">        <a class="code" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a>(h, 0);</div>
<div class="line">}</div>
<div class="line">thread2</div>
<div class="line">{</div>
<div class="line">        KDB * h;</div>
<div class="line">        h = <a class="code" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen</a>(0);</div>
<div class="line">        <span class="comment">// fetch keys and work with them</span></div>
<div class="line">        <a class="code" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a>(h, 0);</div>
<div class="line">}</div>
</div><!-- fragment --><p>You don't need to use the <a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen()</a> if you only want to manipulate plain in-memory Key or KeySet objects.</p>
<dl class="section pre"><dt>Precondition</dt><dd>errorKey must be a valid key, e.g. created with <a class="el" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew()</a></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">errorKey</td><td>the key which holds errors and warnings which were issued </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet()</a>, <a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose()</a> to end all affairs to the <a class="el" href="group__key.html" title="A Key is the essential class that encapsulates key name , value  and metainfo .">Key</a> database. </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>a KDB pointer on success </dd>
<dd>
NULL on failure </dd></dl>

</div>
</div>
<a class="anchor" id="ga11436b058408f83d303ca5e996832bcf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kdbSet </td>
          <td>(</td>
          <td class="paramtype">KDB *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">KeySet *&#160;</td>
          <td class="paramname"><em>ks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>parentKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set keys in an atomic and universal way. </p>
<p>With <code>parentKey</code> you can only store a part of the given keyset. When other keys also belong to a backend, they will be used too, even when they are above <code>parentKey</code>.</p>
<dl class="section user"><dt>Details:</dt><dd></dd></dl>
<p>If you pass a parentKey without a name the whole keyset will be set in an atomic way.</p>
<p>Each key is checked with <a class="el" href="group__keytest.html#gaf247df0de7aca04b32ef80e39ef12950">keyNeedSync()</a> before being actually committed. So only changed keys are updated. If no key of a backend needs to be synced any affairs to backends omitted and 0 is returned.</p>
<dl class="section user"><dt>Errors:</dt><dd></dd></dl>
<p>If some error occurs, <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set keys in an atomic and universal way.">kdbSet()</a> will stop. In this situation the KeySet internal cursor will be set on the key that generated the error.</p>
<p>None of the keys are actually commited.</p>
<p>You should present the error message to the user and let the user decide what to do. Possible solutions are:</p>
<ul>
<li>repeat the same kdbSet (for temporary errors)</li>
<li>remove the key and set it again (for validation or type errors)</li>
<li>change the value and try it again (for validation errors)</li>
<li>do a kdbGet and then (for conflicts ...)<ul>
<li>set the same keyset again (in favour of what was set by this user)</li>
<li>drop the old keyset (in favour of what was set elsewhere)</li>
</ul>
</li>
<li>export the configuration into a file (for unresolvable errors)</li>
</ul>
<dl class="section user"><dt>Example of how this method can be used:</dt><dd><div class="fragment"><div class="line"><span class="keywordtype">int</span> i;</div>
<div class="line">KeySet *myConfig = <a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a>(0,KS_END);</div>
<div class="line">Key *parentKey = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a>(<span class="stringliteral">&quot;system/sw/MyApp&quot;</span>,<a class="code" href="group__key.html#gga91fb3178848bd682000958089abbaf40aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">KDB *handle = <a class="code" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen</a>(pkey);</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet</a>(handle, ks, parentKey); <span class="comment">// kdbGet needs to be called first!</span></div>
<div class="line">KeySet *base = <a class="code" href="group__keyset.html#gac59e4b328245463f1451f68d5106151c">ksDup</a>(ks); <span class="comment">// save a copy of original keyset</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// change the keys within ks</span></div>
<div class="line"></div>
<div class="line">KeySet *ours = <a class="code" href="group__keyset.html#gac59e4b328245463f1451f68d5106151c">ksDup</a>(ks); <span class="comment">// save a copy of our keyset</span></div>
<div class="line"><span class="keywordtype">int</span> ret=<a class="code" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set keys in an atomic and universal way.">kdbSet</a>(handle, ks, parentKey);</div>
<div class="line"><span class="keywordflow">while</span> (ret == -1) <span class="comment">// as long as we have an error</span></div>
<div class="line">{</div>
<div class="line">        <span class="comment">// We got an error. Warn user.</span></div>
<div class="line">        Key *problemKey = <a class="code" href="group__keyset.html#ga4287b9416912c5f2ab9c195cb74fb094">ksCurrent</a>(ks);</div>
<div class="line">        <span class="comment">// parentKey has the errorInformation</span></div>
<div class="line">        <span class="comment">// problemKey is the faulty key (may be null)</span></div>
<div class="line">        <span class="keywordtype">int</span> userInput = showElektraErrorDialog (parentKey, problemKey);</div>
<div class="line">        <span class="keywordflow">switch</span> (userInput)</div>
<div class="line">        {</div>
<div class="line">        <span class="keywordflow">case</span> INPUT_USE_OURS:</div>
<div class="line">                <a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet</a>(handle, ks, parentKey); <span class="comment">// refresh key database</span></div>
<div class="line">                <a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a>(ks);</div>
<div class="line">                ks = ours;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> INPUT_DO_MERGE:</div>
<div class="line">                <a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet</a>(handle, ks, parentKey); <span class="comment">// refresh key database</span></div>
<div class="line">                KeySet * res=doElektraMerge(ours, ks, base);</div>
<div class="line">                <a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a>(ks);</div>
<div class="line">                ks = res;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> INPUT_USE_THEIRS:</div>
<div class="line">                <span class="comment">// should always work, we just write what we got</span></div>
<div class="line">                <span class="comment">// but to be sure always give the user another way</span></div>
<div class="line">                <span class="comment">// to exit the loop</span></div>
<div class="line">                <a class="code" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet</a>(handle, ks, parentKey); <span class="comment">// refresh key database</span></div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        ...</div>
<div class="line">        }</div>
<div class="line">        ret=<a class="code" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set keys in an atomic and universal way.">kdbSet</a>(handle, ks, parentKey);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a> (ours);</div>
<div class="line"><a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a> (base);</div>
<div class="line"><a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a> (ks); <span class="comment">// delete the in-memory configuration</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose</a>(handle, parentKey); <span class="comment">// no more affairs with the key database.</span></div>
<div class="line"><a class="code" href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a>(parentKey);</div>
</div><!-- fragment --></dd></dl>
<p>showElektraErrorDialog() and doElektraMerge() need to be implemented by the user. For doElektraMerge a 3-way merge algorithm exists in libelektra-tools.</p>
<dl class="section pre"><dt>Precondition</dt><dd><a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet()</a> must be called before <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set keys in an atomic and universal way.">kdbSet()</a>:<ul>
<li>initially (after <a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen()</a>)</li>
<li>after conflict errors in <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set keys in an atomic and universal way.">kdbSet()</a>.</li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of <a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca">opened </a> key database </td></tr>
    <tr><td class="paramname">ks</td><td>a KeySet which should contain changed keys, otherwise nothing is done </td></tr>
    <tr><td class="paramname">parentKey</td><td>holds the information below which key keys should be set, see above </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>on success </td></tr>
    <tr><td class="paramname">0</td><td>if nothing had to be done </td></tr>
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group__keytest.html#gaf247df0de7aca04b32ef80e39ef12950">keyNeedSync()</a> </dd>
<dd>
<a class="el" href="group__keyset.html#ga317321c9065b5a4b3e33fe1c399bcec9">ksNext()</a>, <a class="el" href="group__keyset.html#ga4287b9416912c5f2ab9c195cb74fb094">ksCurrent()</a> for iteration over the <a class="el" href="group__keyset.html" title="Methods to manipulate KeySets.">KeySet</a> </dd>
<dd>
<a class="el" href="group__kdb.html#ga6808defe5870f328dd17910aacbdc6ca" title="Opens the session with the Key database.">kdbOpen()</a> and <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve keys in an atomic and universal way.">kdbGet()</a> that must be called first </dd>
<dd>
<a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f">kdbClose()</a> that must be called afterwards </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Sep 2 2014 22:32:52 for Elektra by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>

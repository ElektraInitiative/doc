<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Library Split</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Library Split </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_decisions_4_decided_library_split"></a> </p>
<h1><a class="anchor" id="autotoc_md2169"></a>
Problem</h1>
<p>Only <code>libelektra-core</code> is supposed to access private data, but this contradicts the goal to keep the library minimal. <code><a class="el" href="kdbprivate_8h.html" title="Private declarations.">kdbprivate.h</a></code> was too generic, it contained many other parts next to the struct definitions of Key/KeySet.</p>
<h1><a class="anchor" id="autotoc_md2170"></a>
Constraints</h1>
<ul>
<li>The <a href="https://www.open-std.org/jtc1/sc22/wg14/">C99 standard, section 5.2.4.1</a> gives following limit: 4095 external identifiers in one translation unit</li>
<li>Some parts of Elektra, like <code>mmapstorage</code> need access to private data structure.</li>
<li>Elektra does not support several different struct definitions of Key/KeySet. Alternative implementations that want to coexist (e.g. <code>mmapstorage</code> should still work) must use the same struct definitions of Key/KeySet.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2171"></a>
Assumptions</h1>
<h1><a class="anchor" id="autotoc_md2172"></a>
Considered Alternatives</h1>
<ul>
<li>keep current situation</li>
</ul>
<h1><a class="anchor" id="autotoc_md2173"></a>
Decision</h1>
<p>Also allow <code>libelektra-extra</code> (and maybe other explicitly documented libraries) to access private Key/KeySet. Put struct definitions of Key/KeySet in a separate header file, which gets included by parts that need it.</p>
<p>All currently planned libraries and their respective API prefixes are listed in the <a href="#notes">Notes</a> below.</p>
<h1><a class="anchor" id="autotoc_md2174"></a>
Rationale</h1>
<ul>
<li>allows various users (plugins, applications) to link to (more or less) exactly what they need</li>
<li>allows symbol versioning on different levels (for different evolving libraries)</li>
<li>allows alternative implementation of parts of Elektra, e.g. a libcore written in Rust</li>
<li>facilitates code reuse between plugins</li>
</ul>
<h1><a class="anchor" id="autotoc_md2175"></a>
Implications</h1>
<ul>
<li>we need to clearly communicate which plugins must be exactly in the version of the <code>libelektra-core</code></li>
<li>all libraries will share a versioning scheme and are only supported if used in the same version</li>
</ul>
<h1><a class="anchor" id="autotoc_md2176"></a>
Related Decisions</h1>
<h1><a class="anchor" id="autotoc_md2177"></a>
Notes</h1>
<ul>
<li><p class="startli"><code>libelektra-core</code>: The core minimal API of Elektra. Defines what <code>ElektraKey</code> and <code>ElektraKeyset</code> are, and contains the minimal API for manipulating them.</p>
<p class="startli"><b>Prefixes:</b> <code>elektraKey*</code> and <code>elektraKeyset*</code></p>
</li>
<li><p class="startli"><code>libelektra-kdb</code>: The main API for interfacing with the KDB.</p>
<p class="startli"><b>Prefix:</b> <code>elektraKdb*</code></p>
</li>
<li><p class="startli"><code>libelektra-lowlevel-c</code>: Additional C APIs that are useful when working with <code>ElektraKey</code> and <code>ElektraKeyset</code>, but not are not minimal API. Specifically targets C and not intended for use via bindings.</p>
<p class="startli"><b>Prefixes:</b> <code>elektraCKey*</code>, <code>elektraCKeyset*</code></p>
</li>
<li><p class="startli"><code>libelektra-highlevel-c</code>: The C high-level API for reading/writing configuration with Elektra. Intended for use by applications. Partially intended for use with code-generation. Specifically targets C and not intended for use via bindings.</p>
<p class="startli"><b>Prefix:</b> <code>elektraHlc*</code> (Note: Even though there isn't any other <code>highlevel</code> implementation, <code>c</code> suffix to show this lib is only for C)</p>
</li>
<li><p class="startli"><code>libelektra-opts</code>: The API for parsing command-line arguments according to Elektra's spec.</p>
<p class="startli"><b>Prefix:</b> <code>elektraOpts*</code></p>
</li>
<li><p class="startli"><code>libelektra-notification</code>: The API for setting up callbacks and automatically updated variables linked to changes in the KDB.</p>
<p class="startli"><b>Prefix:</b> <code>elektraNotification*</code></p>
</li>
<li><p class="startli"><code>libelektra-io</code>: Elektra's API for asynchronous operations.</p>
<p class="startli"><b>Prefix:</b> <code>elektraIo*</code></p>
</li>
<li><p class="startli"><code>libelektra-merge</code>: The API for merging and/or detecting conflicts between two keysets.</p>
<p class="startli"><b>Prefix:</b> <code>elektraMerge*</code></p>
</li>
<li><p class="startli"><code>libelektra-plugin</code>: The plugin API. It forms the base for all plugins and contains the functions required to implement a plugin. It also contains the API for interacting with (other) plugins. This includes loading plugins and calling exported functions.</p>
<p class="startli">Note: This library comes with two separate headers. One for implementing a plugin and another for loading/calling plugins.</p>
<p class="startli"><b>Prefix:</b> <code>elektraPlugin*</code> (Note: previously <code>libelektra-plugin</code> merged with <code>libelektra-invoke</code>)</p>
</li>
<li><p class="startli"><code>libelektra-pluginload</code>: Internal static library, linked into <code>libelektra-plugin</code> (re-exported) and <code>libelektra-kdb</code> (not exported). Contains the code for loading plugins.</p>
<p class="startli"><b>Prefix:</b>: <code>elektraPlugin*</code> (shared with <code>libelektra-plugin</code> because exported there)</p>
</li>
<li><p class="startli"><code>libelektra-mount</code>: The API for manipulating mountpoints.</p>
<p class="startli"><b>Prefix:</b> <code>elektraMount*</code></p>
</li>
<li><p class="startli"><code>libelektra-type</code>: The API that defines Elektra's type system.</p>
<p class="startli"><b>Names:</b> <code>elektra&lt;TYPE&gt;ToString</code> and <code>elektraKeyTo&lt;TYPE&gt;</code> (Note: extracted from <code>libelektra-ease</code>)</p>
</li>
<li><p class="startli"><code>libelektra-extra</code>: Contains extra APIs for <code>ElektraKey</code> and <code>ElektraKeyset</code> beyond the minimal API of <code>libelektra-core</code>. These APIs are things that could be considered part of the classes for <code>ElektraKey</code> and <code>ElektraKeyset</code>, but which we do not consider minimal. The APIs should not specifically target C (see <code>libelektra-lowlevel-c</code> for that) and should be usable via bindings (if appropriate for the other language).</p>
<p class="startli"><b>Prefix:</b> <code>elektraExtra*</code> (Note: includes <code>elektraExtraKeysetCut</code>, etc.; may also include stuff from old <code>libelektra-ease</code> or <code>libelektra-meta</code>)</p>
</li>
<li><p class="startli"><code>libelektra-ease</code>: A collection of various other APIs that help when interacting with <code>ElektraKey</code> and <code>ElektraKeyset</code>. These APIs go beyond what could be considered part of the "classes" for <code>ElektraKey</code> and <code>ElektraKeyset</code> (e.g., SHA256 hashes). The APIs should not specifically target C (see <code>libelektra-lowlevel-c</code> for that) and should be usable via bindings (if appropriate for the other language).</p>
<p class="startli"><b>Prefix:</b> <code>elektraEase*</code> (Note: rest of old <code>libelektra-ease</code>, merged with <code>libelektra-meta</code>; cleanup needed)</p>
</li>
<li><p class="startli"><code>libelektra-utility</code>: Standalone helper functions that don't depend on <code>libelektra-core</code></p>
<p class="startli"><b>Prefix:</b> <code>elektraUtil*</code></p>
</li>
<li><p class="startli"><code>libelektra-base</code>: Internal static library, linked into <code>libelektra-core</code> (not exported) and <code>libelektra-utility</code> (partially re-exported). Contains helper functions for e.g., memory allocations, string formatting, etc.</p>
<p class="startli"><b>Prefix:</b> <code>elektra*</code> (for internal), <code>elektraUtil*</code> (for exported) </p>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

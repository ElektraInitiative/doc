<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: quickdump</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: quickdump </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="src_plugins_quickdump_benchmarks_md"></a>
Benchmarks</h1>
<h2><code>benchmark_storage</code></h2>
<p>The following table shows a summary of the results of a <code>benchmark_storage</code> run: NOTE: <code>factor</code> is always <code>dump / quickdump</code> (bigger = <code>quickdump</code> is faster), this test was only run with version 1, see below for a comparison of with version 2</p>
<table class="doxtable">
<tr>
<th>operation </th><th align="right">dump (µs) </th><th align="right">quickdump (µs) </th><th align="right">factor  </th></tr>
<tr>
<td>write keyset </td><td align="right">81661 </td><td align="right">4741 </td><td align="right">17.224 </td></tr>
<tr>
<td>read keyset </td><td align="right">94782 </td><td align="right">44673 </td><td align="right">2.122 </td></tr>
<tr>
<td>iterate keyset </td><td align="right">125 </td><td align="right">135 </td><td align="right">0.926 </td></tr>
<tr>
<td>delete keyset </td><td align="right">1823 </td><td align="right">3518 </td><td align="right">0.518 </td></tr>
<tr>
<td>re-read keyset </td><td align="right">92939 </td><td align="right">43749 </td><td align="right">2.124 </td></tr>
<tr>
<td>strcmp key name </td><td align="right">609 </td><td align="right">1826 </td><td align="right">0.334 </td></tr>
<tr>
<td>strcmp key value </td><td align="right">684 </td><td align="right">761 </td><td align="right">0.899 </td></tr>
</table>
<h2><code>benchmark_plugingetset</code></h2>
<p>A script was used to generate KeySets with <code>2</code>, <code>200</code>, <code>2,000</code>, <code>200,000</code> and <code>2,000,000</code> Keys. For keynames we used increasing numbers (prefixed with <code>_</code> to keep correct order), each key had a randomized value of 15 characters. Additionally we added 4 metakeys to each key. The names and values of these were created similarly.</p>
<p>The parent key used was <code>dir/tests/bench</code>.</p>
<p>We then used <a href="https://github.com/sharkdp/hyperfine"><code>hyperfine</code></a> to compare the performance of <code>dump</code> and <code>quickdump</code>.</p>
<div class="fragment"><div class="line">hyperfine --min-runs 25 &#39;benchmark_plugingetset &lt;path&gt; &lt;parent&gt; dump&#39; &#39;benchmark_plugingetset &lt;path&gt; &lt;parent&gt; quickdump&#39;</div></div><!-- fragment --><p>This means we used the same key sets for each of the runs, but the key values shouldn't really matter. It also means that no shared metadata (<code>keyCopyMeta</code>) was involved.</p>
<p>We also used a modified version of <code>benchmark_plugingetset</code> that returned after the <code>get</code> call, to test the <code>get</code> performance by itself. Because <code>set</code> doesn't scale linearly because of the checks for <code>keyCopyMeta</code>, the largest KeySet was only used for the <code>get</code> only version. (The test was aborted after the initial run of <code>dump</code> took longer than all the runs for <code>quickdump</code> together.)</p>
<p>The complete results can be found in <a href="https://github.com/ElektraInitiative/rawdata">this repository</a> and the files used for these benchmarks are quite big and can be found in another <a href="https://github.com/kodebach/eqd-bench">separate repository</a>.</p>
<h3>Raw data sizes</h3>
<p>For reference in the file size tests below, here is a list of the raw data sizes of the keysets. These sizes are calculated as the sum of: 1) length of all keynames 2) length of all key values 3) length of all metakeys 4) length of all meta values All lengths include a null terminator, sizes are calculated once with (WP) and once without the parent key (WOP).</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">raw size WP (B) </th><th align="right">raw size WOP (B)  </th></tr>
<tr>
<td>2 </td><td align="right">252 </td><td align="right">220 </td></tr>
<tr>
<td>200 </td><td align="right">25784 </td><td align="right">22584 </td></tr>
<tr>
<td>2000 </td><td align="right">262786 </td><td align="right">229786 </td></tr>
<tr>
<td>200000 </td><td align="right">26977790 </td><td align="right">23777790 </td></tr>
<tr>
<td>20000000 </td><td align="right">273777792 </td><td align="right">241777792 </td></tr>
</table>
<h3>Version 1</h3>
<h4>File sizes</h4>
<p><code>factor</code> is <code>dump / quickdump</code> like above (bigger = <code>quickdump</code> has smaller files)</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">dump (B) </th><th align="right">quickdump (B) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">430 </td><td align="right">412 </td><td align="right">1.04 </td></tr>
<tr>
<td>200 </td><td align="right">41206 </td><td align="right">40988 </td><td align="right">1.01 </td></tr>
<tr>
<td>2000 </td><td align="right">415807 </td><td align="right">413788 </td><td align="right">1.00 </td></tr>
<tr>
<td>200000 </td><td align="right">42377809 </td><td align="right">42177788 </td><td align="right">1.00 </td></tr>
<tr>
<td>2000000 </td><td align="right">427777810 </td><td align="right">425777788 </td><td align="right">1.00 </td></tr>
</table>
<h4>get and set</h4>
<p>The values are mean ± standard deviation. <code>factor</code> is <code>dump / quickdump</code> like above</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">dump (s) </th><th align="right">quickdump (s) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">0.0016 ± 0.0003 </td><td align="right">0.0006 ± 0.0001 </td><td align="right">2.67 </td></tr>
<tr>
<td>200 </td><td align="right">0.0091 ± 0.0009 </td><td align="right">0.0018 ± 0.0000 </td><td align="right">5.06 </td></tr>
<tr>
<td>2000 </td><td align="right">0.0770 ± 0.0030 </td><td align="right">0.0127 ± 0.0008 </td><td align="right">6.06 </td></tr>
<tr>
<td>200000 </td><td align="right">10.7876 ± 4.2564 </td><td align="right">1.2640 ± 0.0061 </td><td align="right">8.53 </td></tr>
</table>
<h4>get only</h4>
<p>The values are mean ± standard deviation. <code>factor</code> is <code>dump / quickdump</code> like above</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">dump (s) </th><th align="right">quickdump (s) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">0.0014 ± 0.0000 </td><td align="right">0.0005 ± 0.0000 </td><td align="right">2.8 </td></tr>
<tr>
<td>200 </td><td align="right">0.0032 ± 0.0005 </td><td align="right">0.0013 ± 0.0002 </td><td align="right">2.46 </td></tr>
<tr>
<td>2000 </td><td align="right">0.0179 ± 0.0002 </td><td align="right">0.0086 ± 0.0008 </td><td align="right">2.08 </td></tr>
<tr>
<td>200000 </td><td align="right">1.6830 ± 0.0222 </td><td align="right">0.8515 ± 0.0048 </td><td align="right">1.98 </td></tr>
<tr>
<td>2000000 </td><td align="right">17.1814 ± 0.2201 </td><td align="right">8.8808 ± 0.0344 </td><td align="right">1.93 </td></tr>
</table>
<h3>Version 2</h3>
<p>Running the same <code>benchmark_plugingetset</code> tests with version 2 of the plugin yields:</p>
<h4>File sizes</h4>
<p><code>factor</code> is <code>v1 / v2</code> like above (bigger is better)</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">quickdump v1 (B) </th><th align="right">quickdump v2 (B) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">412 </td><td align="right">380 </td><td align="right">1.08 </td></tr>
<tr>
<td>200 </td><td align="right">40988 </td><td align="right">23788 </td><td align="right">1.72 </td></tr>
<tr>
<td>2000 </td><td align="right">413788 </td><td align="right">381788 </td><td align="right">1.08 </td></tr>
<tr>
<td>200000 </td><td align="right">42177788 </td><td align="right">38977788 </td><td align="right">1.08 </td></tr>
<tr>
<td>2000000 </td><td align="right">425777788 </td><td align="right">393777788 </td><td align="right">1.08 </td></tr>
</table>
<h4>get and set</h4>
<p>The values are mean ± standard deviation. <code>factor</code> is <code>v1 / v2</code>, i.e. bigger is better</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">quickdump v1 (s) </th><th align="right">quickdump v2 (s) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">0.0006 ± 0.0001 </td><td align="right">0.0013 ± 0.0035 </td><td align="right">0.47 </td></tr>
<tr>
<td>200 </td><td align="right">0.0018 ± 0.0000 </td><td align="right">0.0018 ± 0.0002 </td><td align="right">1.02 </td></tr>
<tr>
<td>2000 </td><td align="right">0.0127 ± 0.0008 </td><td align="right">0.0112 ± 0.0021 </td><td align="right">1.13 </td></tr>
<tr>
<td>200000 </td><td align="right">1.2640 ± 0.0061 </td><td align="right">1.2602 ± 0.0372 </td><td align="right">1.00 </td></tr>
<tr>
<td>2000000 </td><td align="right">- </td><td align="right">13.2104 ± 0.1185 </td><td align="right">- </td></tr>
</table>
<h4>get only</h4>
<p>The values are mean ± standard deviation. <code>factor</code> is <code>v1 / v2</code> like above</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">quickdump v1 (s) </th><th align="right">quickdump v2 (s) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">0.0005 ± 0.0000 </td><td align="right">0.0006 ± 0.0001 </td><td align="right">0.88 </td></tr>
<tr>
<td>200 </td><td align="right">0.0014 ± 0.0002 </td><td align="right">0.0010 ± 0.0001 </td><td align="right">1.33 </td></tr>
<tr>
<td>2000 </td><td align="right">0.0086 ± 0.0008 </td><td align="right">0.0072 ± 0.0005 </td><td align="right">1.20 </td></tr>
<tr>
<td>200000 </td><td align="right">0.8516 ± 0.0048 </td><td align="right">0.6413 ± 0.0082 </td><td align="right">1.33 </td></tr>
<tr>
<td>2000000 </td><td align="right">8.8809 ± 0.0345 </td><td align="right">6.3756 ± 0.0443 </td><td align="right">1.39 </td></tr>
</table>
<h3>Version 3</h3>
<p>Running the same <code>benchmark_plugingetset</code> tests with version 3 of the plugin yields:</p>
<h4>File sizes</h4>
<p><code>factor</code> is <code>v1 / v2</code> like above (bigger is better)</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">quickdump v2 (B) </th><th align="right">quickdump v3 (B) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">380 </td><td align="right">240 </td><td align="right">1.58 </td></tr>
<tr>
<td>200 </td><td align="right">23788 </td><td align="right">23788 </td><td align="right">1.00 </td></tr>
<tr>
<td>2000 </td><td align="right">381788 </td><td align="right">241788 </td><td align="right">1.58 </td></tr>
<tr>
<td>200000 </td><td align="right">38977788 </td><td align="right">24977788 </td><td align="right">1.56 </td></tr>
<tr>
<td>2000000 </td><td align="right">393777788 </td><td align="right">253777788 </td><td align="right">1.55 </td></tr>
</table>
<h4>get and set</h4>
<p>The values are mean ± standard deviation. <code>factor</code> is <code>v2 / v3</code>, i.e. bigger is better</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">quickdump v2 (s) </th><th align="right">quickdump v3 (s) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">0.0013 ± 0.0035 </td><td align="right">0.0012 ± 0.0029 </td><td align="right">1.08 </td></tr>
<tr>
<td>200 </td><td align="right">0.0018 ± 0.0002 </td><td align="right">0.0017 ± 0.0002 </td><td align="right">1.05 </td></tr>
<tr>
<td>2000 </td><td align="right">0.0112 ± 0.0021 </td><td align="right">0.0106 ± 0.0011 </td><td align="right">1.06 </td></tr>
<tr>
<td>200000 </td><td align="right">1.2602 ± 0.0372 </td><td align="right">1.1473 ± 0.0287 </td><td align="right">1.10 </td></tr>
<tr>
<td>2000000 </td><td align="right">13.2104 ± 0.1185 </td><td align="right">11.5082 ± 0.2624 </td><td align="right">1.15 </td></tr>
</table>
<h4>get only</h4>
<p>The values are mean ± standard deviation. <code>factor</code> is <code>v2 / v3</code> like above</p>
<table class="doxtable">
<tr>
<th>no. of keys </th><th align="right">quickdump v2 (s) </th><th align="right">quickdump v3 (s) </th><th align="right">factor  </th></tr>
<tr>
<td>2 </td><td align="right">0.0006 ± 0.0001 </td><td align="right">0.0006 ± 0.0001 </td><td align="right">0.99 </td></tr>
<tr>
<td>200 </td><td align="right">0.0010 ± 0.0001 </td><td align="right">0.0012 ± 0.0001 </td><td align="right">0.84 </td></tr>
<tr>
<td>2000 </td><td align="right">0.0072 ± 0.0005 </td><td align="right">0.0070 ± 0.0004 </td><td align="right">1.03 </td></tr>
<tr>
<td>200000 </td><td align="right">0.6413 ± 0.0082 </td><td align="right">0.6288 ± 0.0218 </td><td align="right">1.02 </td></tr>
<tr>
<td>2000000 </td><td align="right">6.3756 ± 0.0443 </td><td align="right">6.2309 ± 0.0462 </td><td align="right">1.02 </td></tr>
</table>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugin: sync</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin: sync </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>infos = Information about the sync plugin is in keys below</li>
<li>infos/author = Markus Raab <a href="#" onclick="location.href='mai'+'lto:'+'ele'+'kt'+'ra@'+'li'+'bel'+'ek'+'tra'+'.o'+'rg'; return false;">elekt<span style="display: none;">.nosp@m.</span>ra@l<span style="display: none;">.nosp@m.</span>ibele<span style="display: none;">.nosp@m.</span>ktra<span style="display: none;">.nosp@m.</span>.org</a></li>
<li>infos/licence = BSD</li>
<li>infos/provides = sync</li>
<li>infos/needs =</li>
<li>infos/placements = precommit</li>
<li>infos/status = recommended productive maintained tested nodep libc final</li>
<li>infos/description = Makes sure that config file is written to disc</li>
</ul>
<p>Storage plugins usually do not use fsync (2) for writing their file to disc. That means that the content of the file could be in some buffer and not on the hard disc.</p>
<p>This is good for power saving on laptops, but not a good idea on production use otherwise. So it is strongly recommended to always add this plugin.</p>
<p>Just add this plugin to the list of plugins during mounting, e.g.</p>
<div class="fragment"><div class="line">kdb mount file.dump /important dump sync</div></div><!-- fragment --><p>Then when you observe the change of a value, e.g.</p>
<div class="fragment"><div class="line">strace kdb set user:/important/key value</div></div><!-- fragment --><p>you can see, done by storage:</p>
<div class="fragment"><div class="line">open(&quot;/home/markus/.kdb/file.dump.16874:1409592592.95084.tmp&quot;,</div><div class="line">        O_WRONLY|O_CREAT|O_TRUNC, 0666) = 4</div><div class="line">write(4, &quot;kdbOpen 1\n&quot;, 10)             = 10</div><div class="line">write(4, &quot;ksNew 1\n&quot;, 8)                = 8</div><div class="line">write(4, &quot;keyNew 19 6\n&quot;, 12)           = 12</div><div class="line">write(4, &quot;user:/important/key\0value\0\n&quot;, 26) = 26</div><div class="line">write(4, &quot;keyEnd\n&quot;, 7)                 = 7</div><div class="line">write(4, &quot;ksEnd\n&quot;, 6)                  = 6</div><div class="line">close(4)                                = 0</div></div><!-- fragment --><p>then done by sync:</p>
<div class="fragment"><div class="line">open(&quot;/home/markus/.kdb/file.dump.16874:1409592592.95084.tmp&quot;,</div><div class="line">        O_RDWR) = 4</div><div class="line">fsync(4)                                = 0</div><div class="line">close(4)                                = 0</div></div><!-- fragment --><p>and finally commit + sync of directory by resolver:</p>
<div class="fragment"><div class="line">rename(&quot;/home/markus/.kdb/file.dump.16874:1409592592.95084.tmp&quot;,</div><div class="line">        &quot;/home/markus/.kdb/file.dump&quot;) = 0</div><div class="line">stat(&quot;/home/markus/.kdb/file.dump&quot;, {st_mode=S_IFREG|0644,</div><div class="line">        st_size=69, ...}) = 0</div><div class="line">fcntl(3, F_SETLK, {type=F_UNLCK, whence=SEEK_SET, start=0,</div><div class="line">        len=0}) = 0</div><div class="line">close(3)                                = 0</div><div class="line">open(&quot;/home/markus/.kdb&quot;,</div><div class="line">        O_RDONLY|O_NONBLOCK|O_DIRECTORY|O_CLOEXEC) = 3</div><div class="line">fsync(3)                                = 0</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

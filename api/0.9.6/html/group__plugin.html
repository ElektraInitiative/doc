<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Plugins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Plugins</div>  </div>
</div><!--header-->
<div class="contents">

<p>Elektra plugin framework.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gacb05c902e4014535589db4193da87460"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gacb05c902e4014535589db4193da87460">ELEKTRA_PLUGIN_FUNCTION</a>(function)&#160;&#160;&#160;ELEKTRA_PLUGIN_FUNCTION2 (ELEKTRA_PLUGIN_NAME_C, function)</td></tr>
<tr class="memdesc:gacb05c902e4014535589db4193da87460"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declare a plugin's function name suitable for compilation variants (see doc/tutorials).  <a href="group__plugin.html#gacb05c902e4014535589db4193da87460">More...</a><br /></td></tr>
<tr class="separator:gacb05c902e4014535589db4193da87460"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabdcb97b05a83130c32bbde75db80fc50"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gabdcb97b05a83130c32bbde75db80fc50">ELEKTRA_README</a>&#160;&#160;&#160;ELEKTRA_README2 (ELEKTRA_PLUGIN_NAME_C)</td></tr>
<tr class="memdesc:gabdcb97b05a83130c32bbde75db80fc50"><td class="mdescLeft">&#160;</td><td class="mdescRight">The filename for inclusion of the readme for compilation variants (see doc/tutorials).  <a href="group__plugin.html#gabdcb97b05a83130c32bbde75db80fc50">More...</a><br /></td></tr>
<tr class="separator:gabdcb97b05a83130c32bbde75db80fc50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaab1842b82272e6d4235b6a71587a64d9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gaab1842b82272e6d4235b6a71587a64d9">ELEKTRA_SET_ERROR</a>(number,  key,  text)</td></tr>
<tr class="memdesc:gaab1842b82272e6d4235b6a71587a64d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the error in the keys metadata.  <a href="group__plugin.html#gaab1842b82272e6d4235b6a71587a64d9">More...</a><br /></td></tr>
<tr class="separator:gaab1842b82272e6d4235b6a71587a64d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3e4fc2c20d8e64bed7a54bb1af882e34"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga3e4fc2c20d8e64bed7a54bb1af882e34">ELEKTRA_SET_ERRORF</a>(number,  key,  formatstring, ...)</td></tr>
<tr class="memdesc:ga3e4fc2c20d8e64bed7a54bb1af882e34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the error in the keys metadata.  <a href="group__plugin.html#ga3e4fc2c20d8e64bed7a54bb1af882e34">More...</a><br /></td></tr>
<tr class="separator:ga3e4fc2c20d8e64bed7a54bb1af882e34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2bbb3bc3a3bdaf5b34b52de81886a098"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga2bbb3bc3a3bdaf5b34b52de81886a098">ELEKTRA_ADD_WARNINGF</a>(number,  key,  formatstring, ...)</td></tr>
<tr class="memdesc:ga2bbb3bc3a3bdaf5b34b52de81886a098"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a warning in the keys metadata.  <a href="group__plugin.html#ga2bbb3bc3a3bdaf5b34b52de81886a098">More...</a><br /></td></tr>
<tr class="separator:ga2bbb3bc3a3bdaf5b34b52de81886a098"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3da3bdb0f41710adda9eee3d7adac9ff"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff">ELEKTRA_ADD_WARNING</a>(number,  key,  text)</td></tr>
<tr class="memdesc:ga3da3bdb0f41710adda9eee3d7adac9ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a warning in the keys metadata.  <a href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff">More...</a><br /></td></tr>
<tr class="separator:ga3da3bdb0f41710adda9eee3d7adac9ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2f5d331ed725c6af0c511a0aa8677daa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga2f5d331ed725c6af0c511a0aa8677daa">ELEKTRA_SET_ERROR_GET</a>(parentKey)</td></tr>
<tr class="memdesc:ga2f5d331ed725c6af0c511a0aa8677daa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set error in <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a> when opening the file failed.  <a href="group__plugin.html#ga2f5d331ed725c6af0c511a0aa8677daa">More...</a><br /></td></tr>
<tr class="separator:ga2f5d331ed725c6af0c511a0aa8677daa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf526686f01dbacd68671732aad4b5d76"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gaf526686f01dbacd68671732aad4b5d76">ELEKTRA_SET_ERROR_SET</a>(parentKey)</td></tr>
<tr class="memdesc:gaf526686f01dbacd68671732aad4b5d76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set error in <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> when opening the file failed.  <a href="group__plugin.html#gaf526686f01dbacd68671732aad4b5d76">More...</a><br /></td></tr>
<tr class="separator:gaf526686f01dbacd68671732aad4b5d76"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga8dd092048e972a3f0c9c9f54eb41576e"><td class="memItemLeft" align="right" valign="top">Plugin *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga8dd092048e972a3f0c9c9f54eb41576e">elektraPluginExport</a> (const char *pluginName,...)</td></tr>
<tr class="memdesc:ga8dd092048e972a3f0c9c9f54eb41576e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allows one to Export Methods for a Plugin.  <a href="group__plugin.html#ga8dd092048e972a3f0c9c9f54eb41576e">More...</a><br /></td></tr>
<tr class="separator:ga8dd092048e972a3f0c9c9f54eb41576e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga644bead796506c172817724051c977c9"><td class="memItemLeft" align="right" valign="top">KeySet *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga644bead796506c172817724051c977c9">elektraPluginGetConfig</a> (Plugin *handle)</td></tr>
<tr class="memdesc:ga644bead796506c172817724051c977c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the configuration of that plugin.  <a href="group__plugin.html#ga644bead796506c172817724051c977c9">More...</a><br /></td></tr>
<tr class="separator:ga644bead796506c172817724051c977c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf4b941a52ff55d0ca2a9158d90208ef2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">elektraPluginSetData</a> (Plugin *plugin, void *data)</td></tr>
<tr class="memdesc:gaf4b941a52ff55d0ca2a9158d90208ef2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store a pointer to plugin specific data.  <a href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">More...</a><br /></td></tr>
<tr class="separator:gaf4b941a52ff55d0ca2a9158d90208ef2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaafcf3216b46292f222b8cc7828b4dd20"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a> (Plugin *plugin)</td></tr>
<tr class="memdesc:gaafcf3216b46292f222b8cc7828b4dd20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a pointer to the plugin specific data stored before.  <a href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">More...</a><br /></td></tr>
<tr class="separator:gaafcf3216b46292f222b8cc7828b4dd20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga436cda13ed70c0face08661a90620bf6"><td class="memItemLeft" align="right" valign="top">KeySet *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga436cda13ed70c0face08661a90620bf6">elektraPluginGetGlobalKeySet</a> (Plugin *plugin)</td></tr>
<tr class="memdesc:ga436cda13ed70c0face08661a90620bf6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a pointer to the global keyset.  <a href="group__plugin.html#ga436cda13ed70c0face08661a90620bf6">More...</a><br /></td></tr>
<tr class="separator:ga436cda13ed70c0face08661a90620bf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga23c2eb3584e38a4d494eb8f91e5e3d8d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga23c2eb3584e38a4d494eb8f91e5e3d8d">elektraDocOpen</a> (Plugin *handle, Key *warningsKey)</td></tr>
<tr class="memdesc:ga23c2eb3584e38a4d494eb8f91e5e3d8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize data for the plugin.  <a href="group__plugin.html#ga23c2eb3584e38a4d494eb8f91e5e3d8d">More...</a><br /></td></tr>
<tr class="separator:ga23c2eb3584e38a4d494eb8f91e5e3d8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1236aefe5b2baf8b7bf636ba5aa9ea29"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29">elektraDocClose</a> (Plugin *handle, Key *warningsKey)</td></tr>
<tr class="memdesc:ga1236aefe5b2baf8b7bf636ba5aa9ea29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finalize the plugin.  <a href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29">More...</a><br /></td></tr>
<tr class="separator:ga1236aefe5b2baf8b7bf636ba5aa9ea29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacb69f3441c6d84241b4362f958fbe313"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313">elektraDocGet</a> (Plugin *handle, KeySet *returned, Key *parentKey)</td></tr>
<tr class="memdesc:gacb69f3441c6d84241b4362f958fbe313"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get data from storage to application.  <a href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313">More...</a><br /></td></tr>
<tr class="separator:gacb69f3441c6d84241b4362f958fbe313"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae65781a1deb34efc79c8cb9d9174842c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c">elektraDocSet</a> (Plugin *handle, KeySet *returned, Key *parentKey)</td></tr>
<tr class="memdesc:gae65781a1deb34efc79c8cb9d9174842c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set data from application to storage.  <a href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c">More...</a><br /></td></tr>
<tr class="separator:gae65781a1deb34efc79c8cb9d9174842c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga52807469897b8acbada5bcc6b8c8ceab"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga52807469897b8acbada5bcc6b8c8ceab">elektraDocCommit</a> (Plugin *handle, KeySet *returned, Key *parentKey)</td></tr>
<tr class="memdesc:ga52807469897b8acbada5bcc6b8c8ceab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make changes to storage final.  <a href="group__plugin.html#ga52807469897b8acbada5bcc6b8c8ceab">More...</a><br /></td></tr>
<tr class="separator:ga52807469897b8acbada5bcc6b8c8ceab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad74b35f558ac7c3262f6069c5c47dc79"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#gad74b35f558ac7c3262f6069c5c47dc79">elektraDocError</a> (Plugin *handle, KeySet *returned, Key *parentKey)</td></tr>
<tr class="memdesc:gad74b35f558ac7c3262f6069c5c47dc79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rollback in case of errors.  <a href="group__plugin.html#gad74b35f558ac7c3262f6069c5c47dc79">More...</a><br /></td></tr>
<tr class="separator:gad74b35f558ac7c3262f6069c5c47dc79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1c8702efe0f3853c2d7ecca0889f78e8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__plugin.html#ga1c8702efe0f3853c2d7ecca0889f78e8">elektraDocCheckConf</a> (Key *errorKey, KeySet *conf)</td></tr>
<tr class="memdesc:ga1c8702efe0f3853c2d7ecca0889f78e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate plugin configuration at mount time.  <a href="group__plugin.html#ga1c8702efe0f3853c2d7ecca0889f78e8">More...</a><br /></td></tr>
<tr class="separator:ga1c8702efe0f3853c2d7ecca0889f78e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Elektra plugin framework. </p>
<dl class="section since"><dt>Since</dt><dd>version 0.4.9, Elektra can dynamically load different key storage plugins.</dd>
<dd>
version 0.7.0 Elektra can have multiple backends, mounted at any place in the key database.</dd>
<dd>
version 0.8.0 Elektra backends are composed out of multiple plugins.</dd></dl>
<p>To get started with writing plugins, first read our <a href="doc_tutorials_plugins_md.html">Plugin Tutorial</a>.</p>
<p>A plugin can implement any functionality related to configuration. There are 6 possible entry points for a plugin.</p><ul>
<li><a class="el" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313" title="Get data from storage to application.">elektraDocGet()</a> will be called when configuration or the plugin's contract is retrieved from the key database</li>
<li><a class="el" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c" title="Set data from application to storage.">elektraDocSet()</a> will be called when configuration is written to the key database</li>
<li><a class="el" href="group__plugin.html#ga23c2eb3584e38a4d494eb8f91e5e3d8d" title="Initialize data for the plugin.">elektraDocOpen()</a> will be called before any other method of the plugin is called</li>
<li><a class="el" href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29" title="Finalize the plugin.">elektraDocClose()</a> will be called as last method</li>
<li><a class="el" href="group__plugin.html#gad74b35f558ac7c3262f6069c5c47dc79" title="Rollback in case of errors.">elektraDocError()</a> will be called when <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> failed (to give the plugin a chance to recover/undo its actions)</li>
<li><a class="el" href="group__plugin.html#ga8dd092048e972a3f0c9c9f54eb41576e" title="Allows one to Export Methods for a Plugin.">elektraPluginExport()</a> exports all methods for the plugin.</li>
</ul>
<p>Additionally, make sure that you write a contract in the README.md. It is used by the build system and the mounting tools.</p>
<p>Plugins should not change the keyname of the key that is passed to the entry points (warningsKey and parentKey in this documentation). These keys might be members in keysets.</p>
<p>The names described here contain "Doc" within the method's name just because the plugin described in this document is called doc (the doxygen source was generated from <a class="el" href="doc_8h.html">src/plugins/doc/doc.h</a>). Always replace Doc with the name of the plugin you are going to implement or use <a class="el" href="group__plugin.html#gacb05c902e4014535589db4193da87460" title="Declare a plugin&#39;s function name suitable for compilation variants (see doc/tutorials).">ELEKTRA_PLUGIN_FUNCTION</a>.</p>
<dl class="section user"><dt>Overview</dt><dd>There are different types of plugins for different concerns. They all only have the entry points as defined above. The types of plugins handled in this document:<ul>
<li>A storage plugin gets an empty keyset in <a class="el" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313" title="Get data from storage to application.">elektraDocGet()</a> and constructs the information out from a file. In <a class="el" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c" title="Set data from application to storage.">elektraDocSet()</a> the keyset is written to a file. <br  />
 Other persistent storage then a file is not handled within this document because it involves many other issues. For files the resolver plugin already takes care of transactions and rollback. So the storage plugin is the source and dump as known from pipes and filters.</li>
<li>A filter plugin is a plugin which operates on existing keys. It may process or change the keyset. Or it may reject specific keysets which do not meet some criteria.</li>
</ul>
</dd></dl>
<p>Use following include to have the functions that are not implemented by you available:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdbplugin_8h.html">kdbplugin.h</a>&gt;</span></div>
<div class="ttc" id="akdbplugin_8h_html"><div class="ttname"><a href="kdbplugin_8h.html">kdbplugin.h</a></div><div class="ttdoc">Methods for plugin programing.</div></div>
</div><!-- fragment --> <dl class="section user"><dt>Error and Warnings</dt><dd>In case of trouble, in some methods you can use the macro <a class="el" href="group__plugin.html#gaab1842b82272e6d4235b6a71587a64d9" title="Sets the error in the keys metadata.">ELEKTRA_SET_ERROR</a> (in other methods it is not allowed). You might add warnings with the macro <a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNING</a>. You can also use their pedants that accept a format string as known by printf: <a class="el" href="group__plugin.html#ga3e4fc2c20d8e64bed7a54bb1af882e34" title="Sets the error in the keys metadata.">ELEKTRA_SET_ERRORF</a> and <a class="el" href="group__plugin.html#ga2bbb3bc3a3bdaf5b34b52de81886a098" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNINGF</a>. Make sure to define and use a macro in the error specification (/src/error/specification) so that you can easily renumber your error/warning codes:</dd></dl>
<div class="fragment"><div class="line">number:60</div>
<div class="line">description:Invalid Line encountered</div>
<div class="line">severity:error</div>
<div class="line">macro:NOEOF</div>
<div class="line">module:simpleini</div>
</div><!-- fragment --><p> Use following include to have the macros for setting the error and adding the warnings available:</p>
<div class="fragment"><div class="line"><span class="comment">// using namespace ckdb; // for C++</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdberrors_8h.html">kdberrors.h</a>&gt;</span></div>
<div class="ttc" id="akdberrors_8h_html"><div class="ttname"><a href="kdberrors_8h.html">kdberrors.h</a></div><div class="ttdoc">Provides all macros and definitions which are used for emitting error or warnings.</div></div>
</div><!-- fragment --><p> and then you can use:</p>
<div class="fragment"><div class="line">ELEKTRA_SET_VALIDATION_SYNTACTIC_ERROR ( parentKey, <span class="stringliteral">&quot;Not at the end of file&quot;</span>);</div>
</div><!-- fragment --><p> Note that you also need to return -1 in the case of error. See individual description of entry points to implement below.</p>
<dl class="section user"><dt>Global KeySet Handle</dt><dd></dd></dl>
<p>This keyset allows plugins to exchange information with other plugins.</p>
<p>The keyset is initialized by the KDB for all plugins, except for manually created plugins with <code><a class="el" href="elektra_2plugin_8c.html#a32a70a7876542c51d153164ac5108a57" title="Opens a plugin.">elektraPluginOpen()</a></code>. The global keyset is tied to a KDB handle, initialized on <code><a class="el" href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5" title="Opens the session with the Key database.">kdbOpen()</a></code> and deleted on <code><a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f" title="Closes the session with the Key database.">kdbClose()</a></code>.</p>
<p>Obtain a handle to the global keyset and work with it:</p>
<div class="fragment"><div class="line">        KeySet * globalKS = <a class="code" href="group__plugin.html#ga436cda13ed70c0face08661a90620bf6">elektraPluginGetGlobalKeySet</a> (plugin);</div>
<div class="line">        <span class="comment">// now we can read something from the global keyset</span></div>
<div class="line">        <span class="comment">// or add something for us or others to read</span></div>
<div class="line">        Key * important = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;user:/global/myDocKey&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a>, <span class="stringliteral">&quot;global plugins can see me&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">        <a class="code" href="group__keyset.html#gaa5a1d467a4d71041edce68ea7748ce45">ksAppendKey</a> (globalKS, important);</div>
<div class="ttc" id="agroup__key_html_gad23c65b44bf48d773759e1f9a4d43b89"><div class="ttname"><a href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a></div><div class="ttdeci">Key * keyNew(const char *name,...)</div><div class="ttdoc">A practical way to fully create a Key object in one step.</div><div class="ttdef"><b>Definition:</b> key.c:150</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a></div><div class="ttdeci">@ KEY_END</div><div class="ttdef"><b>Definition:</b> kdbenum.c:97</div></div>
<div class="ttc" id="agroup__key_html_gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e"><div class="ttname"><a href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a></div><div class="ttdeci">@ KEY_VALUE</div><div class="ttdef"><b>Definition:</b> kdbenum.c:89</div></div>
<div class="ttc" id="agroup__keyset_html_gaa5a1d467a4d71041edce68ea7748ce45"><div class="ttname"><a href="group__keyset.html#gaa5a1d467a4d71041edce68ea7748ce45">ksAppendKey</a></div><div class="ttdeci">ssize_t ksAppendKey(KeySet *ks, Key *toAppend)</div><div class="ttdoc">Appends a Key to the end of ks.</div><div class="ttdef"><b>Definition:</b> keyset.c:786</div></div>
<div class="ttc" id="agroup__plugin_html_ga436cda13ed70c0face08661a90620bf6"><div class="ttname"><a href="group__plugin.html#ga436cda13ed70c0face08661a90620bf6">elektraPluginGetGlobalKeySet</a></div><div class="ttdeci">KeySet * elektraPluginGetGlobalKeySet(Plugin *plugin)</div><div class="ttdoc">Get a pointer to the global keyset.</div><div class="ttdef"><b>Definition:</b> plugin/plugin.c:167</div></div>
</div><!-- fragment --><p> Clean up keys which you do not need any more, to keep the global keyset compact:</p>
<div class="fragment"><div class="line">        <span class="comment">// clean up parts of the global keyset which we do not need</span></div>
<div class="line">        Key * cutKey = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;user:/global/myDocKey&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">        KeySet * notNeeded = <a class="code" href="group__keyset.html#ga6b00cf82b59af4d883a9bad6cf4a4a4a">ksCut</a> (globalKS, cutKey);</div>
<div class="line">        <a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a> (notNeeded);</div>
<div class="ttc" id="agroup__keyset_html_ga27e5c16473b02a422238c8d970db7ac8"><div class="ttname"><a href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a></div><div class="ttdeci">int ksDel(KeySet *ks)</div><div class="ttdoc">A destructor for KeySet objects.</div><div class="ttdef"><b>Definition:</b> keyset.c:451</div></div>
<div class="ttc" id="agroup__keyset_html_ga6b00cf82b59af4d883a9bad6cf4a4a4a"><div class="ttname"><a href="group__keyset.html#ga6b00cf82b59af4d883a9bad6cf4a4a4a">ksCut</a></div><div class="ttdeci">KeySet * ksCut(KeySet *ks, const Key *cutpoint)</div><div class="ttdoc">Cuts out all Keys from KeySet ks that are below or at cutpoint.</div><div class="ttdef"><b>Definition:</b> keyset.c:1281</div></div>
</div><!-- fragment --> <dl class="section user"><dt>Further help</dt><dd>Do not hesitate to open an issue if anything is unclear. </dd></dl>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga3da3bdb0f41710adda9eee3d7adac9ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3da3bdb0f41710adda9eee3d7adac9ff">&#9670;&nbsp;</a></span>ELEKTRA_ADD_WARNING</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELEKTRA_ADD_WARNING</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">number, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">key, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">text&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a warning in the keys metadata. </p>
<p>Include <a class="el" href="kdberrors_8h.html" title="Provides all macros and definitions which are used for emitting error or warnings.">kdberrors.h</a> to make it work:</p>
<div class="fragment"><div class="line"><span class="comment">// using namespace ckdb; // for C++</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdberrors_8h.html">kdberrors.h</a>&gt;</span></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">number</td><td>the warning number from src/error/specification </td></tr>
    <tr><td class="paramname">key</td><td>to write the error to </td></tr>
    <tr><td class="paramname">text</td><td>additional text for the user </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga2bbb3bc3a3bdaf5b34b52de81886a098"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2bbb3bc3a3bdaf5b34b52de81886a098">&#9670;&nbsp;</a></span>ELEKTRA_ADD_WARNINGF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELEKTRA_ADD_WARNINGF</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">number, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">key, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">formatstring, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a warning in the keys metadata. </p>
<p>Include <a class="el" href="kdberrors_8h.html" title="Provides all macros and definitions which are used for emitting error or warnings.">kdberrors.h</a> to make it work:</p>
<div class="fragment"><div class="line"><span class="comment">// using namespace ckdb; // for C++</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdberrors_8h.html">kdberrors.h</a>&gt;</span></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">number</td><td>the warning number from src/error/specification </td></tr>
    <tr><td class="paramname">key</td><td>to write the error to </td></tr>
    <tr><td class="paramname">formatstring</td><td>a format string as in printf </td></tr>
    <tr><td class="paramname">...</td><td>further arguments as in printf </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gacb05c902e4014535589db4193da87460"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacb05c902e4014535589db4193da87460">&#9670;&nbsp;</a></span>ELEKTRA_PLUGIN_FUNCTION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELEKTRA_PLUGIN_FUNCTION</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">function</td><td>)</td>
          <td>&#160;&#160;&#160;ELEKTRA_PLUGIN_FUNCTION2 (ELEKTRA_PLUGIN_NAME_C, function)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Declare a plugin's function name suitable for compilation variants (see doc/tutorials). </p>
<p>It can be used in the same way as <a class="el" href="group__plugin.html#ga8dd092048e972a3f0c9c9f54eb41576e" title="Allows one to Export Methods for a Plugin.">elektraPluginExport()</a>. </p><dl class="section see"><dt>See also</dt><dd>ELEKTRA_PLUGIN_EXPORT</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">plugin</td><td>the name of the plugin </td></tr>
    <tr><td class="paramname">function</td><td>which function it is (open, close, get, set, error, commit) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gabdcb97b05a83130c32bbde75db80fc50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabdcb97b05a83130c32bbde75db80fc50">&#9670;&nbsp;</a></span>ELEKTRA_README</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELEKTRA_README&#160;&#160;&#160;ELEKTRA_README2 (ELEKTRA_PLUGIN_NAME_C)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The filename for inclusion of the readme for compilation variants (see doc/tutorials). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">plugin</td><td>the name of the plugin </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gaab1842b82272e6d4235b6a71587a64d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaab1842b82272e6d4235b6a71587a64d9">&#9670;&nbsp;</a></span>ELEKTRA_SET_ERROR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELEKTRA_SET_ERROR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">number, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">key, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">text&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the error in the keys metadata. </p>
<p>Include <a class="el" href="kdberrors_8h.html" title="Provides all macros and definitions which are used for emitting error or warnings.">kdberrors.h</a> to make it work. Only a single error can be written to the key.</p>
<div class="fragment"><div class="line"><span class="comment">// using namespace ckdb; // for C++</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdberrors_8h.html">kdberrors.h</a>&gt;</span></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">number</td><td>the error number from src/error/specification </td></tr>
    <tr><td class="paramname">key</td><td>to write the error to </td></tr>
    <tr><td class="paramname">text</td><td>additional text for the user </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga2f5d331ed725c6af0c511a0aa8677daa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2f5d331ed725c6af0c511a0aa8677daa">&#9670;&nbsp;</a></span>ELEKTRA_SET_ERROR_GET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELEKTRA_SET_ERROR_GET</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">parentKey</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set error in <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a> when opening the file failed. </p>
<p>Assumes that error reason is in <code>errno</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">parentKey</td><td>key to append error to</td></tr>
  </table>
  </dd>
</dl>
<p>To use it include:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdbplugin_8h.html">kdbplugin.h</a>&gt;</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// using namespace ckdb; // for C++</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdberrors_8h.html">kdberrors.h</a>&gt;</span></div>
</div><!-- fragment --> <dl class="section return"><dt>Returns</dt><dd></dd></dl>

</div>
</div>
<a id="gaf526686f01dbacd68671732aad4b5d76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf526686f01dbacd68671732aad4b5d76">&#9670;&nbsp;</a></span>ELEKTRA_SET_ERROR_SET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELEKTRA_SET_ERROR_SET</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">parentKey</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set error in <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> when opening the file failed. </p>
<p>Assumes that error reason is in <code>errno</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">parentKey</td><td>key to append error to</td></tr>
  </table>
  </dd>
</dl>
<p>To use it include:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdbplugin_8h.html">kdbplugin.h</a>&gt;</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// using namespace ckdb; // for C++</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdberrors_8h.html">kdberrors.h</a>&gt;</span></div>
</div><!-- fragment --> <dl class="section return"><dt>Returns</dt><dd></dd></dl>

</div>
</div>
<a id="ga3e4fc2c20d8e64bed7a54bb1af882e34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3e4fc2c20d8e64bed7a54bb1af882e34">&#9670;&nbsp;</a></span>ELEKTRA_SET_ERRORF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELEKTRA_SET_ERRORF</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">number, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">key, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">formatstring, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the error in the keys metadata. </p>
<p>Include <a class="el" href="kdberrors_8h.html" title="Provides all macros and definitions which are used for emitting error or warnings.">kdberrors.h</a> to make it work. Only a single error can be written to the key.</p>
<div class="fragment"><div class="line"><span class="comment">// using namespace ckdb; // for C++</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kdberrors_8h.html">kdberrors.h</a>&gt;</span></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">number</td><td>the error number from src/error/specification </td></tr>
    <tr><td class="paramname">key</td><td>to write the error to </td></tr>
    <tr><td class="paramname">formatstring</td><td>a format string as in printf </td></tr>
    <tr><td class="paramname">...</td><td>further arguments as in printf </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga1c8702efe0f3853c2d7ecca0889f78e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1c8702efe0f3853c2d7ecca0889f78e8">&#9670;&nbsp;</a></span>elektraDocCheckConf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraDocCheckConf </td>
          <td>(</td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>errorKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">KeySet *&#160;</td>
          <td class="paramname"><em>conf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Validate plugin configuration at mount time. </p>
<p>During the mount phase the BackendBuilder calls this method, if it is provided by the plugin.</p>
<p>In this method the plugin configuration can be checked for validity or integrity. Missing items can be added to complete the configuration.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">errorKey</td><td>is used to propagate error messages to the caller </td></tr>
    <tr><td class="paramname">conf</td><td>contains the plugin configuration to be validated</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success: the configuration was OK and has not been changed. </td></tr>
    <tr><td class="paramname">1</td><td>on success: the configuration has been changed and now it is OK. </td></tr>
    <tr><td class="paramname">-1</td><td>on failure: the configuration was not OK and could not be fixed. Set an error using <a class="el" href="group__plugin.html#gaab1842b82272e6d4235b6a71587a64d9" title="Sets the error in the keys metadata.">ELEKTRA_SET_ERROR</a> to inform the user what went wrong. Additionally you can add any number of warnings with <a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNING</a>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga1236aefe5b2baf8b7bf636ba5aa9ea29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1236aefe5b2baf8b7bf636ba5aa9ea29">&#9670;&nbsp;</a></span>elektraDocClose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraDocClose </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>warningsKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finalize the plugin. </p>
<p>Called prior to unloading the plugin dynamic module. After this function is called, it is ensured that no functions from your plugin will ever be accessed again.</p>
<p>Make sure to free all memory that your plugin requested at runtime. Also make sure to free what you stored by <a class="el" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2" title="Store a pointer to plugin specific data.">elektraPluginSetData()</a> before.</p>
<p>So for the Doc plugin we need to:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29">elektraDocClose</a> (Plugin * handle, Key * warningsKey ELEKTRA_UNUSED)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="internal_8c.html#a7f572149d2e0bfe18023a6ac969f195c">elektraFree</a> (<a class="code" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a> (handle));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 0; <span class="comment">/* success */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__plugin_html_ga1236aefe5b2baf8b7bf636ba5aa9ea29"><div class="ttname"><a href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29">elektraDocClose</a></div><div class="ttdeci">int elektraDocClose(Plugin *handle, Key *warningsKey)</div><div class="ttdoc">Finalize the plugin.</div></div>
<div class="ttc" id="agroup__plugin_html_gaafcf3216b46292f222b8cc7828b4dd20"><div class="ttname"><a href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20">elektraPluginGetData</a></div><div class="ttdeci">void * elektraPluginGetData(Plugin *plugin)</div><div class="ttdoc">Get a pointer to the plugin specific data stored before.</div><div class="ttdef"><b>Definition:</b> plugin/plugin.c:147</div></div>
<div class="ttc" id="ainternal_8c_html_a7f572149d2e0bfe18023a6ac969f195c"><div class="ttname"><a href="internal_8c.html#a7f572149d2e0bfe18023a6ac969f195c">elektraFree</a></div><div class="ttdeci">void elektraFree(void *ptr)</div><div class="ttdoc">Free memory of Elektra or its backends.</div><div class="ttdef"><b>Definition:</b> internal.c:306</div></div>
</div><!-- fragment --><p> After this call, libelektra.so will unload the plugin library, so this is the point to shutdown any affairs with the storage.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of the plugin </td></tr>
    <tr><td class="paramname">warningsKey</td><td>can be used to to add warnings using <a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNING</a> (Do not add errors!)</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>on success (no other return value currently allowed)</td></tr>
    <tr><td class="paramname">-1</td><td>on problems (only use ELEKTRA_ADD_WARNING, but never set an error).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f" title="Closes the session with the Key database.">kdbClose()</a> </dd>
<dd>
<a class="el" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20" title="Get a pointer to the plugin specific data stored before.">elektraPluginGetData()</a>, <a class="el" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2" title="Store a pointer to plugin specific data.">elektraPluginSetData()</a> and <a class="el" href="group__plugin.html#ga644bead796506c172817724051c977c9" title="Returns the configuration of that plugin.">elektraPluginGetConfig()</a> </dd></dl>

</div>
</div>
<a id="ga52807469897b8acbada5bcc6b8c8ceab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga52807469897b8acbada5bcc6b8c8ceab">&#9670;&nbsp;</a></span>elektraDocCommit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraDocCommit </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">KeySet *&#160;</td>
          <td class="paramname"><em>returned</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>parentKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Make changes to storage final. </p>
<p>Once the content of <code>returned</code> has been stored, the changes need to be made final and visible to other users, which is done by this function. After this function has been called, no further changes can be made by elektraPluginSet() functions within this invocation of <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a>.</p>
<p>The function is called by <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> if the plugin implementing it fulfills the <code>commit</code> role.</p>
<dl class="section pre"><dt>Precondition</dt><dd>The keyset <code>returned</code> holds all stored keys which must be made final for this keyset. The keyset is sorted and rewinded.</dd>
<dd>
The <code>parentKey</code> is the key which is the ancestor for all other keys in the keyset. The first key of the keyset <code>returned</code> has the same keyname. The name of the parentKey marks the mountpoint.</dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>the storage changes made by the plugins previously called by <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> will be made final.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> for caller.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of the plugin </td></tr>
    <tr><td class="paramname">returned</td><td>contains a keyset with relevant keys </td></tr>
    <tr><td class="paramname">parentKey</td><td>contains the location of the relevant keys within the key database.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>on success </td></tr>
    <tr><td class="paramname">0</td><td>on success without any changes </td></tr>
    <tr><td class="paramname">-1</td><td>on failure. The cause of the error needs to be entered into parentKey, <a class="el" href="group__keyset.html#gace0444eb8ec958a429794f8586fc72e7" title="Get the internal cursor of the KeySet.">ksGetCursor()</a> needs to point to the position where the error appeared. The error can be specified using <a class="el" href="group__plugin.html#gaab1842b82272e6d4235b6a71587a64d9" title="Sets the error in the keys metadata.">ELEKTRA_SET_ERROR</a>. <a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNING</a> can be used to add warnings for the user. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gad74b35f558ac7c3262f6069c5c47dc79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad74b35f558ac7c3262f6069c5c47dc79">&#9670;&nbsp;</a></span>elektraDocError()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraDocError </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">KeySet *&#160;</td>
          <td class="paramname"><em>returned</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>parentKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rollback in case of errors. </p>
<p>First for all plugins <a class="el" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c" title="Set data from application to storage.">elektraDocSet()</a> will be called. If any plugin had problems before the commit (done by the resolver plugin), we can safely rollback our changes.</p>
<p>This method is rarely used by plugins, it is mainly used for resolvers (to implement rollback) or by logging plugins. It is not needed for storage plugins, because they only operate on temporary files created by the resolver.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of the plugin </td></tr>
    <tr><td class="paramname">returned</td><td>contains a keyset with relevant keys </td></tr>
    <tr><td class="paramname">parentKey</td><td>contains the information where to set the keys. can be used to add warnings with the macro <a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNING</a>, but do not add errors!</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>on success </td></tr>
    <tr><td class="paramname">0</td><td>on success with no action </td></tr>
    <tr><td class="paramname">-1</td><td>on failure (you can add warnings, but we are already in an error state, so do not set the error). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gacb69f3441c6d84241b4362f958fbe313"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacb69f3441c6d84241b4362f958fbe313">&#9670;&nbsp;</a></span>elektraDocGet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraDocGet </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">KeySet *&#160;</td>
          <td class="paramname"><em>returned</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>parentKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get data from storage to application. </p>
<p>Retrieve information from a permanent storage to construct a keyset.</p>
<h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>The <a class="el" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313" title="Get data from storage to application.">elektraDocGet()</a> function handle everything related to receiving keys.</p>
<h2><a class="anchor" id="contract"></a>
Contract Handling</h2>
<p>The contract is a keyset that needs to be returned if the parentKey is system:/elektra/modules/yourpluginname.</p>
<p>Which keys and their meaning is specified in doc/CONTRACT.ini</p>
<p>Here is an example for our doc plugin:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313">elektraDocGet</a> (Plugin * plugin ELEKTRA_UNUSED, KeySet * returned, Key * parentKey)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (!strcmp (<a class="code" href="group__keyname.html#ga8e805c726a60da921d3736cda7813513">keyName</a> (parentKey), <span class="stringliteral">&quot;system:/elektra/modules/doc&quot;</span>))</div>
<div class="line">        {</div>
<div class="line">                KeySet * contract =</div>
<div class="line">                        <a class="code" href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a> (30, <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a>, <span class="stringliteral">&quot;doc plugin waits for your orders&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/exports&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/exports/open&quot;</span>, KEY_FUNC, <a class="code" href="group__plugin.html#ga23c2eb3584e38a4d494eb8f91e5e3d8d">elektraDocOpen</a>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/exports/close&quot;</span>, KEY_FUNC, <a class="code" href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29">elektraDocClose</a>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/exports/get&quot;</span>, KEY_FUNC, <a class="code" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313">elektraDocGet</a>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/exports/set&quot;</span>, KEY_FUNC, <a class="code" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c">elektraDocSet</a>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/exports/commit&quot;</span>, KEY_FUNC, <a class="code" href="group__plugin.html#ga52807469897b8acbada5bcc6b8c8ceab">elektraDocCommit</a>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/exports/error&quot;</span>, KEY_FUNC, <a class="code" href="group__plugin.html#gad74b35f558ac7c3262f6069c5c47dc79">elektraDocError</a>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/exports/checkconf&quot;</span>, KEY_FUNC, <a class="code" href="group__plugin.html#ga1c8702efe0f3853c2d7ecca0889f78e8">elektraDocCheckConf</a>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>),</div>
<div class="line">#include <a class="code" href="group__plugin.html#gabdcb97b05a83130c32bbde75db80fc50">ELEKTRA_README</a></div>
<div class="line">                               <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<span class="stringliteral">&quot;system:/elektra/modules/doc/infos/version&quot;</span>, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8ac66e4a49d09212b79f5754ca6db5bd2e">KEY_VALUE</a>, PLUGINVERSION, <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>), <a class="code" href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a>);</div>
<div class="line">                <a class="code" href="group__keyset.html#ga21eb9c3a14a604ee3a8bdc779232e7b7">ksAppend</a> (returned, contract);</div>
<div class="line">                <a class="code" href="group__keyset.html#ga27e5c16473b02a422238c8d970db7ac8">ksDel</a> (contract);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">return</span> 1; <span class="comment">/* success */</span></div>
<div class="line">        }</div>
<div class="ttc" id="agroup__keyname_html_ga8e805c726a60da921d3736cda7813513"><div class="ttname"><a href="group__keyname.html#ga8e805c726a60da921d3736cda7813513">keyName</a></div><div class="ttdeci">const char * keyName(const Key *key)</div><div class="ttdoc">Returns a pointer to the abbreviated real internal key name.</div><div class="ttdef"><b>Definition:</b> elektra/keyname.c:254</div></div>
<div class="ttc" id="agroup__keyset_html_ga21eb9c3a14a604ee3a8bdc779232e7b7"><div class="ttname"><a href="group__keyset.html#ga21eb9c3a14a604ee3a8bdc779232e7b7">ksAppend</a></div><div class="ttdeci">ssize_t ksAppend(KeySet *ks, const KeySet *toAppend)</div><div class="ttdoc">Append all Keys in toAppend to the end of the KeySet ks.</div><div class="ttdef"><b>Definition:</b> keyset.c:898</div></div>
<div class="ttc" id="agroup__keyset_html_ga671e1aaee3ae9dc13b4834a4ddbd2c3c"><div class="ttname"><a href="group__keyset.html#ga671e1aaee3ae9dc13b4834a4ddbd2c3c">ksNew</a></div><div class="ttdeci">KeySet * ksNew(size_t alloc,...)</div><div class="ttdoc">Allocate, initialize and return a new KeySet object.</div><div class="ttdef"><b>Definition:</b> keyset.c:229</div></div>
<div class="ttc" id="agroup__keyset_html_ga7a28fce3773b2c873c94ac80b8b4cd54"><div class="ttname"><a href="group__keyset.html#ga7a28fce3773b2c873c94ac80b8b4cd54">KS_END</a></div><div class="ttdeci">#define KS_END</div><div class="ttdoc">End of a list of keys.</div><div class="ttdef"><b>Definition:</b> kdbenum.c:158</div></div>
<div class="ttc" id="agroup__plugin_html_ga1c8702efe0f3853c2d7ecca0889f78e8"><div class="ttname"><a href="group__plugin.html#ga1c8702efe0f3853c2d7ecca0889f78e8">elektraDocCheckConf</a></div><div class="ttdeci">int elektraDocCheckConf(Key *errorKey, KeySet *conf)</div><div class="ttdoc">Validate plugin configuration at mount time.</div></div>
<div class="ttc" id="agroup__plugin_html_ga23c2eb3584e38a4d494eb8f91e5e3d8d"><div class="ttname"><a href="group__plugin.html#ga23c2eb3584e38a4d494eb8f91e5e3d8d">elektraDocOpen</a></div><div class="ttdeci">int elektraDocOpen(Plugin *handle, Key *warningsKey)</div><div class="ttdoc">Initialize data for the plugin.</div></div>
<div class="ttc" id="agroup__plugin_html_ga52807469897b8acbada5bcc6b8c8ceab"><div class="ttname"><a href="group__plugin.html#ga52807469897b8acbada5bcc6b8c8ceab">elektraDocCommit</a></div><div class="ttdeci">int elektraDocCommit(Plugin *handle, KeySet *returned, Key *parentKey)</div><div class="ttdoc">Make changes to storage final.</div></div>
<div class="ttc" id="agroup__plugin_html_gabdcb97b05a83130c32bbde75db80fc50"><div class="ttname"><a href="group__plugin.html#gabdcb97b05a83130c32bbde75db80fc50">ELEKTRA_README</a></div><div class="ttdeci">#define ELEKTRA_README</div><div class="ttdoc">The filename for inclusion of the readme for compilation variants (see doc/tutorials).</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:56</div></div>
<div class="ttc" id="agroup__plugin_html_gacb69f3441c6d84241b4362f958fbe313"><div class="ttname"><a href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313">elektraDocGet</a></div><div class="ttdeci">int elektraDocGet(Plugin *handle, KeySet *returned, Key *parentKey)</div><div class="ttdoc">Get data from storage to application.</div></div>
<div class="ttc" id="agroup__plugin_html_gad74b35f558ac7c3262f6069c5c47dc79"><div class="ttname"><a href="group__plugin.html#gad74b35f558ac7c3262f6069c5c47dc79">elektraDocError</a></div><div class="ttdeci">int elektraDocError(Plugin *handle, KeySet *returned, Key *parentKey)</div><div class="ttdoc">Rollback in case of errors.</div></div>
<div class="ttc" id="agroup__plugin_html_gae65781a1deb34efc79c8cb9d9174842c"><div class="ttname"><a href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c">elektraDocSet</a></div><div class="ttdeci">int elektraDocSet(Plugin *handle, KeySet *returned, Key *parentKey)</div><div class="ttdoc">Set data from application to storage.</div></div>
</div><!-- fragment --><p> Some clauses of the contract, especially the description of the plugin can be done more conveniently directly in a README.md that is included by <a class="el" href="group__plugin.html#gabdcb97b05a83130c32bbde75db80fc50" title="The filename for inclusion of the readme for compilation variants (see doc/tutorials).">ELEKTRA_README</a>.</p>
<h2><a class="anchor" id="storage"></a>
Storage Plugins</h2>
<p>For storage plugins the filename is written in the value of the parentKey. So the first task of the plugin is to open that file. Then it should parse its content and construct a keyset with all information of that file.</p>
<p>You need to be able to reconstruct the same file with the information of the keyset. So be sure to copy all comments, whitespaces and so on into some metadata of the keys. Otherwise the information is lost after writing the file the next time.</p>
<p>Now lets look at an example how the typical <a class="el" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313" title="Get data from storage to application.">elektraDocGet()</a> might be implemented. To explain we introduce some pseudo functions which do all the work with the storage (which is of course 90% of the work for a real plugin):</p><ul>
<li>parse_key will parse a key and a value from an open file handle</li>
</ul>
<p>The typical loop for a storage plugin will be like:</p>
<div class="fragment"><div class="line">        FILE * fp = fopen (<a class="code" href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05">keyString</a> (parentKey), <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">        <span class="keywordtype">char</span> * key = 0;</div>
<div class="line">        <span class="keywordtype">char</span> * value = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (parseKey (fp, &amp;key, &amp;value) &gt;= 1)</div>
<div class="line">        {</div>
<div class="line">                Key * read = <a class="code" href="group__key.html#gad23c65b44bf48d773759e1f9a4d43b89">keyNew</a> (<a class="code" href="group__keyname.html#ga8e805c726a60da921d3736cda7813513">keyName</a> (parentKey), <a class="code" href="group__key.html#gga9b703ca49f48b482def322b77d3e6bc8aa8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group__keyname.html#gaa70593a2c772c4b7bc33423b9b10a270">keyAddName</a> (read, key) == -1)</div>
<div class="line">                {</div>
<div class="line">                        ELEKTRA_ADD_VALIDATION_SYNTACTIC_WARNINGF (parentKey, <span class="stringliteral">&quot;Key name %s is not valid, discarding key&quot;</span>, key);</div>
<div class="line">                        <a class="code" href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a> (read);</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="group__keyvalue.html#ga622bde1eb0e0c4994728331326340ef2">keySetString</a> (read, value);</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="group__keyset.html#gaa5a1d467a4d71041edce68ea7748ce45">ksAppendKey</a> (returned, read);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (feof (fp) == 0)</div>
<div class="line">        {</div>
<div class="line">                fclose (fp);</div>
<div class="line">                ELEKTRA_SET_VALIDATION_SYNTACTIC_ERROR (parentKey, <span class="stringliteral">&quot;Invalid line encountered: not at the end of file&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        fclose (fp);</div>
<div class="ttc" id="agroup__key_html_ga3df95bbc2494e3e6703ece5639be5bb1"><div class="ttname"><a href="group__key.html#ga3df95bbc2494e3e6703ece5639be5bb1">keyDel</a></div><div class="ttdeci">int keyDel(Key *key)</div><div class="ttdoc">A destructor for Key objects.</div><div class="ttdef"><b>Definition:</b> key.c:509</div></div>
<div class="ttc" id="agroup__keyname_html_gaa70593a2c772c4b7bc33423b9b10a270"><div class="ttname"><a href="group__keyname.html#gaa70593a2c772c4b7bc33423b9b10a270">keyAddName</a></div><div class="ttdeci">ssize_t keyAddName(Key *key, const char *newName)</div><div class="ttdoc">Add an already escaped name part to the Key's name.</div><div class="ttdef"><b>Definition:</b> elektra/keyname.c:564</div></div>
<div class="ttc" id="agroup__keyvalue_html_ga622bde1eb0e0c4994728331326340ef2"><div class="ttname"><a href="group__keyvalue.html#ga622bde1eb0e0c4994728331326340ef2">keySetString</a></div><div class="ttdeci">ssize_t keySetString(Key *key, const char *newStringValue)</div><div class="ttdoc">Set the value for key as newStringValue.</div><div class="ttdef"><b>Definition:</b> keyvalue.c:372</div></div>
<div class="ttc" id="agroup__keyvalue_html_ga880936f2481d28e6e2acbe7486a21d05"><div class="ttname"><a href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05">keyString</a></div><div class="ttdeci">const char * keyString(const Key *key)</div><div class="ttdoc">Get a pointer to the c-string representing the value.</div><div class="ttdef"><b>Definition:</b> keyvalue.c:206</div></div>
</div><!-- fragment --><p> When opening files, make sure to use the macros <a class="el" href="group__plugin.html#gaf526686f01dbacd68671732aad4b5d76" title="Set error in kdbSet() when opening the file failed.">ELEKTRA_SET_ERROR_SET</a> and <a class="el" href="group__plugin.html#ga2f5d331ed725c6af0c511a0aa8677daa" title="Set error in kdbGet() when opening the file failed.">ELEKTRA_SET_ERROR_GET</a> for errors, as shown here:</p>
<div class="fragment"><div class="line">        FILE * fp = fopen (<a class="code" href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05">keyString</a> (parentKey), <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (!fp)</div>
<div class="line">        {</div>
<div class="line">                <a class="code" href="group__plugin.html#gaf526686f01dbacd68671732aad4b5d76">ELEKTRA_SET_ERROR_SET</a> (parentKey);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="ttc" id="agroup__plugin_html_gaf526686f01dbacd68671732aad4b5d76"><div class="ttname"><a href="group__plugin.html#gaf526686f01dbacd68671732aad4b5d76">ELEKTRA_SET_ERROR_SET</a></div><div class="ttdeci">#define ELEKTRA_SET_ERROR_SET(parentKey)</div><div class="ttdoc">Set error in kdbSet() when opening the file failed.</div><div class="ttdef"><b>Definition:</b> doc.h:227</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="filter"></a>
Filter Plugins</h2>
<p>For filter plugins the actual task is rather unspecified. You basically can do anything with the keyset. To get roundtrip properties you might want to undo any changes you did in <a class="el" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c" title="Set data from application to storage.">elektraDocSet()</a>.</p>
<p>The pseudo functions (which do the real work) are:</p><ul>
<li>do_action() which processes every key in this filter</li>
</ul>
<div class="fragment"><div class="line">        Key * k;</div>
<div class="line">        <a class="code" href="group__keyset.html#gabe793ff51f1728e3429c84a8a9086b70">ksRewind</a> (returned);</div>
<div class="line">        <span class="keywordflow">while</span> ((k = <a class="code" href="group__keyset.html#ga317321c9065b5a4b3e33fe1c399bcec9">ksNext</a> (returned)) != 0)</div>
<div class="line">        {</div>
<div class="line">                doAction (k);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 1; <span class="comment">// success</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__keyset_html_ga317321c9065b5a4b3e33fe1c399bcec9"><div class="ttname"><a href="group__keyset.html#ga317321c9065b5a4b3e33fe1c399bcec9">ksNext</a></div><div class="ttdeci">Key * ksNext(KeySet *ks)</div><div class="ttdoc">Returns the next Key in a KeySet.</div><div class="ttdef"><b>Definition:</b> keyset.c:1489</div></div>
<div class="ttc" id="agroup__keyset_html_gabe793ff51f1728e3429c84a8a9086b70"><div class="ttname"><a href="group__keyset.html#gabe793ff51f1728e3429c84a8a9086b70">ksRewind</a></div><div class="ttdeci">int ksRewind(KeySet *ks)</div><div class="ttdoc">Rewinds the KeySet internal cursor.</div><div class="ttdef"><b>Definition:</b> keyset.c:1451</div></div>
</div><!-- fragment --><dl class="section pre"><dt>Precondition</dt><dd>The caller <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a> will make sure before you are called that the parentKey:<ul>
<li>is a valid key (means that it is a system or user key).</li>
<li>is your mountpoint and that your plugin is responsible for it. </li>
</ul>
</dd>
<dd>
and that the returned:<ul>
<li>is a valid keyset.</li>
<li>your plugin is only called when needed (e.g. only if file was modified)</li>
<li>has <code>all</code> keys related to your plugin.</li>
<li>contains only valid keys below (see <a class="el" href="group__keytest.html#ga03332b5d97c76a4fd2640aca4762b8df" title="Check if the Key check is below the Key key or not.">keyIsBelow()</a>) your parentKey.</li>
<li>is in a sorted order (given implicit by KeySet) </li>
</ul>
</dd>
<dd>
and that the handle:<ul>
<li>is valid for your plugin.</li>
<li>that <a class="el" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20" title="Get a pointer to the plugin specific data stored before.">elektraPluginGetData()</a> contains the same handle for lifetime of your plugin.</li>
</ul>
</dd>
<dd>
The caller <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a> will make sure that afterwards you were called, that:<ul>
<li>other plugins below your plugin will be called again recursively.</li>
<li>that all keys are merged to one keyset the user gets</li>
<li>that all keys (that should not be removed) are passed to <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> if writing to disc is needed.</li>
</ul>
</dd></dl>
<dl class="section invariant"><dt>Invariant</dt><dd>There are no global variables and <a class="el" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2" title="Store a pointer to plugin specific data.">elektraPluginSetData()</a> stores all information. The handle is to be guaranteed to be the same if it is the same plugin.</dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>The keyset <code>returned</code> has the <code>parentKey</code> and all keys below (<a class="el" href="group__keytest.html#ga03332b5d97c76a4fd2640aca4762b8df" title="Check if the Key check is below the Key key or not.">keyIsBelow()</a>) with all information from the storage. Make sure to return all keys, all directories and also all hidden keys. If some of them are not wished, the caller <a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a> will drop these keys with additional plugins.</dd></dl>
<dl class="section user"><dt>Updating</dt><dd>To get all keys out of the storage over and over again can be very inefficient. You might know a more efficient method to know if the key needs update or not, e.g. by stating it or by an external time stamp info. For file storage plugins this is automatically done for you by the resolver. For other types (e.g. databases) you need to implement your own resolver doing this.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__kdb.html#ga28e385fd9cb7ccfe0b2f1ed2f62453a1" title="Retrieve Keys from a Key database in an atomic and universal way.">kdbGet()</a> for caller.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of <a class="el" href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5">opened </a> key database </td></tr>
    <tr><td class="paramname">returned</td><td>contains a keyset where the function need to append the keys got from the storage. There might be also some keys inside it, see conditions. You may use them to support efficient updating of keys, see updating. </td></tr>
    <tr><td class="paramname">parentKey</td><td>contains the information below which key the keys should be gotten.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>on success </td></tr>
    <tr><td class="paramname">0</td><td>when nothing was to do </td></tr>
    <tr><td class="paramname">-1</td><td>on failure, the current key in returned shows the position. use <a class="el" href="group__plugin.html#gaab1842b82272e6d4235b6a71587a64d9" title="Sets the error in the keys metadata.">ELEKTRA_SET_ERROR</a> of <a class="el" href="kdberrors_8h.html" title="Provides all macros and definitions which are used for emitting error or warnings.">kdberrors.h</a> to define the error code. You additionally can add as many warnings as you would like to add. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga23c2eb3584e38a4d494eb8f91e5e3d8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga23c2eb3584e38a4d494eb8f91e5e3d8d">&#9670;&nbsp;</a></span>elektraDocOpen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraDocOpen </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>warningsKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize data for the plugin. </p>
<p>This is the first method called after dynamically loading this plugin. It is guaranteed, that this method will be called before any other method.</p>
<p>This method is responsible for:</p><ul>
<li>plugin's specific configuration gathering</li>
<li>initialization of all plugin's internal structs</li>
<li>initial setup of all I/O details such as opening a file, connecting to a database, setup connection to a server, iff this cannot be done per invocation in <a class="el" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313" title="Get data from storage to application.">elektraDocGet()</a> and <a class="el" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c" title="Set data from application to storage.">elektraDocSet()</a>.</li>
</ul>
<p>You may also read the configuration you can get with <a class="el" href="group__plugin.html#ga644bead796506c172817724051c977c9" title="Returns the configuration of that plugin.">elektraPluginGetConfig()</a> and transform it into other structures used by your plugin.</p>
<dl class="section note"><dt>Note</dt><dd>The plugin must not have any global variables. If you have one Elektra will not be threadsafe. Do not assume that your plugin will be opened only once or will not be reopened at a later time.</dd></dl>
<p>Instead of global variables the methods <a class="el" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20" title="Get a pointer to the plugin specific data stored before.">elektraPluginGetData()</a> and <a class="el" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2" title="Store a pointer to plugin specific data.">elektraPluginSetData()</a> exist to store and get any information related to your plugin.</p>
<p>The correct substitute for global variables will be:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> global;</div>
<div class="line">} GlobalData;</div>
</div><!-- fragment --><p> and then initialize it using:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__plugin.html#ga23c2eb3584e38a4d494eb8f91e5e3d8d">elektraDocOpen</a> (Plugin * handle, Key * warningsKey ELEKTRA_UNUSED)</div>
<div class="line">{</div>
<div class="line">        GlobalData * data;</div>
<div class="line">        KeySet * config = <a class="code" href="group__plugin.html#ga644bead796506c172817724051c977c9">elektraPluginGetConfig</a> (handle);</div>
<div class="line">        Key * kg = <a class="code" href="group__keyset.html#gad65d2cdcbb5381194a1688e169af8a83">ksLookupByName</a> (config, <span class="stringliteral">&quot;/global&quot;</span>, 0);</div>
<div class="line"> </div>
<div class="line">        data = <a class="code" href="internal_8c.html#a35cdc2e5caed3454cb73b4fc7f37858c">elektraMalloc</a> (<span class="keyword">sizeof</span> (GlobalData));</div>
<div class="line">        data-&gt;global = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (kg) data-&gt;global = atoi (<a class="code" href="group__keyvalue.html#ga880936f2481d28e6e2acbe7486a21d05">keyString</a> (kg));</div>
<div class="line">        <a class="code" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">elektraPluginSetData</a> (handle, data);</div>
<div class="ttc" id="agroup__keyset_html_gad65d2cdcbb5381194a1688e169af8a83"><div class="ttname"><a href="group__keyset.html#gad65d2cdcbb5381194a1688e169af8a83">ksLookupByName</a></div><div class="ttdeci">Key * ksLookupByName(KeySet *ks, const char *name, elektraLookupFlags options)</div><div class="ttdoc">Convenience method to look for a Key contained in ks with name name.</div><div class="ttdef"><b>Definition:</b> keyset.c:2496</div></div>
<div class="ttc" id="agroup__plugin_html_ga644bead796506c172817724051c977c9"><div class="ttname"><a href="group__plugin.html#ga644bead796506c172817724051c977c9">elektraPluginGetConfig</a></div><div class="ttdeci">KeySet * elektraPluginGetConfig(Plugin *handle)</div><div class="ttdoc">Returns the configuration of that plugin.</div><div class="ttdef"><b>Definition:</b> plugin/plugin.c:115</div></div>
<div class="ttc" id="agroup__plugin_html_gaf4b941a52ff55d0ca2a9158d90208ef2"><div class="ttname"><a href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2">elektraPluginSetData</a></div><div class="ttdeci">void elektraPluginSetData(Plugin *plugin, void *data)</div><div class="ttdoc">Store a pointer to plugin specific data.</div><div class="ttdef"><b>Definition:</b> plugin/plugin.c:130</div></div>
<div class="ttc" id="ainternal_8c_html_a35cdc2e5caed3454cb73b4fc7f37858c"><div class="ttname"><a href="internal_8c.html#a35cdc2e5caed3454cb73b4fc7f37858c">elektraMalloc</a></div><div class="ttdeci">void * elektraMalloc(size_t size)</div><div class="ttdoc">Allocate memory for Elektra.</div><div class="ttdef"><b>Definition:</b> internal.c:274</div></div>
</div><!-- fragment --><p> Make sure to free everything you allocate within <a class="el" href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29" title="Finalize the plugin.">elektraDocClose()</a>.</p>
<p>If your plugin has no useful way to startup without config, the module loader would not be able to load the module. We need, however, to still load the plugin to get the contract.</p>
<p>To solve that problem the module loader adds the configuration key /module. Even if your plugin is basically not able to startup successfully, it should still provide a fallback when /module is present, so that <a class="el" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313" title="Get data from storage to application.">elektraDocGet()</a> on system:/elektra/modules can be called successfully later on.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__keyset.html#gad65d2cdcbb5381194a1688e169af8a83">ksLookupByName</a> (config, <span class="stringliteral">&quot;/module&quot;</span>, 0))</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// do some setup that will fail without configuration</span></div>
</div><!-- fragment --><p> Note that for plugins where the contract will be altered based on configuration this specific configuration should be considered. In fact the idea of /module is to get the correct contract.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on error, your plugin will be removed then and the missing plugin added instead. Use <a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNING</a> to indicate the problem. The system will automatically add the information that the plugin was removed, so you do not need the user give that information.</td></tr>
    <tr><td class="paramname">1</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of the plugin </td></tr>
    <tr><td class="paramname">warningsKey</td><td>can be used to add warnings with the macro <a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNING</a> (Do not add errors!) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20" title="Get a pointer to the plugin specific data stored before.">elektraPluginGetData()</a>, <a class="el" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2" title="Store a pointer to plugin specific data.">elektraPluginSetData()</a> and <a class="el" href="group__plugin.html#ga644bead796506c172817724051c977c9" title="Returns the configuration of that plugin.">elektraPluginGetConfig()</a> </dd>
<dd>
<a class="el" href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29" title="Finalize the plugin.">elektraDocClose()</a> </dd></dl>

</div>
</div>
<a id="gae65781a1deb34efc79c8cb9d9174842c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae65781a1deb34efc79c8cb9d9174842c">&#9670;&nbsp;</a></span>elektraDocSet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elektraDocSet </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">KeySet *&#160;</td>
          <td class="paramname"><em>returned</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Key *&#160;</td>
          <td class="paramname"><em>parentKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set data from application to storage. </p>
<p>This function does everything related to set and remove keys in a plugin. There is only one function for that purpose to make implementation of file based plugins much easier.</p>
<p>The keyset <code>returned</code> was filled in with information from the application using elektra and the task of this function is to store it in a permanent way so that a subsequent call of elektraPluginGet() can rebuild the keyset as it was before. See the live cycle to understand:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usercode (KDB * handle, KeySet * keyset, Key * key)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// some more user code</span></div>
<div class="line">        <a class="code" href="group__keyvalue.html#ga622bde1eb0e0c4994728331326340ef2">keySetString</a> (key, <span class="stringliteral">&quot;mycomment&quot;</span>); <span class="comment">// the user changes the key</span></div>
<div class="line">        <a class="code" href="group__keyset.html#gaa5a1d467a4d71041edce68ea7748ce45">ksAppendKey</a> (keyset, key);       <span class="comment">// append the key to the keyset</span></div>
<div class="line">        <a class="code" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf">kdbSet</a> (handle, keyset, 0);      <span class="comment">// and syncs it to disc</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// so now kdbSet is called</span></div>
<div class="line"><span class="keywordtype">int</span> elektraKdbSet (KDB * handle, KeySet * keyset, Key * parentKey)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">        <span class="comment">// find appropriate plugin and then call it:</span></div>
<div class="line">        Plugin * plugin = findPlugin (handle);</div>
<div class="line">        ret = <a class="code" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c">elektraDocSet</a> (plugin, keyset, parentKey);</div>
<div class="line">        <span class="comment">// the keyset with the key (and others for this plugin)</span></div>
<div class="line">        <span class="comment">// will be passed to this function</span></div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// so now elektraPluginSet(), which is the function described here,</span></div>
<div class="line"><span class="comment">// is called:</span></div>
<div class="line"><span class="keywordtype">int</span> elektraPluginSet (Plugin * plugin ELEKTRA_UNUSED, KeySet * returned, Key * parentKey ELEKTRA_UNUSED)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// the task of elektraPluginSet is now to store the keys</span></div>
<div class="line">        Key * k;</div>
<div class="line">        <a class="code" href="group__keyset.html#gabe793ff51f1728e3429c84a8a9086b70">ksRewind</a> (returned);</div>
<div class="line">        <span class="keywordflow">while</span> ((k = <a class="code" href="group__keyset.html#ga317321c9065b5a4b3e33fe1c399bcec9">ksNext</a> (returned)) != 0)</div>
<div class="line">        {</div>
<div class="line">                saveToDisc (k);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 1; <span class="comment">/* success */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__kdb_html_ga11436b058408f83d303ca5e996832bcf"><div class="ttname"><a href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf">kdbSet</a></div><div class="ttdeci">int kdbSet(KDB *handle, KeySet *ks, Key *parentKey)</div><div class="ttdoc">Set Keys to a Key database in an atomic and universal way.</div><div class="ttdef"><b>Definition:</b> kdb.c:1734</div></div>
</div><!-- fragment --><p> Of course all information of every key in the keyset <code>returned</code> need to be stored permanently. So this specification needs to give an exhaustive list of information present in a key.</p>
<dl class="section pre"><dt>Precondition</dt><dd>The keyset <code>returned</code> holds all keys which must be saved permanently for this keyset. The keyset is sorted and rewinded.</dd>
<dd>
The <code>parentKey</code> is the key which is the ancestor for all other keys in the keyset. The first key of the keyset <code>returned</code> has the same keyname. The name of the parentKey marks the mountpoint. The string of the parentKey is the filename to write to.</dd></dl>
<p>Make sure to set all keys, all directories and also all hidden keys. If some of them are not wished, the caller <a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> and plugins will sort them out.</p>
<dl class="section invariant"><dt>Invariant</dt><dd>There are no global variables, but instead <a class="el" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20" title="Get a pointer to the plugin specific data stored before.">elektraPluginGetData()</a> will be used. The handle is the same when it is the same plugin.</dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>The information of the keyset <code>returned</code> is stored permanently.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__kdb.html#ga11436b058408f83d303ca5e996832bcf" title="Set Keys to a Key database in an atomic and universal way.">kdbSet()</a> for caller.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>contains internal information of the plugin </td></tr>
    <tr><td class="paramname">returned</td><td>contains a keyset with relevant keys </td></tr>
    <tr><td class="paramname">parentKey</td><td>contains the information where to set the keys (name is mountpoint your plugin is mounted, string is the file to write to)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>When everything works gracefully return the number of keys you set. The cursor position and the keys remaining in the keyset are not important.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>on success </td></tr>
    <tr><td class="paramname">0</td><td>on success with no changed key in database </td></tr>
    <tr><td class="paramname">-1</td><td>on failure. The cause of the error needs to be added in parentKey You also have to make sure that <a class="el" href="group__keyset.html#gace0444eb8ec958a429794f8586fc72e7" title="Get the internal cursor of the KeySet.">ksGetCursor()</a> shows to the position where the error appeared. Set an error using <a class="el" href="group__plugin.html#gaab1842b82272e6d4235b6a71587a64d9" title="Sets the error in the keys metadata.">ELEKTRA_SET_ERROR</a> to inform the user what went wrong. Additionally you can add any number of warnings with <a class="el" href="group__plugin.html#ga3da3bdb0f41710adda9eee3d7adac9ff" title="Adds a warning in the keys metadata.">ELEKTRA_ADD_WARNING</a>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga8dd092048e972a3f0c9c9f54eb41576e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8dd092048e972a3f0c9c9f54eb41576e">&#9670;&nbsp;</a></span>elektraPluginExport()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Plugin* elektraPluginExport </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pluginName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allows one to Export Methods for a Plugin. </p>
<p>This function must be called within ELEKTRA_PLUGIN_EXPORT. It define the plugin's methods that will be exported.</p>
<p>All KDB methods implemented by the plugin basically could have random names (convention is elektraName*), except ELEKTRA_PLUGIN_EXPORT.</p>
<p>This is the single symbol that will be looked up when loading the plugin, and the first method of the backend implementation that will be called.</p>
<p>You need to use a macro so that both dynamic and static loading of the plugin works. For example for the doc plugin: </p><div class="fragment"><div class="line">Plugin * ELEKTRA_PLUGIN_EXPORT</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// clang-format off</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__plugin.html#ga8dd092048e972a3f0c9c9f54eb41576e">elektraPluginExport</a>(DOC_PLUGIN_NAME,</div>
<div class="line">                <a class="code" href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814ab7e2dcc6e79af21dd90d2bb62920551d">ELEKTRA_PLUGIN_OPEN</a>,    &amp;<a class="code" href="group__plugin.html#ga23c2eb3584e38a4d494eb8f91e5e3d8d">elektraDocOpen</a>,</div>
<div class="line">                <a class="code" href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a449e166b322550b3ad26efd4c46e49e3">ELEKTRA_PLUGIN_CLOSE</a>,   &amp;<a class="code" href="group__plugin.html#ga1236aefe5b2baf8b7bf636ba5aa9ea29">elektraDocClose</a>,</div>
<div class="line">                <a class="code" href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a3d5f4a887e68878f1cc3a75985194204">ELEKTRA_PLUGIN_GET</a>,     &amp;<a class="code" href="group__plugin.html#gacb69f3441c6d84241b4362f958fbe313">elektraDocGet</a>,</div>
<div class="line">                <a class="code" href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a85c9545261cf0bcc932616e67ea3b70a">ELEKTRA_PLUGIN_SET</a>,     &amp;<a class="code" href="group__plugin.html#gae65781a1deb34efc79c8cb9d9174842c">elektraDocSet</a>,</div>
<div class="line">                <a class="code" href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a89e027283d949dd78bb9c1fce1b19a10">ELEKTRA_PLUGIN_ERROR</a>,   &amp;<a class="code" href="group__plugin.html#gad74b35f558ac7c3262f6069c5c47dc79">elektraDocError</a>,</div>
<div class="line">                <a class="code" href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814ad8ebee0e9b492518a042e5203336eca9">ELEKTRA_PLUGIN_COMMIT</a>,  &amp;<a class="code" href="group__plugin.html#ga52807469897b8acbada5bcc6b8c8ceab">elektraDocCommit</a>,</div>
<div class="line">                <a class="code" href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a64a0bc789482284d9fd27ce974e0959a">ELEKTRA_PLUGIN_END</a>);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__plugin_html_ga8dd092048e972a3f0c9c9f54eb41576e"><div class="ttname"><a href="group__plugin.html#ga8dd092048e972a3f0c9c9f54eb41576e">elektraPluginExport</a></div><div class="ttdeci">Plugin * elektraPluginExport(const char *pluginName,...)</div><div class="ttdoc">Allows one to Export Methods for a Plugin.</div><div class="ttdef"><b>Definition:</b> plugin/plugin.c:55</div></div>
<div class="ttc" id="akdbplugin_8h_html_afed89ef026fb0622918a5de020de7814a3d5f4a887e68878f1cc3a75985194204"><div class="ttname"><a href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a3d5f4a887e68878f1cc3a75985194204">ELEKTRA_PLUGIN_GET</a></div><div class="ttdeci">@ ELEKTRA_PLUGIN_GET</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:71</div></div>
<div class="ttc" id="akdbplugin_8h_html_afed89ef026fb0622918a5de020de7814a449e166b322550b3ad26efd4c46e49e3"><div class="ttname"><a href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a449e166b322550b3ad26efd4c46e49e3">ELEKTRA_PLUGIN_CLOSE</a></div><div class="ttdeci">@ ELEKTRA_PLUGIN_CLOSE</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:70</div></div>
<div class="ttc" id="akdbplugin_8h_html_afed89ef026fb0622918a5de020de7814a64a0bc789482284d9fd27ce974e0959a"><div class="ttname"><a href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a64a0bc789482284d9fd27ce974e0959a">ELEKTRA_PLUGIN_END</a></div><div class="ttdeci">@ ELEKTRA_PLUGIN_END</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:75</div></div>
<div class="ttc" id="akdbplugin_8h_html_afed89ef026fb0622918a5de020de7814a85c9545261cf0bcc932616e67ea3b70a"><div class="ttname"><a href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a85c9545261cf0bcc932616e67ea3b70a">ELEKTRA_PLUGIN_SET</a></div><div class="ttdeci">@ ELEKTRA_PLUGIN_SET</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:72</div></div>
<div class="ttc" id="akdbplugin_8h_html_afed89ef026fb0622918a5de020de7814a89e027283d949dd78bb9c1fce1b19a10"><div class="ttname"><a href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814a89e027283d949dd78bb9c1fce1b19a10">ELEKTRA_PLUGIN_ERROR</a></div><div class="ttdeci">@ ELEKTRA_PLUGIN_ERROR</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:73</div></div>
<div class="ttc" id="akdbplugin_8h_html_afed89ef026fb0622918a5de020de7814ab7e2dcc6e79af21dd90d2bb62920551d"><div class="ttname"><a href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814ab7e2dcc6e79af21dd90d2bb62920551d">ELEKTRA_PLUGIN_OPEN</a></div><div class="ttdeci">@ ELEKTRA_PLUGIN_OPEN</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:69</div></div>
<div class="ttc" id="akdbplugin_8h_html_afed89ef026fb0622918a5de020de7814ad8ebee0e9b492518a042e5203336eca9"><div class="ttname"><a href="kdbplugin_8h.html#afed89ef026fb0622918a5de020de7814ad8ebee0e9b492518a042e5203336eca9">ELEKTRA_PLUGIN_COMMIT</a></div><div class="ttdeci">@ ELEKTRA_PLUGIN_COMMIT</div><div class="ttdef"><b>Definition:</b> kdbplugin.h:74</div></div>
</div><!-- fragment --><p> The first parameter is the name of the plugin. Then every plugin should have: <code>ELEKTRA_PLUGIN_OPEN</code>, <code>ELEKTRA_PLUGIN_CLOSE</code>, <code>ELEKTRA_PLUGIN_GET</code>, <code>ELEKTRA_PLUGIN_SET</code> and optionally <code>ELEKTRA_PLUGIN_ERROR</code> and <code>ELEKTRA_PLUGIN_COMMIT</code>.</p>
<p>The list is terminated with <code>ELEKTRA_PLUGIN_END</code>.</p>
<p>You must use static "char arrays" in a read only segment. Don't allocate storage, it won't be freed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pluginName</td><td>the name of this plugin </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an object that contains all plugin information needed by libelektra.so </dd></dl>

</div>
</div>
<a id="ga644bead796506c172817724051c977c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga644bead796506c172817724051c977c9">&#9670;&nbsp;</a></span>elektraPluginGetConfig()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">KeySet* elektraPluginGetConfig </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the configuration of that plugin. </p>
<ul>
<li>The user:/ config holds plugin specific configuration</li>
<li>The system:/ config holds backend specific configuration</li>
</ul>
<p>So prefer cascading lookups to honor both.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>a pointer to the plugin</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>keyset to the configuration for that plugin </dd></dl>

</div>
</div>
<a id="gaafcf3216b46292f222b8cc7828b4dd20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaafcf3216b46292f222b8cc7828b4dd20">&#9670;&nbsp;</a></span>elektraPluginGetData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* elektraPluginGetData </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>plugin</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a pointer to the plugin specific data stored before. </p>
<p>If <a class="el" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2" title="Store a pointer to plugin specific data.">elektraPluginSetData()</a> was not called earlier, NULL will be returned.</p>
<p>This data is private to one instance of a plugin.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__plugin.html#gaf4b941a52ff55d0ca2a9158d90208ef2" title="Store a pointer to plugin specific data.">elektraPluginSetData</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">plugin</td><td>a pointer to the plugin </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to the data </dd></dl>

</div>
</div>
<a id="ga436cda13ed70c0face08661a90620bf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga436cda13ed70c0face08661a90620bf6">&#9670;&nbsp;</a></span>elektraPluginGetGlobalKeySet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">KeySet* elektraPluginGetGlobalKeySet </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>plugin</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a pointer to the global keyset. </p>
<p>Initialized for all plugins by the KDB, except for manually created plugins with <code><a class="el" href="elektra_2plugin_8c.html#a32a70a7876542c51d153164ac5108a57" title="Opens a plugin.">elektraPluginOpen()</a></code>. The global keyset is tied to a KDB handle, initialized on <code><a class="el" href="group__kdb.html#ga844e1299a84c3fbf1d3a905c5c893ba5" title="Opens the session with the Key database.">kdbOpen()</a></code> and deleted on <code><a class="el" href="group__kdb.html#gadb54dc9fda17ee07deb9444df745c96f" title="Closes the session with the Key database.">kdbClose()</a></code>.</p>
<p>Plugins using this keyset are responsible for cleaning up their parts of the keyset which they do not need any more.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">plugin</td><td>a pointer to the plugin </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to the global keyset </dd></dl>

</div>
</div>
<a id="gaf4b941a52ff55d0ca2a9158d90208ef2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf4b941a52ff55d0ca2a9158d90208ef2">&#9670;&nbsp;</a></span>elektraPluginSetData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void elektraPluginSetData </td>
          <td>(</td>
          <td class="paramtype">Plugin *&#160;</td>
          <td class="paramname"><em>plugin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store a pointer to plugin specific data. </p>
<p>This data is private to one instance of a plugin.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__plugin.html#gaafcf3216b46292f222b8cc7828b4dd20" title="Get a pointer to the plugin specific data stored before.">elektraPluginGetData</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">plugin</td><td>a pointer to the plugin </td></tr>
    <tr><td class="paramname">data</td><td>the pointer to the data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

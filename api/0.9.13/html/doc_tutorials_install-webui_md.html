<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: elektra-web</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- Add mermaid.js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_color_doxygen.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Elektra<span id="projectnumber">&#160;0.9.13</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">elektra-web </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_tutorials_install_webui"></a> <em>an API and web user interface to remotely manage Elektra instances</em></p>
<p>The configuration view of elektra-web is similar to the tree view of the <a href="https://master.libelektra.org/src/tools/qt-gui">qt-gui</a>, but with dynamic fields rendered via key metadata.</p>
<h1><a class="anchor" id="autotoc_md4306"></a>
Dependencies</h1>
<p>Elektra-web requires:</p>
<ul>
<li><a href="https://libelektra.org/">Elektra</a> with the <a href="https://master.libelektra.org/src/plugins/yajl/"><code>yajl</code> plugin</a> installed</li>
<li>A recent <a href="https://nodejs.org/en/">node.js</a> installation (at least 6.x)</li>
<li><a href="https://go.dev/">Go</a> with version &gt; 1.13</li>
</ul>
<h1><a class="anchor" id="autotoc_md4307"></a>
Building with elektra-web Tool</h1>
<p>To build Elektra with the elektra-web tool:</p>
<ul>
<li>Install Node.js, Go and dependencies for <code>yajl</code> plugin (see links above)</li>
<li>Configure libelektra build with the elektra-web tool, e.g. <code>cmake .. -DTOOLS="kdb;web"</code></li>
<li>Build libelektra: <code>make</code></li>
<li>Install libelektra: <code>sudo make install</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md4308"></a>
Getting Started</h1>
<ul>
<li>Start an elektrad instance: <code>kdb run-elektrad</code></li>
<li>Start the client: <code>kdb run-webd</code></li>
<li>You can now access the client on: <a href="http://localhost:33334">http://localhost:33334</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md4309"></a>
Getting Started (docker)</h1>
<ul>
<li>Create and run a new docker container: <code>docker run -d -it -p 33333:33333 -p 33334:33334 elektra/web</code></li>
<li>You can now access the client on: <a href="http://localhost:33334">http://localhost:33334</a></li>
<li>You can also build it yourself in <code>scripts/docker/webui/</code> (see <a href="#building-docker-image">Building Docker Image</a>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md4310"></a>
Running from source</h1>
<ul>
<li>Install dependencies (see above)</li>
<li>Clone libelektra repo and <code>cd libelektra/src/tools/web</code></li>
<li>Install and start an elektrad instance:<ul>
<li><code>cd elektrad</code></li>
<li><code>go build</code></li>
<li><code>./elektrad</code> (replaces <code>kdb run-elektrad</code>)</li>
</ul>
</li>
<li>Install and start the client (connects to the elektrad instance):<ul>
<li><code>cd webui</code></li>
<li><code>npm install</code></li>
<li><code>npm start</code> (replaces <code>kdb run-webd</code>)</li>
</ul>
</li>
<li>You can now access the client on: <a href="http://localhost:33334">http://localhost:33334</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md4311"></a>
Use-cases</h1>
<h2><a class="anchor" id="autotoc_md4312"></a>
Running elektra-web on a Single Instance</h2>
<p>If you do not want to configure multiple instances, you can set the <code>INSTANCE</code> environment variable to the server you want to configure. You can also set <code>user:/sw/elektra/web/#0/current/instance</code> to the host. Make sure to enter a full HTTP URL, e.g. <code><a href="http://localhost:33333">http://localhost:33333</a></code>.</p>
<p>If this configuration option is set, elektra-web will load the configuration page for that instance instead of the main overview page.</p>
<p>If you want to host elektra-web with the client and elektrad on the same instance, you must first start elektrad via <code>kdb run-elektrad</code>. Afterwards, you can run the client with:</p>
<div class="fragment"><div class="line">INSTANCE=&quot;http://localhost:33333&quot; kdb run-webd</div>
</div><!-- fragment --><p>It is also possible to set visibility by prefixing the host with <code>VISIBILITY@</code>.</p>
<p>For example (<code>advanced</code> visibility, <code>user</code> is default):</p>
<div class="fragment"><div class="line">INSTANCE=&quot;advanced@http://localhost:33333&quot; kdb run-webd</div>
</div><!-- fragment --><p>Now, when you open <a href="http://localhost:33334">http://localhost:33334</a> in your browser, the configuration page for the instance will be opened immediately.</p>
<h1><a class="anchor" id="autotoc_md4313"></a>
Overview</h1>
<p>Elektra web consists of multiple components:</p>
<ul>
<li>(multiple) servers running an elektra daemon (`elektrad`)</li>
<li>a single server to communicate with the elektra daemons and serve the client (`webd`)</li>
<li>a web browser that accesses the client (Web UI) on the `webd` server (`client`)</li>
</ul>
<p><img src="https://cdn.rawgit.com/ElektraInitiative/libelektra/master/doc/images/network_structure.png" alt="https://cdn.rawgit.com/ElektraInitiative/libelektra/master/doc/images/network_structure.png" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md4314"></a>
API</h1>
<p><img src="https://cdn.rawgit.com/ElektraInitiative/libelektra/master/doc/images/daemon_structure.png" alt="https://cdn.rawgit.com/ElektraInitiative/libelektra/master/doc/images/daemon_structure.png" class="inline"/></p>
<p><a href="https://apiblueprint.org/">API blueprints</a> are available for both APIs:</p>
<ul>
<li><a href="https://master.libelektra.org/doc/api_blueprints/elektrad.apib">elektrad</a>, documentation: <a href="https://elektrad.docs.apiary.io/">https://elektrad.docs.apiary.io/</a></li>
<li><a href="https://master.libelektra.org/doc/api_blueprints/webd.apib">webd</a>, documentation: <a href="https://elektrawebd.docs.apiary.io/">https://elektrawebd.docs.apiary.io/</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md4315"></a>
Test REST API on localhost</h1>
<p>In order to test the API on localhost, you have to start an elektrad instance. This is possible in two ways:</p>
<ul>
<li>manually (recommended if you would like to control elektrad manually or the eletrad-web tool is not installed)</li>
</ul>
<div class="fragment"><div class="line">cd libelektra/src/tools/web</div>
<div class="line">cd elektrad</div>
<div class="line">go build</div>
<div class="line">./elektrad</div>
</div><!-- fragment --><ul>
<li>by installing elektrad tool together with Elektra (see section <a href="#building-with-elektra-web-tool">Building with elektra-web Tool</a>)</li>
</ul>
<p>Now the server is running on <a href="http://localhost:33333">http://localhost:33333</a>. After that you can test the API with help of Postman or similar tools that allow sending REST API requests.</p>
<p><b>Additional note</b>: It is recommended to install the elektrad tool rather than starting the server manually. When Elektra is installed, the <code>kdb</code> command together with its tools is installed globally. For instance, whenever you would like to write a shell script which has to start a REST API server, you can just add <code>kdb run-elektrad</code> and execute it locally.</p>
<p>Examples:</p>
<p>First create a new key-value pair <code>user:/test</code> and set its value to 5. This can be done</p>
<ul>
<li>using the command line <div class="fragment"><div class="line">kdb set user:/test 5</div>
</div><!-- fragment --></li>
<li>through the rest API using curl <div class="fragment"><div class="line">curl -X PUT -H &quot;Content-Type: text/plain&quot; --data &quot;5&quot; http://localhost:33333/kdb/user/test</div>
</div><!-- fragment --></li>
</ul>
<p>The output of the commandline tool will be <code>Set string to "5"</code> if the key did not exist before. If the specified key didn't exist before, then the output will be <code>Create a new key user:/test with string "5"</code>. Elektrad will respond with code <code>200</code>.</p>
<p>The command</p>
<div class="fragment"><div class="line">curl http://localhost:33333/kdb/user/test</div>
<div class="line">#&gt; {&quot;exists&quot;:true,&quot;name&quot;:&quot;test&quot;,&quot;path&quot;:&quot;user/test&quot;,&quot;ls&quot;:[&quot;user/test&quot;],&quot;value&quot;:&quot;5&quot;,&quot;meta&quot;:&quot;&quot;}</div>
</div><!-- fragment --><p>will now return the value of the specified key <code>user:/test</code>, which is stored in the database.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;exists&quot;: true,</div>
<div class="line">    &quot;name&quot;: &quot;test&quot;,</div>
<div class="line">    &quot;path&quot;: &quot;user:/test&quot;,</div>
<div class="line">    &quot;ls&quot;: [</div>
<div class="line">        &quot;user:/test&quot;</div>
<div class="line">    ],</div>
<div class="line">    &quot;value&quot;: &quot;5&quot;,</div>
<div class="line">    &quot;meta&quot;: &quot;&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4316"></a>
Auth</h1>
<p>Currently, webd does not support authentication. The best way to work around this is to use a reverse proxy (e.g. <a href="https://www.nginx.com/resources/admin-guide/reverse-proxy/">nginx reverse proxy</a>).</p>
<p>Once you set up a reverse proxy on your web server, you can use it to authenticate users, e.g. by <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-password-authentication-with-nginx-on-ubuntu-14-04">username/password auth</a></p>
<h1><a class="anchor" id="autotoc_md4317"></a>
Code Structure</h1>
<p><code>elektrad/</code> - contains the daemon to interact with a single elektra instance <br  />
 <code>webd/</code> - contains a daemon to serve the client and interact with multiple elektra instances</p>
<p><code>webui/</code> - contains the elektra-web client (Web UI)</p>
<ul>
<li><code>src/actions/</code> - Redux actions to access the KDB or display notifications in the UI</li>
<li><code>src/components/</code> - React components<ul>
<li><code>pages/</code> - pages in the app<ul>
<li><code>Home.jsx</code> - the main page (overview of all instances)</li>
<li><code>Configuration.jsx</code> - configuration page (single instance)</li>
</ul>
</li>
<li><code>TreeItem/</code> - contains all UI components related to a single item in the tree view<ul>
<li><code>dialogs/</code> - these dialogs are opened when certain actions are pressed (icons next to the tree items)<ul>
<li><code>AddDialog.jsx</code> - dialog to create a new (sub-)key</li>
<li><code>DuplicateDialog.jsx</code> - dialog to duplicate a key</li>
<li><code>EditDialog.jsx</code> - dialog to edit a key value</li>
<li><code>RemoveDialog.jsx</code> - dialog to confirm the removal of a key</li>
<li><code>SettingsDialog.jsx</code> - dialog to edit metadata (new metadata can be implemented here)</li>
<li><code>*SubDialog.jsx</code> - sub-dialogs of the SettingsDialog</li>
</ul>
</li>
<li><code>fields/</code> - special input fields to display various values</li>
</ul>
</li>
<li><code>App.jsx</code> - defines app structure and routes</li>
</ul>
</li>
<li><code>src/index.js</code> - main entry point of the app (fetches instances and renders UI)</li>
<li><code>src/containers/</code> - contains components that are connected to Redux</li>
<li><code>src/css/</code> - contains CSS styles</li>
<li><code>src/reducers/</code> - contains Redux reducers (used to process actions)</li>
</ul>
<h1><a class="anchor" id="autotoc_md4318"></a>
Development Guides</h1>
<h2><a class="anchor" id="autotoc_md4319"></a>
Updating Dependencies</h2>
<p>Lockfiles (<code>package-lock.json</code>) can be updated by simply deleting the current lock file and running <code>npm install</code>, which creates a new lock file.</p>
<p>Check for outdated dependencies via <code>npm outdated</code>. Dependencies can then be updated by running <code>npm update</code>.</p>
<h2><a class="anchor" id="autotoc_md4320"></a>
Building Docker Image</h2>
<p>Run the following command in the <code>scripts/docker/web/</code> directory, replacing <code>1.5.0</code> with the latest version:</p>
<div class="fragment"><div class="line">docker build -t elektra/web:1.5.0 -t elektra/web:latest .</div>
</div><!-- fragment --><p>Test the image:</p>
<div class="fragment"><div class="line">docker run -d -it -p 33333:33333 -p 33334:33334 elektra/web:1.5.0</div>
</div><!-- fragment --><p>Publish it to the docker registry:</p>
<div class="fragment"><div class="line">docker push elektra/web:1.5.0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4321"></a>
Adding Support for New Metadata</h2>
<ul>
<li>Create a new sub dialog by, for example, copying the <code>NumberSubDialog.jsx</code> file (or similar) to a new file in the <code>webui/src/components/TreeItem/dialogs</code> folder.</li>
<li>Include the sub dialog by adding it to the <code>SettingsDialog.jsx</code> file in the same folder. For example, it could be added before the AdditionalMetakeysSubDialog at the end of the file:</li>
</ul>
<div class="fragment"><div class="line">+     &lt;NewSubDialog</div>
<div class="line">+       onChange={this.handleEdit(&#39;check/something&#39;)}</div>
<div class="line">+       value={this.getMeta(&#39;check/something&#39;, &#39;&#39;)}</div>
<div class="line">+       saved={this.getSaved(&#39;check/something&#39;)}</div>
<div class="line">+     /&gt;</div>
<div class="line">      &lt;AdditionalMetakeysSubDialog</div>
<div class="line">        handleEdit={this.handleEdit.bind(this)}</div>
<div class="line">        getMeta={this.getMeta.bind(this)}</div>
<div class="line">        getSaved={this.getSaved.bind(this)}</div>
<div class="line">        meta={this.props.meta}</div>
<div class="line">        deleteMeta={this.props.deleteMeta}</div>
<div class="line">      /&gt;</div>
<div class="line">    &lt;/FocusTrapDialog&gt;</div>
</div><!-- fragment --><ul>
<li>Mark the meta keys as handled by adding them to the <code>HANDLED_METADATA</code> array in <code>webui/src/components/TreeItem/dialogs/utils.js</code>:</li>
</ul>
<div class="fragment"><div class="line">export const HANDLED_METADATA = [</div>
<div class="line">  ...,</div>
<div class="line">  &#39;visibility&#39;,</div>
<div class="line">  &#39;binary&#39;,</div>
<div class="line">+ &#39;check/something&#39;,</div>
<div class="line">]</div>
</div><!-- fragment --><ul>
<li>Validation can then be added by handling metadata in the <code>webui/src/components/TreeItem/fields/validateType.js</code> file to the <code>validateType</code> function.</li>
<li>Rendering fields in a special way when certain metakeys are present can be done by adjusting the <code>renderSpecialValue</code> function in the <code>webui/src/components/TreeItem/index.js</code> file. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark'
  });
</script>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Elektrify LCDproc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.9</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Elektrify LCDproc </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_news_2017_03_18_lcdproc"></a></p><ul>
<li>guid: d52657b5-60da-4a21-9679-f8aacf6d6b72</li>
<li>author: Markus Raab</li>
<li>pubDate: Sat, 18 Mar 2017 20:43:03 +0100</li>
<li>shortDesc: Elektrify LCDproc</li>
</ul>
<blockquote class="doxtable">
<p>LCDproc is a piece of open source software that displays real-time system information from your <code>Linux</code>/<code>*BSD</code> box on a LCD. </p>
</blockquote>
<p>LCDproc's <a href="http://lcdproc.omnipotent.net/">website</a> is a bit outdated but LCDproc itself is now well-maintained on <a href="https://github.com/lcdproc/lcdproc">GitHub</a> and had a <a href="https://github.com/lcdproc/lcdproc/releases">release recently</a>.</p>
<p>Like in many projects, it invented its own configuration access and INI parser which did not evolve with the needs of the project. As a consequence inconsistencies and code duplication spread over the source. For example, the LCDproc configuration access does not support values that represent display's size (such as <code>20x4</code>). Thus every LCDproc's module has its own parsing code for such values.</p>
<p>Some days ago (16.03.2017), we met with Harald Geyer and discussed the current situation. We decided that we will elektrify LCDproc and remove all the configuration access and parsing code within LCDproc. To <b>elektrify</b> an application means to change the application so that it uses LibElektra afterwards.</p>
<h1><a class="anchor" id="autotoc_md2984"></a>
Goals</h1>
<p>We formulated three goals:</p>
<ol type="1">
<li>We (Elektra Initiative, mainly Thomas Waser) remove as much code as possible from LCDproc's code base.</li>
<li>Users of LCDproc should be able to use <code>LCDd.conf</code> as they use it now.</li>
<li>We avoid the current duplications of configuration specifications. (Currently in <code>LCDd.conf</code>, the docbook, in code checking the limits, and the default parameter in the code.)</li>
</ol>
<p>Nice-to-have is:</p>
<ul>
<li>Safe updates: <code>make install</code> should not break the current <code>LCDd.conf</code>. (As it is already done in Debian.)</li>
<li>The robustness of LCDproc on misconfiguration should be improved (Thomas Waser writes the specification).</li>
<li>Automatic reloading of the daemon when using Elektra to update configuration. (Manual <code>SIGHUP</code>-signals will work in any case.)</li>
<li>Have physical units with metric prefix like <code>500ms</code> for <code>0.5s</code> (seconds).</li>
</ul>
<p>Possible limitations are:</p>
<ul>
<li>We break support for systems that only have very old compilers.</li>
<li>The <code>-c</code> option to specify a different configuration file is against the abstraction Elektra should deliver. We might create a <a href="https://github.com/ElektraInitiative/libelektra/issues/1416">wrapper script</a> that emulates <code>-c</code> via mountpoints.</li>
<li>LCDproc will depend on the yet-to-be-released <a href="https://github.com/ElektraInitiative/libelektra/milestone/11">0.8.20</a>. We will delay the 0.8.20 release until all parts for LCDproc are tested and ready.</li>
</ul>
<p>In any case, the <a href="https://www.libelektra.org">advertised benefits of Elektra</a> will automatically apply (incomplete list):</p>
<ul>
<li>Global key database: you can connect other configuration files with the LCDproc's configuration and validation.</li>
<li>Allows users to easily modify the specifications, for example to have different command-line options, or support for environment variables.</li>
<li><a href="https://www.libelektra.org/plugins/profile">Profile support</a>: Having multiple complete configuration settings you can easily choose from. (thanks to Thomas Waser)</li>
<li>Introspectibility: you can check with <code>kdb</code>-tool which configuration settings LCDproc will receive.</li>
<li>Other configuration file formats can be used instead, e.g. JSON or XML. (Only if wanted as personal preference, by default INI will be used to remain compatibility with <code>LCDd.conf</code>.)</li>
<li>Easy migration paths to use other configuration file formats such as YAML as default in future. (thanks to René Schwaiger)</li>
<li>Elektra's tool can be used to configure LCDconf, including:<ul>
<li><code>kdb set</code> to modify individual settings within scripts and validation.</li>
<li><code>kdb editor</code>, which spawns your favourite editor but validates the configuration file before writing it out.</li>
<li><code>kdb qt-gui</code>, the Qt GUI (thanks to Raffael Pancheri).</li>
<li>The web UI of Elektra (thanks to Daniel Bugl).</li>
</ul>
</li>
<li>Elektra's website can be used to share LCDproc's configuration files, and you can use the <a href="https://www.libelektra.org/plugins/curlget">curlget plugin</a> to mount files from the website. (thanks to Marvin Mall)</li>
<li>You can use Shell, Python, or Lua to write small scripts that are executed on configuration access.</li>
<li>Elektra allows you to directly read and write from git using the <a href="https://www.libelektra.org/plugins/gitresolver">git plugin</a>. (Even if <code>LCDd.conf</code> is not checked out, thanks to Thomas Waser)</li>
<li>We extensively <a href="https://www.libelektra.org/devgettingstarted/testing">test</a> Elektra with modern techniques such as fuzzing.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2985"></a>
Validation</h1>
<p>Instead of <code>if</code>s within the code, we will use SpecElektra for validation. <a href="https://www.libelektra.org/manpages/elektra-glossary">SpecElektra</a> is a configuration specification language that allows us to describe which configuration is valid.</p>
<p>This specification will be installed as part of LCDproc to <code>/usr/share/elektra/specifications</code>. It uses the <a href="https://www.libelektra.org/docgettingstarted/metadata">metadata</a> as defined by the plugins to validate configuration changed via Elektra.</p>
<p>For broken installations or when executing LCDproc from the source repository, there is also a built-in specification. The specification will only be used if the installed one cannot be found.</p>
<p>Thus the configuration validation specification is a normal configuration file also integrated in Elektra, also the specification can be introspected: useful for system administrators who want to know about valid entries, but also for tools like our newly developed web-UI by Daniel Bugl.</p>
<p>The web-UI automatically restricts the interface so that only valid entries can be entered. For example, if you should enter a boolean, only a check box is presented to you.</p>
<ul>
<li>For more information about validation, see the <a href="https://www.libelektra.org/tutorials/validate-configuration">tutorial</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md2986"></a>
Code Generation</h1>
<p>We (mainly Dominik Hofer) are currently developing <a href="https://www.libelektra.org/decisions/high-level-api">a high-level API</a>, whose first user will be LCDproc. In this API, we will make sure during compilation, that configuration access is done correctly.</p>
<p>This is especially useful when configuration settings get renamed. Then all places where out-dated configuration settings are used will fail to compile.</p>
<p>In particular using code generation developers do not need to use strings to refer to configuration settings and they get easy-to-use enums consistent with the configuration specification.</p>
<p>Furthermore, code generation will make sure that a specification (and default configuration settings) will be found even if no <code>/etc</code> or no <code>/usr</code> is found.</p>
<p>We also found that we cannot use code generation everywhere. In generic access code, code generation obviously is limited.</p>
<ul>
<li>For more information about code generation, see the <a href="https://www.libelektra.org/tools/gen">tutorial</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md2987"></a>
Risks</h1>
<p>Understandably, users might be concerned that such a change will not work or create problems in the future. Here we will discuss some of the concerns.</p>
<blockquote class="doxtable">
<p>Elektra might be discontinued. </p>
</blockquote>
<p>From history perspective, Elektra received steady development since 2004. Elektra is a FLOSS project and welcomes everyone to join. In the last years several people did, with an increasing number per year. Currently following people are working on substantial new features in Elektra (sorted by first name):</p>
<ul>
<li>Armin Wurzinger: Quality Improvements</li>
<li>Bernhard Denner: <a href="https://github.com/ElektraInitiative/puppet-libelektra">Puppet Module</a></li>
<li>Daniel Bugl: <a href="https://www.libelektra.org/tools/web">WebUI</a></li>
<li>Dominik Hofer: <a href="https://www.libelektra.org/decisions/high-level-api">the high-level API</a></li>
<li>Kurt Micheli: Order Preserving Minimal Hash Map</li>
<li>Markus Raab: Maintainer</li>
<li>Michael Zehender: Quality Improvements</li>
<li>Mihael Pranjić: mmap plugin</li>
<li>Peter Nirschl: <a href="https://www.libelektra.org/plugins/crypto">crypto plugin</a></li>
<li>René Schwaiger: YAML plugin</li>
<li>Sebastian Bachmann: Shell Completion</li>
<li>Thomas Waht: Notification</li>
<li>Thomas Waser: Validation and Transformations of Configuration</li>
<li>Vanessa Kos: Misconfiguration Bug Database</li>
</ul>
<p>Obviously, there are many more casual contributors.</p>
<p>Elektra has a large set of <a href="https://build.libelektra.org">automated tests</a> and only a small amount of technical dept. Elektra has no required external dependencies except libc. So without internal changes, only minimal maintenance cost is required.</p>
<blockquote class="doxtable">
<p>Elektra is unfinished. </p>
</blockquote>
<p>Technically this is true: we did not reach <a href="https://git.libelektra.org/milestone/12">1.0</a>. We are, however, on track to reach this goal within this summer. Now is the best time to join because we can provide more support and are more flexible for changes and wishes.</p>
<p>Some <a href="https://www.libelektra.org/news/2016-06-14_0.8.17.md">time ago</a> we asked in a survey in which direction Elektra should develop. Most open issues are (in)direct responses from this wanted direction.</p>
<p>Some plugins are experimental or proof-of-concept, but they are clearly marked as such.</p>
<blockquote class="doxtable">
<p>It seems a bit to me like <a href="https://xkcd.com/927/">xkcd: Standards</a>. </p>
</blockquote>
<p>Elektra does not invent a new configuration file format nor new standards where to store configuration files but abstracts over these issues.</p>
<blockquote class="doxtable">
<p>Elektra not being available in my distribution. </p>
</blockquote>
<p>For the following Linux Distributions Elektra 0.8 packages are available:</p>
<ul>
<li>Gentoo</li>
<li><a href="https://aur.archlinux.org/packages/elektra/">Arch Linux</a></li>
<li><a href="https://packages.debian.org/de/jessie/libelektra4">Debian</a></li>
<li><a href="https://launchpad.net/ubuntu/+source/elektra">Ubuntu</a></li>
<li><a href="https://software.opensuse.org/package/elektra">OpenSuse</a></li>
<li>PLDLinux</li>
<li><a href="https://community.linuxmint.com/software/view/elektra-bin">Linux Mint</a></li>
<li><a href="https://openwrt.org/packages/pkgdata/libelektra-core?s[]=elektra">OpenWRT</a></li>
</ul>
<p>See <a href="https://www.libelektra.org/docgettingstarted/installation">INSTALL</a> for the complete and up-to-date list.</p>
<blockquote class="doxtable">
<p>If Elektra does not take off and achieve world dominance, will we be worse off than before? </p>
</blockquote>
<p>Making sure that projects will not be worse off is what we did the last years: Not only offer an API and wait for world dominance but to offer an implementation that can compete with any configuration library out there. We are not completely there yet (there are some details where specific other libraries are better than Elektra in specific points) but these are not points that the current configuration system of LCDproc supports (not even close). And the libraries that can compete with Elektra have a completely different level on which dependencies they have: Elektra is the only one only requiring libc.</p>
<blockquote class="doxtable">
<p>Do we retain the old way of configuring things, i.e. manually editing an ini file in /etc? </p>
</blockquote>
<p>Absolutely, you can think of libelektra as a small library in C that reads a configuration file and returns a data structure if you do not use any of its advanced features.</p>
<blockquote class="doxtable">
<p>Do we retain the old way reloading/restarting the system service? </p>
</blockquote>
<p>Elektra does not interfere with restarting. It is a passive library. It provides some techniques for reloading but they are optional (but we recommend that you keep the in-memory and persistent configuration in sync via notification).</p>
<p>For more information, see the <a href="https://www.libelektra.org/manpages/elektra-faq">FAQ</a>.</p>
<h1><a class="anchor" id="autotoc_md2988"></a>
Win-Win</h1>
<p>We can both profit from it:</p>
<ol type="1">
<li>For LCDproc it will be a simplification of code while getting many more tools.</li>
<li>For Elektra it will improve its adoption and packaging.</li>
</ol>
<p>For oyranos it already worked well on both sides, see our discussions in the issue tracker, for example <a href="https://issues.libelektra.org/1134">#1134</a>.</p>
<p>If you also maintain an free or open source (FLOSS) project with an out-dated configuration system, please contact us.</p>
<p>Obviously, we cannot fully port every FLOSS project ourselves, instead we will handle requests on a first come, first serve basis. Earlier projects will also have an higher impact on the feature set of Elektra, thus you will less likely need to implement your own plugin.</p>
<h1><a class="anchor" id="autotoc_md2989"></a>
See Also</h1>
<ul>
<li>Progress can be viewed <a href="https://git.libelektra.org/projects/7">here</a></li>
<li>We discussed about alternatives to Elektra <a href="https://issues.libelektra.org/1266">here</a>.</li>
</ul>
<p>Best regards, Markus </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>

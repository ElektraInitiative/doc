<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elektra: Benchmarking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elektra
   &#160;<span id="projectnumber">0.9.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Benchmarking </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_tutorials_benchmarking"></a> </p>
<h1><a class="anchor" id="autotoc_md3728"></a>
Execution Time</h1>
<p>One of the usual questions for a standard benchmark is, how much more or less time two or more different programs take to execute on the same hardware. This tutorial will introduce some tools and techniques that will help you to answer this question. For that purpose we compare the time it takes for certain YAML <a class="el" href="doc_tutorials_storage-plugins_md.html">storage plugins</a> to translate YAML data into Elektra’s key set structure. Most of the techniques we describe here should be applicable too, if you want to compare the run-time of other parts of Elektra. If you want to know why a certain part of Elektra takes a long time to execute, then you might also be interested in the <a class="el" href="doc_tutorials_profiling_md.html">profiling tutorial</a>.</p>
<h2><a class="anchor" id="autotoc_md3729"></a>
Translating Elektra</h2>
<p>If you have never translated the code base of Elektra before, then please take a look <a class="el" href="doc_COMPILE_md.html">here</a> before you continue.</p>
<p>Usually you want to compare the execution time of the fastest version of a compiled binary. For that purpose it makes sense to change the CMake build type to <code>Release</code>, which means that the generated build system will optimize the code and strip debug symbols. You should also disable the logger and debug code. An example CMake command that uses <a href="https://ninja-build.org">Ninja</a> as build tool could look like this:</p>
<div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake -GNinja ..                 \</div>
<div class="line">      -DCMAKE_BUILD_TYPE=Release \</div>
<div class="line">      -DENABLE_LOGGER=OFF        \</div>
<div class="line">      -DENABLE_DEBUG=OFF         \</div>
<div class="line">      -DPLUGINS=ALL</div>
<div class="line">ninja</div>
<div class="line">cd .. # Change working directory back to the root of repository</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3730"></a>
Using the Plugin Benchmark Helper Tool</h2>
<p>Elektra already includes a tool that helps you to benchmark the <code>get</code> and <code>set</code> methods of a certain <a class="el" href="doc_tutorials_plugins_md.html">plugin</a> called `benchmark_plugingetset`. To show you how to use <code>benchmark_plugingetset</code>, we create a file named <code>test.yamlcpp.in</code> with the following content:</p>
<div class="fragment"><div class="line">- You,</div>
<div class="line">- Me, &amp;</div>
<div class="line">- The Violence</div>
</div><!-- fragment --><p>and save it in the folder <code>benchmarks/data</code>:</p>
<div class="fragment"><div class="line">mkdir -p benchmarks/data</div>
<div class="line">printf -- &#39;- You,\n&#39;       &gt;  benchmarks/data/test.yamlcpp.in</div>
<div class="line">printf -- &#39;- Me, &amp;\n&#39;      &gt;&gt; benchmarks/data/test.yamlcpp.in</div>
<div class="line">printf -- &#39;- The Violence&#39; &gt;&gt; benchmarks/data/test.yamlcpp.in</div>
</div><!-- fragment --><p>. As you can see the filename has to use the pattern:</p>
<div class="fragment"><div class="line">test.$plugin.in</div>
</div><!-- fragment --><p>, where <code>$plugin</code> specifies the name of the plugin the benchmark tool should call. We can now call the <code>get</code> method of the plugin <a class="el" href="md_src_plugins_yamlcpp_README.html">YAML CPP</a> using the following shell command</p>
<div class="fragment"><div class="line">build/bin/benchmark_plugingetset benchmarks/data      user    yamlcpp       get</div>
<div class="line">#                                       ↑              ↑        ↑           ↑</div>
<div class="line">#                                parent directory  namespace  plugin   only use `get`</div>
<div class="line">#                                 of config file                       plugin method</div>
</div><!-- fragment --><p>. If you can want you can also use the <code>time</code> utility to measure the execution time of the last command:</p>
<div class="fragment"><div class="line">time build/bin/benchmark_plugingetset benchmarks/data user yamlcpp get</div>
<div class="line">#&gt;       0.00 real         0.00 user         0.00 sys</div>
</div><!-- fragment --><p>. As you can see in the output above a real configuration file that tests the performance of the <a class="el" href="md_src_plugins_yamlcpp_README.html">YAML CPP</a> plugin should be much larger.</p>
<h2><a class="anchor" id="autotoc_md3731"></a>
Comparing Execution Times</h2>
<p>Now that you know how to execute <code>benchmark_plugingetset</code>, you can use it to compare the performance of different plugins. Since you usually want</p>
<ul>
<li>to run <code>benchmark_plugingetset</code> multiple times, and</li>
<li>compare different plugins</li>
</ul>
<p>it makes sense to use a benchmarking tool such as <a href="https://github.com/sharkdp/hyperfine">hyperfine</a> for that task. For our tutorial we assume that you copied the file <a href="https://github.com/ElektraInitiative/rawdata/blob/master/YAML/Input/keyframes.yaml"><code>keyframes.yaml</code></a> to the locations</p>
<ul>
<li><code>benchmarks/data/test.yamlcpp.in</code>, and</li>
<li><code>benchmarks/data/test.yanlr.in</code></li>
</ul>
<p>. You can do that using the following commands:</p>
<div class="fragment"><div class="line">mkdir -p benchmarks/data</div>
<div class="line">curl -L https://github.com/ElektraInitiative/rawdata/raw/master/YAML/Input/keyframes.yaml -o benchmarks/data/test.yamlcpp.in</div>
<div class="line">cp benchmarks/data/test.yamlcpp.in benchmarks/data/test.yanlr.in</div>
</div><!-- fragment --><p>. Afterwards you can use:</p>
<div class="fragment"><div class="line">hyperfine --warmup 3 &#39;build/bin/benchmark_plugingetset benchmarks/data user yamlcpp get&#39; \</div>
<div class="line">                     &#39;build/bin/benchmark_plugingetset benchmarks/data user yanlr get&#39;</div>
</div><!-- fragment --><p>to compare the performance of the plugins. The output of this benchmark would look something like this:</p>
<div class="fragment"><div class="line">Benchmark #1: build/bin/benchmark_plugingetset benchmarks/data user yamlcpp get</div>
<div class="line">  Time (mean ± σ):      18.3 ms ±   0.9 ms    [User: 15.2 ms, System: 1.4 ms]</div>
<div class="line">  Range (min … max):    17.1 ms …  21.2 ms    136 runs</div>
<div class="line"> </div>
<div class="line">Benchmark #2: build/bin/benchmark_plugingetset benchmarks/data user yanlr get</div>
<div class="line">  Time (mean ± σ):      16.2 ms ±   0.9 ms    [User: 12.7 ms, System: 1.7 ms]</div>
<div class="line">  Range (min … max):    14.8 ms …  20.0 ms    161 runs</div>
<div class="line"> </div>
<div class="line">Summary</div>
<div class="line">  &#39;build/bin/benchmark_plugingetset benchmarks/data user yanlr get&#39; ran</div>
<div class="line">    1.13 ± 0.08 times faster than &#39;build/bin/benchmark_plugingetset benchmarks/data user yamlcpp get&#39;</div>
</div><!-- fragment --><p>. You can now remove the input files and the folder <code>benchmarks/data</code>:</p>
<div class="fragment"><div class="line">rm benchmarks/data/test.yamlcpp.in</div>
<div class="line">rm benchmarks/data/test.yanlr.in</div>
<div class="line">rmdir benchmarks/data</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
